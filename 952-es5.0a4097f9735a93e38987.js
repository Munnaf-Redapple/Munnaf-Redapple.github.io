!function(){var e,t,n,i;function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(a.push(i.value),!t||a.length!==t);o=!0);}catch(u){s=!0,r=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw r}}return a}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function u(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(l){return void n(l)}s.done?t(u):Promise.resolve(u).then(i,r)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(i,r){var a=e.apply(t,n);function o(e){u(a,i,r,o,s,"next",e)}function s(e){u(a,i,r,o,s,"throw",e)}o(void 0)})}}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return h(e,arguments,b(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),f(i,e)})(e)}function h(e,t,n){return(h=y()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&f(r,n.prototype),r}).apply(null,arguments)}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){var t=y();return function(){var n,i=b(e);if(t){var r=b(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return m(this,n)}}function m(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function w(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t,n){return t&&T(e.prototype,t),n&&T(e,n),e}(self.webpackChunkmultikart=self.webpackChunkmultikart||[]).push([[952],{62057:function(e,t){"use strict";var n={update:function(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener){var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),i=function(){};window.addEventListener("testPassiveEventSupport",i,t),window.removeEventListener("testPassiveEventSupport",i,t),n.hasSupport=e}}};n.update(),t.Z=n},17090:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(83326),o=function(e){function t(){e.apply(this,arguments),this.value=null,this.hasNext=!1,this.hasCompleted=!1}return i(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),a.Subscription.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),a.Subscription.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(r.Subject);t.AsyncSubject=o},75140:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(72e3),o=function(e){function t(t){e.call(this),this._value=t}return i(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new a.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(r.Subject);t.BehaviorSubject=o},52731:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n,i){e.call(this),this.parent=t,this.outerValue=n,this.outerIndex=i,this.index=0}return i(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(84164).Subscriber);t.InnerSubscriber=r},72995:function(e,t,n){"use strict";var i=n(56437);t.Notification=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return i.Observable.of(this.value);case"E":return i.Observable.throw(this.error);case"C":return i.Observable.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},56437:function(e,t,n){"use strict";var i=n(70276),r=n(7622),a=n(61275),o=n(28187);t.Observable=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,a=r.toSubscriber(e,t,n);if(i?i.call(a,this.source):a.add(this.source||!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var n=this;if(t||(i.root.Rx&&i.root.Rx.config&&i.root.Rx.config.Promise?t=i.root.Rx.config.Promise:i.root.Promise&&(t=i.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,i){var r;r=n.subscribe(function(t){if(r)try{e(t)}catch(n){i(n),r.unsubscribe()}else e(t)},i,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[a.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:o.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(i.root.Rx&&i.root.Rx.config&&i.root.Rx.config.Promise?e=i.root.Rx.config.Promise:i.root.Promise&&(e=i.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,n){var i;t.subscribe(function(e){return i=e},function(e){return n(e)},function(){return e(i)})})},e.create=function(t){return new e(t)},e}()},89377:function(e,t){"use strict";t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},257:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(84164).Subscriber);t.OuterSubscriber=r},64336:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(37869),o=n(83326),s=n(52921),u=n(72e3),l=n(97046),c=function(e){function t(t,n,i){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY),e.call(this),this.scheduler=i,this._events=[],this._bufferSize=t<1?1:t,this._windowTime=n<1?1:n}return i(t,e),t.prototype.next=function(t){var n=this._getNow();this._events.push(new h(n,t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._trimBufferThenGetEvents(),i=this.scheduler;if(this.closed)throw new u.ObjectUnsubscribedError;this.hasError||this.isStopped?t=o.Subscription.EMPTY:(this.observers.push(e),t=new l.SubjectSubscription(this,e)),i&&e.add(e=new s.ObserveOnSubscriber(e,i));for(var r=n.length,a=0;a<r&&!e.closed;a++)e.next(n[a].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||a.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,i=this._events,r=i.length,a=0;a<r&&!(e-i[a].time<n);)a++;return r>t&&(a=Math.max(a,r-t)),a>0&&i.splice(0,a),i},t}(r.Subject);t.ReplaySubject=c;var h=function(e,t){this.time=e,this.value=t}},28412:function(e,t,n){"use strict";t.xQ=n(82503).Subject},11984:function(e,t){"use strict";t.Scheduler=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=Date.now?Date.now:function(){return+new Date},e}()},82503:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(84164),o=n(83326),s=n(72e3),u=n(97046),l=n(79903),c=function(e){function t(t){e.call(this,t),this.destination=t}return i(t,e),t}(a.Subscriber);t.SubjectSubscriber=c;var h=function(e){function t(){e.call(this),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}return i(t,e),t.prototype[l.rxSubscriber]=function(){return new c(this)},t.prototype.lift=function(e){var t=new p(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,i=t.slice(),r=0;r<n;r++)i[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new s.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),i=0;i<t;i++)n[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new s.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new s.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),o.Subscription.EMPTY):this.isStopped?(e.complete(),o.Subscription.EMPTY):(this.observers.push(e),new u.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new r.Observable;return e.source=this,e},t.create=function(e,t){return new p(e,t)},t}(r.Observable);t.Subject=h;var p=function(e){function t(t,n){e.call(this),this.destination=t,this.source=n}return i(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):o.Subscription.EMPTY},t}(h);t.AnonymousSubject=p},97046:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n){e.call(this),this.subject=t,this.subscriber=n,this.closed=!1}return i(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(83326).Subscription);t.SubjectSubscription=r},84164:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(8398),a=n(83326),o=n(89377),s=n(79903),u=function(e){function t(t,n,i){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=o.empty;break;case 1:if(!t){this.destination=o.empty;break}if("object"==typeof t){if(c(t)){var r=t[s.rxSubscriber]();this.syncErrorThrowable=r.syncErrorThrowable,this.destination=r,r.add(this)}else this.syncErrorThrowable=!0,this.destination=new l(this,t);break}default:this.syncErrorThrowable=!0,this.destination=new l(this,t,n,i)}}return i(t,e),t.prototype[s.rxSubscriber]=function(){return this},t.create=function(e,n,i){var r=new t(e,n,i);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(a.Subscription);t.Subscriber=u;var l=function(e){function t(t,n,i,a){var s;e.call(this),this._parentSubscriber=t;var u=this;r.isFunction(n)?s=n:n&&(s=n.next,i=n.error,a=n.complete,n!==o.empty&&(u=Object.create(n),r.isFunction(u.unsubscribe)&&this.add(u.unsubscribe.bind(u)),u.unsubscribe=this.unsubscribe.bind(this))),this._context=u,this._next=s,this._error=i,this._complete=a}return i(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){throw this.unsubscribe(),n}},t.prototype.__tryOrSetError=function(e,t,n){try{t.call(this._context,n)}catch(i){return e.syncErrorValue=i,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(u);function c(e){return e instanceof u||"syncErrorThrowable"in e&&e[s.rxSubscriber]}},83326:function(e,t,n){"use strict";var i=n(9939),r=n(71953),a=n(8398),o=n(66226),s=n(57812),u=n(63369);function l(e){return e.reduce(function(e,t){return e.concat(t instanceof u.UnsubscriptionError?t.errors:t)},[])}t.Subscription=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,c=this._parents,h=this._unsubscribe,p=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var d=-1,f=c?c.length:0;n;)n.remove(this),n=++d<f&&c[d]||null;if(a.isFunction(h)&&o.tryCatch(h).call(this)===s.errorObject&&(t=!0,e=e||(s.errorObject.e instanceof u.UnsubscriptionError?l(s.errorObject.e.errors):[s.errorObject.e])),i.isArray(p))for(d=-1,f=p.length;++d<f;){var v=p[d];if(r.isObject(v)&&o.tryCatch(v.unsubscribe).call(v)===s.errorObject){t=!0,e=e||[];var m=s.errorObject.e;m instanceof u.UnsubscriptionError?e=e.concat(l(m.errors)):e.push(m)}}if(t)throw new u.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var i=n;(n=new e)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;t&&t!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}()},53587:function(e,t,n){"use strict";var i=n(56437),r=n(84118);i.Observable.bindCallback=r.bindCallback},31266:function(e,t,n){"use strict";var i=n(56437),r=n(17017);i.Observable.bindNodeCallback=r.bindNodeCallback},85911:function(e,t,n){"use strict";var i=n(56437),r=n(366);i.Observable.combineLatest=r.combineLatest},38234:function(e,t,n){"use strict";var i=n(56437),r=n(41948);i.Observable.concat=r.concat},71689:function(e,t,n){"use strict";var i=n(56437),r=n(71449);i.Observable.defer=r.defer},12931:function(e,t,n){"use strict";var i=n(56437),r=n(36102);i.Observable.ajax=r.ajax},23454:function(e,t,n){"use strict";var i=n(56437),r=n(35324);i.Observable.webSocket=r.webSocket},2552:function(e,t,n){"use strict";var i=n(56437),r=n(17639);i.Observable.empty=r.empty},28950:function(e,t,n){"use strict";var i=n(56437),r=n(1346);i.Observable.forkJoin=r.forkJoin},59156:function(e,t,n){"use strict";var i=n(56437),r=n(20873);i.Observable.from=r.from},15236:function(e,t,n){"use strict";var i=n(56437),r=n(84619);i.Observable.fromEvent=r.fromEvent},14201:function(e,t,n){"use strict";var i=n(56437),r=n(31518);i.Observable.fromEventPattern=r.fromEventPattern},43458:function(e,t,n){"use strict";var i=n(56437),r=n(84703);i.Observable.fromPromise=r.fromPromise},93956:function(e,t,n){"use strict";var i=n(56437),r=n(88762);i.Observable.generate=r.generate},12563:function(e,t,n){"use strict";var i=n(56437),r=n(11667);i.Observable.if=r._if},79594:function(e,t,n){"use strict";var i=n(56437),r=n(38061);i.Observable.interval=r.interval},76711:function(e,t,n){"use strict";var i=n(56437),r=n(55067);i.Observable.merge=r.merge},39919:function(e,t,n){"use strict";var i=n(56437),r=n(32732);i.Observable.never=r.never},3735:function(e,t,n){"use strict";var i=n(56437),r=n(77246);i.Observable.of=r.of},8229:function(e,t,n){"use strict";var i=n(56437),r=n(46428);i.Observable.onErrorResumeNext=r.onErrorResumeNext},93426:function(e,t,n){"use strict";var i=n(56437),r=n(67873);i.Observable.pairs=r.pairs},72337:function(e,t,n){"use strict";var i=n(56437),r=n(9360);i.Observable.race=r.race},19586:function(e,t,n){"use strict";var i=n(56437),r=n(20348);i.Observable.range=r.range},43767:function(e,t,n){"use strict";var i=n(56437),r=n(60079);i.Observable.throw=r._throw},2115:function(e,t,n){"use strict";var i=n(56437),r=n(13156);i.Observable.timer=r.timer},9250:function(e,t,n){"use strict";var i=n(56437),r=n(81361);i.Observable.using=r.using},36765:function(e,t,n){"use strict";var i=n(56437),r=n(16320);i.Observable.zip=r.zip},43628:function(e,t,n){"use strict";var i=n(56437),r=n(51633);i.Observable.prototype.audit=r.audit},65975:function(e,t,n){"use strict";var i=n(56437),r=n(44433);i.Observable.prototype.auditTime=r.auditTime},93433:function(e,t,n){"use strict";var i=n(56437),r=n(88945);i.Observable.prototype.buffer=r.buffer},73554:function(e,t,n){"use strict";var i=n(56437),r=n(46840);i.Observable.prototype.bufferCount=r.bufferCount},64514:function(e,t,n){"use strict";var i=n(56437),r=n(70550);i.Observable.prototype.bufferTime=r.bufferTime},97806:function(e,t,n){"use strict";var i=n(56437),r=n(45454);i.Observable.prototype.bufferToggle=r.bufferToggle},38778:function(e,t,n){"use strict";var i=n(56437),r=n(14895);i.Observable.prototype.bufferWhen=r.bufferWhen},23407:function(e,t,n){"use strict";var i=n(56437),r=n(64181);i.Observable.prototype.catch=r._catch,i.Observable.prototype._catch=r._catch},60652:function(e,t,n){"use strict";var i=n(56437),r=n(75524);i.Observable.prototype.combineAll=r.combineAll},9305:function(e,t,n){"use strict";var i=n(56437),r=n(58578);i.Observable.prototype.combineLatest=r.combineLatest},5539:function(e,t,n){"use strict";var i=n(56437),r=n(75515);i.Observable.prototype.concat=r.concat},45158:function(e,t,n){"use strict";var i=n(56437),r=n(50734);i.Observable.prototype.concatAll=r.concatAll},77297:function(e,t,n){"use strict";var i=n(56437),r=n(27516);i.Observable.prototype.concatMap=r.concatMap},51084:function(e,t,n){"use strict";var i=n(56437),r=n(26312);i.Observable.prototype.concatMapTo=r.concatMapTo},86525:function(e,t,n){"use strict";var i=n(56437),r=n(78014);i.Observable.prototype.count=r.count},29332:function(e,t,n){"use strict";var i=n(56437),r=n(89378);i.Observable.prototype.debounce=r.debounce},20323:function(e,t,n){"use strict";var i=n(56437),r=n(84872);i.Observable.prototype.debounceTime=r.debounceTime},27904:function(e,t,n){"use strict";var i=n(56437),r=n(52194);i.Observable.prototype.defaultIfEmpty=r.defaultIfEmpty},35400:function(e,t,n){"use strict";var i=n(56437),r=n(82104);i.Observable.prototype.delay=r.delay},56410:function(e,t,n){"use strict";var i=n(56437),r=n(49533);i.Observable.prototype.delayWhen=r.delayWhen},58497:function(e,t,n){"use strict";var i=n(56437),r=n(91963);i.Observable.prototype.dematerialize=r.dematerialize},70657:function(e,t,n){"use strict";var i=n(56437),r=n(64080);i.Observable.prototype.distinct=r.distinct},91836:function(e,t,n){"use strict";var i=n(56437),r=n(40316);i.Observable.prototype.distinctUntilChanged=r.distinctUntilChanged},11290:function(e,t,n){"use strict";var i=n(56437),r=n(3190);i.Observable.prototype.distinctUntilKeyChanged=r.distinctUntilKeyChanged},34304:function(e,t,n){"use strict";var i=n(56437),r=n(84450);i.Observable.prototype.do=r._do,i.Observable.prototype._do=r._do},85378:function(e,t,n){"use strict";var i=n(56437),r=n(97331);i.Observable.prototype.elementAt=r.elementAt},11816:function(e,t,n){"use strict";var i=n(56437),r=n(36162);i.Observable.prototype.every=r.every},23251:function(e,t,n){"use strict";var i=n(56437),r=n(62059);i.Observable.prototype.exhaust=r.exhaust},55638:function(e,t,n){"use strict";var i=n(56437),r=n(12119);i.Observable.prototype.exhaustMap=r.exhaustMap},98614:function(e,t,n){"use strict";var i=n(56437),r=n(35443);i.Observable.prototype.expand=r.expand},73804:function(e,t,n){"use strict";var i=n(56437),r=n(64414);i.Observable.prototype.filter=r.filter},53517:function(e,t,n){"use strict";var i=n(56437),r=n(55958);i.Observable.prototype.finally=r._finally,i.Observable.prototype._finally=r._finally},24006:function(e,t,n){"use strict";var i=n(56437),r=n(52767);i.Observable.prototype.find=r.find},28554:function(e,t,n){"use strict";var i=n(56437),r=n(52293);i.Observable.prototype.findIndex=r.findIndex},35489:function(e,t,n){"use strict";var i=n(56437),r=n(10316);i.Observable.prototype.first=r.first},91664:function(e,t,n){"use strict";var i=n(56437),r=n(10789);i.Observable.prototype.groupBy=r.groupBy},18894:function(e,t,n){"use strict";var i=n(56437),r=n(71585);i.Observable.prototype.ignoreElements=r.ignoreElements},64579:function(e,t,n){"use strict";var i=n(56437),r=n(55679);i.Observable.prototype.isEmpty=r.isEmpty},52461:function(e,t,n){"use strict";var i=n(56437),r=n(48764);i.Observable.prototype.last=r.last},65017:function(e,t,n){"use strict";var i=n(56437),r=n(20966);i.Observable.prototype.let=r.letProto,i.Observable.prototype.letBind=r.letProto},30135:function(e,t,n){"use strict";var i=n(56437),r=n(67333);i.Observable.prototype.map=r.map},71541:function(e,t,n){"use strict";var i=n(56437),r=n(34379);i.Observable.prototype.mapTo=r.mapTo},6183:function(e,t,n){"use strict";var i=n(56437),r=n(72570);i.Observable.prototype.materialize=r.materialize},12241:function(e,t,n){"use strict";var i=n(56437),r=n(45164);i.Observable.prototype.max=r.max},88730:function(e,t,n){"use strict";var i=n(56437),r=n(62485);i.Observable.prototype.merge=r.merge},15702:function(e,t,n){"use strict";var i=n(56437),r=n(5694);i.Observable.prototype.mergeAll=r.mergeAll},10902:function(e,t,n){"use strict";var i=n(56437),r=n(80463);i.Observable.prototype.mergeMap=r.mergeMap,i.Observable.prototype.flatMap=r.mergeMap},45790:function(e,t,n){"use strict";var i=n(56437),r=n(65801);i.Observable.prototype.flatMapTo=r.mergeMapTo,i.Observable.prototype.mergeMapTo=r.mergeMapTo},43798:function(e,t,n){"use strict";var i=n(56437),r=n(44661);i.Observable.prototype.mergeScan=r.mergeScan},44220:function(e,t,n){"use strict";var i=n(56437),r=n(11234);i.Observable.prototype.min=r.min},44812:function(e,t,n){"use strict";var i=n(56437),r=n(12228);i.Observable.prototype.multicast=r.multicast},97004:function(e,t,n){"use strict";var i=n(56437),r=n(77326);i.Observable.prototype.observeOn=r.observeOn},72358:function(e,t,n){"use strict";var i=n(56437),r=n(42402);i.Observable.prototype.onErrorResumeNext=r.onErrorResumeNext},45282:function(e,t,n){"use strict";var i=n(56437),r=n(47235);i.Observable.prototype.pairwise=r.pairwise},62225:function(e,t,n){"use strict";var i=n(56437),r=n(24862);i.Observable.prototype.partition=r.partition},42091:function(e,t,n){"use strict";var i=n(56437),r=n(59259);i.Observable.prototype.pluck=r.pluck},97694:function(e,t,n){"use strict";var i=n(56437),r=n(63821);i.Observable.prototype.publish=r.publish},96373:function(e,t,n){"use strict";var i=n(56437),r=n(51186);i.Observable.prototype.publishBehavior=r.publishBehavior},26941:function(e,t,n){"use strict";var i=n(56437),r=n(54433);i.Observable.prototype.publishLast=r.publishLast},3773:function(e,t,n){"use strict";var i=n(56437),r=n(30514);i.Observable.prototype.publishReplay=r.publishReplay},48477:function(e,t,n){"use strict";var i=n(56437),r=n(54067);i.Observable.prototype.race=r.race},93017:function(e,t,n){"use strict";var i=n(56437),r=n(94034);i.Observable.prototype.reduce=r.reduce},21123:function(e,t,n){"use strict";var i=n(56437),r=n(45566);i.Observable.prototype.repeat=r.repeat},42225:function(e,t,n){"use strict";var i=n(56437),r=n(37958);i.Observable.prototype.repeatWhen=r.repeatWhen},9703:function(e,t,n){"use strict";var i=n(56437),r=n(1492);i.Observable.prototype.retry=r.retry},94203:function(e,t,n){"use strict";var i=n(56437),r=n(99598);i.Observable.prototype.retryWhen=r.retryWhen},66731:function(e,t,n){"use strict";var i=n(56437),r=n(49913);i.Observable.prototype.sample=r.sample},49594:function(e,t,n){"use strict";var i=n(56437),r=n(32068);i.Observable.prototype.sampleTime=r.sampleTime},88856:function(e,t,n){"use strict";var i=n(56437),r=n(12096);i.Observable.prototype.scan=r.scan},20431:function(e,t,n){"use strict";var i=n(56437),r=n(78522);i.Observable.prototype.sequenceEqual=r.sequenceEqual},2812:function(e,t,n){"use strict";var i=n(56437),r=n(38021);i.Observable.prototype.share=r.share},46904:function(e,t,n){"use strict";var i=n(56437),r=n(11159);i.Observable.prototype.shareReplay=r.shareReplay},91924:function(e,t,n){"use strict";var i=n(56437),r=n(64261);i.Observable.prototype.single=r.single},72952:function(e,t,n){"use strict";var i=n(56437),r=n(72192);i.Observable.prototype.skip=r.skip},43199:function(e,t,n){"use strict";var i=n(56437),r=n(71436);i.Observable.prototype.skipLast=r.skipLast},77117:function(e,t,n){"use strict";var i=n(56437),r=n(79901);i.Observable.prototype.skipUntil=r.skipUntil},95859:function(e,t,n){"use strict";var i=n(56437),r=n(11203);i.Observable.prototype.skipWhile=r.skipWhile},83759:function(e,t,n){"use strict";var i=n(56437),r=n(59808);i.Observable.prototype.startWith=r.startWith},44596:function(e,t,n){"use strict";var i=n(56437),r=n(5936);i.Observable.prototype.subscribeOn=r.subscribeOn},47924:function(e,t,n){"use strict";var i=n(56437),r=n(80866);i.Observable.prototype.switch=r._switch,i.Observable.prototype._switch=r._switch},76859:function(e,t,n){"use strict";var i=n(56437),r=n(65496);i.Observable.prototype.switchMap=r.switchMap},79139:function(e,t,n){"use strict";var i=n(56437),r=n(7641);i.Observable.prototype.switchMapTo=r.switchMapTo},29715:function(e,t,n){"use strict";var i=n(56437),r=n(54072);i.Observable.prototype.take=r.take},69792:function(e,t,n){"use strict";var i=n(56437),r=n(21849);i.Observable.prototype.takeLast=r.takeLast},81553:function(e,t,n){"use strict";var i=n(56437),r=n(87063);i.Observable.prototype.takeUntil=r.takeUntil},41511:function(e,t,n){"use strict";var i=n(56437),r=n(6845);i.Observable.prototype.takeWhile=r.takeWhile},74619:function(e,t,n){"use strict";var i=n(56437),r=n(70780);i.Observable.prototype.throttle=r.throttle},52431:function(e,t,n){"use strict";var i=n(56437),r=n(40441);i.Observable.prototype.throttleTime=r.throttleTime},48031:function(e,t,n){"use strict";var i=n(56437),r=n(95523);i.Observable.prototype.timeInterval=r.timeInterval},83687:function(e,t,n){"use strict";var i=n(56437),r=n(22374);i.Observable.prototype.timeout=r.timeout},48265:function(e,t,n){"use strict";var i=n(56437),r=n(392);i.Observable.prototype.timeoutWith=r.timeoutWith},63618:function(e,t,n){"use strict";var i=n(56437),r=n(8869);i.Observable.prototype.timestamp=r.timestamp},55444:function(e,t,n){"use strict";var i=n(56437),r=n(26261);i.Observable.prototype.toArray=r.toArray},16885:function(){},54515:function(e,t,n){"use strict";var i=n(56437),r=n(16417);i.Observable.prototype.window=r.window},5247:function(e,t,n){"use strict";var i=n(56437),r=n(88454);i.Observable.prototype.windowCount=r.windowCount},69474:function(e,t,n){"use strict";var i=n(56437),r=n(16447);i.Observable.prototype.windowTime=r.windowTime},88178:function(e,t,n){"use strict";var i=n(56437),r=n(34362);i.Observable.prototype.windowToggle=r.windowToggle},40887:function(e,t,n){"use strict";var i=n(56437),r=n(38280);i.Observable.prototype.windowWhen=r.windowWhen},89094:function(e,t,n){"use strict";var i=n(56437),r=n(67808);i.Observable.prototype.withLatestFrom=r.withLatestFrom},30904:function(e,t,n){"use strict";var i=n(56437),r=n(87167);i.Observable.prototype.zip=r.zipProto},3614:function(e,t,n){"use strict";var i=n(56437),r=n(29339);i.Observable.prototype.zipAll=r.zipAll},6159:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(36027),o=n(70699),s=function(e){function t(t,n){e.call(this),this.arrayLike=t,this.scheduler=n,n||1!==t.length||(this._isScalar=!0,this.value=t[0])}return i(t,e),t.create=function(e,n){var i=e.length;return 0===i?new o.EmptyObservable:1===i?new a.ScalarObservable(e[0],n):new t(e,n)},t.dispatch=function(e){var t=e.arrayLike,n=e.index,i=e.subscriber;i.closed||(n>=e.length?i.complete():(i.next(t[n]),e.index=n+1,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.arrayLike,i=this.scheduler,r=n.length;if(i)return i.schedule(t.dispatch,0,{arrayLike:n,index:0,length:r,subscriber:e});for(var a=0;a<r&&!e.closed;a++)e.next(n[a]);e.complete()},t}(r.Observable);t.ArrayLikeObservable=s},4655:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(36027),o=n(70699),s=n(12774),u=function(e){function t(t,n){e.call(this),this.array=t,this.scheduler=n,n||1!==t.length||(this._isScalar=!0,this.value=t[0])}return i(t,e),t.create=function(e,n){return new t(e,n)},t.of=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];var i=e[e.length-1];s.isScheduler(i)?e.pop():i=null;var r=e.length;return r>1?new t(e,i):1===r?new a.ScalarObservable(e[0],i):new o.EmptyObservable(i)},t.dispatch=function(e){var t=e.array,n=e.index,i=e.subscriber;n>=e.count?i.complete():(i.next(t[n]),i.closed||(e.index=n+1,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.array,i=n.length,r=this.scheduler;if(r)return r.schedule(t.dispatch,0,{array:n,index:0,count:i,subscriber:e});for(var a=0;a<i&&!e.closed;a++)e.next(n[a]);e.complete()},t}(r.Observable);t.ArrayObservable=u},24786:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(66226),o=n(57812),s=n(17090),u=function(e){function t(t,n,i,r,a){e.call(this),this.callbackFunc=t,this.selector=n,this.args=i,this.context=r,this.scheduler=a}return i(t,e),t.create=function(e,n,i){return void 0===n&&(n=void 0),function(){for(var r=[],a=0;a<arguments.length;a++)r[a-0]=arguments[a];return new t(e,n,r,this,i)}},t.prototype._subscribe=function(e){var n=this.callbackFunc,i=this.args,r=this.scheduler,u=this.subject;if(r)return r.schedule(t.dispatch,0,{source:this,subscriber:e,context:this.context});if(!u){u=this.subject=new s.AsyncSubject;var l=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var i=e.source,r=i.selector,s=i.subject;if(r){var u=a.tryCatch(r).apply(this,t);u===o.errorObject?s.error(o.errorObject.e):(s.next(u),s.complete())}else s.next(t.length<=1?t[0]:t),s.complete()};l.source=this,a.tryCatch(n).apply(this.context,i.concat(l))===o.errorObject&&u.error(o.errorObject.e)}return u.subscribe(e)},t.dispatch=function(e){var t=this,n=e.source,i=e.subscriber,r=e.context,u=n.callbackFunc,h=n.args,p=n.scheduler,d=n.subject;if(!d){d=n.subject=new s.AsyncSubject;var f=function e(){for(var n=[],i=0;i<arguments.length;i++)n[i-0]=arguments[i];var r=e.source,s=r.selector,u=r.subject;if(s){var h=a.tryCatch(s).apply(this,n);t.add(h===o.errorObject?p.schedule(c,0,{err:o.errorObject.e,subject:u}):p.schedule(l,0,{value:h,subject:u}))}else{var d=n.length<=1?n[0]:n;t.add(p.schedule(l,0,{value:d,subject:u}))}};f.source=n,a.tryCatch(u).apply(r,h.concat(f))===o.errorObject&&d.error(o.errorObject.e)}t.add(d.subscribe(i))},t}(r.Observable);function l(e){var t=e.subject;t.next(e.value),t.complete()}function c(e){e.subject.error(e.err)}t.BoundCallbackObservable=u},88381:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(66226),o=n(57812),s=n(17090),u=function(e){function t(t,n,i,r,a){e.call(this),this.callbackFunc=t,this.selector=n,this.args=i,this.context=r,this.scheduler=a}return i(t,e),t.create=function(e,n,i){return void 0===n&&(n=void 0),function(){for(var r=[],a=0;a<arguments.length;a++)r[a-0]=arguments[a];return new t(e,n,r,this,i)}},t.prototype._subscribe=function(e){var t=this.callbackFunc,n=this.args,i=this.scheduler,r=this.subject;if(i)return i.schedule(l,0,{source:this,subscriber:e,context:this.context});if(!r){r=this.subject=new s.AsyncSubject;var u=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var i=e.source,r=i.selector,s=i.subject,u=t.shift();if(u)s.error(u);else if(r){var l=a.tryCatch(r).apply(this,t);l===o.errorObject?s.error(o.errorObject.e):(s.next(l),s.complete())}else s.next(t.length<=1?t[0]:t),s.complete()};u.source=this,a.tryCatch(t).apply(this.context,n.concat(u))===o.errorObject&&r.error(o.errorObject.e)}return r.subscribe(e)},t}(r.Observable);function l(e){var t=this,n=e.source,i=e.subscriber,r=e.context,u=n.callbackFunc,l=n.args,p=n.scheduler,d=n.subject;if(!d){d=n.subject=new s.AsyncSubject;var f=function e(){for(var n=[],i=0;i<arguments.length;i++)n[i-0]=arguments[i];var r=e.source,s=r.selector,u=r.subject,l=n.shift();if(l)t.add(p.schedule(h,0,{err:l,subject:u}));else if(s){var d=a.tryCatch(s).apply(this,n);t.add(d===o.errorObject?p.schedule(h,0,{err:o.errorObject.e,subject:u}):p.schedule(c,0,{value:d,subject:u}))}else{var f=n.length<=1?n[0]:n;t.add(p.schedule(c,0,{value:f,subject:u}))}};f.source=n,a.tryCatch(u).apply(r,l.concat(f))===o.errorObject&&t.add(p.schedule(h,0,{err:o.errorObject.e,subject:d}))}t.add(d.subscribe(i))}function c(e){var t=e.subject;t.next(e.value),t.complete()}function h(e){e.subject.error(e.err)}t.BoundNodeCallbackObservable=u},25569:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(56437),o=n(84164),s=n(83326),u=n(24702),l=function(e){function t(t,n){e.call(this),this.source=t,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}return i(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new s.Subscription).add(this.source.subscribe(new h(this.getSubject(),this))),e.closed?(this._connection=null,e=s.Subscription.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return u.refCount()(this)},t}(a.Observable);t.ConnectableObservable=l;var c=l.prototype;t.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:c._subscribe},_isComplete:{value:c._isComplete,writable:!0},getSubject:{value:c.getSubject},connect:{value:c.connect},refCount:{value:c.refCount}};var h=function(e){function t(t,n){e.call(this,t),this.connectable=n}return i(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(r.SubjectSubscriber);!function(e){function t(t,n){e.call(this,t),this.connectable=n}i(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,i=e._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null}}(o.Subscriber)},13792:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(34620),o=n(257),s=function(e){function t(t){e.call(this),this.observableFactory=t}return i(t,e),t.create=function(e){return new t(e)},t.prototype._subscribe=function(e){return new u(e,this.observableFactory)},t}(r.Observable);t.DeferObservable=s;var u=function(e){function t(t,n){e.call(this,t),this.factory=n,this.tryDefer()}return i(t,e),t.prototype.tryDefer=function(){try{this._callFactory()}catch(e){this._error(e)}},t.prototype._callFactory=function(){var e=this.factory();e&&this.add(a.subscribeToResult(this,e))},t}(o.OuterSubscriber)},70699:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t){e.call(this),this.scheduler=t}return i(t,e),t.create=function(e){return new t(e)},t.dispatch=function(e){e.subscriber.complete()},t.prototype._subscribe=function(e){var n=this.scheduler;if(n)return n.schedule(t.dispatch,0,{subscriber:e});e.complete()},t}(n(56437).Observable);t.EmptyObservable=r},78542:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n){e.call(this),this.error=t,this.scheduler=n}return i(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){e.subscriber.error(e.error)},t.prototype._subscribe=function(e){var n=this.error,i=this.scheduler;if(e.syncErrorThrowable=!0,i)return i.schedule(t.dispatch,0,{error:n,subscriber:e});e.error(n)},t}(n(56437).Observable);t.ErrorObservable=r},45227:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(70699),o=n(9939),s=n(34620),u=n(257),l=function(e){function t(t,n){e.call(this),this.sources=t,this.resultSelector=n}return i(t,e),t.create=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];if(null===e||0===arguments.length)return new a.EmptyObservable;var i=null;return"function"==typeof e[e.length-1]&&(i=e.pop()),1===e.length&&o.isArray(e[0])&&(e=e[0]),0===e.length?new a.EmptyObservable:new t(e,i)},t.prototype._subscribe=function(e){return new c(e,this.sources,this.resultSelector)},t}(r.Observable);t.ForkJoinObservable=l;var c=function(e){function t(t,n,i){e.call(this,t),this.sources=n,this.resultSelector=i,this.completed=0,this.haveValues=0;var r=n.length;this.total=r,this.values=new Array(r);for(var a=0;a<r;a++){var o=s.subscribeToResult(this,n[a],null,a);o&&(o.outerIndex=a,this.add(o))}}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.values[n]=t,r._hasValue||(r._hasValue=!0,this.haveValues++)},t.prototype.notifyComplete=function(e){var t=this.destination,n=this.haveValues,i=this.resultSelector,r=this.values,a=r.length;if(e._hasValue){if(this.completed++,this.completed===a){if(n===a){var o=i?i.apply(this,r):r;t.next(o)}t.complete()}}else t.complete()},t}(u.OuterSubscriber)},97420:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(66226),o=n(8398),s=n(57812),u=n(83326),l=Object.prototype.toString,c=function(e){function t(t,n,i,r){e.call(this),this.sourceObj=t,this.eventName=n,this.selector=i,this.options=r}return i(t,e),t.create=function(e,n,i,r){return o.isFunction(i)&&(r=i,i=void 0),new t(e,n,r,i)},t.setupSubscription=function(e,n,i,r,a){var o;if(function(e){return!!e&&"[object NodeList]"===l.call(e)}(e)||function(e){return!!e&&"[object HTMLCollection]"===l.call(e)}(e))for(var s=0,c=e.length;s<c;s++)t.setupSubscription(e[s],n,i,r,a);else if(function(e){return!!e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var h=e;e.addEventListener(n,i,a),o=function(){return h.removeEventListener(n,i,a)}}else if(function(e){return!!e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var p=e;e.on(n,i),o=function(){return p.off(n,i)}}else{if(!function(e){return!!e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e))throw new TypeError("Invalid event target");var d=e;e.addListener(n,i),o=function(){return d.removeListener(n,i)}}r.add(new u.Subscription(o))},t.prototype._subscribe=function(e){var n=this.selector;t.setupSubscription(this.sourceObj,this.eventName,n?function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];var r=a.tryCatch(n).apply(void 0,t);r===s.errorObject?e.error(s.errorObject.e):e.next(r)}:function(t){return e.next(t)},e,this.options)},t}(r.Observable);t.FromEventObservable=c},74137:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(8398),a=n(56437),o=n(83326),s=function(e){function t(t,n,i){e.call(this),this.addHandler=t,this.removeHandler=n,this.selector=i}return i(t,e),t.create=function(e,n,i){return new t(e,n,i)},t.prototype._subscribe=function(e){var t=this,n=this.removeHandler,i=this.selector?function(){for(var n=[],i=0;i<arguments.length;i++)n[i-0]=arguments[i];t._callSelector(e,n)}:function(t){e.next(t)},a=this._callAddHandler(i,e);r.isFunction(n)&&e.add(new o.Subscription(function(){n(i,a)}))},t.prototype._callSelector=function(e,t){try{var n=this.selector.apply(this,t);e.next(n)}catch(i){e.error(i)}},t.prototype._callAddHandler=function(e,t){try{return this.addHandler(e)||null}catch(n){t.error(n)}},t}(a.Observable);t.FromEventPatternObservable=s},34843:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(9939),a=n(30899),o=n(98598),s=n(44293),u=n(3744),l=n(4655),c=n(6159),h=n(13950),p=n(56437),d=n(52921),f=n(61275),v=function(e){function t(t,n){e.call(this,null),this.ish=t,this.scheduler=n}return i(t,e),t.create=function(e,n){if(null!=e){if("function"==typeof e[f.observable])return e instanceof p.Observable&&!n?e:new t(e,n);if(r.isArray(e))return new l.ArrayObservable(e,n);if(o.isPromise(e))return new s.PromiseObservable(e,n);if("function"==typeof e[h.iterator]||"string"==typeof e)return new u.IteratorObservable(e,n);if(a.isArrayLike(e))return new c.ArrayLikeObservable(e,n)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")},t.prototype._subscribe=function(e){var t=this.ish,n=this.scheduler;return null==n?t[f.observable]().subscribe(e):t[f.observable]().subscribe(new d.ObserveOnSubscriber(e,n,0))},t}(p.Observable);t.FromObservable=v},92110:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(12774),o=function(e){return e},s=function(e){function t(t,n,i,r,a){e.call(this),this.initialState=t,this.condition=n,this.iterate=i,this.resultSelector=r,this.scheduler=a}return i(t,e),t.create=function(e,n,i,r,s){return 1==arguments.length?new t(e.initialState,e.condition,e.iterate,e.resultSelector||o,e.scheduler):void 0===r||a.isScheduler(r)?new t(e,n,i,o,r):new t(e,n,i,r,s)},t.prototype._subscribe=function(e){var n=this.initialState;if(this.scheduler)return this.scheduler.schedule(t.dispatch,0,{subscriber:e,iterate:this.iterate,condition:this.condition,resultSelector:this.resultSelector,state:n});for(var i=this.condition,r=this.resultSelector,a=this.iterate;;){if(i){var o=void 0;try{o=i(n)}catch(u){return void e.error(u)}if(!o){e.complete();break}}var s=void 0;try{s=r(n)}catch(u){return void e.error(u)}if(e.next(s),e.closed)break;try{n=a(n)}catch(u){return void e.error(u)}}},t.dispatch=function(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(a){return void t.error(a)}else e.needIterate=!0;if(n){var i=void 0;try{i=n(e.state)}catch(a){return void t.error(a)}if(!i)return void t.complete();if(t.closed)return}var r;try{r=e.resultSelector(e.state)}catch(a){return void t.error(a)}if(!t.closed&&(t.next(r),!t.closed))return this.schedule(e)}},t}(r.Observable);t.GenerateObservable=s},58410:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(34620),o=n(257),s=function(e){function t(t,n,i){e.call(this),this.condition=t,this.thenSource=n,this.elseSource=i}return i(t,e),t.create=function(e,n,i){return new t(e,n,i)},t.prototype._subscribe=function(e){return new u(e,this.condition,this.thenSource,this.elseSource)},t}(r.Observable);t.IfObservable=s;var u=function(e){function t(t,n,i,r){e.call(this,t),this.condition=n,this.thenSource=i,this.elseSource=r,this.tryIf()}return i(t,e),t.prototype.tryIf=function(){var e=this.condition,t=this.thenSource,n=this.elseSource;try{var i=e()?t:n;i?this.add(a.subscribeToResult(this,i)):this._complete()}catch(r){this._error(r)}},t}(o.OuterSubscriber)},2182:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(65593),a=n(56437),o=n(6163),s=function(e){function t(t,n){void 0===t&&(t=0),void 0===n&&(n=o.async),e.call(this),this.period=t,this.scheduler=n,(!r.isNumeric(t)||t<0)&&(this.period=0),n&&"function"==typeof n.schedule||(this.scheduler=o.async)}return i(t,e),t.create=function(e,n){return void 0===e&&(e=0),void 0===n&&(n=o.async),new t(e,n)},t.dispatch=function(e){var t=e.subscriber,n=e.period;t.next(e.index),t.closed||(e.index+=1,this.schedule(e,n))},t.prototype._subscribe=function(e){var n=this.period;e.add(this.scheduler.schedule(t.dispatch,n,{index:0,subscriber:e,period:n}))},t}(a.Observable);t.IntervalObservable=s},3744:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(70276),a=n(56437),o=n(13950),s=function(e){function t(t,n){if(e.call(this),this.scheduler=n,null==t)throw new Error("iterator cannot be null.");this.iterator=function(e){var t=e[o.iterator];if(!t&&"string"==typeof e)return new u(e);if(!t&&void 0!==e.length)return new l(e);if(!t)throw new TypeError("object is not iterable");return e[o.iterator]()}(t)}return i(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){var t=e.index,n=e.iterator,i=e.subscriber;if(e.hasError)i.error(e.error);else{var r=n.next();r.done?i.complete():(i.next(r.value),e.index=t+1,i.closed?"function"==typeof n.return&&n.return():this.schedule(e))}},t.prototype._subscribe=function(e){var n=this.iterator,i=this.scheduler;if(i)return i.schedule(t.dispatch,0,{index:0,iterator:n,subscriber:e});for(;;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed){"function"==typeof n.return&&n.return();break}}},t}(a.Observable);t.IteratorObservable=s;var u=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.length),this.str=e,this.idx=t,this.len=n}return e.prototype[o.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},e}(),l=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=function(e){var t,n=+e.length;return isNaN(n)?0:0!==n&&"number"==typeof(t=n)&&r.root.isFinite(t)?(n=function(e){var t=+e;return 0===t||isNaN(t)?t:t<0?-1:1}(n)*Math.floor(Math.abs(n)))<=0?0:n>c?c:n:n}(e)),this.arr=e,this.idx=t,this.len=n}return e.prototype[o.iterator]=function(){return this},e.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},e}(),c=Math.pow(2,53)-1},53995:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(53617),o=function(e){function t(){e.call(this)}return i(t,e),t.create=function(){return new t},t.prototype._subscribe=function(e){a.noop()},t}(r.Observable);t.NeverObservable=o},86266:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)};function r(e){var t=e.index,n=e.subscriber;if(t!==e.length){var i=e.keys[t];n.next([i,e.obj[i]]),e.index=t+1,this.schedule(e)}else n.complete()}var a=function(e){function t(t,n){e.call(this),this.obj=t,this.scheduler=n,this.keys=Object.keys(t)}return i(t,e),t.create=function(e,n){return new t(e,n)},t.prototype._subscribe=function(e){var t=this.keys,n=this.scheduler,i=t.length;if(n)return n.schedule(r,0,{obj:this.obj,keys:t,length:i,index:0,subscriber:e});for(var a=0;a<i;a++){var o=t[a];e.next([o,this.obj[o]])}e.complete()},t}(n(56437).Observable);t.PairsObservable=a},44293:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(70276),a=function(e){function t(t,n){e.call(this),this.promise=t,this.scheduler=n}return i(t,e),t.create=function(e,n){return new t(e,n)},t.prototype._subscribe=function(e){var t=this,n=this.promise,i=this.scheduler;if(null==i)this._isScalar?e.closed||(e.next(this.value),e.complete()):n.then(function(n){t.value=n,t._isScalar=!0,e.closed||(e.next(n),e.complete())},function(t){e.closed||e.error(t)}).then(null,function(e){r.root.setTimeout(function(){throw e})});else if(this._isScalar){if(!e.closed)return i.schedule(o,0,{value:this.value,subscriber:e})}else n.then(function(n){t.value=n,t._isScalar=!0,e.closed||e.add(i.schedule(o,0,{value:n,subscriber:e}))},function(t){e.closed||e.add(i.schedule(s,0,{err:t,subscriber:e}))}).then(null,function(e){r.root.setTimeout(function(){throw e})})},t}(n(56437).Observable);function o(e){var t=e.subscriber;t.closed||(t.next(e.value),t.complete())}function s(e){var t=e.subscriber;t.closed||t.error(e.err)}t.PromiseObservable=a},91006:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n,i){e.call(this),this.start=t,this._count=n,this.scheduler=i}return i(t,e),t.create=function(e,n,i){return void 0===e&&(e=0),void 0===n&&(n=0),new t(e,n,i)},t.dispatch=function(e){var t=e.start,n=e.index,i=e.subscriber;n>=e.count?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))},t.prototype._subscribe=function(e){var n=0,i=this.start,r=this._count,a=this.scheduler;if(a)return a.schedule(t.dispatch,0,{index:n,count:r,start:i,subscriber:e});for(;;){if(n++>=r){e.complete();break}if(e.next(i++),e.closed)break}},t}(n(56437).Observable);t.RangeObservable=r},36027:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n){e.call(this),this.value=t,this.scheduler=n,this._isScalar=!0,n&&(this._isScalar=!1)}return i(t,e),t.create=function(e,n){return new t(e,n)},t.dispatch=function(e){var t=e.value,n=e.subscriber;e.done?n.complete():(n.next(t),n.closed||(e.done=!0,this.schedule(e)))},t.prototype._subscribe=function(e){var n=this.value,i=this.scheduler;if(i)return i.schedule(t.dispatch,0,{done:!1,value:n,subscriber:e});e.next(n),e.closed||e.complete()},t}(n(56437).Observable);t.ScalarObservable=r},13981:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(9688),o=n(65593),s=function(e){function t(t,n,i){void 0===n&&(n=0),void 0===i&&(i=a.asap),e.call(this),this.source=t,this.delayTime=n,this.scheduler=i,(!o.isNumeric(n)||n<0)&&(this.delayTime=0),i&&"function"==typeof i.schedule||(this.scheduler=a.asap)}return i(t,e),t.create=function(e,n,i){return void 0===n&&(n=0),void 0===i&&(i=a.asap),new t(e,n,i)},t.dispatch=function(e){return this.add(e.source.subscribe(e.subscriber))},t.prototype._subscribe=function(e){return this.scheduler.schedule(t.dispatch,this.delayTime,{source:this.source,subscriber:e})},t}(r.Observable);t.SubscribeOnObservable=s},76586:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(65593),a=n(56437),o=n(6163),s=n(12774),u=n(79286),l=function(e){function t(t,n,i){void 0===t&&(t=0),e.call(this),this.period=-1,this.dueTime=0,r.isNumeric(n)?this.period=Number(n)<1?1:Number(n):s.isScheduler(n)&&(i=n),s.isScheduler(i)||(i=o.async),this.scheduler=i,this.dueTime=u.isDate(t)?+t-this.scheduler.now():t}return i(t,e),t.create=function(e,n,i){return void 0===e&&(e=0),new t(e,n,i)},t.dispatch=function(e){var t=e.index,n=e.period,i=e.subscriber;if(i.next(t),!i.closed){if(-1===n)return i.complete();e.index=t+1,this.schedule(e,n)}},t.prototype._subscribe=function(e){return this.scheduler.schedule(t.dispatch,this.dueTime,{index:0,period:this.period,subscriber:e})},t}(a.Observable);t.TimerObservable=l},11814:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(34620),o=n(257),s=function(e){function t(t,n){e.call(this),this.resourceFactory=t,this.observableFactory=n}return i(t,e),t.create=function(e,n){return new t(e,n)},t.prototype._subscribe=function(e){var t,n=this.resourceFactory,i=this.observableFactory;try{return t=n(),new u(e,t,i)}catch(r){e.error(r)}},t}(r.Observable);t.UsingObservable=s;var u=function(e){function t(t,n,i){e.call(this,t),this.resource=n,this.observableFactory=i,t.add(n),this.tryUse()}return i(t,e),t.prototype.tryUse=function(){try{var e=this.observableFactory.call(this,this.resource);e&&this.add(a.subscribeToResult(this,e))}catch(t){this._error(t)}},t}(o.OuterSubscriber)},84118:function(e,t,n){"use strict";t.bindCallback=n(24786).BoundCallbackObservable.create},17017:function(e,t,n){"use strict";t.bindNodeCallback=n(88381).BoundNodeCallbackObservable.create},366:function(e,t,n){"use strict";var i=n(12774),r=n(9939),a=n(4655),o=n(17305);t.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=null,s=null;return i.isScheduler(e[e.length-1])&&(s=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&r.isArray(e[0])&&(e=e[0]),new a.ArrayObservable(e,s).lift(new o.CombineLatestOperator(n))}},41948:function(e,t,n){"use strict";var i=n(12774),r=n(77246),a=n(20873),o=n(65659);t.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length||2===e.length&&i.isScheduler(e[1])?a.from(e[0]):o.concatAll()(r.of.apply(void 0,e))}},71449:function(e,t,n){"use strict";t.defer=n(13792).DeferObservable.create},57242:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(70276),a=n(66226),o=n(57812),s=n(56437),u=n(84164),l=n(86589);function c(){if(r.root.XMLHttpRequest)return new r.root.XMLHttpRequest;if(r.root.XDomainRequest)return new r.root.XDomainRequest;throw new Error("CORS is not supported by your browser")}function h(e,t){return void 0===t&&(t=null),new y({method:"GET",url:e,headers:t})}function p(e,t,n){return new y({method:"POST",url:e,body:t,headers:n})}function d(e,t){return new y({method:"DELETE",url:e,headers:t})}function f(e,t,n){return new y({method:"PUT",url:e,body:t,headers:n})}function v(e,t,n){return new y({method:"PATCH",url:e,body:t,headers:n})}t.ajaxGet=h,t.ajaxPost=p,t.ajaxDelete=d,t.ajaxPut=f,t.ajaxPatch=v;var m=l.map(function(e,t){return e.response});function g(e,t){return m(new y({method:"GET",url:e,responseType:"json",headers:t}))}t.ajaxGetJSON=g;var y=function(e){function t(t){e.call(this);var n={async:!0,createXHR:function(){return this.crossDomain?c.call(this):function(){if(r.root.XMLHttpRequest)return new r.root.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(new r.root.ActiveXObject(e=t[n]))break}catch(i){}return new r.root.ActiveXObject(e)}catch(i){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!1,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)n.url=t;else for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);this.request=n}var n;return i(t,e),t.prototype._subscribe=function(e){return new b(e,this.request)},t.create=((n=function(e){return new t(e)}).get=h,n.post=p,n.delete=d,n.put=f,n.patch=v,n.getJSON=g,n),t}(s.Observable);t.AjaxObservable=y;var b=function(e){function t(t,n){e.call(this,t),this.request=n,this.done=!1;var i=n.headers=n.headers||{};n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),"Content-Type"in i||r.root.FormData&&n.body instanceof r.root.FormData||void 0===n.body||(i["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=this.serializeBody(n.body,n.headers["Content-Type"]),this.send()}return i(t,e),t.prototype.next=function(e){this.done=!0;var t=this.destination,n=new x(e,this.xhr,this.request);t.next(n)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,i=t.method,r=t.url,s=t.async,u=t.password,l=t.headers,c=t.body,h=a.tryCatch(e.createXHR).call(e);if(h===o.errorObject)this.error(o.errorObject.e);else{if(this.xhr=h,this.setupEvents(h,e),(n?a.tryCatch(h.open).call(h,i,r,s,n,u):a.tryCatch(h.open).call(h,i,r,s))===o.errorObject)return this.error(o.errorObject.e),null;if(s&&(h.timeout=e.timeout,h.responseType=e.responseType),"withCredentials"in h&&(h.withCredentials=!!e.withCredentials),this.setHeaders(h,l),(c?a.tryCatch(h.send).call(h,c):a.tryCatch(h.send).call(h))===o.errorObject)return this.error(o.errorObject.e),null}return h},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(r.root.FormData&&e instanceof r.root.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.setupEvents=function(e,t){var n,i,a=t.progressSubscriber;function o(e){var t=o.subscriber,n=o.progressSubscriber,i=o.request;n&&n.error(e),t.error(new S(this,i))}function s(e){var t=s.subscriber,n=s.progressSubscriber,i=s.request;if(4===this.readyState){var r=1223===this.status?204:this.status;0===r&&(r=("text"===this.responseType?this.response||this.responseText:this.response)?200:0),200<=r&&r<300?(n&&n.complete(),t.next(e),t.complete()):(n&&n.error(e),t.error(new w("ajax error "+r,this,i)))}}e.ontimeout=o,o.request=t,o.subscriber=this,o.progressSubscriber=a,e.upload&&"withCredentials"in e&&(a&&(n=function(e){n.progressSubscriber.next(e)},r.root.XDomainRequest?e.onprogress=n:e.upload.onprogress=n,n.progressSubscriber=a),e.onerror=i=function(e){var t=i.progressSubscriber,n=i.subscriber,r=i.request;t&&t.error(e),n.error(new w("ajax error",this,r))},i.request=t,i.subscriber=this,i.progressSubscriber=a),e.onreadystatechange=s,s.subscriber=this,s.progressSubscriber=a,s.request=t},t.prototype.unsubscribe=function(){var t=this.xhr;!this.done&&t&&4!==t.readyState&&"function"==typeof t.abort&&t.abort(),e.prototype.unsubscribe.call(this)},t}(u.Subscriber);t.AjaxSubscriber=b;var x=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=_(this.responseType,t)};t.AjaxResponse=x;var w=function(e){function t(t,n,i){e.call(this,t),this.message=t,this.xhr=n,this.request=i,this.status=n.status,this.responseType=n.responseType||i.responseType,this.response=_(this.responseType,n)}return i(t,e),t}(Error);function _(e,t){switch(e){case"json":return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null");case"xml":return t.responseXML;case"text":default:return"response"in t?t.response:t.responseText}}t.AjaxError=w;var S=function(e){function t(t,n){e.call(this,"ajax timeout",t,n)}return i(t,e),t}(w);t.AjaxTimeoutError=S},80450:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(84164),o=n(56437),s=n(83326),u=n(70276),l=n(64336),c=n(66226),h=n(57812),p=n(65369),d=function(e){function t(t,n){if(t instanceof o.Observable)e.call(this,n,t);else{if(e.call(this),this.WebSocketCtor=u.root.WebSocket,this._output=new r.Subject,"string"==typeof t?this.url=t:p.assign(this,t),!this.WebSocketCtor)throw new Error("no WebSocket constructor can be found");this.destination=new l.ReplaySubject}}return i(t,e),t.prototype.resultSelector=function(e){return JSON.parse(e.data)},t.create=function(e){return new t(e)},t.prototype.lift=function(e){var n=new t(this,this.destination);return n.operator=e,n},t.prototype._resetState=function(){this.socket=null,this.source||(this.destination=new l.ReplaySubject),this._output=new r.Subject},t.prototype.multiplex=function(e,t,n){var i=this;return new o.Observable(function(r){var a=c.tryCatch(e)();a===h.errorObject?r.error(h.errorObject.e):i.next(a);var o=i.subscribe(function(e){var t=c.tryCatch(n)(e);t===h.errorObject?r.error(h.errorObject.e):t&&r.next(e)},function(e){return r.error(e)},function(){return r.complete()});return function(){var e=c.tryCatch(t)();e===h.errorObject?r.error(h.errorObject.e):i.next(e),o.unsubscribe()}})},t.prototype._connectSocket=function(){var e=this,t=this.WebSocketCtor,n=this._output,i=null;try{i=this.protocol?new t(this.url,this.protocol):new t(this.url),this.socket=i,this.binaryType&&(this.socket.binaryType=this.binaryType)}catch(o){return void n.error(o)}var r=new s.Subscription(function(){e.socket=null,i&&1===i.readyState&&i.close()});i.onopen=function(t){var o=e.openObserver;o&&o.next(t);var s=e.destination;e.destination=a.Subscriber.create(function(e){return 1===i.readyState&&i.send(e)},function(t){var r=e.closingObserver;r&&r.next(void 0),t&&t.code?i.close(t.code,t.reason):n.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()},function(){var t=e.closingObserver;t&&t.next(void 0),i.close(),e._resetState()}),s&&s instanceof l.ReplaySubject&&r.add(s.subscribe(e.destination))},i.onerror=function(t){e._resetState(),n.error(t)},i.onclose=function(t){e._resetState();var i=e.closeObserver;i&&i.next(t),t.wasClean?n.complete():n.error(t)},i.onmessage=function(t){var i=c.tryCatch(e.resultSelector)(t);i===h.errorObject?n.error(h.errorObject.e):n.next(i)}},t.prototype._subscribe=function(e){var t=this,n=this.source;if(n)return n.subscribe(e);this.socket||this._connectSocket();var i=new s.Subscription;return i.add(this._output.subscribe(e)),i.add(function(){var e=t.socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())}),i},t.prototype.unsubscribe=function(){var t=this.source,n=this.socket;n&&1===n.readyState&&(n.close(),this._resetState()),e.prototype.unsubscribe.call(this),t||(this.destination=new l.ReplaySubject)},t}(r.AnonymousSubject);t.WebSocketSubject=d},36102:function(e,t,n){"use strict";t.ajax=n(57242).AjaxObservable.create},35324:function(e,t,n){"use strict";t.webSocket=n(80450).WebSocketSubject.create},17639:function(e,t,n){"use strict";t.empty=n(70699).EmptyObservable.create},1346:function(e,t,n){"use strict";t.forkJoin=n(45227).ForkJoinObservable.create},20873:function(e,t,n){"use strict";t.from=n(34843).FromObservable.create},84619:function(e,t,n){"use strict";t.fromEvent=n(97420).FromEventObservable.create},31518:function(e,t,n){"use strict";t.fromEventPattern=n(74137).FromEventPatternObservable.create},84703:function(e,t,n){"use strict";t.fromPromise=n(44293).PromiseObservable.create},88762:function(e,t,n){"use strict";t.generate=n(92110).GenerateObservable.create},11667:function(e,t,n){"use strict";t._if=n(58410).IfObservable.create},38061:function(e,t,n){"use strict";t.interval=n(2182).IntervalObservable.create},55067:function(e,t,n){"use strict";var i=n(56437),r=n(4655),a=n(12774),o=n(23455);t.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=Number.POSITIVE_INFINITY,s=null,u=e[e.length-1];return a.isScheduler(u)?(s=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof u&&(n=e.pop()),null===s&&1===e.length&&e[0]instanceof i.Observable?e[0]:o.mergeAll(n)(new r.ArrayObservable(e,s))}},32732:function(e,t,n){"use strict";t.never=n(53995).NeverObservable.create},77246:function(e,t,n){"use strict";t.of=n(4655).ArrayObservable.of},46428:function(e,t,n){"use strict";t.onErrorResumeNext=n(19582).onErrorResumeNextStatic},67873:function(e,t,n){"use strict";t.pairs=n(86266).PairsObservable.create},9360:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(9939),a=n(4655),o=n(257),s=n(34620);t.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];if(1===e.length){if(!r.isArray(e[0]))return e[0];e=e[0]}return new a.ArrayObservable(e).lift(new u)};var u=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new l(e))},e}();t.RaceOperator=u;var l=function(e){function t(t){e.call(this,t),this.hasFirst=!1,this.observables=[],this.subscriptions=[]}return i(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var i=e[n],r=s.subscribeToResult(this,i,i,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n,i,r){if(!this.hasFirst){this.hasFirst=!0;for(var a=0;a<this.subscriptions.length;a++)if(a!==n){var o=this.subscriptions[a];o.unsubscribe(),this.remove(o)}this.subscriptions=null}this.destination.next(t)},t}(o.OuterSubscriber);t.RaceSubscriber=l},20348:function(e,t,n){"use strict";t.range=n(91006).RangeObservable.create},60079:function(e,t,n){"use strict";t._throw=n(78542).ErrorObservable.create},13156:function(e,t,n){"use strict";t.timer=n(76586).TimerObservable.create},81361:function(e,t,n){"use strict";t.using=n(11814).UsingObservable.create},16320:function(e,t,n){"use strict";t.zip=n(2902).zipStatic},51633:function(e,t,n){"use strict";var i=n(24578);t.audit=function(e){return i.audit(e)(this)}},44433:function(e,t,n){"use strict";var i=n(6163),r=n(83505);t.auditTime=function(e,t){return void 0===t&&(t=i.async),r.auditTime(e,t)(this)}},88945:function(e,t,n){"use strict";var i=n(94757);t.buffer=function(e){return i.buffer(e)(this)}},46840:function(e,t,n){"use strict";var i=n(50101);t.bufferCount=function(e,t){return void 0===t&&(t=null),i.bufferCount(e,t)(this)}},70550:function(e,t,n){"use strict";var i=n(6163),r=n(12774),a=n(85102);t.bufferTime=function(e){var t=arguments.length,n=i.async;r.isScheduler(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var o=null;t>=2&&(o=arguments[1]);var s=Number.POSITIVE_INFINITY;return t>=3&&(s=arguments[2]),a.bufferTime(e,o,s,n)(this)}},45454:function(e,t,n){"use strict";var i=n(40435);t.bufferToggle=function(e,t){return i.bufferToggle(e,t)(this)}},14895:function(e,t,n){"use strict";var i=n(48322);t.bufferWhen=function(e){return i.bufferWhen(e)(this)}},64181:function(e,t,n){"use strict";var i=n(62546);t._catch=function(e){return i.catchError(e)(this)}},75524:function(e,t,n){"use strict";var i=n(32255);t.combineAll=function(e){return i.combineAll(e)(this)}},58578:function(e,t,n){"use strict";var i=n(17305);t.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.combineLatest.apply(void 0,e)(this)}},75515:function(e,t,n){"use strict";var i=n(43923);t.concatStatic=n(41948).concat,t.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.concat.apply(void 0,e)(this)}},50734:function(e,t,n){"use strict";var i=n(65659);t.concatAll=function(){return i.concatAll()(this)}},27516:function(e,t,n){"use strict";var i=n(61743);t.concatMap=function(e,t){return i.concatMap(e,t)(this)}},26312:function(e,t,n){"use strict";var i=n(50252);t.concatMapTo=function(e,t){return i.concatMapTo(e,t)(this)}},78014:function(e,t,n){"use strict";var i=n(29507);t.count=function(e){return i.count(e)(this)}},89378:function(e,t,n){"use strict";var i=n(59126);t.debounce=function(e){return i.debounce(e)(this)}},84872:function(e,t,n){"use strict";var i=n(6163),r=n(70746);t.debounceTime=function(e,t){return void 0===t&&(t=i.async),r.debounceTime(e,t)(this)}},52194:function(e,t,n){"use strict";var i=n(1583);t.defaultIfEmpty=function(e){return void 0===e&&(e=null),i.defaultIfEmpty(e)(this)}},82104:function(e,t,n){"use strict";var i=n(6163),r=n(29786);t.delay=function(e,t){return void 0===t&&(t=i.async),r.delay(e,t)(this)}},49533:function(e,t,n){"use strict";var i=n(43534);t.delayWhen=function(e,t){return i.delayWhen(e,t)(this)}},91963:function(e,t,n){"use strict";var i=n(45745);t.dematerialize=function(){return i.dematerialize()(this)}},64080:function(e,t,n){"use strict";var i=n(52334);t.distinct=function(e,t){return i.distinct(e,t)(this)}},40316:function(e,t,n){"use strict";var i=n(18817);t.distinctUntilChanged=function(e,t){return i.distinctUntilChanged(e,t)(this)}},3190:function(e,t,n){"use strict";var i=n(68738);t.distinctUntilKeyChanged=function(e,t){return i.distinctUntilKeyChanged(e,t)(this)}},84450:function(e,t,n){"use strict";var i=n(24642);t._do=function(e,t,n){return i.tap(e,t,n)(this)}},97331:function(e,t,n){"use strict";var i=n(17207);t.elementAt=function(e,t){return i.elementAt(e,t)(this)}},36162:function(e,t,n){"use strict";var i=n(65514);t.every=function(e,t){return i.every(e,t)(this)}},62059:function(e,t,n){"use strict";var i=n(44333);t.exhaust=function(){return i.exhaust()(this)}},12119:function(e,t,n){"use strict";var i=n(97292);t.exhaustMap=function(e,t){return i.exhaustMap(e,t)(this)}},35443:function(e,t,n){"use strict";var i=n(85011);t.expand=function(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),i.expand(e,t=(t||0)<1?Number.POSITIVE_INFINITY:t,n)(this)}},64414:function(e,t,n){"use strict";var i=n(54057);t.filter=function(e,t){return i.filter(e,t)(this)}},55958:function(e,t,n){"use strict";var i=n(81469);t._finally=function(e){return i.finalize(e)(this)}},52767:function(e,t,n){"use strict";var i=n(51968);t.find=function(e,t){return i.find(e,t)(this)}},52293:function(e,t,n){"use strict";var i=n(32555);t.findIndex=function(e,t){return i.findIndex(e,t)(this)}},10316:function(e,t,n){"use strict";var i=n(50362);t.first=function(e,t,n){return i.first(e,t,n)(this)}},10789:function(e,t,n){"use strict";var i=n(89136);t.GroupedObservable=i.GroupedObservable,t.groupBy=function(e,t,n,r){return i.groupBy(e,t,n,r)(this)}},71585:function(e,t,n){"use strict";var i=n(91766);t.ignoreElements=function(){return i.ignoreElements()(this)}},55679:function(e,t,n){"use strict";var i=n(30605);t.isEmpty=function(){return i.isEmpty()(this)}},48764:function(e,t,n){"use strict";var i=n(13490);t.last=function(e,t,n){return i.last(e,t,n)(this)}},20966:function(e,t){"use strict";t.letProto=function(e){return e(this)}},67333:function(e,t,n){"use strict";var i=n(86589);t.map=function(e,t){return i.map(e,t)(this)}},34379:function(e,t,n){"use strict";var i=n(80330);t.mapTo=function(e){return i.mapTo(e)(this)}},72570:function(e,t,n){"use strict";var i=n(61626);t.materialize=function(){return i.materialize()(this)}},45164:function(e,t,n){"use strict";var i=n(2874);t.max=function(e){return i.max(e)(this)}},62485:function(e,t,n){"use strict";var i=n(63066);t.mergeStatic=n(55067).merge,t.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.merge.apply(void 0,e)(this)}},5694:function(e,t,n){"use strict";var i=n(23455);t.mergeAll=function(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),i.mergeAll(e)(this)}},80463:function(e,t,n){"use strict";var i=n(55049);t.mergeMap=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),i.mergeMap(e,t,n)(this)}},65801:function(e,t,n){"use strict";var i=n(97165);t.mergeMapTo=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),i.mergeMapTo(e,t,n)(this)}},44661:function(e,t,n){"use strict";var i=n(60083);t.mergeScan=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),i.mergeScan(e,t,n)(this)}},11234:function(e,t,n){"use strict";var i=n(59626);t.min=function(e){return i.min(e)(this)}},12228:function(e,t,n){"use strict";var i=n(75068);t.multicast=function(e,t){return i.multicast(e,t)(this)}},77326:function(e,t,n){"use strict";var i=n(52921);t.observeOn=function(e,t){return void 0===t&&(t=0),i.observeOn(e,t)(this)}},42402:function(e,t,n){"use strict";var i=n(19582);t.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.onErrorResumeNext.apply(void 0,e)(this)}},47235:function(e,t,n){"use strict";var i=n(61132);t.pairwise=function(){return i.pairwise()(this)}},24862:function(e,t,n){"use strict";var i=n(43407);t.partition=function(e,t){return i.partition(e,t)(this)}},59259:function(e,t,n){"use strict";var i=n(29798);t.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.pluck.apply(void 0,e)(this)}},63821:function(e,t,n){"use strict";var i=n(49948);t.publish=function(e){return i.publish(e)(this)}},51186:function(e,t,n){"use strict";var i=n(61228);t.publishBehavior=function(e){return i.publishBehavior(e)(this)}},54433:function(e,t,n){"use strict";var i=n(89172);t.publishLast=function(){return i.publishLast()(this)}},30514:function(e,t,n){"use strict";var i=n(31781);t.publishReplay=function(e,t,n,r){return i.publishReplay(e,t,n,r)(this)}},54067:function(e,t,n){"use strict";var i=n(87109);t.raceStatic=n(9360).race,t.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.race.apply(void 0,e)(this)}},94034:function(e,t,n){"use strict";var i=n(69203);t.reduce=function(e,t){return arguments.length>=2?i.reduce(e,t)(this):i.reduce(e)(this)}},45566:function(e,t,n){"use strict";var i=n(2983);t.repeat=function(e){return void 0===e&&(e=-1),i.repeat(e)(this)}},37958:function(e,t,n){"use strict";var i=n(3027);t.repeatWhen=function(e){return i.repeatWhen(e)(this)}},1492:function(e,t,n){"use strict";var i=n(31043);t.retry=function(e){return void 0===e&&(e=-1),i.retry(e)(this)}},99598:function(e,t,n){"use strict";var i=n(58164);t.retryWhen=function(e){return i.retryWhen(e)(this)}},49913:function(e,t,n){"use strict";var i=n(80540);t.sample=function(e){return i.sample(e)(this)}},32068:function(e,t,n){"use strict";var i=n(6163),r=n(68744);t.sampleTime=function(e,t){return void 0===t&&(t=i.async),r.sampleTime(e,t)(this)}},12096:function(e,t,n){"use strict";var i=n(59042);t.scan=function(e,t){return arguments.length>=2?i.scan(e,t)(this):i.scan(e)(this)}},78522:function(e,t,n){"use strict";var i=n(32198);t.sequenceEqual=function(e,t){return i.sequenceEqual(e,t)(this)}},38021:function(e,t,n){"use strict";var i=n(93361);t.share=function(){return i.share()(this)}},11159:function(e,t,n){"use strict";var i=n(56555);t.shareReplay=function(e,t,n){return i.shareReplay(e,t,n)(this)}},64261:function(e,t,n){"use strict";var i=n(36920);t.single=function(e){return i.single(e)(this)}},72192:function(e,t,n){"use strict";var i=n(68097);t.skip=function(e){return i.skip(e)(this)}},71436:function(e,t,n){"use strict";var i=n(62687);t.skipLast=function(e){return i.skipLast(e)(this)}},79901:function(e,t,n){"use strict";var i=n(17136);t.skipUntil=function(e){return i.skipUntil(e)(this)}},11203:function(e,t,n){"use strict";var i=n(14460);t.skipWhile=function(e){return i.skipWhile(e)(this)}},59808:function(e,t,n){"use strict";var i=n(13690);t.startWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.startWith.apply(void 0,e)(this)}},5936:function(e,t,n){"use strict";var i=n(10480);t.subscribeOn=function(e,t){return void 0===t&&(t=0),i.subscribeOn(e,t)(this)}},80866:function(e,t,n){"use strict";var i=n(77211);t._switch=function(){return i.switchAll()(this)}},65496:function(e,t,n){"use strict";var i=n(17232);t.switchMap=function(e,t){return i.switchMap(e,t)(this)}},7641:function(e,t,n){"use strict";var i=n(12744);t.switchMapTo=function(e,t){return i.switchMapTo(e,t)(this)}},54072:function(e,t,n){"use strict";var i=n(59806);t.take=function(e){return i.take(e)(this)}},21849:function(e,t,n){"use strict";var i=n(82699);t.takeLast=function(e){return i.takeLast(e)(this)}},87063:function(e,t,n){"use strict";var i=n(52887);t.takeUntil=function(e){return i.takeUntil(e)(this)}},6845:function(e,t,n){"use strict";var i=n(496);t.takeWhile=function(e){return i.takeWhile(e)(this)}},70780:function(e,t,n){"use strict";var i=n(29378);t.throttle=function(e,t){return void 0===t&&(t=i.defaultThrottleConfig),i.throttle(e,t)(this)}},40441:function(e,t,n){"use strict";var i=n(6163),r=n(29378),a=n(17786);t.throttleTime=function(e,t,n){return void 0===t&&(t=i.async),void 0===n&&(n=r.defaultThrottleConfig),a.throttleTime(e,t,n)(this)}},95523:function(e,t,n){"use strict";var i=n(6163),r=n(41401);t.TimeInterval=r.TimeInterval,t.timeInterval=function(e){return void 0===e&&(e=i.async),r.timeInterval(e)(this)}},22374:function(e,t,n){"use strict";var i=n(6163),r=n(12687);t.timeout=function(e,t){return void 0===t&&(t=i.async),r.timeout(e,t)(this)}},392:function(e,t,n){"use strict";var i=n(6163),r=n(45252);t.timeoutWith=function(e,t,n){return void 0===n&&(n=i.async),r.timeoutWith(e,t,n)(this)}},8869:function(e,t,n){"use strict";var i=n(6163),r=n(71609);t.timestamp=function(e){return void 0===e&&(e=i.async),r.timestamp(e)(this)}},26261:function(e,t,n){"use strict";var i=n(43056);t.toArray=function(){return i.toArray()(this)}},16417:function(e,t,n){"use strict";var i=n(89883);t.window=function(e){return i.window(e)(this)}},88454:function(e,t,n){"use strict";var i=n(5588);t.windowCount=function(e,t){return void 0===t&&(t=0),i.windowCount(e,t)(this)}},16447:function(e,t,n){"use strict";var i=n(6163),r=n(65593),a=n(12774),o=n(65795);t.windowTime=function(e){var t=i.async,n=null,s=Number.POSITIVE_INFINITY;return a.isScheduler(arguments[3])&&(t=arguments[3]),a.isScheduler(arguments[2])?t=arguments[2]:r.isNumeric(arguments[2])&&(s=arguments[2]),a.isScheduler(arguments[1])?t=arguments[1]:r.isNumeric(arguments[1])&&(n=arguments[1]),o.windowTime(e,n,s,t)(this)}},34362:function(e,t,n){"use strict";var i=n(53375);t.windowToggle=function(e,t){return i.windowToggle(e,t)(this)}},38280:function(e,t,n){"use strict";var i=n(55937);t.windowWhen=function(e){return i.windowWhen(e)(this)}},67808:function(e,t,n){"use strict";var i=n(93252);t.withLatestFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.withLatestFrom.apply(void 0,e)(this)}},87167:function(e,t,n){"use strict";var i=n(2902);t.zipProto=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.zip.apply(void 0,e)(this)}},29339:function(e,t,n){"use strict";var i=n(84575);t.zipAll=function(e){return i.zipAll(e)(this)}},42069:function(e,t,n){"use strict";t.audit=n(24578).audit,t.auditTime=n(83505).auditTime,t.buffer=n(94757).buffer,t.bufferCount=n(50101).bufferCount,t.bufferTime=n(85102).bufferTime,t.bufferToggle=n(40435).bufferToggle,t.bufferWhen=n(48322).bufferWhen,t.catchError=n(62546).catchError,t.combineAll=n(32255).combineAll,t.combineLatest=n(17305).combineLatest,t.concat=n(43923).concat,t.concatAll=n(65659).concatAll,t.concatMap=n(61743).concatMap,t.concatMapTo=n(50252).concatMapTo,t.count=n(29507).count,t.debounce=n(59126).debounce,t.debounceTime=n(70746).debounceTime,t.defaultIfEmpty=n(1583).defaultIfEmpty,t.delay=n(29786).delay,t.delayWhen=n(43534).delayWhen,t.dematerialize=n(45745).dematerialize,t.distinct=n(52334).distinct,t.distinctUntilChanged=n(18817).distinctUntilChanged,t.distinctUntilKeyChanged=n(68738).distinctUntilKeyChanged,t.elementAt=n(17207).elementAt,t.every=n(65514).every,t.exhaust=n(44333).exhaust,t.exhaustMap=n(97292).exhaustMap,t.expand=n(85011).expand,t.filter=n(54057).filter,t.finalize=n(81469).finalize,t.find=n(51968).find,t.findIndex=n(32555).findIndex,t.first=n(50362).first,t.groupBy=n(89136).groupBy,t.ignoreElements=n(91766).ignoreElements,t.isEmpty=n(30605).isEmpty,t.last=n(13490).last,t.map=n(86589).map,t.mapTo=n(80330).mapTo,t.materialize=n(61626).materialize,t.max=n(2874).max,t.merge=n(63066).merge,t.mergeAll=n(23455).mergeAll,t.mergeMap=n(55049).mergeMap,t.flatMap=n(55049).mergeMap,t.mergeMapTo=n(97165).mergeMapTo,t.mergeScan=n(60083).mergeScan,t.min=n(59626).min,t.multicast=n(75068).multicast,t.observeOn=n(52921).observeOn,t.onErrorResumeNext=n(19582).onErrorResumeNext,t.pairwise=n(61132).pairwise,t.partition=n(43407).partition,t.pluck=n(29798).pluck,t.publish=n(49948).publish,t.publishBehavior=n(61228).publishBehavior,t.publishLast=n(89172).publishLast,t.publishReplay=n(31781).publishReplay,t.race=n(87109).race,t.reduce=n(69203).reduce,t.repeat=n(2983).repeat,t.repeatWhen=n(3027).repeatWhen,t.retry=n(31043).retry,t.retryWhen=n(58164).retryWhen,t.refCount=n(24702).refCount,t.sample=n(80540).sample,t.sampleTime=n(68744).sampleTime,t.scan=n(59042).scan,t.sequenceEqual=n(32198).sequenceEqual,t.share=n(93361).share,t.shareReplay=n(56555).shareReplay,t.single=n(36920).single,t.skip=n(68097).skip,t.skipLast=n(62687).skipLast,t.skipUntil=n(17136).skipUntil,t.skipWhile=n(14460).skipWhile,t.startWith=n(13690).startWith,t.switchAll=n(77211).switchAll,t.switchMap=n(17232).switchMap,t.switchMapTo=n(12744).switchMapTo,t.take=n(59806).take,t.takeLast=n(82699).takeLast,t.takeUntil=n(52887).takeUntil,t.takeWhile=n(496).takeWhile,t.tap=n(24642).tap,t.throttle=n(29378).throttle,t.throttleTime=n(17786).throttleTime,t.timeInterval=n(41401).timeInterval,t.timeout=n(12687).timeout,t.timeoutWith=n(45252).timeoutWith,t.timestamp=n(71609).timestamp,t.toArray=n(43056).toArray,t.window=n(89883).window,t.windowCount=n(5588).windowCount,t.windowTime=n(65795).windowTime,t.windowToggle=n(53375).windowToggle,t.windowWhen=n(55937).windowWhen,t.withLatestFrom=n(93252).withLatestFrom,t.zip=n(2902).zip,t.zipAll=n(84575).zipAll},24578:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(66226),a=n(57812),o=n(257),s=n(34620);t.audit=function(e){return function(t){return t.lift(new u(e))}};var u=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.durationSelector))},e}(),l=function(e){function t(t,n){e.call(this,t),this.durationSelector=n,this.hasValue=!1}return i(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=r.tryCatch(this.durationSelector)(e);if(t===a.errorObject)this.destination.error(a.errorObject.e);else{var n=s.subscribeToResult(this,t);n.closed?this.clearThrottle():this.add(this.throttled=n)}}},t.prototype.clearThrottle=function(){var e=this.value,t=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))},t.prototype.notifyNext=function(e,t,n,i){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(o.OuterSubscriber)},83505:function(e,t,n){"use strict";var i=n(6163),r=n(24578),a=n(13156);t.auditTime=function(e,t){return void 0===t&&(t=i.async),r.audit(function(){return a.timer(e,t)})}},94757:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.buffer=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.closingNotifier))},e}(),s=function(e){function t(t,n){e.call(this,t),this.buffer=[],this.add(a.subscribeToResult(this,n))}return i(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.buffer;this.buffer=[],this.destination.next(a)},t}(r.OuterSubscriber)},50101:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.bufferCount=function(e,t){return void 0===t&&(t=null),function(n){return n.lift(new a(e,t))}};var a=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?s:o}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),o=function(e){function t(t,n){e.call(this,t),this.bufferSize=n,this.buffer=[]}return i(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(r.Subscriber),s=function(e){function t(t,n,i){e.call(this,t),this.bufferSize=n,this.startBufferEvery=i,this.buffers=[],this.count=0}return i(t,e),t.prototype._next=function(e){var t=this.bufferSize,n=this.startBufferEvery,i=this.buffers,r=this.count;this.count++,r%n==0&&i.push([]);for(var a=i.length;a--;){var o=i[a];o.push(e),o.length===t&&(i.splice(a,1),this.destination.next(o))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var i=t.shift();i.length>0&&n.next(i)}e.prototype._complete.call(this)},t}(r.Subscriber)},85102:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(6163),a=n(84164),o=n(12774);t.bufferTime=function(e){var t=arguments.length,n=r.async;o.isScheduler(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var i=null;t>=2&&(i=arguments[1]);var a=Number.POSITIVE_INFINITY;return t>=3&&(a=arguments[2]),function(t){return t.lift(new s(e,i,a,n))}};var s=function(){function e(e,t,n,i){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=i}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),u=function(){this.buffer=[]},l=function(e){function t(t,n,i,r,a){e.call(this,t),this.bufferTimeSpan=n,this.bufferCreationInterval=i,this.maxBufferSize=r,this.scheduler=a,this.contexts=[];var o=this.openContext();if(this.timespanOnly=null==i||i<0,this.timespanOnly)this.add(o.closeAction=a.schedule(c,n,{subscriber:this,context:o,bufferTimeSpan:n}));else{var s={bufferTimeSpan:n,bufferCreationInterval:i,subscriber:this,scheduler:a};this.add(o.closeAction=a.schedule(p,n,{subscriber:this,context:o})),this.add(a.schedule(h,i,s))}}return i(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,i=n.length,r=0;r<i;r++){var a=n[r],o=a.buffer;o.push(e),o.length==this.maxBufferSize&&(t=a)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var i=t.shift();n.next(i.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan;this.add(e.closeAction=this.scheduler.schedule(c,n,{subscriber:this,context:e,bufferTimeSpan:n}))}},t.prototype.openContext=function(){var e=new u;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(a.Subscriber);function c(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function h(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,i=e.subscriber,r=e.scheduler,a=i.openContext();i.closed||(i.add(a.closeAction=r.schedule(p,n,{subscriber:i,context:a})),this.schedule(e,t))}function p(e){e.subscriber.closeContext(e.context)}},40435:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(83326),a=n(34620),o=n(257);t.bufferToggle=function(e,t){return function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.openings,this.closingSelector))},e}(),u=function(e){function t(t,n,i){e.call(this,t),this.openings=n,this.closingSelector=i,this.contexts=[],this.add(a.subscribeToResult(this,n))}return i(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,i=0;i<n;i++)t[i].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var i=n.shift();i.subscription.unsubscribe(),i.buffer=null,i.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,i,r){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(n){this._error(n)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.subscription;this.destination.next(e.buffer),t.splice(t.indexOf(e),1),this.remove(n),n.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new r.Subscription,i={buffer:[],subscription:n};t.push(i);var o=a.subscribeToResult(this,e,i);!o||o.closed?this.closeBuffer(i):(o.context=i,this.add(o),n.add(o))},t}(o.OuterSubscriber)},48322:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(83326),a=n(66226),o=n(57812),s=n(257),u=n(34620);t.bufferWhen=function(e){return function(t){return t.lift(new l(e))}};var l=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.closingSelector))},e}(),c=function(e){function t(t,n){e.call(this,t),this.closingSelector=n,this.subscribing=!1,this.openBuffer()}return i(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},t.prototype.notifyNext=function(e,t,n,i,r){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe()),this.buffer&&this.destination.next(this.buffer),this.buffer=[];var t=a.tryCatch(this.closingSelector)();t===o.errorObject?this.error(o.errorObject.e):(e=new r.Subscription,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(u.subscribeToResult(this,t)),this.subscribing=!1)},t}(s.OuterSubscriber)},62546:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.catchError=function(e){return function(t){var n=new o(e),i=t.lift(n);return n.caught=i}};var o=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.selector,this.caught))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.selector=n,this.caught=i}return i(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(i){return void e.prototype.error.call(this,i)}this._unsubscribeAndRecycle(),this.add(a.subscribeToResult(this,n))}},t}(r.OuterSubscriber)},32255:function(e,t,n){"use strict";var i=n(17305);t.combineAll=function(e){return function(t){return t.lift(new i.CombineLatestOperator(e))}}},17305:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(4655),a=n(9939),o=n(257),s=n(34620),u={};t.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&a.isArray(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(new r.ArrayObservable([t].concat(e)),new l(n))}};var l=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.project))},e}();t.CombineLatestOperator=l;var c=function(e){function t(t,n){e.call(this,t),this.project=n,this.active=0,this.values=[],this.observables=[]}return i(t,e),t.prototype._next=function(e){this.values.push(u),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var i=e[n];this.add(s.subscribeToResult(this,i,i,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.values,o=this.toRespond?a[n]===u?--this.toRespond:this.toRespond:0;a[n]=t,0===o&&(this.project?this._tryProject(a):this.destination.next(a.slice()))},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.OuterSubscriber);t.CombineLatestSubscriber=c},43923:function(e,t,n){"use strict";var i=n(41948);t.concatStatic=n(41948).concat,t.concat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){return t.lift.call(i.concat.apply(void 0,[t].concat(e)))}}},65659:function(e,t,n){"use strict";var i=n(23455);t.concatAll=function(){return i.mergeAll(1)}},61743:function(e,t,n){"use strict";var i=n(55049);t.concatMap=function(e,t){return i.mergeMap(e,t,1)}},50252:function(e,t,n){"use strict";var i=n(61743);t.concatMapTo=function(e,t){return i.concatMap(function(){return e},t)}},29507:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.count=function(e){return function(t){return t.lift(new a(e,t))}};var a=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.source))},e}(),o=function(e){function t(t,n,i){e.call(this,t),this.predicate=n,this.source=i,this.count=0,this.index=0}return i(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(r.Subscriber)},59126:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.debounce=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.durationSelector))},e}(),s=function(e){function t(t,n){e.call(this,t),this.durationSelector=n,this.hasValue=!1,this.durationSubscription=null}return i(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=a.subscribeToResult(this,t)).closed||this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(e,t,n,i,r){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(r.OuterSubscriber)},70746:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(6163);t.debounceTime=function(e,t){return void 0===t&&(t=a.async),function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.dueTime,this.scheduler))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.dueTime=n,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}return i(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(u,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){this.clearDebounce(),this.hasValue&&(this.destination.next(this.lastValue),this.lastValue=null,this.hasValue=!1)},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(r.Subscriber);function u(e){e.debouncedNext()}},1583:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.defaultIfEmpty=function(e){return void 0===e&&(e=null),function(t){return t.lift(new a(e))}};var a=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.defaultValue))},e}(),o=function(e){function t(t,n){e.call(this,t),this.defaultValue=n,this.isEmpty=!0}return i(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(r.Subscriber)},29786:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(6163),a=n(79286),o=n(84164),s=n(72995);t.delay=function(e,t){void 0===t&&(t=r.async);var n=a.isDate(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new u(n,t))}};var u=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.delay,this.scheduler))},e}(),l=function(e){function t(t,n,i){e.call(this,t),this.delay=n,this.scheduler=i,this.queue=[],this.active=!1,this.errored=!1}return i(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,i=e.scheduler,r=e.destination;n.length>0&&n[0].time-i.now()<=0;)n.shift().notification.observe(r);if(n.length>0){var a=Math.max(0,n[0].time-i.now());this.schedule(e,a)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new c(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(s.Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},t.prototype._complete=function(){this.scheduleNotification(s.Notification.createComplete())},t}(o.Subscriber),c=function(e,t){this.time=e,this.notification=t}},43534:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(56437),o=n(257),s=n(34620);t.delayWhen=function(e,t){return t?function(n){return new c(n,t).lift(new u(e))}:function(t){return t.lift(new u(e))}};var u=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.delayDurationSelector))},e}(),l=function(e){function t(t,n){e.call(this,t),this.delayDurationSelector=n,this.completed=!1,this.delayNotifierSubscriptions=[],this.values=[]}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.destination.next(e),this.removeSubscription(r),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){try{var t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e),n=null;return-1!==t&&(n=this.values[t],this.delayNotifierSubscriptions.splice(t,1),this.values.splice(t,1)),n},t.prototype.tryDelay=function(e,t){var n=s.subscribeToResult(this,e,t);n&&!n.closed&&(this.add(n),this.delayNotifierSubscriptions.push(n)),this.values.push(t)},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(o.OuterSubscriber),c=function(e){function t(t,n){e.call(this),this.source=t,this.subscriptionDelay=n}return i(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new h(e,this.source))},t}(a.Observable),h=function(e){function t(t,n){e.call(this),this.parent=t,this.source=n,this.sourceSubscribed=!1}return i(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(r.Subscriber)},45745:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.dematerialize=function(){return function(e){return e.lift(new a)}};var a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new o(e))},e}(),o=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(r.Subscriber)},52334:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620),o=n(64888);t.distinct=function(e,t){return function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.keySelector,this.flushes))},e}(),u=function(e){function t(t,n,i){e.call(this,t),this.keySelector=n,this.values=new o.Set,i&&this.add(a.subscribeToResult(this,i))}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.values.clear()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(i){return void n.error(i)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(r.OuterSubscriber);t.DistinctSubscriber=u},18817:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(66226),o=n(57812);t.distinctUntilChanged=function(e,t){return function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.compare,this.keySelector))},e}(),u=function(e){function t(t,n,i){e.call(this,t),this.keySelector=i,this.hasKey=!1,"function"==typeof n&&(this.compare=n)}return i(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t=e;if(this.keySelector&&(t=a.tryCatch(this.keySelector)(e))===o.errorObject)return this.destination.error(o.errorObject.e);var n=!1;if(this.hasKey){if((n=a.tryCatch(this.compare)(this.key,t))===o.errorObject)return this.destination.error(o.errorObject.e)}else this.hasKey=!0;!1===Boolean(n)&&(this.key=t,this.destination.next(e))},t}(r.Subscriber)},68738:function(e,t,n){"use strict";var i=n(18817);t.distinctUntilKeyChanged=function(e,t){return i.distinctUntilChanged(function(n,i){return t?t(n[e],i[e]):n[e]===i[e]})}},17207:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(44589);t.elementAt=function(e,t){return function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){if(this.index=e,this.defaultValue=t,e<0)throw new a.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.index,this.defaultValue))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.index=n,this.defaultValue=i}return i(t,e),t.prototype._next=function(e){0==this.index--&&(this.destination.next(e),this.destination.complete())},t.prototype._complete=function(){var e=this.destination;this.index>=0&&(void 0!==this.defaultValue?e.next(this.defaultValue):e.error(new a.ArgumentOutOfRangeError)),e.complete()},t}(r.Subscriber)},65514:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.every=function(e,t){return function(n){return n.lift(new a(e,t,n))}};var a=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.thisArg,this.source))},e}(),o=function(e){function t(t,n,i,r){e.call(this,t),this.predicate=n,this.thisArg=i,this.source=r,this.index=0,this.thisArg=i||this}return i(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(r.Subscriber)},44333:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.exhaust=function(){return function(e){return e.lift(new o)}};var o=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new s(e))},e}(),s=function(e){function t(t){e.call(this,t),this.hasCompleted=!1,this.hasSubscription=!1}return i(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(a.subscribeToResult(this,e)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(r.OuterSubscriber)},97292:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.exhaustMap=function(e,t){return function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.resultSelector))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.project=n,this.resultSelector=i,this.hasSubscription=!1,this.hasCompleted=!1,this.index=0}return i(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++,n=this.destination;try{var i=this.project(e,t);this.hasSubscription=!0,this.add(a.subscribeToResult(this,i,e,t))}catch(r){n.error(r)}},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.destination;this.resultSelector?this.trySelectResult(e,t,n,i):a.next(t)},t.prototype.trySelectResult=function(e,t,n,i){var r=this.resultSelector,a=this.destination;try{var o=r(e,t,n,i);a.next(o)}catch(s){a.error(s)}},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(r.OuterSubscriber)},85011:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(66226),a=n(57812),o=n(257),s=n(34620);t.expand=function(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(i){return i.lift(new u(e,t,n))}};var u=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project,this.concurrent,this.scheduler))},e}();t.ExpandOperator=u;var l=function(e){function t(t,n,i,r){e.call(this,t),this.project=n,this.concurrent=i,this.scheduler=r,this.index=0,this.active=0,this.hasCompleted=!1,i<Number.POSITIVE_INFINITY&&(this.buffer=[])}return i(t,e),t.dispatch=function(e){e.subscriber.subscribeToProjection(e.result,e.value,e.index)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var i=this.index++;if(this.active<this.concurrent){n.next(e);var o=r.tryCatch(this.project)(e,i);o===a.errorObject?n.error(a.errorObject.e):this.scheduler?this.add(this.scheduler.schedule(t.dispatch,0,{subscriber:this,result:o,value:e,index:i})):this.subscribeToProjection(o,e,i)}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.add(s.subscribeToResult(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){this._next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(o.OuterSubscriber);t.ExpandSubscriber=l},54057:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.filter=function(e,t){return function(n){return n.lift(new a(e,t))}};var a=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.thisArg))},e}(),o=function(e){function t(t,n,i){e.call(this,t),this.predicate=n,this.thisArg=i,this.count=0}return i(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(r.Subscriber)},81469:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(83326);t.finalize=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.callback))},e}(),s=function(e){function t(t,n){e.call(this,t),this.add(new a.Subscription(n))}return i(t,e),t}(r.Subscriber)},51968:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.find=function(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new a(e,n,!1,t))}};var a=function(){function e(e,t,n,i){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=i}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}();t.FindValueOperator=a;var o=function(e){function t(t,n,i,r,a){e.call(this,t),this.predicate=n,this.source=i,this.yieldIndex=r,this.thisArg=a,this.index=0}return i(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,i=this.index++;try{t.call(n||this,e,i,this.source)&&this.notifyComplete(this.yieldIndex?i:e)}catch(r){this.destination.error(r)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(r.Subscriber);t.FindValueSubscriber=o},32555:function(e,t,n){"use strict";var i=n(51968);t.findIndex=function(e,t){return function(n){return n.lift(new i.FindValueOperator(e,n,!0,t))}}},50362:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(76042);t.first=function(e,t,n){return function(i){return i.lift(new o(e,t,n,i))}};var o=function(){function e(e,t,n,i){this.predicate=e,this.resultSelector=t,this.defaultValue=n,this.source=i}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),s=function(e){function t(t,n,i,r,a){e.call(this,t),this.predicate=n,this.resultSelector=i,this.defaultValue=r,this.source=a,this.index=0,this.hasCompleted=!1,this._emitted=!1}return i(t,e),t.prototype._next=function(e){var t=this.index++;this.predicate?this._tryPredicate(e,t):this._emit(e,t)},t.prototype._tryPredicate=function(e,t){var n;try{n=this.predicate(e,t,this.source)}catch(i){return void this.destination.error(i)}n&&this._emit(e,t)},t.prototype._emit=function(e,t){this.resultSelector?this._tryResultSelector(e,t):this._emitFinal(e)},t.prototype._tryResultSelector=function(e,t){var n;try{n=this.resultSelector(e,t)}catch(i){return void this.destination.error(i)}this._emitFinal(n)},t.prototype._emitFinal=function(e){var t=this.destination;this._emitted||(this._emitted=!0,t.next(e),t.complete(),this.hasCompleted=!0)},t.prototype._complete=function(){var e=this.destination;this.hasCompleted||void 0===this.defaultValue?this.hasCompleted||e.error(new a.EmptyError):(e.next(this.defaultValue),e.complete())},t}(r.Subscriber)},89136:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(83326),o=n(56437),s=n(82503),u=n(84930),l=n(72758);t.groupBy=function(e,t,n,i){return function(r){return r.lift(new c(e,t,n,i))}};var c=function(){function e(e,t,n,i){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=i}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),h=function(e){function t(t,n,i,r,a){e.call(this,t),this.keySelector=n,this.elementSelector=i,this.durationSelector=r,this.subjectSelector=a,this.groups=null,this.attemptedToUnsubscribe=!1,this.count=0}return i(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(n){return void this.error(n)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups="string"==typeof t?new l.FastMap:new u.Map);var i,r=n.get(t);if(this.elementSelector)try{i=this.elementSelector(e)}catch(c){this.error(c)}else i=e;if(!r){r=this.subjectSelector?this.subjectSelector():new s.Subject,n.set(t,r);var a=new d(t,r,this);if(this.destination.next(a),this.durationSelector){var o=void 0;try{o=this.durationSelector(new d(t,r))}catch(c){return void this.error(c)}this.add(o.subscribe(new p(t,r,this)))}}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(r.Subscriber),p=function(e){function t(t,n,i){e.call(this,n),this.key=t,this.group=n,this.parent=i}return i(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(r.Subscriber),d=function(e){function t(t,n,i){e.call(this),this.key=t,this.groupSubject=n,this.refCountSubscription=i}return i(t,e),t.prototype._subscribe=function(e){var t=new a.Subscription,n=this.refCountSubscription,i=this.groupSubject;return n&&!n.closed&&t.add(new f(n)),t.add(i.subscribe(e)),t},t}(o.Observable);t.GroupedObservable=d;var f=function(e){function t(t){e.call(this),this.parent=t,t.count++}return i(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(a.Subscription)},91766:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(53617);t.ignoreElements=function(){return function(e){return e.lift(new o)}};var o=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new s(e))},e}(),s=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype._next=function(e){a.noop()},t}(r.Subscriber)},30605:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.isEmpty=function(){return function(e){return e.lift(new a)}};var a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new o(e))},e}(),o=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(r.Subscriber)},13490:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(76042);t.last=function(e,t,n){return function(i){return i.lift(new o(e,t,n,i))}};var o=function(){function e(e,t,n,i){this.predicate=e,this.resultSelector=t,this.defaultValue=n,this.source=i}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.resultSelector,this.defaultValue,this.source))},e}(),s=function(e){function t(t,n,i,r,a){e.call(this,t),this.predicate=n,this.resultSelector=i,this.defaultValue=r,this.source=a,this.hasValue=!1,this.index=0,void 0!==r&&(this.lastValue=r,this.hasValue=!0)}return i(t,e),t.prototype._next=function(e){var t=this.index++;if(this.predicate)this._tryPredicate(e,t);else{if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},t.prototype._tryPredicate=function(e,t){var n;try{n=this.predicate(e,t,this.source)}catch(i){return void this.destination.error(i)}if(n){if(this.resultSelector)return void this._tryResultSelector(e,t);this.lastValue=e,this.hasValue=!0}},t.prototype._tryResultSelector=function(e,t){var n;try{n=this.resultSelector(e,t)}catch(i){return void this.destination.error(i)}this.lastValue=n,this.hasValue=!0},t.prototype._complete=function(){var e=this.destination;this.hasValue?(e.next(this.lastValue),e.complete()):e.error(new a.EmptyError)},t}(r.Subscriber)},86589:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.map=function(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new a(e,t))}};var a=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.project,this.thisArg))},e}();t.MapOperator=a;var o=function(e){function t(t,n,i){e.call(this,t),this.project=n,this.count=0,this.thisArg=i||this}return i(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(r.Subscriber)},80330:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.mapTo=function(e){return function(t){return t.lift(new a(e))}};var a=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.value))},e}(),o=function(e){function t(t,n){e.call(this,t),this.value=n}return i(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(r.Subscriber)},61626:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(72995);t.materialize=function(){return function(e){return e.lift(new o)}};var o=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new s(e))},e}(),s=function(e){function t(t){e.call(this,t)}return i(t,e),t.prototype._next=function(e){this.destination.next(a.Notification.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(a.Notification.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(a.Notification.createComplete()),e.complete()},t}(r.Subscriber)},2874:function(e,t,n){"use strict";var i=n(69203);t.max=function(e){return i.reduce("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})}},63066:function(e,t,n){"use strict";var i=n(55067);t.mergeStatic=n(55067).merge,t.merge=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){return t.lift.call(i.merge.apply(void 0,[t].concat(e)))}}},23455:function(e,t,n){"use strict";var i=n(55049),r=n(55032);t.mergeAll=function(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),i.mergeMap(r.identity,null,e)}},55049:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(34620),a=n(257);t.mergeMap=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(i){return"number"==typeof t&&(n=t,t=null),i.lift(new o(e,t,n))}};var o=function(){function e(e,t,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.project=e,this.resultSelector=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.resultSelector,this.concurrent))},e}();t.MergeMapOperator=o;var s=function(e){function t(t,n,i,r){void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this,t),this.project=n,this.resultSelector=i,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return i(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){this.add(r.subscribeToResult(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){this.resultSelector?this._notifyResultSelector(e,t,n,i):this.destination.next(t)},t.prototype._notifyResultSelector=function(e,t,n,i){var r;try{r=this.resultSelector(e,t,n,i)}catch(a){return void this.destination.error(a)}this.destination.next(r)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(a.OuterSubscriber);t.MergeMapSubscriber=s},97165:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.mergeMapTo=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"number"==typeof t&&(n=t,t=null),function(i){return i.lift(new o(e,t,n))}};var o=function(){function e(e,t,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.ish=e,this.resultSelector=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.ish,this.resultSelector,this.concurrent))},e}();t.MergeMapToOperator=o;var s=function(e){function t(t,n,i,r){void 0===r&&(r=Number.POSITIVE_INFINITY),e.call(this,t),this.ish=n,this.resultSelector=i,this.concurrent=r,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return i(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.resultSelector,n=this.index++,i=this.ish,r=this.destination;this.active++,this._innerSub(i,r,t,e,n)}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n,i,r){this.add(a.subscribeToResult(this,e,i,r))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.destination;this.resultSelector?this.trySelectResult(e,t,n,i):a.next(t)},t.prototype.trySelectResult=function(e,t,n,i){var r,a=this.resultSelector,o=this.destination;try{r=a(e,t,n,i)}catch(s){return void o.error(s)}o.next(r)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(r.OuterSubscriber);t.MergeMapToSubscriber=s},60083:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(66226),a=n(57812),o=n(34620),s=n(257);t.mergeScan=function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(i){return i.lift(new u(e,t,n))}};var u=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.accumulator,this.seed,this.concurrent))},e}();t.MergeScanOperator=u;var l=function(e){function t(t,n,i,r){e.call(this,t),this.accumulator=n,this.acc=i,this.concurrent=r,this.hasValue=!1,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return i(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=r.tryCatch(this.accumulator)(this.acc,e);n===a.errorObject?this.destination.error(a.errorObject.e):(this.active++,this._innerSub(n,e,t))}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n){this.add(o.subscribeToResult(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.destination;this.acc=t,this.hasValue=!0,a.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(s.OuterSubscriber);t.MergeScanSubscriber=l},59626:function(e,t,n){"use strict";var i=n(69203);t.min=function(e){return i.reduce("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})}},75068:function(e,t,n){"use strict";var i=n(25569);t.multicast=function(e,t){return function(n){var a;if(a="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new r(a,t));var o=Object.create(n,i.connectableObservableDescriptor);return o.source=n,o.subjectFactory=a,o}};var r=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,i=this.subjectFactory(),r=n(i).subscribe(e);return r.add(t.subscribe(i)),r},e}();t.MulticastOperator=r},52921:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(72995);t.observeOn=function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.scheduler,this.delay))},e}();t.ObserveOnOperator=o;var s=function(e){function t(t,n,i){void 0===i&&(i=0),e.call(this,t),this.scheduler=n,this.delay=i}return i(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new u(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(a.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(a.Notification.createError(e))},t.prototype._complete=function(){this.scheduleMessage(a.Notification.createComplete())},t}(r.Subscriber);t.ObserveOnSubscriber=s;var u=function(e,t){this.notification=e,this.destination=t};t.ObserveOnMessage=u},19582:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(34843),a=n(9939),o=n(257),s=n(34620);t.onErrorResumeNext=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 1===e.length&&a.isArray(e[0])&&(e=e[0]),function(t){return t.lift(new u(e))}},t.onErrorResumeNextStatic=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=null;return 1===e.length&&a.isArray(e[0])&&(e=e[0]),n=e.shift(),new r.FromObservable(n,null).lift(new u(e))};var u=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.nextSources))},e}(),l=function(e){function t(t,n){e.call(this,t),this.destination=t,this.nextSources=n}return i(t,e),t.prototype.notifyError=function(e,t){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource()},t.prototype._complete=function(){this.subscribeToNextSource()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();e?this.add(s.subscribeToResult(this,e)):this.destination.complete()},t}(o.OuterSubscriber)},61132:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.pairwise=function(){return function(e){return e.lift(new a)}};var a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new o(e))},e}(),o=function(e){function t(t){e.call(this,t),this.hasPrev=!1}return i(t,e),t.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},t}(r.Subscriber)},43407:function(e,t,n){"use strict";var i=n(17127),r=n(54057);t.partition=function(e,t){return function(n){return[r.filter(e,t)(n),r.filter(i.not(e,t))(n)]}}},29798:function(e,t,n){"use strict";var i=n(86589);function r(e,t){return function(n){for(var i=n,r=0;r<t;r++){var a=i[e[r]];if(void 0===a)return;i=a}return i}}t.pluck=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return i.map(r(e,n))(t)}}},49948:function(e,t,n){"use strict";var i=n(82503),r=n(75068);t.publish=function(e){return e?r.multicast(function(){return new i.Subject},e):r.multicast(new i.Subject)}},61228:function(e,t,n){"use strict";var i=n(75140),r=n(75068);t.publishBehavior=function(e){return function(t){return r.multicast(new i.BehaviorSubject(e))(t)}}},89172:function(e,t,n){"use strict";var i=n(17090),r=n(75068);t.publishLast=function(){return function(e){return r.multicast(new i.AsyncSubject)(e)}}},31781:function(e,t,n){"use strict";var i=n(64336),r=n(75068);t.publishReplay=function(e,t,n,a){n&&"function"!=typeof n&&(a=n);var o="function"==typeof n?n:void 0,s=new i.ReplaySubject(e,t,a);return function(e){return r.multicast(function(){return s},o)(e)}}},87109:function(e,t,n){"use strict";var i=n(9939),r=n(9360);t.race=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){return 1===e.length&&i.isArray(e[0])&&(e=e[0]),t.lift.call(r.race.apply(void 0,[t].concat(e)))}}},69203:function(e,t,n){"use strict";var i=n(59042),r=n(82699),a=n(1583),o=n(28187);t.reduce=function(e,t){return arguments.length>=2?function(n){return o.pipe(i.scan(e,t),r.takeLast(1),a.defaultIfEmpty(t))(n)}:function(t){return o.pipe(i.scan(function(t,n,i){return e(t,n,i+1)}),r.takeLast(1))(t)}}},24702:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.refCount=function(){return function(e){return e.lift(new a(e))}};var a=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var i=new o(e,n),r=t.subscribe(i);return i.closed||(i.connection=n.connect()),r},e}(),o=function(e){function t(t,n){e.call(this,t),this.connectable=n}return i(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,i=e._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null},t}(r.Subscriber)},2983:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(70699);t.repeat=function(e){return void 0===e&&(e=-1),function(t){return 0===e?new a.EmptyObservable:t.lift(new o(e<0?-1:e-1,t))}};var o=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.count,this.source))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.count=n,this.source=i}return i(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(r.Subscriber)},3027:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(66226),o=n(57812),s=n(257),u=n(34620);t.repeatWhen=function(e){return function(t){return t.lift(new l(e))}};var l=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.notifier,t))},e}(),c=function(e){function t(t,n,i){e.call(this,t),this.notifier=n,this.source=i,this.sourceIsBeingSubscribedTo=!0}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype._unsubscribeAndRecycle=function(){var t=this.notifications,n=this.retries,i=this.retriesSubscription;return this.notifications=null,this.retries=null,this.retriesSubscription=null,e.prototype._unsubscribeAndRecycle.call(this),this.notifications=t,this.retries=n,this.retriesSubscription=i,this},t.prototype.subscribeToRetries=function(){this.notifications=new r.Subject;var t=a.tryCatch(this.notifier)(this.notifications);if(t===o.errorObject)return e.prototype.complete.call(this);this.retries=t,this.retriesSubscription=u.subscribeToResult(this,t)},t}(s.OuterSubscriber)},31043:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.retry=function(e){return void 0===e&&(e=-1),function(t){return t.lift(new a(e,t))}};var a=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.count,this.source))},e}(),o=function(e){function t(t,n,i){e.call(this,t),this.count=n,this.source=i}return i(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,i=this.count;if(0===i)return e.prototype.error.call(this,t);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(r.Subscriber)},58164:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(66226),o=n(57812),s=n(257),u=n(34620);t.retryWhen=function(e){return function(t){return t.lift(new l(e,t))}};var l=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.notifier,this.source))},e}(),c=function(e){function t(t,n,i){e.call(this,t),this.notifier=n,this.source=i}return i(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,i=this.retries,s=this.retriesSubscription;if(i)this.errors=null,this.retriesSubscription=null;else{if(n=new r.Subject,(i=a.tryCatch(this.notifier)(n))===o.errorObject)return e.prototype.error.call(this,o.errorObject.e);s=u.subscribeToResult(this,i)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=i,this.retriesSubscription=s,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.errors,o=this.retries,s=this.retriesSubscription;this.errors=null,this.retries=null,this.retriesSubscription=null,this._unsubscribeAndRecycle(),this.errors=a,this.retries=o,this.retriesSubscription=s,this.source.subscribe(this)},t}(s.OuterSubscriber)},80540:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.sample=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new s(e),i=t.subscribe(n);return i.add(a.subscribeToResult(n,this.notifier)),i},e}(),s=function(e){function t(){e.apply(this,arguments),this.hasValue=!1}return i(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(e,t,n,i,r){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(r.OuterSubscriber)},68744:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(6163);t.sampleTime=function(e,t){return void 0===t&&(t=a.async),function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.period,this.scheduler))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.period=n,this.scheduler=i,this.hasValue=!1,this.add(i.schedule(u,n,{subscriber:this,period:n}))}return i(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(r.Subscriber);function u(e){var t=e.period;e.subscriber.notifyNext(),this.schedule(e,t)}},59042:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.scan=function(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(i){return i.lift(new a(e,t,n))}};var a=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.accumulator,this.seed,this.hasSeed))},e}(),o=function(e){function t(t,n,i,r){e.call(this,t),this.accumulator=n,this._seed=i,this.hasSeed=r,this.index=0}return i(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(i){this.destination.error(i)}this.seed=t,this.destination.next(t)},t}(r.Subscriber)},32198:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(66226),o=n(57812);t.sequenceEqual=function(e,t){return function(n){return n.lift(new s(e,t))}};var s=function(){function e(e,t){this.compareTo=e,this.comparor=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.compareTo,this.comparor))},e}();t.SequenceEqualOperator=s;var u=function(e){function t(t,n,i){e.call(this,t),this.compareTo=n,this.comparor=i,this._a=[],this._b=[],this._oneComplete=!1,this.add(n.subscribe(new l(t,this)))}return i(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t.prototype.checkValues=function(){for(var e=this._a,t=this._b,n=this.comparor;e.length>0&&t.length>0;){var i=e.shift(),r=t.shift(),s=!1;n?(s=a.tryCatch(n)(i,r))===o.errorObject&&this.destination.error(o.errorObject.e):s=i===r,s||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t}(r.Subscriber);t.SequenceEqualSubscriber=u;var l=function(e){function t(t,n){e.call(this,t),this.parent=n}return i(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e)},t.prototype._complete=function(){this.parent._complete()},t}(r.Subscriber)},93361:function(e,t,n){"use strict";var i=n(75068),r=n(24702),a=n(82503);function o(){return new a.Subject}t.share=function(){return function(e){return r.refCount()(i.multicast(o)(e))}}},56555:function(e,t,n){"use strict";var i=n(64336);t.shareReplay=function(e,t,n){return function(r){return r.lift(function(e,t,n){var r,a,o=0,s=!1,u=!1;return function(l){o++,r&&!s||(s=!1,r=new i.ReplaySubject(e,t,n),a=l.subscribe({next:function(e){r.next(e)},error:function(e){s=!0,r.error(e)},complete:function(){u=!0,r.complete()}}));var c=r.subscribe(this);return function(){o--,c.unsubscribe(),a&&0===o&&u&&a.unsubscribe()}}}(e,t,n))}}},36920:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(76042);t.single=function(e){return function(t){return t.lift(new o(e,t))}};var o=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.predicate,this.source))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.predicate=n,this.source=i,this.seenValue=!1,this.index=0}return i(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new a.EmptyError)},t}(r.Subscriber)},68097:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.skip=function(e){return function(t){return t.lift(new a(e))}};var a=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.total))},e}(),o=function(e){function t(t,n){e.call(this,t),this.total=n,this.count=0}return i(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(r.Subscriber)},62687:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(44589);t.skipLast=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new a.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(0===this._skipCount?new r.Subscriber(e):new s(e,this._skipCount))},e}(),s=function(e){function t(t,n){e.call(this,t),this._skipCount=n,this._count=0,this._ring=new Array(n)}return i(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var i=n%t,r=this._ring,a=r[i];r[i]=e,this.destination.next(a)}},t}(r.Subscriber)},17136:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.skipUntil=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.notifier))},e}(),s=function(e){function t(t,n){e.call(this,t),this.hasValue=!1,this.isInnerStopped=!1,this.add(a.subscribeToResult(this,n))}return i(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype._complete=function(){this.isInnerStopped?e.prototype._complete.call(this):this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,i,r){this.hasValue=!0},t.prototype.notifyComplete=function(){this.isInnerStopped=!0,this.isStopped&&e.prototype._complete.call(this)},t}(r.OuterSubscriber)},14460:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.skipWhile=function(e){return function(t){return t.lift(new a(e))}};var a=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate))},e}(),o=function(e){function t(t,n){e.call(this,t),this.predicate=n,this.skipping=!0,this.index=0}return i(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(n){this.destination.error(n)}},t}(r.Subscriber)},13690:function(e,t,n){"use strict";var i=n(4655),r=n(36027),a=n(70699),o=n(41948),s=n(12774);t.startWith=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){var n=e[e.length-1];s.isScheduler(n)?e.pop():n=null;var u=e.length;return o.concat(1===u?new r.ScalarObservable(e[0],n):u>1?new i.ArrayObservable(e,n):new a.EmptyObservable(n),t)}}},10480:function(e,t,n){"use strict";var i=n(13981);t.subscribeOn=function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new r(e,t))}};var r=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new i.SubscribeOnObservable(t,this.delay,this.scheduler).subscribe(e)},e}()},77211:function(e,t,n){"use strict";var i=n(17232),r=n(55032);t.switchAll=function(){return i.switchMap(r.identity)}},17232:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.switchMap=function(e,t){return function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.project=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.project,this.resultSelector))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.project=n,this.resultSelector=i,this.index=0}return i(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(i){return void this.destination.error(i)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var i=this.innerSubscription;i&&i.unsubscribe(),this.add(this.innerSubscription=a.subscribeToResult(this,e,t,n))},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,i,r){this.resultSelector?this._tryNotifyNext(e,t,n,i):this.destination.next(t)},t.prototype._tryNotifyNext=function(e,t,n,i){var r;try{r=this.resultSelector(e,t,n,i)}catch(a){return void this.destination.error(a)}this.destination.next(r)},t}(r.OuterSubscriber)},12744:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.switchMapTo=function(e,t){return function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.observable=e,this.resultSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.observable,this.resultSelector))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.inner=n,this.resultSelector=i,this.index=0}return i(t,e),t.prototype._next=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),this.add(this.innerSubscription=a.subscribeToResult(this,this.inner,e,this.index++))},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,i,r){var a=this.destination;this.resultSelector?this.tryResultSelector(e,t,n,i):a.next(t)},t.prototype.tryResultSelector=function(e,t,n,i){var r,a=this.resultSelector,o=this.destination;try{r=a(e,t,n,i)}catch(s){return void o.error(s)}o.next(r)},t}(r.OuterSubscriber)},59806:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(44589),o=n(70699);t.take=function(e){return function(t){return 0===e?new o.EmptyObservable:t.lift(new s(e))}};var s=function(){function e(e){if(this.total=e,this.total<0)throw new a.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){e.call(this,t),this.total=n,this.count=0}return i(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(r.Subscriber)},82699:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(44589),o=n(70699);t.takeLast=function(e){return function(t){return 0===e?new o.EmptyObservable:t.lift(new s(e))}};var s=function(){function e(e){if(this.total=e,this.total<0)throw new a.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){e.call(this,t),this.total=n,this.ring=new Array,this.count=0}return i(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,i=this.count++;t.length<n?t.push(e):t[i%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,i=this.ring,r=0;r<n;r++){var a=t++%n;e.next(i[a])}e.complete()},t}(r.Subscriber)},52887:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.takeUntil=function(e){return function(t){return t.lift(new o(e))}};var o=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.notifier))},e}(),s=function(e){function t(t,n){e.call(this,t),this.notifier=n,this.add(a.subscribeToResult(this,n))}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.complete()},t.prototype.notifyComplete=function(){},t}(r.OuterSubscriber)},496:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.takeWhile=function(e){return function(t){return t.lift(new a(e))}};var a=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.predicate))},e}(),o=function(e){function t(t,n){e.call(this,t),this.predicate=n,this.index=0}return i(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(i){return void n.error(i)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):n.complete()},t}(r.Subscriber)},24642:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164);t.tap=function(e,t,n){return function(i){return i.lift(new a(e,t,n))}};var a=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new o(e,this.nextOrObserver,this.error,this.complete))},e}(),o=function(e){function t(t,n,i,a){e.call(this,t);var o=new r.Subscriber(n,i,a);o.syncErrorThrowable=!0,this.add(o),this.safeSubscriber=o}return i(t,e),t.prototype._next=function(e){var t=this.safeSubscriber;t.next(e),t.syncErrorThrown?this.destination.error(t.syncErrorValue):this.destination.next(e)},t.prototype._error=function(e){var t=this.safeSubscriber;t.error(e),this.destination.error(t.syncErrorThrown?t.syncErrorValue:e)},t.prototype._complete=function(){var e=this.safeSubscriber;e.complete(),e.syncErrorThrown?this.destination.error(e.syncErrorValue):this.destination.complete()},t}(r.Subscriber)},29378:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.defaultThrottleConfig={leading:!0,trailing:!1},t.throttle=function(e,n){return void 0===n&&(n=t.defaultThrottleConfig),function(t){return t.lift(new o(e,n.leading,n.trailing))}};var o=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.durationSelector,this.leading,this.trailing))},e}(),s=function(e){function t(t,n,i,r){e.call(this,t),this.destination=t,this.durationSelector=n,this._leading=i,this._trailing=r,this._hasTrailingValue=!1}return i(t,e),t.prototype._next=function(e){if(this.throttled)this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=e);else{var t=this.tryDurationSelector(e);t&&this.add(this.throttled=a.subscribeToResult(this,t)),this._leading&&(this.destination.next(e),this._trailing&&(this._hasTrailingValue=!0,this._trailingValue=e))}},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(t){return this.destination.error(t),null}},t.prototype._unsubscribe=function(){var e=this.throttled;this._trailingValue=null,this._hasTrailingValue=!1,e&&(this.remove(e),this.throttled=null,e.unsubscribe())},t.prototype._sendTrailing=function(){var e=this;e.throttled&&e._trailing&&e._hasTrailingValue&&(e.destination.next(e._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1)},t.prototype.notifyNext=function(e,t,n,i,r){this._sendTrailing(),this._unsubscribe()},t.prototype.notifyComplete=function(){this._sendTrailing(),this._unsubscribe()},t}(r.OuterSubscriber)},17786:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(6163),o=n(29378);t.throttleTime=function(e,t,n){return void 0===t&&(t=a.async),void 0===n&&(n=o.defaultThrottleConfig),function(i){return i.lift(new s(e,t,n.leading,n.trailing))}};var s=function(){function e(e,t,n,i){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=i}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),u=function(e){function t(t,n,i,r,a){e.call(this,t),this.duration=n,this.scheduler=i,this.leading=r,this.trailing=a,this._hasTrailingValue=!1,this._trailingValue=null}return i(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(l,this.duration,{subscriber:this})),this.leading&&this.destination.next(e))},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(r.Subscriber);function l(e){e.subscriber.clearThrottle()}},41401:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(6163);t.timeInterval=function(e){return void 0===e&&(e=a.async),function(t){return t.lift(new s(e))}};var o=function(e,t){this.value=e,this.interval=t};t.TimeInterval=o;var s=function(){function e(e){this.scheduler=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.scheduler))},e}(),u=function(e){function t(t,n){e.call(this,t),this.scheduler=n,this.lastTime=0,this.lastTime=n.now()}return i(t,e),t.prototype._next=function(e){var t=this.scheduler.now(),n=t-this.lastTime;this.lastTime=t,this.destination.next(new o(e,n))},t}(r.Subscriber)},12687:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(6163),a=n(79286),o=n(84164),s=n(23003);t.timeout=function(e,t){void 0===t&&(t=r.async);var n=a.isDate(e),i=n?+e-t.now():Math.abs(e);return function(e){return e.lift(new u(i,n,t,new s.TimeoutError))}};var u=function(){function e(e,t,n,i){this.waitFor=e,this.absoluteTimeout=t,this.scheduler=n,this.errorInstance=i}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.absoluteTimeout,this.waitFor,this.scheduler,this.errorInstance))},e}(),l=function(e){function t(t,n,i,r,a){e.call(this,t),this.absoluteTimeout=n,this.waitFor=i,this.scheduler=r,this.errorInstance=a,this.action=null,this.scheduleTimeout()}return i(t,e),t.dispatchTimeout=function(e){e.error(e.errorInstance)},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.errorInstance=null},t}(o.Subscriber)},45252:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(6163),a=n(79286),o=n(257),s=n(34620);t.timeoutWith=function(e,t,n){return void 0===n&&(n=r.async),function(i){var r=a.isDate(e),o=r?+e-n.now():Math.abs(e);return i.lift(new u(o,r,t,n))}};var u=function(){function e(e,t,n,i){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=i}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),l=function(e){function t(t,n,i,r,a){e.call(this,t),this.absoluteTimeout=n,this.waitFor=i,this.withObservable=r,this.scheduler=a,this.action=null,this.scheduleTimeout()}return i(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(s.subscribeToResult(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},t}(o.OuterSubscriber)},71609:function(e,t,n){"use strict";var i=n(6163),r=n(86589);t.timestamp=function(e){return void 0===e&&(e=i.async),r.map(function(t){return new a(t,e.now())})};var a=function(e,t){this.value=e,this.timestamp=t};t.Timestamp=a},43056:function(e,t,n){"use strict";var i=n(69203);function r(e,t,n){return 0===n?[t]:(e.push(t),e)}t.toArray=function(){return i.reduce(r,[])}},89883:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(257),o=n(34620);t.window=function(e){return function(t){return t.lift(new s(e))}};var s=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new u(e),i=t.subscribe(n);return i.closed||n.add(o.subscribeToResult(n,this.windowBoundaries)),i},e}(),u=function(e){function t(t){e.call(this,t),this.window=new r.Subject,t.next(this.window)}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.openWindow()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new r.Subject;t.next(n)},t}(a.OuterSubscriber)},5588:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(84164),a=n(82503);t.windowCount=function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}};var o=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.windowSize,this.startWindowEvery))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.destination=t,this.windowSize=n,this.startWindowEvery=i,this.windows=[new a.Subject],this.count=0,t.next(this.windows[0])}return i(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,i=this.windowSize,r=this.windows,o=r.length,s=0;s<o&&!this.closed;s++)r[s].next(e);var u=this.count-i+1;if(u>=0&&u%t==0&&!this.closed&&r.shift().complete(),++this.count%t==0&&!this.closed){var l=new a.Subject;r.push(l),n.next(l)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(r.Subscriber)},65795:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(6163),o=n(84164),s=n(65593),u=n(12774);t.windowTime=function(e){var t=a.async,n=null,i=Number.POSITIVE_INFINITY;return u.isScheduler(arguments[3])&&(t=arguments[3]),u.isScheduler(arguments[2])?t=arguments[2]:s.isNumeric(arguments[2])&&(i=arguments[2]),u.isScheduler(arguments[1])?t=arguments[1]:s.isNumeric(arguments[1])&&(n=arguments[1]),function(r){return r.lift(new l(e,n,i,t))}};var l=function(){function e(e,t,n,i){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=i}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),c=function(e){function t(){e.apply(this,arguments),this._numberOfNextedValues=0}return i(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(r.Subject),h=function(e){function t(t,n,i,r,a){e.call(this,t),this.destination=t,this.windowTimeSpan=n,this.windowCreationInterval=i,this.maxWindowSize=r,this.scheduler=a,this.windows=[];var o=this.openWindow();if(null!==i&&i>=0){var s={windowTimeSpan:n,windowCreationInterval:i,subscriber:this,scheduler:a};this.add(a.schedule(f,n,{subscriber:this,window:o,context:null})),this.add(a.schedule(d,i,s))}else this.add(a.schedule(p,n,{subscriber:this,window:o,windowTimeSpan:n}))}return i(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,i=0;i<n;i++){var r=t[i];r.closed||(r.next(e),r.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(r))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new c;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(o.Subscriber);function p(e){var t=e.subscriber,n=e.windowTimeSpan,i=e.window;i&&t.closeWindow(i),e.window=t.openWindow(),this.schedule(e,n)}function d(e){var t=e.windowTimeSpan,n=e.subscriber,i=e.scheduler,r=e.windowCreationInterval,a=n.openWindow(),o={action:this,subscription:null};o.subscription=i.schedule(f,t,{subscriber:n,window:a,context:o}),this.add(o.subscription),this.schedule(e,r)}function f(e){var t=e.subscriber,n=e.window,i=e.context;i&&i.action&&i.subscription&&i.action.remove(i.subscription),t.closeWindow(n)}},53375:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(83326),o=n(66226),s=n(57812),u=n(257),l=n(34620);t.windowToggle=function(e,t){return function(n){return n.lift(new c(e,t))}};var c=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.openings,this.closingSelector))},e}(),h=function(e){function t(t,n,i){e.call(this,t),this.openings=n,this.closingSelector=i,this.contexts=[],this.add(this.openSubscription=l.subscribeToResult(this,n,n))}return i(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,i=0;i<n;i++)t[i].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var i=n.length,r=-1;++r<i;){var a=n[r];a.window.error(t),a.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,i=-1;++i<n;){var r=t[i];r.window.complete(),r.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var i=e[n];i.window.unsubscribe(),i.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,i,u){if(e===this.openings){var c=o.tryCatch(this.closingSelector)(t);if(c===s.errorObject)return this.error(s.errorObject.e);var h=new r.Subject,p=new a.Subscription,d={window:h,subscription:p};this.contexts.push(d);var f=l.subscribeToResult(this,c,d);f.closed?this.closeWindow(this.contexts.length-1):(f.context=d,p.add(f)),this.destination.next(h)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],i=n.window,r=n.subscription;t.splice(e,1),i.complete(),r.unsubscribe()}},t}(u.OuterSubscriber)},55937:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(66226),o=n(57812),s=n(257),u=n(34620);t.windowWhen=function(e){return function(t){return t.lift(new l(e))}};var l=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.closingSelector))},e}(),c=function(e){function t(t,n){e.call(this,t),this.destination=t,this.closingSelector=n,this.openWindow()}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.openWindow(r)},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n=this.window=new r.Subject;this.destination.next(n);var i=a.tryCatch(this.closingSelector)();if(i===o.errorObject){var s=o.errorObject.e;this.destination.error(s),this.window.error(s)}else this.add(this.closingNotification=u.subscribeToResult(this,i))},t}(s.OuterSubscriber)},93252:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(257),a=n(34620);t.withLatestFrom=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new o(e,n))}};var o=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new s(e,this.observables,this.project))},e}(),s=function(e){function t(t,n,i){e.call(this,t),this.observables=n,this.project=i,this.toRespond=[];var r=n.length;this.values=new Array(r);for(var o=0;o<r;o++)this.toRespond.push(o);for(o=0;o<r;o++){var s=n[o];this.add(a.subscribeToResult(this,s,s,o))}}return i(t,e),t.prototype.notifyNext=function(e,t,n,i,r){this.values[n]=t;var a=this.toRespond;if(a.length>0){var o=a.indexOf(n);-1!==o&&a.splice(o,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(r.OuterSubscriber)},2902:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(4655),a=n(9939),o=n(84164),s=n(257),u=n(34620),l=n(13950);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),new r.ArrayObservable(e).lift(new h(n))}t.zip=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t){return t.lift.call(c.apply(void 0,[t].concat(e)))}},t.zipStatic=c;var h=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new p(e,this.project))},e}();t.ZipOperator=h;var p=function(e){function t(t,n,i){void 0===i&&(i=Object.create(null)),e.call(this,t),this.iterators=[],this.active=0,this.project="function"==typeof n?n:null,this.values=i}return i(t,e),t.prototype._next=function(e){var t=this.iterators;a.isArray(e)?t.push(new f(e)):t.push("function"==typeof e[l.iterator]?new d(e[l.iterator]()):new v(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(0!==t){this.active=t;for(var n=0;n<t;n++){var i=e[n];i.stillUnsubscribed?this.add(i.subscribe(i,n)):this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,i=0;i<t;i++)if("function"==typeof(o=e[i]).hasValue&&!o.hasValue())return;var r=!1,a=[];for(i=0;i<t;i++){var o,s=(o=e[i]).next();if(o.hasCompleted()&&(r=!0),s.done)return void n.complete();a.push(s.value)}this.project?this._tryProject(a):n.next(a),r&&n.complete()},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(o.Subscriber);t.ZipSubscriber=p;var d=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),f=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[l.iterator]=function(){return this},e.prototype.next=function(e){var t=this.index++;return t<this.length?{value:this.array[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),v=function(e){function t(t,n,i){e.call(this,t),this.parent=n,this.observable=i,this.stillUnsubscribed=!0,this.buffer=[],this.isComplete=!1}return i(t,e),t.prototype[l.iterator]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e,t,n,i,r){this.buffer.push(t),this.parent.checkIterators()},t.prototype.subscribe=function(e,t){return u.subscribeToResult(this,this.observable,this,t)},t}(s.OuterSubscriber)},84575:function(e,t,n){"use strict";var i=n(2902);t.zipAll=function(e){return function(t){return t.lift(new i.ZipOperator(e))}}},48733:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n){e.call(this)}return i(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(83326).Subscription);t.Action=r},20390:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(79748),a=n(78166),o=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.work=n}return i(t,e),t.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),null!==i&&i>0?e.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t.scheduled||(t.scheduled=a.AnimationFrame.requestAnimationFrame(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,i);0===t.actions.length&&(a.AnimationFrame.cancelAnimationFrame(n),t.scheduled=void 0)},t}(r.AsyncAction);t.AnimationFrameAction=o},57938:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,i=-1,r=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++i<r&&(e=n.shift()));if(this.active=!1,t){for(;++i<r&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(30987).AsyncScheduler);t.AnimationFrameScheduler=r},42084:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(46312),a=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.work=n}return i(t,e),t.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),null!==i&&i>0?e.prototype.requestAsyncId.call(this,t,n,i):(t.actions.push(this),t.scheduled||(t.scheduled=r.Immediate.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,i);0===t.actions.length&&(r.Immediate.clearImmediate(n),t.scheduled=void 0)},t}(n(79748).AsyncAction);t.AsapAction=a},56454:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,i=-1,r=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++i<r&&(e=n.shift()));if(this.active=!1,t){for(;++i<r&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(30987).AsyncScheduler);t.AsapScheduler=r},79748:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(70276),a=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.pending=!1,this.work=n}return i(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,this.pending=!0;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),r.root.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;r.root.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,i=void 0;try{this.work(e)}catch(r){n=!0,i=!!r&&r||new Error(r)}if(n)return this.unsubscribe(),i},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(n(48733).Action);t.AsyncAction=a},30987:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){e.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return i(t,e),t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(n(11984).Scheduler);t.AsyncScheduler=r},53832:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(t,n){e.call(this,t,n),this.scheduler=t,this.work=n}return i(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,i):t.flush(this)},t}(n(79748).AsyncAction);t.QueueAction=r},32274:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=function(e){function t(){e.apply(this,arguments)}return i(t,e),t}(n(30987).AsyncScheduler);t.QueueScheduler=r},75315:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(79748),a=function(e){function t(t,n){var i=this;void 0===t&&(t=o),void 0===n&&(n=Number.POSITIVE_INFINITY),e.call(this,t,function(){return i.frame}),this.maxFrames=n,this.frame=0,this.index=-1}return i(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,i=this.maxFrames;(t=n.shift())&&(this.frame=t.delay)<=i&&!(e=t.execute(t.state,t.delay)););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(n(30987).AsyncScheduler);t.VirtualTimeScheduler=a;var o=function(e){function t(t,n,i){void 0===i&&(i=t.index+=1),e.call(this,t,n),this.scheduler=t,this.work=n,this.index=i,this.active=!0,this.index=t.index=i}return i(t,e),t.prototype.schedule=function(n,i){if(void 0===i&&(i=0),!this.id)return e.prototype.schedule.call(this,n,i);this.active=!1;var r=new t(this.scheduler,this.work);return this.add(r),r.schedule(n,i)},t.prototype.requestAsyncId=function(e,n,i){void 0===i&&(i=0),this.delay=e.frame+i;var r=e.actions;return r.push(this),r.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(r.AsyncAction);t.VirtualAction=o},37263:function(e,t,n){"use strict";var i=n(20390);t.animationFrame=new(n(57938).AnimationFrameScheduler)(i.AnimationFrameAction)},9688:function(e,t,n){"use strict";var i=n(42084);t.asap=new(n(56454).AsapScheduler)(i.AsapAction)},6163:function(e,t,n){"use strict";var i=n(79748);t.async=new(n(30987).AsyncScheduler)(i.AsyncAction)},37869:function(e,t,n){"use strict";var i=n(53832);t.queue=new(n(32274).QueueScheduler)(i.QueueAction)},13950:function(e,t,n){"use strict";var i=n(70276);function r(e){var t=e.Symbol;if("function"==typeof t)return t.iterator||(t.iterator=t("iterator polyfill")),t.iterator;var n=e.Set;if(n&&"function"==typeof(new n)["@@iterator"])return"@@iterator";var i=e.Map;if(i)for(var r=Object.getOwnPropertyNames(i.prototype),a=0;a<r.length;++a){var o=r[a];if("entries"!==o&&"size"!==o&&i.prototype[o]===i.prototype.entries)return o}return"@@iterator"}t.symbolIteratorPonyfill=r,t.iterator=r(i.root),t.$$iterator=t.iterator},61275:function(e,t,n){"use strict";var i=n(70276);function r(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}t.getSymbolObservable=r,t.observable=r(i.root),t.$$observable=t.observable},79903:function(e,t,n){"use strict";var i=n(70276).root.Symbol;t.rxSubscriber="function"==typeof i&&"function"==typeof i.for?i.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},12186:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(83326),o=function(e){function t(t,n){e.call(this,function(e){var t=this,n=t.logSubscribedFrame();return e.add(new a.Subscription(function(){t.logUnsubscribedFrame(n)})),t.scheduleMessages(e),e}),this.messages=t,this.subscriptions=[],this.scheduler=n}return i(t,e),t.prototype.scheduleMessages=function(e){for(var t=this.messages.length,n=0;n<t;n++){var i=this.messages[n];e.add(this.scheduler.schedule(function(e){e.message.notification.observe(e.subscriber)},i.frame,{message:i,subscriber:e}))}},t}(r.Observable);t.ColdObservable=o},71011:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(82503),a=n(83326),o=function(e){function t(t,n){e.call(this),this.messages=t,this.subscriptions=[],this.scheduler=n}return i(t,e),t.prototype._subscribe=function(t){var n=this,i=n.logSubscribedFrame();return t.add(new a.Subscription(function(){n.logUnsubscribedFrame(i)})),e.prototype._subscribe.call(this,t)},t.prototype.setup=function(){for(var e=this,t=e.messages.length,n=0;n<t;n++)!function(){var t=e.messages[n];e.scheduler.schedule(function(){t.notification.observe(e)},t.frame)}()},t}(r.Subject);t.HotObservable=o},35841:function(e,t){"use strict";t.SubscriptionLog=function(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.subscribedFrame=e,this.unsubscribedFrame=t}},68662:function(e,t,n){"use strict";var i=n(35841);t.SubscriptionLoggable=function(){function e(){this.subscriptions=[]}return e.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new i.SubscriptionLog(this.scheduler.now())),this.subscriptions.length-1},e.prototype.logUnsubscribedFrame=function(e){var t=this.subscriptions;t[e]=new i.SubscriptionLog(t[e].subscribedFrame,this.scheduler.now())},e}()},75363:function(e,t,n){"use strict";var i=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},r=n(56437),a=n(72995),o=n(12186),s=n(71011),u=n(35841),l=n(75315),c=function(e){function t(t){e.call(this,l.VirtualAction,750),this.assertDeepEqual=t,this.hotObservables=[],this.coldObservables=[],this.flushTests=[]}return i(t,e),t.prototype.createTime=function(e){var n=e.indexOf("|");if(-1===n)throw new Error('marble diagram for time should have a completion marker "|"');return n*t.frameTimeFactor},t.prototype.createColdObservable=function(e,n,i){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var r=t.parseMarbles(e,n,i),a=new o.ColdObservable(r,this);return this.coldObservables.push(a),a},t.prototype.createHotObservable=function(e,n,i){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var r=t.parseMarbles(e,n,i),a=new s.HotObservable(r,this);return this.hotObservables.push(a),a},t.prototype.materializeInnerObservable=function(e,t){var n=this,i=[];return e.subscribe(function(e){i.push({frame:n.frame-t,notification:a.Notification.createNext(e)})},function(e){i.push({frame:n.frame-t,notification:a.Notification.createError(e)})},function(){i.push({frame:n.frame-t,notification:a.Notification.createComplete()})}),i},t.prototype.expectObservable=function(e,n){var i=this;void 0===n&&(n=null);var o,s=[],u={actual:s,ready:!1},l=t.parseMarblesAsSubscriptions(n).unsubscribedFrame;return this.schedule(function(){o=e.subscribe(function(e){var t=e;e instanceof r.Observable&&(t=i.materializeInnerObservable(t,i.frame)),s.push({frame:i.frame,notification:a.Notification.createNext(t)})},function(e){s.push({frame:i.frame,notification:a.Notification.createError(e)})},function(){s.push({frame:i.frame,notification:a.Notification.createComplete()})})},0),l!==Number.POSITIVE_INFINITY&&this.schedule(function(){return o.unsubscribe()},l),this.flushTests.push(u),{toBe:function(e,n,i){u.ready=!0,u.expected=t.parseMarbles(e,n,i,!0)}}},t.prototype.expectSubscriptions=function(e){var n={actual:e,ready:!1};return this.flushTests.push(n),{toBe:function(e){var i="string"==typeof e?[e]:e;n.ready=!0,n.expected=i.map(function(e){return t.parseMarblesAsSubscriptions(e)})}}},t.prototype.flush=function(){for(var t=this.hotObservables;t.length>0;)t.shift().setup();e.prototype.flush.call(this);for(var n=this.flushTests.filter(function(e){return e.ready});n.length>0;){var i=n.shift();this.assertDeepEqual(i.actual,i.expected)}},t.parseMarblesAsSubscriptions=function(e){if("string"!=typeof e)return new u.SubscriptionLog(Number.POSITIVE_INFINITY);for(var t=e.length,n=-1,i=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,a=0;a<t;a++){var o=a*this.frameTimeFactor,s=e[a];switch(s){case"-":case" ":break;case"(":n=o;break;case")":n=-1;break;case"^":if(i!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");i=n>-1?n:o;break;case"!":if(r!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");r=n>-1?n:o;break;default:throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+s+"'.")}}return r<0?new u.SubscriptionLog(i):new u.SubscriptionLog(i,r)},t.parseMarbles=function(e,t,n,i){if(void 0===i&&(i=!1),-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var r=e.length,s=[],u=e.indexOf("^"),l=-1===u?0:u*-this.frameTimeFactor,c="object"!=typeof t?function(e){return e}:function(e){return i&&t[e]instanceof o.ColdObservable?t[e].messages:t[e]},h=-1,p=0;p<r;p++){var d=p*this.frameTimeFactor+l,f=void 0,v=e[p];switch(v){case"-":case" ":break;case"(":h=d;break;case")":h=-1;break;case"|":f=a.Notification.createComplete();break;case"^":break;case"#":f=a.Notification.createError(n||"error");break;default:f=a.Notification.createNext(c(v))}f&&s.push({frame:h>-1?h:d,notification:f})}return s},t}(l.VirtualTimeScheduler);t.TestScheduler=c},78166:function(e,t,n){"use strict";var i=n(70276),r=function(e){e.requestAnimationFrame?(this.cancelAnimationFrame=e.cancelAnimationFrame.bind(e),this.requestAnimationFrame=e.requestAnimationFrame.bind(e)):e.mozRequestAnimationFrame?(this.cancelAnimationFrame=e.mozCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.mozRequestAnimationFrame.bind(e)):e.webkitRequestAnimationFrame?(this.cancelAnimationFrame=e.webkitCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.webkitRequestAnimationFrame.bind(e)):e.msRequestAnimationFrame?(this.cancelAnimationFrame=e.msCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.msRequestAnimationFrame.bind(e)):e.oRequestAnimationFrame?(this.cancelAnimationFrame=e.oCancelAnimationFrame.bind(e),this.requestAnimationFrame=e.oRequestAnimationFrame.bind(e)):(this.cancelAnimationFrame=e.clearTimeout.bind(e),this.requestAnimationFrame=function(t){return e.setTimeout(t,1e3/60)})};t.RequestAnimationFrameDefinition=r,t.AnimationFrame=new r(i.root)},44589:function(e,t){"use strict";var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},i=function(e){function t(){var t=e.call(this,"argument out of range");this.name=t.name="ArgumentOutOfRangeError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);t.ArgumentOutOfRangeError=i},76042:function(e,t){"use strict";var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},i=function(e){function t(){var t=e.call(this,"no elements in sequence");this.name=t.name="EmptyError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);t.EmptyError=i},72758:function(e,t){"use strict";t.FastMap=function(){function e(){this.values={}}return e.prototype.delete=function(e){return this.values[e]=null,!0},e.prototype.set=function(e,t){return this.values[e]=t,this},e.prototype.get=function(e){return this.values[e]},e.prototype.forEach=function(e,t){var n=this.values;for(var i in n)n.hasOwnProperty(i)&&null!==n[i]&&e.call(t,n[i],i)},e.prototype.clear=function(){this.values={}},e}()},46312:function(e,t,n){"use strict";var i=n(70276),r=function(){function e(e){if(this.root=e,e.setImmediate&&"function"==typeof e.setImmediate)this.setImmediate=e.setImmediate.bind(e),this.clearImmediate=e.clearImmediate.bind(e);else{this.nextHandle=1,this.tasksByHandle={},this.currentlyRunningATask=!1,this.setImmediate=this.canUseProcessNextTick()?this.createProcessNextTickSetImmediate():this.canUsePostMessage()?this.createPostMessageSetImmediate():this.canUseMessageChannel()?this.createMessageChannelSetImmediate():this.canUseReadyStateChange()?this.createReadyStateChangeSetImmediate():this.createSetTimeoutSetImmediate();var t=function e(t){delete e.instance.tasksByHandle[t]};t.instance=this,this.clearImmediate=t}}return e.prototype.identify=function(e){return this.root.Object.prototype.toString.call(e)},e.prototype.canUseProcessNextTick=function(){return"[object process]"===this.identify(this.root.process)},e.prototype.canUseMessageChannel=function(){return Boolean(this.root.MessageChannel)},e.prototype.canUseReadyStateChange=function(){var e=this.root.document;return Boolean(e&&"onreadystatechange"in e.createElement("script"))},e.prototype.canUsePostMessage=function(){var e=this.root;if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}return!1},e.prototype.partiallyApplied=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=function e(){var t=e.handler;"function"==typeof t?t.apply(void 0,e.args):new Function(""+t)()};return i.handler=e,i.args=t,i},e.prototype.addFromSetImmediateArguments=function(e){return this.tasksByHandle[this.nextHandle]=this.partiallyApplied.apply(void 0,e),this.nextHandle++},e.prototype.createProcessNextTickSetImmediate=function(){var e=function e(){var t=e.instance,n=t.addFromSetImmediateArguments(arguments);return t.root.process.nextTick(t.partiallyApplied(t.runIfPresent,n)),n};return e.instance=this,e},e.prototype.createPostMessageSetImmediate=function(){var e=this.root,t="setImmediate$"+e.Math.random()+"$",n=function n(i){var r=n.instance;i.source===e&&"string"==typeof i.data&&0===i.data.indexOf(t)&&r.runIfPresent(+i.data.slice(t.length))};n.instance=this,e.addEventListener("message",n,!1);var i=function e(){var t=e,n=t.messagePrefix,i=t.instance,r=i.addFromSetImmediateArguments(arguments);return i.root.postMessage(n+r,"*"),r};return i.instance=this,i.messagePrefix=t,i},e.prototype.runIfPresent=function(e){if(this.currentlyRunningATask)this.root.setTimeout(this.partiallyApplied(this.runIfPresent,e),0);else{var t=this.tasksByHandle[e];if(t){this.currentlyRunningATask=!0;try{t()}finally{this.clearImmediate(e),this.currentlyRunningATask=!1}}}},e.prototype.createMessageChannelSetImmediate=function(){var e=this,t=new this.root.MessageChannel;t.port1.onmessage=function(t){e.runIfPresent(t.data)};var n=function e(){var t=e,n=t.channel,i=t.instance,r=i.addFromSetImmediateArguments(arguments);return n.port2.postMessage(r),r};return n.channel=t,n.instance=this,n},e.prototype.createReadyStateChangeSetImmediate=function(){var e=function e(){var t=e.instance,n=t.root,i=n.document,r=i.documentElement,a=t.addFromSetImmediateArguments(arguments),o=i.createElement("script");return o.onreadystatechange=function(){t.runIfPresent(a),o.onreadystatechange=null,r.removeChild(o),o=null},r.appendChild(o),a};return e.instance=this,e},e.prototype.createSetTimeoutSetImmediate=function(){var e=function e(){var t=e.instance,n=t.addFromSetImmediateArguments(arguments);return t.root.setTimeout(t.partiallyApplied(t.runIfPresent,n),0),n};return e.instance=this,e},e}();t.ImmediateDefinition=r,t.Immediate=new r(i.root)},84930:function(e,t,n){"use strict";var i=n(70276),r=n(28481);t.Map=i.root.Map||r.MapPolyfill},28481:function(e,t){"use strict";t.MapPolyfill=function(){function e(){this.size=0,this._values=[],this._keys=[]}return e.prototype.get=function(e){var t=this._keys.indexOf(e);return-1===t?void 0:this._values[t]},e.prototype.set=function(e,t){var n=this._keys.indexOf(e);return-1===n?(this._keys.push(e),this._values.push(t),this.size++):this._values[n]=t,this},e.prototype.delete=function(e){var t=this._keys.indexOf(e);return-1!==t&&(this._values.splice(t,1),this._keys.splice(t,1),this.size--,!0)},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},e.prototype.forEach=function(e,t){for(var n=0;n<this.size;n++)e.call(t,this._values[n],this._keys[n])},e}()},72e3:function(e,t){"use strict";var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},i=function(e){function t(){var t=e.call(this,"object unsubscribed");this.name=t.name="ObjectUnsubscribedError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);t.ObjectUnsubscribedError=i},64888:function(e,t,n){"use strict";var i=n(70276);function r(){return function(){function e(){this._values=[]}return e.prototype.add=function(e){this.has(e)||this._values.push(e)},e.prototype.has=function(e){return-1!==this._values.indexOf(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._values.length=0},e}()}t.minimalSetImpl=r,t.Set=i.root.Set||r()},23003:function(e,t){"use strict";var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},i=function(e){function t(){var t=e.call(this,"Timeout has occurred");this.name=t.name="TimeoutError",this.stack=t.stack,this.message=t.message}return n(t,e),t}(Error);t.TimeoutError=i},63369:function(e,t){"use strict";var n=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},i=function(e){function t(t){e.call(this),this.errors=t;var n=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=n.name="UnsubscriptionError",this.stack=n.stack,this.message=n.message}return n(t,e),t}(Error);t.UnsubscriptionError=i},48983:function(e,t){"use strict";t.applyMixins=function(e,t){for(var n=0,i=t.length;n<i;n++)for(var r=t[n],a=Object.getOwnPropertyNames(r.prototype),o=0,s=a.length;o<s;o++){var u=a[o];e.prototype[u]=r.prototype[u]}}},65369:function(e,t,n){"use strict";var i=n(70276);function r(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=t.length,r=0;r<i;r++){var a=t[r];for(var o in a)a.hasOwnProperty(o)&&(e[o]=a[o])}return e}function a(e){return e.Object.assign||r}t.assignImpl=r,t.getAssign=a,t.assign=a(i.root)},57812:function(e,t){"use strict";t.errorObject={e:{}}},55032:function(e,t){"use strict";t.identity=function(e){return e}},9939:function(e,t){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},30899:function(e,t){"use strict";t.isArrayLike=function(e){return e&&"number"==typeof e.length}},79286:function(e,t){"use strict";t.isDate=function(e){return e instanceof Date&&!isNaN(+e)}},8398:function(e,t){"use strict";t.isFunction=function(e){return"function"==typeof e}},65593:function(e,t,n){"use strict";var i=n(9939);t.isNumeric=function(e){return!i.isArray(e)&&e-parseFloat(e)+1>=0}},71953:function(e,t){"use strict";t.isObject=function(e){return null!=e&&"object"==typeof e}},98598:function(e,t){"use strict";t.isPromise=function(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}},12774:function(e,t){"use strict";t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},53617:function(e,t){"use strict";t.noop=function(){}},17127:function(e,t){"use strict";t.not=function(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}},28187:function(e,t,n){"use strict";var i=n(53617);function r(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:i.noop}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return r(e)},t.pipeFromArray=r},70276:function(e,t){"use strict";var n="undefined"!=typeof window&&window,i="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,r="undefined"!=typeof global&&global;t.root=n||r||i},34620:function(e,t,n){"use strict";var i=n(70276),r=n(30899),a=n(98598),o=n(71953),s=n(56437),u=n(13950),l=n(52731),c=n(61275);t.subscribeToResult=function(e,t,n,h){var p=new l.InnerSubscriber(e,n,h);if(p.closed)return null;if(t instanceof s.Observable)return t._isScalar?(p.next(t.value),p.complete(),null):(p.syncErrorThrowable=!0,t.subscribe(p));if(r.isArrayLike(t)){for(var d=0,f=t.length;d<f&&!p.closed;d++)p.next(t[d]);p.closed||p.complete()}else{if(a.isPromise(t))return t.then(function(e){p.closed||(p.next(e),p.complete())},function(e){return p.error(e)}).then(null,function(e){i.root.setTimeout(function(){throw e})}),p;if(t&&"function"==typeof t[u.iterator])for(var v=t[u.iterator]();;){var m=v.next();if(m.done){p.complete();break}if(p.next(m.value),p.closed)break}else if(t&&"function"==typeof t[c.observable]){var g=t[c.observable]();if("function"==typeof g.subscribe)return g.subscribe(new l.InnerSubscriber(e,n,h));p.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var y=o.isObject(t)?"an invalid object":"'"+t+"'";p.error(new TypeError("You provided "+y+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))}}return null}},7622:function(e,t,n){"use strict";var i=n(84164),r=n(79903),a=n(89377);t.toSubscriber=function(e,t,n){if(e){if(e instanceof i.Subscriber)return e;if(e[r.rxSubscriber])return e[r.rxSubscriber]()}return e||t||n?new i.Subscriber(e,t,n):new i.Subscriber(a.empty)}},66226:function(e,t,n){"use strict";var i,r=n(57812);function a(){try{return i.apply(this,arguments)}catch(e){return r.errorObject.e=e,r.errorObject}}t.tryCatch=function(e){return i=e,a}},88952:function(u,h,f){"use strict";f.r(h),f.d(h,{ShopModule:function(){return j_}});var y=f(61116),_=f(35366),S=f(55959),T=["payPalButtonContainer"],E=function(){var e=function(){function e(t){M(this,e),this.zone=t}return k(e,[{key:"registerScript",value:function(e,t,n){var i=this,r=window[t];if(r)this.zone.run(function(){n(r)});else{var a=document.createElement("script");a.id=this.getElemId(t),a.innerHTML="",a.onload=function(){i.zone.run(function(){n(window[t])})},a.src=e,a.async=!0,a.defer=!0,document.getElementsByTagName("head")[0].appendChild(a)}}},{key:"cleanup",value:function(e){var t=document.getElementById(this.getElemId(e));t&&t.remove()}},{key:"getElemId",value:function(e){return"ngx-paypal-script-elem-".concat(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.LFG(_.R0b))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac}),e}(),A=function(){var e=function(){function e(t){M(this,e),this.scriptService=t,this.paypalWindowName="paypal"}return k(e,[{key:"registerPayPalScript",value:function(e,t){this.scriptService.registerScript(this.getUrlForConfig(e),this.paypalWindowName,t)}},{key:"destroyPayPalScript",value:function(){this.scriptService.cleanup(this.paypalWindowName)}},{key:"getUrlForConfig",value:function(e){var t=[{name:"client-id",value:e.clientId}];return e.currency&&t.push({name:"currency",value:e.currency}),e.commit&&t.push({name:"commit",value:e.commit}),e.vault&&t.push({name:"vault",value:e.vault}),e.extraParams&&t.push.apply(t,w(e.extraParams)),"https://www.paypal.com/sdk/js".concat(this.getQueryString(t))}},{key:"getQueryString",value:function(e){for(var t="",n=0;n<e.length;n++){var i=e[n];t+=0===n?"?":"&",t+="".concat(i.name,"=").concat(i.value)}return t}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.LFG(E))},e.\u0275prov=_.Yz7({token:e,factory:e.\u0275fac}),e}(),C=function(){var e=function(){function e(t,n,i){M(this,e),this.paypalScriptService=t,this.cdr=n,this.ngZone=i,this.registerScript=!0,this.scriptLoaded=new _.vpe,this.ngUnsubscribe=new S.xQ,this.initializePayPal=!0}return k(e,[{key:"payPalButtonContainer",set:function(e){this.payPalButtonContainerElem=e}},{key:"ngOnChanges",value:function(e){var t=this;this.payPalButtonContainerId||(this.payPalButtonContainerId=this.generateElementId());var n=this.config;e.config.isFirstChange()&&n&&this.registerScript&&this.initPayPalScript(n,function(e){t.payPal=e,t.doPayPalCheck()}),e.config.isFirstChange()||this.reinitialize(n)}},{key:"ngOnDestroy",value:function(){this.paypalScriptService.destroyPayPalScript(),this.ngUnsubscribe.next(),this.ngUnsubscribe.complete()}},{key:"ngAfterViewInit",value:function(){this.doPayPalCheck()}},{key:"customInit",value:function(e){this.payPal=e,this.doPayPalCheck()}},{key:"reinitialize",value:function(e){var t=this;if(this.config=e,this.payPal=void 0,this.paypalScriptService.destroyPayPalScript(),this.payPalButtonContainerId=this.generateElementId(),this.initializePayPal=!0,this.payPalButtonContainerElem)for(;this.payPalButtonContainerElem.nativeElement.firstChild;)this.payPalButtonContainerElem.nativeElement.removeChild(this.payPalButtonContainerElem.nativeElement.firstChild);this.cdr.detectChanges(),this.config&&(this.payPal?this.doPayPalCheck():this.initPayPalScript(this.config,function(e){t.payPal=e,t.doPayPalCheck()}))}},{key:"doPayPalCheck",value:function(){this.initializePayPal&&this.config&&this.payPal&&this.payPalButtonContainerElem&&this.payPalButtonContainerElem.nativeElement.id&&(this.initializePayPal=!1,this.initPayPal(this.config,this.payPal))}},{key:"initPayPalScript",value:function(e,t){var n=this;this.paypalScriptService.registerPayPalScript({clientId:e.clientId,commit:e.advanced&&e.advanced.commit?e.advanced.commit:void 0,currency:e.currency,vault:e.vault,extraParams:e.advanced&&e.advanced.extraQueryParams?e.advanced.extraQueryParams:[]},function(e){n.scriptLoaded.next(e),t(e)})}},{key:"generateElementId",value:function(){return"ngx-captcha-id-".concat((new Date).valueOf())}},{key:"initPayPal",value:function(e,t){var n=this;this.ngZone.runOutsideAngular(function(){var i=Object.assign(Object.assign(Object.assign({style:e.style,onApprove:function(t,i){return n.ngZone.run(function(){if(e.onApprove&&e.onApprove(t,i),e.authorizeOnServer)return e.authorizeOnServer(t,i);var r=e.onClientAuthorization;r&&i.order.capture().then(function(e){n.ngZone.run(function(){r(e)})})})},onError:function(t){n.ngZone.run(function(){e.onError&&e.onError(t)})},onCancel:function(t,i){n.ngZone.run(function(){e.onCancel&&e.onCancel(t,i)})},onClick:function(t,i){n.ngZone.run(function(){e.onClick&&e.onClick(t,i)})},onInit:function(t,i){n.ngZone.run(function(){e.onInit&&e.onInit(t,i)})}},(e.createOrderOnClient||e.createOrderOnServer)&&{createOrder:function(t,i){return n.ngZone.run(function(){if(e.createOrderOnClient&&e.createOrderOnServer)throw Error("Both 'createOrderOnClient' and 'createOrderOnServer' are defined.\n                    Please choose one or the other.");if(!e.createOrderOnClient&&!e.createOrderOnServer)throw Error("Neither 'createOrderOnClient' or 'createOrderOnServer' are defined.\n                    Please define one of these to create order.");if(e.createOrderOnClient)return i.order.create(e.createOrderOnClient(t));if(e.createOrderOnServer)return e.createOrderOnServer(t);throw Error("Invalid state for 'createOrder'.")})}}),e.createSubscription&&{createSubscription:function(t,i){return n.ngZone.run(function(){if(e.createSubscription)return e.createSubscription(t,i)})}}),e.onShippingChange&&{onShippingChange:function(t,i){return n.ngZone.run(function(){if(e.onShippingChange)return e.onShippingChange(t,i)})}});t.Buttons(i).render("#".concat(n.payPalButtonContainerId))})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(A),_.Y36(_.sBO),_.Y36(_.R0b))},e.\u0275cmp=_.Xpm({type:e,selectors:[["ngx-paypal"]],viewQuery:function(e,t){var n;(1&e&&_.Gf(T,5),2&e)&&(_.iGM(n=_.CRH())&&(t.payPalButtonContainer=n.first))},inputs:{registerScript:"registerScript",config:"config"},outputs:{scriptLoaded:"scriptLoaded"},features:[_.TTD],decls:2,vars:1,consts:[[3,"id"],["payPalButtonContainer",""]],template:function(e,t){1&e&&_._UZ(0,"div",0,1),2&e&&_.Q6J("id",t.payPalButtonContainerId)},encapsulation:2,changeDetection:0}),e}(),O=function(){var e=function e(){M(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({providers:[E,A],imports:[[y.ez]]}),e}(),L=f(28412),R=f(42069),P=f(62057),I=f(31041),N=["tooltipTemplate"],D=["leftOuterSelectionBar"],F=["rightOuterSelectionBar"],U=["fullBar"],B=["selectionBar"],V=["minHandle"],H=["maxHandle"],z=["floorLabel"],Z=["ceilLabel"],G=["minHandleLabel"],j=["maxHandleLabel"],q=["combinedLabel"],W=["ticksElement"];function J(e,t){if(1&e&&_._UZ(0,"ng5-slider-tooltip-wrapper",31),2&e){var n=_.oxw().$implicit,i=_.oxw();_.Q6J("template",i.tooltipTemplate)("tooltip",n.valueTooltip)("placement",n.valueTooltipPlacement)("content",n.value)}}function Y(e,t){if(1&e&&_._UZ(0,"span",32),2&e){var n=_.oxw().$implicit;_.Q6J("innerHTML",n.legend,_.oJD)}}var X=function(e){return{"ng5-slider-selected":e}};function Q(e,t){if(1&e&&(_.TgZ(0,"span",27),_._UZ(1,"ng5-slider-tooltip-wrapper",28),_.YNc(2,J,1,4,"ng5-slider-tooltip-wrapper",29),_.YNc(3,Y,1,1,"span",30),_.qZA()),2&e){var n=t.$implicit,i=_.oxw();_.Q6J("ngClass",_.VKq(7,X,n.selected))("ngStyle",n.style),_.xp6(1),_.Q6J("template",i.tooltipTemplate)("tooltip",n.tooltip)("placement",n.tooltipPlacement),_.xp6(1),_.Q6J("ngIf",null!=n.value),_.xp6(1),_.Q6J("ngIf",null!=n.legend)}}function K(e,t){}function $(e,t){1&e&&_.YNc(0,K,0,0,"ng-template")}var ee=function(e,t,n){return{tooltip:e,placement:t,content:n}};function te(e,t){if(1&e&&(_.ynx(0),_.YNc(1,$,1,0,void 0,1),_.BQk()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngTemplateOutlet",n.template)("ngTemplateOutletContext",_.kEZ(2,ee,n.tooltip,n.placement,n.content))}}function ne(e,t){if(1&e&&(_.ynx(0),_.TgZ(1,"div",2),_._uU(2),_.qZA(),_.BQk()),2&e){var n=_.oxw();_.xp6(1),_.uIk("title",n.tooltip)("data-tooltip-placement",n.placement),_.xp6(1),_.hij(" ",n.content," ")}}var ie={Min:0,Max:1};ie[ie.Min]="Min",ie[ie.Max]="Max";var re={Low:0,High:1,Floor:2,Ceil:3,TickValue:4};re[re.Low]="Low",re[re.High]="High",re[re.Floor]="Floor",re[re.Ceil]="Ceil",re[re.TickValue]="TickValue";var ae=function e(){M(this,e),this.floor=0,this.ceil=null,this.step=1,this.minRange=null,this.maxRange=null,this.pushRange=!1,this.minLimit=null,this.maxLimit=null,this.translate=null,this.combineLabels=null,this.getLegend=null,this.stepsArray=null,this.bindIndexForStepsArray=!1,this.draggableRange=!1,this.draggableRangeOnly=!1,this.showSelectionBar=!1,this.showSelectionBarEnd=!1,this.showSelectionBarFromValue=null,this.showOuterSelectionBars=!1,this.hidePointerLabels=!1,this.hideLimitLabels=!1,this.autoHideLimitLabels=!0,this.readOnly=!1,this.disabled=!1,this.mouseEventsInterval=50,this.touchEventsInterval=50,this.inputEventsInterval=100,this.outputEventsInterval=100,this.showTicks=!1,this.showTicksValues=!1,this.tickStep=null,this.tickValueStep=1,this.ticksArray=null,this.ticksTooltip=null,this.ticksValuesTooltip=null,this.vertical=!1,this.getSelectionBarColor=null,this.getTickColor=null,this.getPointerColor=null,this.keyboardSupport=!0,this.scale=1,this.enforceStep=!0,this.enforceRange=!0,this.noSwitching=!1,this.onlyBindHandles=!1,this.rightToLeft=!1,this.reversedControls=!1,this.boundPointerLabels=!0,this.logScale=!1,this.customValueToPosition=null,this.customPositionToValue=null,this.precisionLimit=12,this.selectionBarGradient=null,this.ariaLabel=null,this.ariaLabelledBy=null,this.ariaLabelHigh=null,this.ariaLabelledByHigh=null,this.handleDimension=null,this.barDimension=null,this.animate=!0},oe=function e(){M(this,e)},se=function(){function e(){M(this,e)}return k(e,null,[{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"linearValueToPosition",value:function(e,t,n){return(e-t)/(n-t)}},{key:"logValueToPosition",value:function(e,t,n){return((e=Math.log(e))-(t=Math.log(t)))/((n=Math.log(n))-t)}},{key:"linearPositionToValue",value:function(e,t,n){return e*(n-t)+t}},{key:"logPositionToValue",value:function(e,t,n){return t=Math.log(t),n=Math.log(n),Math.exp(e*(n-t)+t)}},{key:"findStepIndex",value:function(e,t){for(var n=t.map(function(t){return Math.abs(e-t.value)}),i=0,r=0;r<t.length;r++)n[r]!==n[i]&&n[r]<n[i]&&(i=r);return i}}]),e}(),ue=function(){function e(){M(this,e)}return k(e,null,[{key:"isTouchEvent",value:function(e){return void 0!==window.TouchEvent?e instanceof TouchEvent:void 0!==e.touches}},{key:"isResizeObserverAvailable",value:function(){return void 0!==window.ResizeObserver}}]),e}(),le=function(){function e(){M(this,e)}return k(e,null,[{key:"roundToPrecisionLimit",value:function(e,t){return+e.toPrecision(t)}},{key:"clampToRange",value:function(e,t,n){return Math.min(Math.max(e,t),n)}}]),e}(),ce=function e(){M(this,e),this.eventName=null,this.events=null,this.eventsSubscription=null,this.teardownCallback=null},he=function(){function e(t){M(this,e),this.renderer=t}return k(e,[{key:"attachPassiveEventListener",value:function(e,t,n,i){if(!0!==P.Z.hasSupport)return this.attachEventListener(e,t,n,i);var r=new ce;r.eventName=t,r.events=new L.xQ;var a=function(e){r.events.next(e)};return e.addEventListener(t,a,{passive:!0,capture:!1}),r.teardownCallback=function(){e.removeEventListener(t,a,{passive:!0,capture:!1})},r.eventsSubscription=r.events.pipe(se.isNullOrUndefined(i)?(0,R.tap)(function(){}):(0,R.throttleTime)(i,void 0,{leading:!0,trailing:!0})).subscribe(function(e){n(e)}),r}},{key:"detachEventListener",value:function(e){se.isNullOrUndefined(e.eventsSubscription)||(e.eventsSubscription.unsubscribe(),e.eventsSubscription=null),se.isNullOrUndefined(e.events)||(e.events.complete(),e.events=null),se.isNullOrUndefined(e.teardownCallback)||(e.teardownCallback(),e.teardownCallback=null)}},{key:"attachEventListener",value:function(e,t,n,i){var r=new ce;return r.eventName=t,r.events=new L.xQ,r.teardownCallback=this.renderer.listen(e,t,function(e){r.events.next(e)}),r.eventsSubscription=r.events.pipe(se.isNullOrUndefined(i)?(0,R.tap)(function(){}):(0,R.throttleTime)(i,void 0,{leading:!0,trailing:!0})).subscribe(function(e){n(e)}),r}}]),e}(),pe=function(){var e=function(){function e(t,n,i){M(this,e),this.elemRef=t,this.renderer=n,this.changeDetectionRef=i,this._position=0,this._dimension=0,this._alwaysHide=!1,this._vertical=!1,this._scale=1,this.opacity=1,this.visibility="visible",this.left="",this.bottom="",this.height="",this.width="",this.eventListeners=[],this.eventListenerHelper=new he(this.renderer)}return k(e,[{key:"position",get:function(){return this._position}},{key:"dimension",get:function(){return this._dimension}},{key:"alwaysHide",get:function(){return this._alwaysHide}},{key:"vertical",get:function(){return this._vertical}},{key:"scale",get:function(){return this._scale}},{key:"setAlwaysHide",value:function(e){this._alwaysHide=e,this.visibility=e?"hidden":"visible"}},{key:"hide",value:function(){this.opacity=0}},{key:"show",value:function(){this.alwaysHide||(this.opacity=1)}},{key:"isVisible",value:function(){return!this.alwaysHide&&0!==this.opacity}},{key:"setVertical",value:function(e){this._vertical=e,this._vertical?(this.left="",this.width=""):(this.bottom="",this.height="")}},{key:"setScale",value:function(e){this._scale=e}},{key:"setPosition",value:function(e){this._position===e||this.isRefDestroyed()||this.changeDetectionRef.markForCheck(),this._position=e,this._vertical?this.bottom=Math.round(e)+"px":this.left=Math.round(e)+"px"}},{key:"calculateDimension",value:function(){var e=this.getBoundingClientRect();this._dimension=this.vertical?(e.bottom-e.top)*this.scale:(e.right-e.left)*this.scale}},{key:"setDimension",value:function(e){this._dimension===e||this.isRefDestroyed()||this.changeDetectionRef.markForCheck(),this._dimension=e,this._vertical?this.height=Math.round(e)+"px":this.width=Math.round(e)+"px"}},{key:"getBoundingClientRect",value:function(){return this.elemRef.nativeElement.getBoundingClientRect()}},{key:"on",value:function(e,t,n){var i=this.eventListenerHelper.attachEventListener(this.elemRef.nativeElement,e,t,n);this.eventListeners.push(i)}},{key:"onPassive",value:function(e,t,n){var i=this.eventListenerHelper.attachPassiveEventListener(this.elemRef.nativeElement,e,t,n);this.eventListeners.push(i)}},{key:"off",value:function(e){var t,n;se.isNullOrUndefined(e)?(t=[],n=this.eventListeners):(t=this.eventListeners.filter(function(t){return t.eventName!==e}),n=this.eventListeners.filter(function(t){return t.eventName===e}));var i,r=x(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.eventListenerHelper.detachEventListener(a)}}catch(o){r.e(o)}finally{r.f()}this.eventListeners=t}},{key:"isRefDestroyed",value:function(){return se.isNullOrUndefined(this.changeDetectionRef)||this.changeDetectionRef.destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(_.sBO))},e.\u0275dir=_.lG2({type:e,selectors:[["","ng5SliderElement",""]],hostVars:12,hostBindings:function(e,t){2&e&&_.Udp("opacity",t.opacity)("visibility",t.visibility)("left",t.left)("bottom",t.bottom)("height",t.height)("width",t.width)}}),e}(),de=function(){var e=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,i,r)).active=!1,a.role="",a.tabindex="",a.ariaOrientation="",a.ariaLabel="",a.ariaLabelledBy="",a.ariaValueNow="",a.ariaValueText="",a.ariaValueMin="",a.ariaValueMax="",a}return k(n,[{key:"focus",value:function(){this.elemRef.nativeElement.focus()}}]),n}(pe);return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(_.sBO))},e.\u0275dir=_.lG2({type:e,selectors:[["","ng5SliderHandle",""]],hostVars:11,hostBindings:function(e,t){2&e&&(_.uIk("role",t.role)("tabindex",t.tabindex)("aria-orientation",t.ariaOrientation)("aria-label",t.ariaLabel)("aria-labelledby",t.ariaLabelledBy)("aria-valuenow",t.ariaValueNow)("aria-valuetext",t.ariaValueText)("aria-valuemin",t.ariaValueMin)("aria-valuemax",t.ariaValueMax),_.ekj("ng5-slider-active",t.active))},features:[_.qOj]}),e}(),fe=function(){var e=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,i,r))._value=null,a}return k(n,[{key:"value",get:function(){return this._value}},{key:"setValue",value:function(e){var t=!1;!this.alwaysHide&&(se.isNullOrUndefined(this.value)||this.value.length!==e.length||this.value.length>0&&0===this.dimension)&&(t=!0),this._value=e,this.elemRef.nativeElement.innerHTML=e,t&&this.calculateDimension()}}]),n}(pe);return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.SBq),_.Y36(_.Qsj),_.Y36(_.sBO))},e.\u0275dir=_.lG2({type:e,selectors:[["","ng5SliderLabel",""]],features:[_.qOj]}),e}(),ve=function e(){M(this,e),this.selected=!1,this.style={},this.tooltip=null,this.tooltipPlacement=null,this.value=null,this.valueTooltip=null,this.valueTooltipPlacement=null,this.legend=null},me=function e(){M(this,e),this.active=!1,this.value=0,this.difference=0,this.position=0,this.lowLimit=0,this.highLimit=0},ge=function(){function e(){M(this,e)}return k(e,null,[{key:"compare",value:function(e,t){return!(se.isNullOrUndefined(e)&&se.isNullOrUndefined(t)||se.isNullOrUndefined(e)!==se.isNullOrUndefined(t)||e.value!==t.value||e.highValue!==t.highValue)}}]),e}(),ye=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return k(n,null,[{key:"compare",value:function(e,t){return!(se.isNullOrUndefined(e)&&se.isNullOrUndefined(t)||se.isNullOrUndefined(e)!==se.isNullOrUndefined(t)||e.value!==t.value||e.highValue!==t.highValue||e.forceChange!==t.forceChange)}}]),n}(ge),be={provide:I.JU,useExisting:(0,_.Gpc)(function(){return xe}),multi:!0},xe=function(){var e=function(){function e(t,n,i,r){M(this,e),this.renderer=t,this.elementRef=n,this.changeDetectionRef=i,this.zone=r,this.value=null,this.valueChange=new _.vpe,this.highValue=null,this.highValueChange=new _.vpe,this.options=new ae,this.userChangeStart=new _.vpe,this.userChange=new _.vpe,this.userChangeEnd=new _.vpe,this.initHasRun=!1,this.inputModelChangeSubject=new L.xQ,this.inputModelChangeSubscription=null,this.outputModelChangeSubject=new L.xQ,this.outputModelChangeSubscription=null,this.viewLowValue=null,this.viewHighValue=null,this.viewOptions=new ae,this.handleHalfDimension=0,this.maxHandlePosition=0,this.currentTrackingPointer=null,this.currentFocusPointer=null,this.firstKeyDown=!1,this.touchId=null,this.dragging=new me,this.sliderElementVerticalClass=!1,this.sliderElementAnimateClass=!1,this.sliderElementDisabledAttr=null,this.barStyle={},this.minPointerStyle={},this.maxPointerStyle={},this.fullBarTransparentClass=!1,this.selectionBarDraggableClass=!1,this.ticksUnderValuesClass=!1,this.intermediateTicks=!1,this.ticks=[],this.eventListenerHelper=null,this.onMoveEventListener=null,this.onEndEventListener=null,this.resizeObserver=null,this.onTouchedCallback=null,this.onChangeCallback=null,this.eventListenerHelper=new he(this.renderer)}return k(e,[{key:"manualRefresh",set:function(e){var t=this;this.unsubscribeManualRefresh(),this.manualRefreshSubscription=e.subscribe(function(){setTimeout(function(){return t.calculateViewDimensionsAndDetectChanges()})})}},{key:"triggerFocus",set:function(e){var t=this;this.unsubscribeTriggerFocus(),this.triggerFocusSubscription=e.subscribe(function(e){t.focusPointer(e)})}},{key:"range",get:function(){return!se.isNullOrUndefined(this.value)&&!se.isNullOrUndefined(this.highValue)}},{key:"showTicks",get:function(){return this.viewOptions.showTicks}},{key:"ngOnInit",value:function(){this.viewOptions=new ae,Object.assign(this.viewOptions,this.options),this.updateDisabledState(),this.updateVerticalState()}},{key:"ngAfterViewInit",value:function(){this.applyOptions(),this.subscribeInputModelChangeSubject(this.viewOptions.inputEventsInterval),this.subscribeOutputModelChangeSubject(this.viewOptions.outputEventsInterval),this.renormaliseModelValues(),this.viewLowValue=this.modelValueToViewValue(this.value),this.viewHighValue=this.range?this.modelValueToViewValue(this.highValue):null,this.updateVerticalState(),this.manageElementsStyle(),this.updateDisabledState(),this.calculateViewDimensions(),this.addAccessibility(),this.updateCeilLabel(),this.updateFloorLabel(),this.initHandles(),this.manageEventsBindings(),this.subscribeResizeObserver(),this.initHasRun=!0,this.isRefDestroyed()||this.changeDetectionRef.detectChanges()}},{key:"ngOnChanges",value:function(e){se.isNullOrUndefined(e.options)||this.onChangeOptions(),se.isNullOrUndefined(e.value)&&se.isNullOrUndefined(e.highValue)||this.inputModelChangeSubject.next({value:this.value,highValue:this.highValue,forceChange:!1,internalChange:!1})}},{key:"ngOnDestroy",value:function(){this.unbindEvents(),this.unsubscribeResizeObserver(),this.unsubscribeInputModelChangeSubject(),this.unsubscribeOutputModelChangeSubject(),this.unsubscribeManualRefresh(),this.unsubscribeTriggerFocus()}},{key:"writeValue",value:function(e){e instanceof Array?(this.value=e[0],this.highValue=e[1]):this.value=e,this.inputModelChangeSubject.next({value:this.value,highValue:this.highValue,forceChange:!1,internalChange:!1})}},{key:"registerOnChange",value:function(e){this.onChangeCallback=e}},{key:"registerOnTouched",value:function(e){this.onTouchedCallback=e}},{key:"setDisabledState",value:function(e){this.viewOptions.disabled=e,this.updateDisabledState()}},{key:"onResize",value:function(e){this.calculateViewDimensionsAndDetectChanges()}},{key:"subscribeInputModelChangeSubject",value:function(e){var t=this;this.inputModelChangeSubscription=this.inputModelChangeSubject.pipe((0,R.distinctUntilChanged)(ye.compare),(0,R.filter)(function(e){return!e.forceChange&&!e.internalChange}),se.isNullOrUndefined(e)?(0,R.tap)(function(){}):(0,R.throttleTime)(e,void 0,{leading:!0,trailing:!0})).subscribe(function(e){return t.applyInputModelChange(e)})}},{key:"subscribeOutputModelChangeSubject",value:function(e){var t=this;this.outputModelChangeSubscription=this.outputModelChangeSubject.pipe((0,R.distinctUntilChanged)(ye.compare),se.isNullOrUndefined(e)?(0,R.tap)(function(){}):(0,R.throttleTime)(e,void 0,{leading:!0,trailing:!0})).subscribe(function(e){return t.publishOutputModelChange(e)})}},{key:"subscribeResizeObserver",value:function(){var e=this;ue.isResizeObserverAvailable()&&(this.resizeObserver=new ResizeObserver(function(){return e.calculateViewDimensionsAndDetectChanges()}),this.resizeObserver.observe(this.elementRef.nativeElement))}},{key:"unsubscribeResizeObserver",value:function(){ue.isResizeObserverAvailable()&&null!==this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}},{key:"unsubscribeOnMove",value:function(){se.isNullOrUndefined(this.onMoveEventListener)||(this.eventListenerHelper.detachEventListener(this.onMoveEventListener),this.onMoveEventListener=null)}},{key:"unsubscribeOnEnd",value:function(){se.isNullOrUndefined(this.onEndEventListener)||(this.eventListenerHelper.detachEventListener(this.onEndEventListener),this.onEndEventListener=null)}},{key:"unsubscribeInputModelChangeSubject",value:function(){se.isNullOrUndefined(this.inputModelChangeSubscription)||(this.inputModelChangeSubscription.unsubscribe(),this.inputModelChangeSubscription=null)}},{key:"unsubscribeOutputModelChangeSubject",value:function(){se.isNullOrUndefined(this.outputModelChangeSubscription)||(this.outputModelChangeSubscription.unsubscribe(),this.outputModelChangeSubscription=null)}},{key:"unsubscribeManualRefresh",value:function(){se.isNullOrUndefined(this.manualRefreshSubscription)||(this.manualRefreshSubscription.unsubscribe(),this.manualRefreshSubscription=null)}},{key:"unsubscribeTriggerFocus",value:function(){se.isNullOrUndefined(this.triggerFocusSubscription)||(this.triggerFocusSubscription.unsubscribe(),this.triggerFocusSubscription=null)}},{key:"getPointerElement",value:function(e){return e===ie.Min?this.minHandleElement:e===ie.Max?this.maxHandleElement:null}},{key:"getCurrentTrackingValue",value:function(){return this.currentTrackingPointer===ie.Min?this.viewLowValue:this.currentTrackingPointer===ie.Max?this.viewHighValue:null}},{key:"modelValueToViewValue",value:function(e){return se.isNullOrUndefined(e)?NaN:se.isNullOrUndefined(this.viewOptions.stepsArray)||this.viewOptions.bindIndexForStepsArray?+e:se.findStepIndex(+e,this.viewOptions.stepsArray)}},{key:"viewValueToModelValue",value:function(e){return se.isNullOrUndefined(this.viewOptions.stepsArray)||this.viewOptions.bindIndexForStepsArray?e:this.getStepValue(e)}},{key:"getStepValue",value:function(e){var t=this.viewOptions.stepsArray[e];return se.isNullOrUndefined(t)?NaN:t.value}},{key:"applyViewChange",value:function(){this.value=this.viewValueToModelValue(this.viewLowValue),this.range&&(this.highValue=this.viewValueToModelValue(this.viewHighValue)),this.outputModelChangeSubject.next({value:this.value,highValue:this.highValue,userEventInitiated:!0,forceChange:!1}),this.inputModelChangeSubject.next({value:this.value,highValue:this.highValue,forceChange:!1,internalChange:!0})}},{key:"applyInputModelChange",value:function(e){var t=this.normaliseModelValues(e),n=!ge.compare(e,t);n&&(this.value=t.value,this.highValue=t.highValue),this.viewLowValue=this.modelValueToViewValue(t.value),this.viewHighValue=this.range?this.modelValueToViewValue(t.highValue):null,this.updateLowHandle(this.valueToPosition(this.viewLowValue)),this.range&&this.updateHighHandle(this.valueToPosition(this.viewHighValue)),this.updateSelectionBar(),this.updateTicksScale(),this.updateAriaAttributes(),this.range&&this.updateCombinedLabel(),this.outputModelChangeSubject.next({value:t.value,highValue:t.highValue,forceChange:n,userEventInitiated:!1})}},{key:"publishOutputModelChange",value:function(e){var t=this,n=function(){t.valueChange.emit(e.value),t.range&&t.highValueChange.emit(e.highValue),se.isNullOrUndefined(t.onChangeCallback)||t.onChangeCallback(t.range?[e.value,e.highValue]:e.value),se.isNullOrUndefined(t.onTouchedCallback)||t.onTouchedCallback(t.range?[e.value,e.highValue]:e.value)};e.userEventInitiated?(n(),this.userChange.emit(this.getChangeContext())):setTimeout(function(){n()})}},{key:"normaliseModelValues",value:function(e){var t=new ge;if(t.value=e.value,t.highValue=e.highValue,this.viewOptions.enforceStep&&(t.value=this.roundStep(t.value),this.range&&(t.highValue=this.roundStep(t.highValue))),!se.isNullOrUndefined(this.viewOptions.stepsArray)||!this.viewOptions.enforceRange)return t;if(t.value=le.clampToRange(t.value,this.viewOptions.floor,this.viewOptions.ceil),this.range&&(t.highValue=le.clampToRange(t.highValue,this.viewOptions.floor,this.viewOptions.ceil)),this.range&&e.value>e.highValue)if(this.viewOptions.noSwitching)t.value=t.highValue;else{var n=e.value;t.value=e.highValue,t.highValue=n}return t}},{key:"renormaliseModelValues",value:function(){var e={value:this.value,highValue:this.highValue},t=this.normaliseModelValues(e);ge.compare(t,e)||(this.value=t.value,this.highValue=t.highValue,this.outputModelChangeSubject.next({value:this.value,highValue:this.highValue,forceChange:!0,userEventInitiated:!1}))}},{key:"onChangeOptions",value:function(){if(this.initHasRun){var e=this.viewOptions.inputEventsInterval,t=this.viewOptions.outputEventsInterval;this.applyOptions(),e!==this.viewOptions.inputEventsInterval&&(this.unsubscribeInputModelChangeSubject(),this.subscribeInputModelChangeSubject(this.viewOptions.inputEventsInterval)),t!==this.viewOptions.outputEventsInterval&&(this.unsubscribeInputModelChangeSubject(),this.subscribeInputModelChangeSubject(this.viewOptions.outputEventsInterval)),this.renormaliseModelValues(),this.viewLowValue=this.modelValueToViewValue(this.value),this.viewHighValue=this.range?this.modelValueToViewValue(this.highValue):null,this.resetSlider()}}},{key:"applyOptions",value:function(){if(this.viewOptions=new ae,Object.assign(this.viewOptions,this.options),this.viewOptions.draggableRange=this.range&&this.viewOptions.draggableRange,this.viewOptions.draggableRangeOnly=this.range&&this.viewOptions.draggableRangeOnly,this.viewOptions.draggableRangeOnly&&(this.viewOptions.draggableRange=!0),this.viewOptions.showTicks=this.viewOptions.showTicks||this.viewOptions.showTicksValues||!se.isNullOrUndefined(this.viewOptions.ticksArray),!this.viewOptions.showTicks||se.isNullOrUndefined(this.viewOptions.tickStep)&&se.isNullOrUndefined(this.viewOptions.ticksArray)||(this.intermediateTicks=!0),this.viewOptions.showSelectionBar=this.viewOptions.showSelectionBar||this.viewOptions.showSelectionBarEnd||!se.isNullOrUndefined(this.viewOptions.showSelectionBarFromValue),se.isNullOrUndefined(this.viewOptions.stepsArray)?this.applyFloorCeilOptions():this.applyStepsArrayOptions(),se.isNullOrUndefined(this.viewOptions.combineLabels)&&(this.viewOptions.combineLabels=function(e,t){return e+" - "+t}),this.viewOptions.logScale&&0===this.viewOptions.floor)throw Error("Can't use floor=0 with logarithmic scale")}},{key:"applyStepsArrayOptions",value:function(){var e=this;this.viewOptions.floor=0,this.viewOptions.ceil=this.viewOptions.stepsArray.length-1,this.viewOptions.step=1,se.isNullOrUndefined(this.viewOptions.translate)&&(this.viewOptions.translate=function(t){return String(e.viewOptions.bindIndexForStepsArray?e.getStepValue(t):t)}),this.viewOptions.getLegend=function(t){return e.viewOptions.stepsArray[t].legend}}},{key:"applyFloorCeilOptions",value:function(){if(se.isNullOrUndefined(this.viewOptions.step)?this.viewOptions.step=1:(this.viewOptions.step=+this.viewOptions.step,this.viewOptions.step<=0&&(this.viewOptions.step=1)),se.isNullOrUndefined(this.viewOptions.ceil)||se.isNullOrUndefined(this.viewOptions.floor))throw Error("floor and ceil options must be supplied");this.viewOptions.ceil=+this.viewOptions.ceil,this.viewOptions.floor=+this.viewOptions.floor,se.isNullOrUndefined(this.viewOptions.translate)&&(this.viewOptions.translate=function(e){return String(e)})}},{key:"resetSlider",value:function(){this.manageElementsStyle(),this.addAccessibility(),this.updateCeilLabel(),this.updateFloorLabel(),this.unbindEvents(),this.manageEventsBindings(),this.updateDisabledState(),this.calculateViewDimensions(),this.refocusPointerIfNeeded()}},{key:"focusPointer",value:function(e){e!==ie.Min&&e!==ie.Max&&(e=ie.Min),e===ie.Min?this.minHandleElement.focus():this.range&&e===ie.Max&&this.maxHandleElement.focus()}},{key:"refocusPointerIfNeeded",value:function(){se.isNullOrUndefined(this.currentFocusPointer)||(this.onPointerFocus(this.currentFocusPointer),this.getPointerElement(this.currentFocusPointer).focus())}},{key:"manageElementsStyle",value:function(){var e=this;this.updateScale(),this.floorLabelElement.setAlwaysHide(this.viewOptions.showTicksValues||this.viewOptions.hideLimitLabels),this.ceilLabelElement.setAlwaysHide(this.viewOptions.showTicksValues||this.viewOptions.hideLimitLabels);var t=this.viewOptions.showTicksValues&&!this.intermediateTicks;this.minHandleLabelElement.setAlwaysHide(t||this.viewOptions.hidePointerLabels),this.maxHandleLabelElement.setAlwaysHide(t||!this.range||this.viewOptions.hidePointerLabels),this.combinedLabelElement.setAlwaysHide(t||!this.range||this.viewOptions.hidePointerLabels),this.selectionBarElement.setAlwaysHide(!this.range&&!this.viewOptions.showSelectionBar),this.leftOuterSelectionBarElement.setAlwaysHide(!this.range||!this.viewOptions.showOuterSelectionBars),this.rightOuterSelectionBarElement.setAlwaysHide(!this.range||!this.viewOptions.showOuterSelectionBars),this.fullBarTransparentClass=this.range&&this.viewOptions.showOuterSelectionBars,this.selectionBarDraggableClass=this.viewOptions.draggableRange&&!this.viewOptions.onlyBindHandles,this.ticksUnderValuesClass=this.intermediateTicks&&this.options.showTicksValues,this.sliderElementVerticalClass!==this.viewOptions.vertical&&(this.updateVerticalState(),setTimeout(function(){e.resetSlider()})),this.sliderElementAnimateClass!==this.viewOptions.animate&&setTimeout(function(){e.sliderElementAnimateClass=e.viewOptions.animate})}},{key:"manageEventsBindings",value:function(){this.viewOptions.disabled||this.viewOptions.readOnly?this.unbindEvents():this.bindEvents()}},{key:"updateDisabledState",value:function(){this.sliderElementDisabledAttr=this.viewOptions.disabled?"disabled":null}},{key:"updateVerticalState",value:function(){this.sliderElementVerticalClass=this.viewOptions.vertical;var e,t=x(this.getAllSliderElements());try{for(t.s();!(e=t.n()).done;){var n=e.value;se.isNullOrUndefined(n)||n.setVertical(this.viewOptions.vertical)}}catch(i){t.e(i)}finally{t.f()}}},{key:"updateScale",value:function(){var e,t=x(this.getAllSliderElements());try{for(t.s();!(e=t.n()).done;){e.value.setScale(this.viewOptions.scale)}}catch(n){t.e(n)}finally{t.f()}}},{key:"getAllSliderElements",value:function(){return[this.leftOuterSelectionBarElement,this.rightOuterSelectionBarElement,this.fullBarElement,this.selectionBarElement,this.minHandleElement,this.maxHandleElement,this.floorLabelElement,this.ceilLabelElement,this.minHandleLabelElement,this.maxHandleLabelElement,this.combinedLabelElement,this.ticksElement]}},{key:"initHandles",value:function(){this.updateLowHandle(this.valueToPosition(this.viewLowValue)),this.range&&this.updateHighHandle(this.valueToPosition(this.viewHighValue)),this.updateSelectionBar(),this.range&&this.updateCombinedLabel(),this.updateTicksScale()}},{key:"addAccessibility",value:function(){this.updateAriaAttributes(),this.minHandleElement.role="slider",this.minHandleElement.tabindex=!this.viewOptions.keyboardSupport||this.viewOptions.readOnly||this.viewOptions.disabled?"":"0",this.viewOptions.vertical&&(this.minHandleElement.ariaOrientation="vertical"),se.isNullOrUndefined(this.viewOptions.ariaLabel)?se.isNullOrUndefined(this.viewOptions.ariaLabelledBy)||(this.minHandleElement.ariaLabelledBy=this.viewOptions.ariaLabelledBy):this.minHandleElement.ariaLabel=this.viewOptions.ariaLabel,this.range&&(this.maxHandleElement.role="slider",this.maxHandleElement.tabindex=!this.viewOptions.keyboardSupport||this.viewOptions.readOnly||this.viewOptions.disabled?"":"0",this.maxHandleElement.ariaOrientation=this.viewOptions.vertical?"vertical":"horizontal",se.isNullOrUndefined(this.viewOptions.ariaLabelHigh)?se.isNullOrUndefined(this.viewOptions.ariaLabelledByHigh)||(this.maxHandleElement.ariaLabelledBy=this.viewOptions.ariaLabelledByHigh):this.maxHandleElement.ariaLabel=this.viewOptions.ariaLabelHigh)}},{key:"updateAriaAttributes",value:function(){this.minHandleElement.ariaValueNow=(+this.value).toString(),this.minHandleElement.ariaValueText=this.viewOptions.translate(+this.value,re.Low),this.minHandleElement.ariaValueMin=this.viewOptions.floor.toString(),this.minHandleElement.ariaValueMax=this.viewOptions.ceil.toString(),this.range&&(this.maxHandleElement.ariaValueNow=(+this.highValue).toString(),this.maxHandleElement.ariaValueText=this.viewOptions.translate(+this.highValue,re.High),this.maxHandleElement.ariaValueMin=this.viewOptions.floor.toString(),this.maxHandleElement.ariaValueMax=this.viewOptions.ceil.toString())}},{key:"calculateViewDimensions",value:function(){se.isNullOrUndefined(this.viewOptions.handleDimension)?this.minHandleElement.calculateDimension():this.minHandleElement.setDimension(this.viewOptions.handleDimension);var e=this.minHandleElement.dimension;this.handleHalfDimension=e/2,se.isNullOrUndefined(this.viewOptions.barDimension)?this.fullBarElement.calculateDimension():this.fullBarElement.setDimension(this.viewOptions.barDimension),this.maxHandlePosition=this.fullBarElement.dimension-e,this.initHasRun&&(this.updateFloorLabel(),this.updateCeilLabel(),this.initHandles())}},{key:"calculateViewDimensionsAndDetectChanges",value:function(){this.calculateViewDimensions(),this.isRefDestroyed()||this.changeDetectionRef.detectChanges()}},{key:"isRefDestroyed",value:function(){return this.changeDetectionRef.destroyed}},{key:"updateTicksScale",value:function(){var e=this;if(this.viewOptions.showTicks){var t=se.isNullOrUndefined(this.viewOptions.ticksArray)?this.getTicksArray():this.viewOptions.ticksArray,n=this.viewOptions.vertical?"translateY":"translateX";this.viewOptions.rightToLeft&&t.reverse();var i=t.map(function(t){var i=e.valueToPosition(t);e.viewOptions.vertical&&(i=e.maxHandlePosition-i);var r=n+"("+Math.round(i)+"px)",a=new ve;if(a.selected=e.isTickSelected(t),a.style={"-webkit-transform":r,"-moz-transform":r,"-o-transform":r,"-ms-transform":r,transform:r},a.selected&&!se.isNullOrUndefined(e.viewOptions.getSelectionBarColor)&&(a.style["background-color"]=e.getSelectionBarColor()),a.selected||se.isNullOrUndefined(e.viewOptions.getTickColor)||(a.style["background-color"]=e.getTickColor(t)),se.isNullOrUndefined(e.viewOptions.ticksTooltip)||(a.tooltip=e.viewOptions.ticksTooltip(t),a.tooltipPlacement=e.viewOptions.vertical?"right":"top"),e.viewOptions.showTicksValues&&t%e.viewOptions.tickValueStep==0&&(a.value=e.getDisplayValue(t,re.TickValue),se.isNullOrUndefined(e.viewOptions.ticksValuesTooltip)||(a.valueTooltip=e.viewOptions.ticksValuesTooltip(t),a.valueTooltipPlacement=e.viewOptions.vertical?"right":"top")),!se.isNullOrUndefined(e.viewOptions.getLegend)){var o=e.viewOptions.getLegend(t);se.isNullOrUndefined(o)||(a.legend=o)}return a});if(se.isNullOrUndefined(this.ticks)||this.ticks.length!==i.length)this.ticks=i;else for(var r=0;r<i.length;++r)Object.assign(this.ticks[r],i[r]);this.isRefDestroyed()||this.changeDetectionRef.detectChanges()}}},{key:"getTicksArray",value:function(){for(var e=se.isNullOrUndefined(this.viewOptions.tickStep)?this.viewOptions.step:this.viewOptions.tickStep,t=[],n=this.viewOptions.floor;n<=this.viewOptions.ceil;n+=e)t.push(n);return t}},{key:"isTickSelected",value:function(e){if(!this.range)if(se.isNullOrUndefined(this.viewOptions.showSelectionBarFromValue)){if(this.viewOptions.showSelectionBarEnd){if(e>=this.viewLowValue)return!0}else if(this.viewOptions.showSelectionBar&&e<=this.viewLowValue)return!0}else{var t=this.viewOptions.showSelectionBarFromValue;if(this.viewLowValue>t&&e>=t&&e<=this.viewLowValue)return!0;if(this.viewLowValue<t&&e<=t&&e>=this.viewLowValue)return!0}return!!(this.range&&e>=this.viewLowValue&&e<=this.viewHighValue)}},{key:"updateFloorLabel",value:function(){this.floorLabelElement.alwaysHide||(this.floorLabelElement.setValue(this.getDisplayValue(this.viewOptions.floor,re.Floor)),this.floorLabelElement.calculateDimension(),this.floorLabelElement.setPosition(this.viewOptions.rightToLeft?this.fullBarElement.dimension-this.floorLabelElement.dimension:0))}},{key:"updateCeilLabel",value:function(){this.ceilLabelElement.alwaysHide||(this.ceilLabelElement.setValue(this.getDisplayValue(this.viewOptions.ceil,re.Ceil)),this.ceilLabelElement.calculateDimension(),this.ceilLabelElement.setPosition(this.viewOptions.rightToLeft?0:this.fullBarElement.dimension-this.ceilLabelElement.dimension))}},{key:"updateHandles",value:function(e,t){e===ie.Min?this.updateLowHandle(t):e===ie.Max&&this.updateHighHandle(t),this.updateSelectionBar(),this.updateTicksScale(),this.range&&this.updateCombinedLabel()}},{key:"getHandleLabelPos",value:function(e,t){var n=e===ie.Min?this.minHandleLabelElement.dimension:this.maxHandleLabelElement.dimension,i=t-n/2+this.handleHalfDimension,r=this.fullBarElement.dimension-n;return this.viewOptions.boundPointerLabels?this.viewOptions.rightToLeft&&e===ie.Min||!this.viewOptions.rightToLeft&&e===ie.Max?Math.min(i,r):Math.min(Math.max(i,0),r):i}},{key:"updateLowHandle",value:function(e){this.minHandleElement.setPosition(e),this.minHandleLabelElement.setValue(this.getDisplayValue(this.viewLowValue,re.Low)),this.minHandleLabelElement.setPosition(this.getHandleLabelPos(ie.Min,e)),se.isNullOrUndefined(this.viewOptions.getPointerColor)||(this.minPointerStyle={backgroundColor:this.getPointerColor(ie.Min)}),this.viewOptions.autoHideLimitLabels&&this.updateFloorAndCeilLabelsVisibility()}},{key:"updateHighHandle",value:function(e){this.maxHandleElement.setPosition(e),this.maxHandleLabelElement.setValue(this.getDisplayValue(this.viewHighValue,re.High)),this.maxHandleLabelElement.setPosition(this.getHandleLabelPos(ie.Max,e)),se.isNullOrUndefined(this.viewOptions.getPointerColor)||(this.maxPointerStyle={backgroundColor:this.getPointerColor(ie.Max)}),this.viewOptions.autoHideLimitLabels&&this.updateFloorAndCeilLabelsVisibility()}},{key:"updateFloorAndCeilLabelsVisibility",value:function(){if(!this.viewOptions.hidePointerLabels){var e=!1,t=!1,n=this.isLabelBelowFloorLabel(this.minHandleLabelElement),i=this.isLabelAboveCeilLabel(this.minHandleLabelElement),r=this.isLabelAboveCeilLabel(this.maxHandleLabelElement),a=this.isLabelBelowFloorLabel(this.combinedLabelElement),o=this.isLabelAboveCeilLabel(this.combinedLabelElement);if(n?(e=!0,this.floorLabelElement.hide()):(e=!1,this.floorLabelElement.show()),i?(t=!0,this.ceilLabelElement.hide()):(t=!1,this.ceilLabelElement.show()),this.range){var s=this.combinedLabelElement.isVisible()?o:r,u=this.combinedLabelElement.isVisible()?a:n;s?this.ceilLabelElement.hide():t||this.ceilLabelElement.show(),u?this.floorLabelElement.hide():e||this.floorLabelElement.show()}}}},{key:"isLabelBelowFloorLabel",value:function(e){var t=e.position,n=this.floorLabelElement.position;return this.viewOptions.rightToLeft?t+e.dimension>=n-2:t<=n+this.floorLabelElement.dimension+2}},{key:"isLabelAboveCeilLabel",value:function(e){var t=e.position,n=this.ceilLabelElement.position;return this.viewOptions.rightToLeft?t<=n+this.ceilLabelElement.dimension+2:t+e.dimension>=n-2}},{key:"updateSelectionBar",value:function(){var e=0,t=0,n=this.viewOptions.rightToLeft?!this.viewOptions.showSelectionBarEnd:this.viewOptions.showSelectionBarEnd,i=this.viewOptions.rightToLeft?this.maxHandleElement.position+this.handleHalfDimension:this.minHandleElement.position+this.handleHalfDimension;if(this.range)t=Math.abs(this.maxHandleElement.position-this.minHandleElement.position),e=i;else if(se.isNullOrUndefined(this.viewOptions.showSelectionBarFromValue))n?(t=Math.ceil(Math.abs(this.maxHandlePosition-this.minHandleElement.position)+this.handleHalfDimension),e=Math.floor(this.minHandleElement.position+this.handleHalfDimension)):(t=this.minHandleElement.position+this.handleHalfDimension,e=0);else{var r=this.viewOptions.showSelectionBarFromValue,a=this.valueToPosition(r);(this.viewOptions.rightToLeft?this.viewLowValue<=r:this.viewLowValue>r)?(t=this.minHandleElement.position-a,e=a+this.handleHalfDimension):(t=a-this.minHandleElement.position,e=this.minHandleElement.position+this.handleHalfDimension)}if(this.selectionBarElement.setDimension(t),this.selectionBarElement.setPosition(e),this.range&&this.viewOptions.showOuterSelectionBars&&(this.viewOptions.rightToLeft?(this.rightOuterSelectionBarElement.setDimension(e),this.rightOuterSelectionBarElement.setPosition(0),this.fullBarElement.calculateDimension(),this.leftOuterSelectionBarElement.setDimension(this.fullBarElement.dimension-(e+t)),this.leftOuterSelectionBarElement.setPosition(e+t)):(this.leftOuterSelectionBarElement.setDimension(e),this.leftOuterSelectionBarElement.setPosition(0),this.fullBarElement.calculateDimension(),this.rightOuterSelectionBarElement.setDimension(this.fullBarElement.dimension-(e+t)),this.rightOuterSelectionBarElement.setPosition(e+t))),se.isNullOrUndefined(this.viewOptions.getSelectionBarColor)){if(!se.isNullOrUndefined(this.viewOptions.selectionBarGradient)){var o=se.isNullOrUndefined(this.viewOptions.showSelectionBarFromValue)?0:this.valueToPosition(this.viewOptions.showSelectionBarFromValue),s=o-e>0&&!n||o-e<=0&&n;this.barStyle={backgroundImage:"linear-gradient(to "+(this.viewOptions.vertical?s?"bottom":"top":s?"left":"right")+", "+this.viewOptions.selectionBarGradient.from+" 0%,"+this.viewOptions.selectionBarGradient.to+" 100%)"},this.viewOptions.vertical?(this.barStyle.backgroundPosition="center "+(o+t+e+(s?-this.handleHalfDimension:0))+"px",this.barStyle.backgroundSize="100% "+(this.fullBarElement.dimension-this.handleHalfDimension)+"px"):(this.barStyle.backgroundPosition=o-e+(s?this.handleHalfDimension:0)+"px center",this.barStyle.backgroundSize=this.fullBarElement.dimension-this.handleHalfDimension+"px 100%")}}else{var u=this.getSelectionBarColor();this.barStyle={backgroundColor:u}}}},{key:"getSelectionBarColor",value:function(){return this.range?this.viewOptions.getSelectionBarColor(this.value,this.highValue):this.viewOptions.getSelectionBarColor(this.value)}},{key:"getPointerColor",value:function(e){return this.viewOptions.getPointerColor(e===ie.Max?this.highValue:this.value,e)}},{key:"getTickColor",value:function(e){return this.viewOptions.getTickColor(e)}},{key:"updateCombinedLabel",value:function(){if(this.viewOptions.rightToLeft?this.minHandleLabelElement.position-this.minHandleLabelElement.dimension-10<=this.maxHandleLabelElement.position:this.minHandleLabelElement.position+this.minHandleLabelElement.dimension+10>=this.maxHandleLabelElement.position){var e=this.getDisplayValue(this.viewLowValue,re.Low),t=this.getDisplayValue(this.viewHighValue,re.High),n=this.viewOptions.rightToLeft?this.viewOptions.combineLabels(t,e):this.viewOptions.combineLabels(e,t);this.combinedLabelElement.setValue(n);var i=this.viewOptions.boundPointerLabels?Math.min(Math.max(this.selectionBarElement.position+this.selectionBarElement.dimension/2-this.combinedLabelElement.dimension/2,0),this.fullBarElement.dimension-this.combinedLabelElement.dimension):this.selectionBarElement.position+this.selectionBarElement.dimension/2-this.combinedLabelElement.dimension/2;this.combinedLabelElement.setPosition(i),this.minHandleLabelElement.hide(),this.maxHandleLabelElement.hide(),this.combinedLabelElement.show()}else this.updateHighHandle(this.valueToPosition(this.viewHighValue)),this.updateLowHandle(this.valueToPosition(this.viewLowValue)),this.maxHandleLabelElement.show(),this.minHandleLabelElement.show(),this.combinedLabelElement.hide();this.viewOptions.autoHideLimitLabels&&this.updateFloorAndCeilLabelsVisibility()}},{key:"getDisplayValue",value:function(e,t){return se.isNullOrUndefined(this.viewOptions.stepsArray)||this.viewOptions.bindIndexForStepsArray||(e=this.getStepValue(e)),this.viewOptions.translate(e,t)}},{key:"roundStep",value:function(e,t){var n=se.isNullOrUndefined(t)?this.viewOptions.step:t,i=le.roundToPrecisionLimit((e-this.viewOptions.floor)/n,this.viewOptions.precisionLimit);return i=Math.round(i)*n,le.roundToPrecisionLimit(this.viewOptions.floor+i,this.viewOptions.precisionLimit)}},{key:"valueToPosition",value:function(e){var t=se.linearValueToPosition;se.isNullOrUndefined(this.viewOptions.customValueToPosition)?this.viewOptions.logScale&&(t=se.logValueToPosition):t=this.viewOptions.customValueToPosition;var n=t(e=le.clampToRange(e,this.viewOptions.floor,this.viewOptions.ceil),this.viewOptions.floor,this.viewOptions.ceil);return se.isNullOrUndefined(n)&&(n=0),this.viewOptions.rightToLeft&&(n=1-n),n*this.maxHandlePosition}},{key:"positionToValue",value:function(e){var t=e/this.maxHandlePosition;this.viewOptions.rightToLeft&&(t=1-t);var n=se.linearPositionToValue;se.isNullOrUndefined(this.viewOptions.customPositionToValue)?this.viewOptions.logScale&&(n=se.logPositionToValue):n=this.viewOptions.customPositionToValue;var i=n(t,this.viewOptions.floor,this.viewOptions.ceil);return se.isNullOrUndefined(i)?0:i}},{key:"getEventXY",value:function(e,t){if(e instanceof MouseEvent)return this.viewOptions.vertical?e.clientY:e.clientX;var n=0,i=e.touches;if(!se.isNullOrUndefined(t))for(var r=0;r<i.length;r++)if(i[r].identifier===t){n=r;break}return this.viewOptions.vertical?i[n].clientY:i[n].clientX}},{key:"getEventPosition",value:function(e,t){var n=this.elementRef.nativeElement.getBoundingClientRect(),i=this.viewOptions.vertical?n.bottom:n.left;return(this.viewOptions.vertical?-this.getEventXY(e,t)+i:this.getEventXY(e,t)-i)*this.viewOptions.scale-this.handleHalfDimension}},{key:"getNearestHandle",value:function(e){if(!this.range)return ie.Min;var t=this.getEventPosition(e),n=Math.abs(t-this.minHandleElement.position),i=Math.abs(t-this.maxHandleElement.position);return n<i?ie.Min:n>i?ie.Max:this.viewOptions.rightToLeft?t>this.minHandleElement.position?ie.Min:ie.Max:t<this.minHandleElement.position?ie.Min:ie.Max}},{key:"bindEvents",value:function(){var e=this,t=this.viewOptions.draggableRange;this.viewOptions.onlyBindHandles||this.selectionBarElement.on("mousedown",function(n){return e.onBarStart(null,t,n,!0,!0,!0)}),this.viewOptions.draggableRangeOnly?(this.minHandleElement.on("mousedown",function(n){return e.onBarStart(ie.Min,t,n,!0,!0)}),this.maxHandleElement.on("mousedown",function(n){return e.onBarStart(ie.Max,t,n,!0,!0)})):(this.minHandleElement.on("mousedown",function(t){return e.onStart(ie.Min,t,!0,!0)}),this.range&&this.maxHandleElement.on("mousedown",function(t){return e.onStart(ie.Max,t,!0,!0)}),this.viewOptions.onlyBindHandles||(this.fullBarElement.on("mousedown",function(t){return e.onStart(null,t,!0,!0,!0)}),this.ticksElement.on("mousedown",function(t){return e.onStart(null,t,!0,!0,!0,!0)}))),this.viewOptions.onlyBindHandles||this.selectionBarElement.onPassive("touchstart",function(n){return e.onBarStart(null,t,n,!0,!0,!0)}),this.viewOptions.draggableRangeOnly?(this.minHandleElement.onPassive("touchstart",function(n){return e.onBarStart(ie.Min,t,n,!0,!0)}),this.maxHandleElement.onPassive("touchstart",function(n){return e.onBarStart(ie.Max,t,n,!0,!0)})):(this.minHandleElement.onPassive("touchstart",function(t){return e.onStart(ie.Min,t,!0,!0)}),this.range&&this.maxHandleElement.onPassive("touchstart",function(t){return e.onStart(ie.Max,t,!0,!0)}),this.viewOptions.onlyBindHandles||(this.fullBarElement.onPassive("touchstart",function(t){return e.onStart(null,t,!0,!0,!0)}),this.ticksElement.onPassive("touchstart",function(t){return e.onStart(null,t,!1,!1,!0,!0)}))),this.viewOptions.keyboardSupport&&(this.minHandleElement.on("focus",function(){return e.onPointerFocus(ie.Min)}),this.range&&this.maxHandleElement.on("focus",function(){return e.onPointerFocus(ie.Max)}))}},{key:"unbindEvents",value:function(){this.unsubscribeOnMove(),this.unsubscribeOnEnd();var e,t=x(this.getAllSliderElements());try{for(t.s();!(e=t.n()).done;){var n=e.value;se.isNullOrUndefined(n)||n.off()}}catch(i){t.e(i)}finally{t.f()}}},{key:"onBarStart",value:function(e,t,n,i,r,a,o){t?this.onDragStart(e,n,i,r):this.onStart(e,n,i,r,a,o)}},{key:"onStart",value:function(e,t,n,i,r,a){var o=this;t.stopPropagation(),ue.isTouchEvent(t)&&P.Z.hasSupport||t.preventDefault(),this.calculateViewDimensions(),se.isNullOrUndefined(e)&&(e=this.getNearestHandle(t)),this.currentTrackingPointer=e;var s=this.getPointerElement(e);if(s.active=!0,this.viewOptions.keyboardSupport&&s.focus(),n){this.unsubscribeOnMove();var u=function(e){return o.dragging.active?o.onDragMove(e):o.onMove(e)};this.onMoveEventListener=ue.isTouchEvent(t)?this.eventListenerHelper.attachPassiveEventListener(document,"touchmove",u,this.viewOptions.touchEventsInterval):this.eventListenerHelper.attachEventListener(document,"mousemove",u,this.viewOptions.mouseEventsInterval)}if(i){this.unsubscribeOnEnd();var l=function(e){return o.onEnd(e)};this.onEndEventListener=ue.isTouchEvent(t)?this.eventListenerHelper.attachPassiveEventListener(document,"touchend",l):this.eventListenerHelper.attachEventListener(document,"mouseup",l)}this.userChangeStart.emit(this.getChangeContext()),ue.isTouchEvent(t)&&!se.isNullOrUndefined(t.changedTouches)&&se.isNullOrUndefined(this.touchId)&&(this.touchId=t.changedTouches[0].identifier),r&&this.onMove(t,!0),a&&this.onEnd(t)}},{key:"onMove",value:function(e,t){var n=null;if(ue.isTouchEvent(e)){for(var i=e.changedTouches,r=0;r<i.length;r++)if(i[r].identifier===this.touchId){n=i[r];break}if(se.isNullOrUndefined(n))return}var a,o=se.isNullOrUndefined(n)?this.getEventPosition(e):this.getEventPosition(e,n.identifier);o<=0?a=this.viewOptions.rightToLeft?this.viewOptions.ceil:this.viewOptions.floor:o>=this.maxHandlePosition?a=this.viewOptions.rightToLeft?this.viewOptions.floor:this.viewOptions.ceil:(a=this.positionToValue(o),a=t&&!se.isNullOrUndefined(this.viewOptions.tickStep)?this.roundStep(a,this.viewOptions.tickStep):this.roundStep(a)),this.positionTrackingHandle(a)}},{key:"onEnd",value:function(e){ue.isTouchEvent(e)&&e.changedTouches[0].identifier!==this.touchId||(this.touchId=null,this.viewOptions.keyboardSupport||(this.minHandleElement.active=!1,this.maxHandleElement.active=!1,this.currentTrackingPointer=null),this.dragging.active=!1,this.unsubscribeOnMove(),this.unsubscribeOnEnd(),this.userChangeEnd.emit(this.getChangeContext()))}},{key:"onPointerFocus",value:function(e){var t=this,n=this.getPointerElement(e);n.on("blur",function(){return t.onPointerBlur(n)}),n.on("keydown",function(e){return t.onKeyboardEvent(e)}),n.on("keyup",function(){return t.onKeyUp()}),n.active=!0,this.currentTrackingPointer=e,this.currentFocusPointer=e,this.firstKeyDown=!0}},{key:"onKeyUp",value:function(){this.firstKeyDown=!0,this.userChangeEnd.emit(this.getChangeContext())}},{key:"onPointerBlur",value:function(e){e.off("blur"),e.off("keydown"),e.off("keyup"),e.active=!1,se.isNullOrUndefined(this.touchId)&&(this.currentTrackingPointer=null,this.currentFocusPointer=null)}},{key:"getKeyActions",value:function(e){var t=this.viewOptions.ceil-this.viewOptions.floor,n=e+this.viewOptions.step,i=e-this.viewOptions.step,r=e+t/10,a=e-t/10;this.viewOptions.reversedControls&&(n=e-this.viewOptions.step,i=e+this.viewOptions.step,r=e-t/10,a=e+t/10);var o={UP:n,DOWN:i,LEFT:i,RIGHT:n,PAGEUP:r,PAGEDOWN:a,HOME:this.viewOptions.reversedControls?this.viewOptions.ceil:this.viewOptions.floor,END:this.viewOptions.reversedControls?this.viewOptions.floor:this.viewOptions.ceil};return this.viewOptions.rightToLeft&&(o.LEFT=n,o.RIGHT=i,this.viewOptions.vertical&&(o.UP=i,o.DOWN=n)),o}},{key:"onKeyboardEvent",value:function(e){var t=this.getCurrentTrackingValue(),n=se.isNullOrUndefined(e.keyCode)?e.which:e.keyCode,i=this.getKeyActions(t)[{38:"UP",40:"DOWN",37:"LEFT",39:"RIGHT",33:"PAGEUP",34:"PAGEDOWN",36:"HOME",35:"END"}[n]];if(!se.isNullOrUndefined(i)&&!se.isNullOrUndefined(this.currentTrackingPointer)){e.preventDefault(),this.firstKeyDown&&(this.firstKeyDown=!1,this.userChangeStart.emit(this.getChangeContext()));var r=le.clampToRange(i,this.viewOptions.floor,this.viewOptions.ceil),a=this.roundStep(r);if(this.viewOptions.draggableRangeOnly){var o,s,u=this.viewHighValue-this.viewLowValue;this.currentTrackingPointer===ie.Min?(o=a,(s=a+u)>this.viewOptions.ceil&&(o=(s=this.viewOptions.ceil)-u)):this.currentTrackingPointer===ie.Max&&(s=a,(o=a-u)<this.viewOptions.floor&&(s=(o=this.viewOptions.floor)+u)),this.positionTrackingBar(o,s)}else this.positionTrackingHandle(a)}}},{key:"onDragStart",value:function(e,t,n,i){var r=this.getEventPosition(t);this.dragging=new me,this.dragging.active=!0,this.dragging.value=this.positionToValue(r),this.dragging.difference=this.viewHighValue-this.viewLowValue,this.dragging.lowLimit=this.viewOptions.rightToLeft?this.minHandleElement.position-r:r-this.minHandleElement.position,this.dragging.highLimit=this.viewOptions.rightToLeft?r-this.maxHandleElement.position:this.maxHandleElement.position-r,this.onStart(e,t,n,i)}},{key:"getMinValue",value:function(e,t,n){var i,r=this.viewOptions.rightToLeft;return i=t?n?r?this.viewOptions.floor:this.viewOptions.ceil-this.dragging.difference:r?this.viewOptions.ceil-this.dragging.difference:this.viewOptions.floor:this.positionToValue(r?e+this.dragging.lowLimit:e-this.dragging.lowLimit),this.roundStep(i)}},{key:"getMaxValue",value:function(e,t,n){var i,r=this.viewOptions.rightToLeft;return i=t?n?r?this.viewOptions.floor+this.dragging.difference:this.viewOptions.ceil:r?this.viewOptions.ceil:this.viewOptions.floor+this.dragging.difference:r?this.positionToValue(e+this.dragging.lowLimit)+this.dragging.difference:this.positionToValue(e-this.dragging.lowLimit)+this.dragging.difference,this.roundStep(i)}},{key:"onDragMove",value:function(e){var t,n,i,r,a=this.getEventPosition(e);this.viewOptions.rightToLeft?(t=this.dragging.lowLimit,n=this.dragging.highLimit,i=this.maxHandleElement,r=this.minHandleElement):(t=this.dragging.highLimit,n=this.dragging.lowLimit,i=this.minHandleElement,r=this.maxHandleElement);var o,s,u=a>=this.maxHandlePosition-t;if(a<=n){if(0===i.position)return;o=this.getMinValue(a,!0,!1),s=this.getMaxValue(a,!0,!1)}else if(u){if(r.position===this.maxHandlePosition)return;s=this.getMaxValue(a,!0,!0),o=this.getMinValue(a,!0,!0)}else o=this.getMinValue(a,!1,!1),s=this.getMaxValue(a,!1,!1);this.positionTrackingBar(o,s)}},{key:"positionTrackingBar",value:function(e,t){!se.isNullOrUndefined(this.viewOptions.minLimit)&&e<this.viewOptions.minLimit&&(t=le.roundToPrecisionLimit((e=this.viewOptions.minLimit)+this.dragging.difference,this.viewOptions.precisionLimit)),!se.isNullOrUndefined(this.viewOptions.maxLimit)&&t>this.viewOptions.maxLimit&&(e=le.roundToPrecisionLimit((t=this.viewOptions.maxLimit)-this.dragging.difference,this.viewOptions.precisionLimit)),this.viewLowValue=e,this.viewHighValue=t,this.applyViewChange(),this.updateHandles(ie.Min,this.valueToPosition(e)),this.updateHandles(ie.Max,this.valueToPosition(t))}},{key:"positionTrackingHandle",value:function(e){e=this.applyMinMaxLimit(e),this.range&&(this.viewOptions.pushRange?e=this.applyPushRange(e):(this.viewOptions.noSwitching&&(this.currentTrackingPointer===ie.Min&&e>this.viewHighValue?e=this.applyMinMaxRange(this.viewHighValue):this.currentTrackingPointer===ie.Max&&e<this.viewLowValue&&(e=this.applyMinMaxRange(this.viewLowValue))),e=this.applyMinMaxRange(e),this.currentTrackingPointer===ie.Min&&e>this.viewHighValue?(this.viewLowValue=this.viewHighValue,this.applyViewChange(),this.updateHandles(ie.Min,this.maxHandleElement.position),this.updateAriaAttributes(),this.currentTrackingPointer=ie.Max,this.minHandleElement.active=!1,this.maxHandleElement.active=!0,this.viewOptions.keyboardSupport&&this.maxHandleElement.focus()):this.currentTrackingPointer===ie.Max&&e<this.viewLowValue&&(this.viewHighValue=this.viewLowValue,this.applyViewChange(),this.updateHandles(ie.Max,this.minHandleElement.position),this.updateAriaAttributes(),this.currentTrackingPointer=ie.Min,this.maxHandleElement.active=!1,this.minHandleElement.active=!0,this.viewOptions.keyboardSupport&&this.minHandleElement.focus()))),this.getCurrentTrackingValue()!==e&&(this.currentTrackingPointer===ie.Min?(this.viewLowValue=e,this.applyViewChange()):this.currentTrackingPointer===ie.Max&&(this.viewHighValue=e,this.applyViewChange()),this.updateHandles(this.currentTrackingPointer,this.valueToPosition(e)),this.updateAriaAttributes())}},{key:"applyMinMaxLimit",value:function(e){return!se.isNullOrUndefined(this.viewOptions.minLimit)&&e<this.viewOptions.minLimit?this.viewOptions.minLimit:!se.isNullOrUndefined(this.viewOptions.maxLimit)&&e>this.viewOptions.maxLimit?this.viewOptions.maxLimit:e}},{key:"applyMinMaxRange",value:function(e){var t=Math.abs(e-(this.currentTrackingPointer===ie.Min?this.viewHighValue:this.viewLowValue));if(!se.isNullOrUndefined(this.viewOptions.minRange)&&t<this.viewOptions.minRange){if(this.currentTrackingPointer===ie.Min)return le.roundToPrecisionLimit(this.viewHighValue-this.viewOptions.minRange,this.viewOptions.precisionLimit);if(this.currentTrackingPointer===ie.Max)return le.roundToPrecisionLimit(this.viewLowValue+this.viewOptions.minRange,this.viewOptions.precisionLimit)}if(!se.isNullOrUndefined(this.viewOptions.maxRange)&&t>this.viewOptions.maxRange){if(this.currentTrackingPointer===ie.Min)return le.roundToPrecisionLimit(this.viewHighValue-this.viewOptions.maxRange,this.viewOptions.precisionLimit);if(this.currentTrackingPointer===ie.Max)return le.roundToPrecisionLimit(this.viewLowValue+this.viewOptions.maxRange,this.viewOptions.precisionLimit)}return e}},{key:"applyPushRange",value:function(e){var t=this.currentTrackingPointer===ie.Min?this.viewHighValue-e:e-this.viewLowValue,n=se.isNullOrUndefined(this.viewOptions.minRange)?this.viewOptions.step:this.viewOptions.minRange,i=this.viewOptions.maxRange;return t<n?(this.currentTrackingPointer===ie.Min?(this.viewHighValue=le.roundToPrecisionLimit(Math.min(e+n,this.viewOptions.ceil),this.viewOptions.precisionLimit),e=le.roundToPrecisionLimit(this.viewHighValue-n,this.viewOptions.precisionLimit),this.applyViewChange(),this.updateHandles(ie.Max,this.valueToPosition(this.viewHighValue))):this.currentTrackingPointer===ie.Max&&(this.viewLowValue=le.roundToPrecisionLimit(Math.max(e-n,this.viewOptions.floor),this.viewOptions.precisionLimit),e=le.roundToPrecisionLimit(this.viewLowValue+n,this.viewOptions.precisionLimit),this.applyViewChange(),this.updateHandles(ie.Min,this.valueToPosition(this.viewLowValue))),this.updateAriaAttributes()):!se.isNullOrUndefined(i)&&t>i&&(this.currentTrackingPointer===ie.Min?(this.viewHighValue=le.roundToPrecisionLimit(e+i,this.viewOptions.precisionLimit),this.applyViewChange(),this.updateHandles(ie.Max,this.valueToPosition(this.viewHighValue))):this.currentTrackingPointer===ie.Max&&(this.viewLowValue=le.roundToPrecisionLimit(e-i,this.viewOptions.precisionLimit),this.applyViewChange(),this.updateHandles(ie.Min,this.valueToPosition(this.viewLowValue))),this.updateAriaAttributes()),e}},{key:"getChangeContext",value:function(){var e=new oe;return e.pointerType=this.currentTrackingPointer,e.value=+this.value,this.range&&(e.highValue=+this.highValue),e}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.Qsj),_.Y36(_.SBq),_.Y36(_.sBO),_.Y36(_.R0b))},e.\u0275cmp=_.Xpm({type:e,selectors:[["ng5-slider"]],contentQueries:function(e,t,n){var i;(1&e&&_.Suo(n,N,5),2&e)&&(_.iGM(i=_.CRH())&&(t.tooltipTemplate=i.first))},viewQuery:function(e,t){var n;(1&e&&(_.Gf(D,5,pe),_.Gf(F,5,pe),_.Gf(U,5,pe),_.Gf(B,5,pe),_.Gf(V,5,de),_.Gf(H,5,de),_.Gf(z,5,fe),_.Gf(Z,5,fe),_.Gf(G,5,fe),_.Gf(j,5,fe),_.Gf(q,5,fe),_.Gf(W,5,pe)),2&e)&&(_.iGM(n=_.CRH())&&(t.leftOuterSelectionBarElement=n.first),_.iGM(n=_.CRH())&&(t.rightOuterSelectionBarElement=n.first),_.iGM(n=_.CRH())&&(t.fullBarElement=n.first),_.iGM(n=_.CRH())&&(t.selectionBarElement=n.first),_.iGM(n=_.CRH())&&(t.minHandleElement=n.first),_.iGM(n=_.CRH())&&(t.maxHandleElement=n.first),_.iGM(n=_.CRH())&&(t.floorLabelElement=n.first),_.iGM(n=_.CRH())&&(t.ceilLabelElement=n.first),_.iGM(n=_.CRH())&&(t.minHandleLabelElement=n.first),_.iGM(n=_.CRH())&&(t.maxHandleLabelElement=n.first),_.iGM(n=_.CRH())&&(t.combinedLabelElement=n.first),_.iGM(n=_.CRH())&&(t.ticksElement=n.first))},hostAttrs:[1,"ng5-slider"],hostVars:5,hostBindings:function(e,t){1&e&&_.NdJ("resize",function(e){return t.onResize(e)},!1,_.Jf7),2&e&&(_.uIk("disabled",t.sliderElementDisabledAttr),_.ekj("vertical",t.sliderElementVerticalClass)("animate",t.sliderElementAnimateClass))},inputs:{value:"value",highValue:"highValue",options:"options",manualRefresh:"manualRefresh",triggerFocus:"triggerFocus"},outputs:{valueChange:"valueChange",highValueChange:"highValueChange",userChangeStart:"userChangeStart",userChange:"userChange",userChangeEnd:"userChangeEnd"},features:[_._Bn([be]),_.TTD],decls:29,vars:13,consts:[["ng5SliderElement","",1,"ng5-slider-span","ng5-slider-bar-wrapper","ng5-slider-left-out-selection"],["leftOuterSelectionBar",""],[1,"ng5-slider-span","ng5-slider-bar"],["ng5SliderElement","",1,"ng5-slider-span","ng5-slider-bar-wrapper","ng5-slider-right-out-selection"],["rightOuterSelectionBar",""],["ng5SliderElement","",1,"ng5-slider-span","ng5-slider-bar-wrapper","ng5-slider-full-bar"],["fullBar",""],["ng5SliderElement","",1,"ng5-slider-span","ng5-slider-bar-wrapper","ng5-slider-selection-bar"],["selectionBar",""],[1,"ng5-slider-span","ng5-slider-bar","ng5-slider-selection",3,"ngStyle"],["ng5SliderHandle","",1,"ng5-slider-span","ng5-slider-pointer","ng5-slider-pointer-min",3,"ngStyle"],["minHandle",""],["ng5SliderHandle","",1,"ng5-slider-span","ng5-slider-pointer","ng5-slider-pointer-max",3,"ngStyle"],["maxHandle",""],["ng5SliderLabel","",1,"ng5-slider-span","ng5-slider-bubble","ng5-slider-limit","ng5-slider-floor"],["floorLabel",""],["ng5SliderLabel","",1,"ng5-slider-span","ng5-slider-bubble","ng5-slider-limit","ng5-slider-ceil"],["ceilLabel",""],["ng5SliderLabel","",1,"ng5-slider-span","ng5-slider-bubble","ng5-slider-model-value"],["minHandleLabel",""],["ng5SliderLabel","",1,"ng5-slider-span","ng5-slider-bubble","ng5-slider-model-high"],["maxHandleLabel",""],["ng5SliderLabel","",1,"ng5-slider-span","ng5-slider-bubble","ng5-slider-combined"],["combinedLabel",""],["ng5SliderElement","",1,"ng5-slider-ticks",3,"hidden"],["ticksElement",""],["class","ng5-slider-tick",3,"ngClass","ngStyle",4,"ngFor","ngForOf"],[1,"ng5-slider-tick",3,"ngClass","ngStyle"],[3,"template","tooltip","placement"],["class","ng5-slider-span ng5-slider-tick-value",3,"template","tooltip","placement","content",4,"ngIf"],["class","ng5-slider-span ng5-slider-tick-legend",3,"innerHTML",4,"ngIf"],[1,"ng5-slider-span","ng5-slider-tick-value",3,"template","tooltip","placement","content"],[1,"ng5-slider-span","ng5-slider-tick-legend",3,"innerHTML"]],template:function(e,t){1&e&&(_.TgZ(0,"span",0,1),_._UZ(2,"span",2),_.qZA(),_.TgZ(3,"span",3,4),_._UZ(5,"span",2),_.qZA(),_.TgZ(6,"span",5,6),_._UZ(8,"span",2),_.qZA(),_.TgZ(9,"span",7,8),_._UZ(11,"span",9),_.qZA(),_._UZ(12,"span",10,11),_._UZ(14,"span",12,13),_._UZ(16,"span",14,15),_._UZ(18,"span",16,17),_._UZ(20,"span",18,19),_._UZ(22,"span",20,21),_._UZ(24,"span",22,23),_.TgZ(26,"span",24,25),_.YNc(28,Q,4,9,"span",26),_.qZA()),2&e&&(_.xp6(6),_.ekj("ng5-slider-transparent",t.fullBarTransparentClass),_.xp6(3),_.ekj("ng5-slider-draggable",t.selectionBarDraggableClass),_.xp6(2),_.Q6J("ngStyle",t.barStyle),_.xp6(1),_.Q6J("ngStyle",t.minPointerStyle),_.xp6(2),_.Udp("display",t.range?"inherit":"none"),_.Q6J("ngStyle",t.maxPointerStyle),_.xp6(12),_.ekj("ng5-slider-ticks-values-under",t.ticksUnderValuesClass),_.Q6J("hidden",!t.showTicks),_.xp6(2),_.Q6J("ngForOf",t.ticks))},directives:function(){return[pe,y.PC,de,fe,y.sg,y.mk,we,y.O5]},styles:[".ng5-slider{display:inline-block;position:relative;height:4px;width:100%;margin:35px 0 15px;vertical-align:middle;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-touch-action:pan-y;touch-action:pan-y}  .ng5-slider.with-legend{margin-bottom:40px}  .ng5-slider[disabled]{cursor:not-allowed}  .ng5-slider[disabled] .ng5-slider-pointer{cursor:not-allowed;background-color:#d8e0f3}  .ng5-slider[disabled] .ng5-slider-draggable{cursor:not-allowed}  .ng5-slider[disabled] .ng5-slider-selection{background:#8b91a2}  .ng5-slider[disabled] .ng5-slider-tick{cursor:not-allowed}  .ng5-slider[disabled] .ng5-slider-tick.ng5-slider-selected{background:#8b91a2}  .ng5-slider .ng5-slider-span{white-space:nowrap;position:absolute;display:inline-block}  .ng5-slider .ng5-slider-base{width:100%;height:100%;padding:0}  .ng5-slider .ng5-slider-bar-wrapper{left:0;-webkit-box-sizing:border-box;box-sizing:border-box;margin-top:-16px;padding-top:16px;width:100%;height:32px;z-index:1}  .ng5-slider .ng5-slider-draggable{cursor:move}  .ng5-slider .ng5-slider-bar{left:0;width:100%;height:4px;z-index:1;background:#d8e0f3;border-radius:2px}  .ng5-slider .ng5-slider-bar-wrapper.ng5-slider-transparent .ng5-slider-bar{background:0 0}  .ng5-slider .ng5-slider-bar-wrapper.ng5-slider-left-out-selection .ng5-slider-bar{background:#df002d}  .ng5-slider .ng5-slider-bar-wrapper.ng5-slider-right-out-selection .ng5-slider-bar{background:#03a688}  .ng5-slider .ng5-slider-selection{z-index:2;background:#0db9f0;border-radius:2px}  .ng5-slider .ng5-slider-pointer{cursor:pointer;width:32px;height:32px;top:-14px;background-color:#0db9f0;z-index:3;border-radius:16px}  .ng5-slider .ng5-slider-pointer:after{content:'';width:8px;height:8px;position:absolute;top:12px;left:12px;border-radius:4px;background:#fff}  .ng5-slider .ng5-slider-pointer:hover:after{background-color:#fff}  .ng5-slider .ng5-slider-pointer.ng5-slider-active{z-index:4}  .ng5-slider .ng5-slider-pointer.ng5-slider-active:after{background-color:#451aff}  .ng5-slider .ng5-slider-bubble{cursor:default;bottom:16px;padding:1px 3px;color:#55637d;font-size:16px}  .ng5-slider .ng5-slider-bubble.ng5-slider-limit{color:#55637d}  .ng5-slider .ng5-slider-ticks{-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;height:0;position:absolute;left:0;top:-3px;margin:0;z-index:1;list-style:none}  .ng5-slider .ng5-slider-ticks-values-under .ng5-slider-tick-value{top:auto;bottom:-36px}  .ng5-slider .ng5-slider-tick{text-align:center;cursor:pointer;width:10px;height:10px;background:#d8e0f3;border-radius:50%;position:absolute;top:0;left:0;margin-left:11px}  .ng5-slider .ng5-slider-tick.ng5-slider-selected{background:#0db9f0}  .ng5-slider .ng5-slider-tick-value{position:absolute;top:-34px;-webkit-transform:translate(-50%,0);transform:translate(-50%,0)}  .ng5-slider .ng5-slider-tick-legend{position:absolute;top:24px;-webkit-transform:translate(-50%,0);transform:translate(-50%,0);max-width:50px;white-space:normal}  .ng5-slider.vertical{position:relative;width:4px;height:100%;margin:0 20px;padding:0;vertical-align:baseline;-ms-touch-action:pan-x;touch-action:pan-x}  .ng5-slider.vertical .ng5-slider-base{width:100%;height:100%;padding:0}  .ng5-slider.vertical .ng5-slider-bar-wrapper{top:auto;left:0;margin:0 0 0 -16px;padding:0 0 0 16px;height:100%;width:32px}  .ng5-slider.vertical .ng5-slider-bar{bottom:0;left:auto;width:4px;height:100%}  .ng5-slider.vertical .ng5-slider-pointer{left:-14px!important;top:auto;bottom:0}  .ng5-slider.vertical .ng5-slider-bubble{left:16px!important;bottom:0}  .ng5-slider.vertical .ng5-slider-ticks{height:100%;width:0;left:-3px;top:0;z-index:1}  .ng5-slider.vertical .ng5-slider-tick{vertical-align:middle;margin-left:auto;margin-top:11px}  .ng5-slider.vertical .ng5-slider-tick-value{left:24px;top:auto;-webkit-transform:translate(0,-28%);transform:translate(0,-28%)}  .ng5-slider.vertical .ng5-slider-tick-legend{top:auto;right:24px;-webkit-transform:translate(0,-28%);transform:translate(0,-28%);max-width:none;white-space:nowrap}  .ng5-slider.vertical .ng5-slider-ticks-values-under .ng5-slider-tick-value{bottom:auto;left:auto;right:24px}  .ng5-slider *{-webkit-transition:none;transition:none}  .ng5-slider.animate .ng5-slider-bar-wrapper{-webkit-transition:all linear .3s;transition:all linear .3s}  .ng5-slider.animate .ng5-slider-selection{-webkit-transition:background-color linear .3s;transition:background-color linear .3s}  .ng5-slider.animate .ng5-slider-pointer{-webkit-transition:all linear .3s;transition:all linear .3s}  .ng5-slider.animate .ng5-slider-bubble{-webkit-transition:all linear .3s;transition:all linear .3s}  .ng5-slider.animate .ng5-slider-bubble.ng5-slider-limit{-webkit-transition:opacity linear .3s;transition:opacity linear .3s}  .ng5-slider.animate .ng5-slider-bubble.ng5-slider-combined{-webkit-transition:opacity linear .3s;transition:opacity linear .3s}  .ng5-slider.animate .ng5-slider-tick{-webkit-transition:background-color linear .3s;transition:background-color linear .3s}"]}),e}(),we=function(){var e=function e(){M(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["ng5-slider-tooltip-wrapper"]],inputs:{template:"template",tooltip:"tooltip",placement:"placement",content:"content"},decls:2,vars:2,consts:[[4,"ngIf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ng5-slider-inner-tooltip"]],template:function(e,t){1&e&&(_.YNc(0,te,2,6,"ng-container",0),_.YNc(1,ne,3,3,"ng-container",0)),2&e&&(_.Q6J("ngIf",t.template),_.xp6(1),_.Q6J("ngIf",!t.template))},directives:[y.O5,y.tP],styles:[".ng5-slider-inner-tooltip[_ngcontent-%COMP%]{height:100%}"]}),e}(),_e=function(){var e=function e(){M(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[y.ez]]}),e}();f(40878),f(87254),f(73982),f(79996),f(44019),f(43835),f(96673),f(48569);var Se=function(){var e=function e(){M(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({providers:[],imports:[[]]}),e}(),Me=f(75425),Te=f(67103),ke=f(16353),Ee=f(68003),Ae=f(64762),Ce=f(26675),Oe="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,Le=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t!==n;){var i=t.nextSibling;e.removeChild(t),t=i}},Re="{{lit-".concat(String(Math.random()).slice(2),"}}"),Pe="\x3c!--".concat(Re,"--\x3e"),Ie=new RegExp("".concat(Re,"|").concat(Pe)),Ne=function e(t,n){M(this,e),this.parts=[],this.element=n;for(var i=[],r=[],a=document.createTreeWalker(n.content,133,null,!1),o=0,s=-1,u=0,l=t.strings,c=t.values.length;u<c;){var h=a.nextNode();if(null!==h){if(s++,1===h.nodeType){if(h.hasAttributes()){for(var p=h.attributes,d=p.length,f=0,v=0;v<d;v++)De(p[v].name,"$lit$")&&f++;for(;f-- >0;){var m=Be.exec(l[u])[2],g=m.toLowerCase()+"$lit$",y=h.getAttribute(g);h.removeAttribute(g);var b=y.split(Ie);this.parts.push({type:"attribute",index:s,name:m,strings:b}),u+=b.length-1}}"TEMPLATE"===h.tagName&&(r.push(h),a.currentNode=h.content)}else if(3===h.nodeType){var x=h.data;if(x.indexOf(Re)>=0){for(var w=h.parentNode,_=x.split(Ie),S=_.length-1,T=0;T<S;T++){var k=void 0,E=_[T];if(""===E)k=Ue();else{var A=Be.exec(E);null!==A&&De(A[2],"$lit$")&&(E=E.slice(0,A.index)+A[1]+A[2].slice(0,-"$lit$".length)+A[3]),k=document.createTextNode(E)}w.insertBefore(k,h),this.parts.push({type:"node",index:++s})}""===_[S]?(w.insertBefore(Ue(),h),i.push(h)):h.data=_[S],u+=S}}else if(8===h.nodeType)if(h.data===Re){var C=h.parentNode;null!==h.previousSibling&&s!==o||(s++,C.insertBefore(Ue(),h)),o=s,this.parts.push({type:"node",index:s}),null===h.nextSibling?h.data="":(i.push(h),s--),u++}else for(var O=-1;-1!==(O=h.data.indexOf(Re,O+1));)this.parts.push({type:"node",index:-1}),u++}else a.currentNode=r.pop()}for(var L=0,R=i;L<R.length;L++){var P=R[L];P.parentNode.removeChild(P)}},De=function(e,t){var n=e.length-t.length;return n>=0&&e.slice(n)===t},Fe=function(e){return-1!==e.index},Ue=function(){return document.createComment("")},Be=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function Ve(e,t){for(var n=e.element.content,i=e.parts,r=document.createTreeWalker(n,133,null,!1),a=ze(i),o=i[a],s=-1,u=0,l=[],c=null;r.nextNode();){s++;var h=r.currentNode;for(h.previousSibling===c&&(c=null),t.has(h)&&(l.push(h),null===c&&(c=h)),null!==c&&u++;void 0!==o&&o.index===s;)o.index=null!==c?-1:o.index-u,o=i[a=ze(i,a)]}l.forEach(function(e){return e.parentNode.removeChild(e)})}var He=function(e){for(var t=11===e.nodeType?0:1,n=document.createTreeWalker(e,133,null,!1);n.nextNode();)t++;return t},ze=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=t+1;n<e.length;n++)if(Fe(e[n]))return n;return-1},Ze=new WeakMap,Ge=function(e){return"function"==typeof e&&Ze.has(e)},je={},qe={},We=function(){function e(t,n,i){M(this,e),this.__parts=[],this.template=t,this.processor=n,this.options=i}return k(e,[{key:"update",value:function(e){var t,n=0,i=x(this.__parts);try{for(i.s();!(t=i.n()).done;){var r=t.value;void 0!==r&&r.setValue(e[n]),n++}}catch(u){i.e(u)}finally{i.f()}var a,o=x(this.__parts);try{for(o.s();!(a=o.n()).done;){var s=a.value;void 0!==s&&s.commit()}}catch(u){o.e(u)}finally{o.f()}}},{key:"_clone",value:function(){for(var e,t=Oe?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],i=this.template.parts,r=document.createTreeWalker(t,133,null,!1),a=0,o=0,s=r.nextNode();a<i.length;)if(e=i[a],Fe(e)){for(var u;o<e.index;)o++,"TEMPLATE"===s.nodeName&&(n.push(s),r.currentNode=s.content),null===(s=r.nextNode())&&(r.currentNode=n.pop(),s=r.nextNode());if("node"===e.type){var l=this.processor.handleTextExpression(this.options);l.insertAfterNode(s.previousSibling),this.__parts.push(l)}else(u=this.__parts).push.apply(u,w(this.processor.handleAttributeExpressions(s,e.name,e.strings,this.options)));a++}else this.__parts.push(void 0),a++;return Oe&&(document.adoptNode(t),customElements.upgrade(t)),t}}]),e}(),Je=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:function(e){return e}}),Ye=" ".concat(Re," "),Xe=function(){function e(t,n,i,r){M(this,e),this.strings=t,this.values=n,this.type=i,this.processor=r}return k(e,[{key:"getHTML",value:function(){for(var e=this.strings.length-1,t="",n=!1,i=0;i<e;i++){var r=this.strings[i],a=r.lastIndexOf("\x3c!--");n=(a>-1||n)&&-1===r.indexOf("--\x3e",a+1);var o=Be.exec(r);t+=null===o?r+(n?Ye:Pe):r.substr(0,o.index)+o[1]+o[2]+"$lit$"+o[3]+Re}return t+=this.strings[e]}},{key:"getTemplateElement",value:function(){var e=document.createElement("template"),t=this.getHTML();return void 0!==Je&&(t=Je.createHTML(t)),e.innerHTML=t,e}}]),e}(),Qe=function(e){return null===e||!("object"==typeof e||"function"==typeof e)},Ke=function(e){return Array.isArray(e)||!(!e||!e[Symbol.iterator])},$e=function(){function e(t,n,i){M(this,e),this.dirty=!0,this.element=t,this.name=n,this.strings=i,this.parts=[];for(var r=0;r<i.length-1;r++)this.parts[r]=this._createPart()}return k(e,[{key:"_createPart",value:function(){return new et(this)}},{key:"_getValue",value:function(){var e=this.strings,t=e.length-1,n=this.parts;if(1===t&&""===e[0]&&""===e[1]){var i=n[0].value;if("symbol"==typeof i)return String(i);if("string"==typeof i||!Ke(i))return i}for(var r="",a=0;a<t;a++){r+=e[a];var o=n[a];if(void 0!==o){var s=o.value;if(Qe(s)||!Ke(s))r+="string"==typeof s?s:String(s);else{var u,l=x(s);try{for(l.s();!(u=l.n()).done;){var c=u.value;r+="string"==typeof c?c:String(c)}}catch(h){l.e(h)}finally{l.f()}}}}return r+=e[t]}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}]),e}(),et=function(){function e(t){M(this,e),this.value=void 0,this.committer=t}return k(e,[{key:"setValue",value:function(e){e===je||Qe(e)&&e===this.value||(this.value=e,Ge(e)||(this.committer.dirty=!0))}},{key:"commit",value:function(){for(;Ge(this.value);){var e=this.value;this.value=je,e(this)}this.value!==je&&this.committer.commit()}}]),e}(),tt=function(){function e(t){M(this,e),this.value=void 0,this.__pendingValue=void 0,this.options=t}return k(e,[{key:"appendInto",value:function(e){this.startNode=e.appendChild(Ue()),this.endNode=e.appendChild(Ue())}},{key:"insertAfterNode",value:function(e){this.startNode=e,this.endNode=e.nextSibling}},{key:"appendIntoPart",value:function(e){e.__insert(this.startNode=Ue()),e.__insert(this.endNode=Ue())}},{key:"insertAfterPart",value:function(e){e.__insert(this.startNode=Ue()),this.endNode=e.endNode,e.endNode=this.startNode}},{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){if(null!==this.startNode.parentNode){for(;Ge(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=je,e(this)}var t=this.__pendingValue;t!==je&&(Qe(t)?t!==this.value&&this.__commitText(t):t instanceof Xe?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):Ke(t)?this.__commitIterable(t):t===qe?(this.value=qe,this.clear()):this.__commitText(t))}}},{key:"__insert",value:function(e){this.endNode.parentNode.insertBefore(e,this.endNode)}},{key:"__commitNode",value:function(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}},{key:"__commitText",value:function(e){var t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}},{key:"__commitTemplateResult",value:function(e){var t=this.options.templateFactory(e);if(this.value instanceof We&&this.value.template===t)this.value.update(e.values);else{var n=new We(t,e.processor,this.options),i=n._clone();n.update(e.values),this.__commitNode(i),this.value=n}}},{key:"__commitIterable",value:function(t){Array.isArray(this.value)||(this.value=[],this.clear());var n,i,r=this.value,a=0,o=x(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;void 0===(n=r[a])&&(n=new e(this.options),r.push(n),0===a?n.appendIntoPart(this):n.insertAfterPart(r[a-1])),n.setValue(s),n.commit(),a++}}catch(u){o.e(u)}finally{o.f()}a<r.length&&(r.length=a,this.clear(n&&n.endNode))}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startNode;Le(this.startNode.parentNode,e.nextSibling,this.endNode)}}]),e}(),nt=function(){function e(t,n,i){if(M(this,e),this.value=void 0,this.__pendingValue=void 0,2!==i.length||""!==i[0]||""!==i[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=n,this.strings=i}return k(e,[{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){for(;Ge(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=je,e(this)}if(this.__pendingValue!==je){var t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=je}}}]),e}(),it=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,i,r)).single=2===r.length&&""===r[0]&&""===r[1],a}return k(n,[{key:"_createPart",value:function(){return new rt(this)}},{key:"_getValue",value:function(){return this.single?this.parts[0].value:p(b(n.prototype),"_getValue",this).call(this)}},{key:"commit",value:function(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}]),n}($e),rt=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(et),at=!1;!function(){try{var e={get capture(){return at=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(Oe){}}();var ot=function(){function e(t,n,i){var r=this;M(this,e),this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=n,this.eventContext=i,this.__boundHandleEvent=function(e){return r.handleEvent(e)}}return k(e,[{key:"setValue",value:function(e){this.__pendingValue=e}},{key:"commit",value:function(){for(;Ge(this.__pendingValue);){var e=this.__pendingValue;this.__pendingValue=je,e(this)}if(this.__pendingValue!==je){var t=this.__pendingValue,n=this.value,i=null==t||null!=n&&(t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive),r=null!=t&&(null==n||i);i&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),r&&(this.__options=st(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=je}}},{key:"handleEvent",value:function(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}]),e}(),st=function(e){return e&&(at?{capture:e.capture,passive:e.passive,once:e.once}:e.capture)};function ut(e){var t=lt.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},lt.set(e.type,t));var n=t.stringsArray.get(e.strings);if(void 0!==n)return n;var i=e.strings.join(Re);return void 0===(n=t.keyString.get(i))&&(n=new Ne(e,e.getTemplateElement()),t.keyString.set(i,n)),t.stringsArray.set(e.strings,n),n}var lt=new Map,ct=new WeakMap,ht=function(e,t,n){var i=ct.get(t);void 0===i&&(Le(t,t.firstChild),ct.set(t,i=new tt(Object.assign({templateFactory:ut},n))),i.appendInto(t)),i.setValue(e),i.commit()},pt=new(function(){function e(){M(this,e)}return k(e,[{key:"handleAttributeExpressions",value:function(e,t,n,i){var r=t[0];return"."===r?new it(e,t.slice(1),n).parts:"@"===r?[new ot(e,t.slice(1),i.eventContext)]:"?"===r?[new nt(e,t.slice(1),n)]:new $e(e,t,n).parts}},{key:"handleTextExpression",value:function(e){return new tt(e)}}]),e}());"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var dt=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return new Xe(e,n,"html",pt)},ft=function(e,t){return"".concat(e,"--").concat(t)},vt=!0;void 0===window.ShadyCSS?vt=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),vt=!1);var mt=function(e){return function(t){var n=ft(t.type,e),i=lt.get(n);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},lt.set(n,i));var r=i.stringsArray.get(t.strings);if(void 0!==r)return r;var a=t.strings.join(Re);if(void 0===(r=i.keyString.get(a))){var o=t.getTemplateElement();vt&&window.ShadyCSS.prepareTemplateDom(o,e),r=new Ne(t,o),i.keyString.set(a,r)}return i.stringsArray.set(t.strings,r),r}},gt=["html","svg"],yt=new Set;window.JSCompiler_renameProperty=function(e,t){return e};var bt={toAttribute:function(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute:function(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},xt=function(e,t){return t!==e&&(t==t||e==e)},wt={attribute:!0,type:String,converter:bt,reflect:!1,hasChanged:xt},_t=function(e){d(i,e);var t,n=v(i);function i(){var e;return M(this,i),(e=n.call(this)).initialize(),e}return k(i,[{key:"initialize",value:function(){var e=this;this._updateState=0,this._updatePromise=new Promise(function(t){return e._enableUpdatingResolver=t}),this._changedProperties=new Map,this._saveInstanceProperties(),this.requestUpdateInternal()}},{key:"_saveInstanceProperties",value:function(){var e=this;this.constructor._classProperties.forEach(function(t,n){if(e.hasOwnProperty(n)){var i=e[n];delete e[n],e._instanceProperties||(e._instanceProperties=new Map),e._instanceProperties.set(n,i)}})}},{key:"_applyInstanceProperties",value:function(){var e=this;this._instanceProperties.forEach(function(t,n){return e[n]=t}),this._instanceProperties=void 0}},{key:"connectedCallback",value:function(){this.enableUpdating()}},{key:"enableUpdating",value:function(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}},{key:"disconnectedCallback",value:function(){}},{key:"attributeChangedCallback",value:function(e,t,n){t!==n&&this._attributeToProperty(e,n)}},{key:"_propertyToAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:wt,i=this.constructor,r=i._attributeNameForProperty(e,n);if(void 0!==r){var a=i._propertyValueToAttribute(t,n);if(void 0===a)return;this._updateState=8|this._updateState,null==a?this.removeAttribute(r):this.setAttribute(r,a),this._updateState=-9&this._updateState}}},{key:"_attributeToProperty",value:function(e,t){if(!(8&this._updateState)){var n=this.constructor,i=n._attributeToPropertyMap.get(e);if(void 0!==i){var r=n.getPropertyOptions(i);this._updateState=16|this._updateState,this[i]=n._propertyValueFromAttribute(t,r),this._updateState=-17&this._updateState}}}},{key:"requestUpdateInternal",value:function(e,t,n){var i=!0;if(void 0!==e){var r=this.constructor;n=n||r.getPropertyOptions(e),r._valueHasChanged(this[e],t,n.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==n.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,n))):i=!1}!this._hasRequestedUpdate&&i&&(this._updatePromise=this._enqueueUpdate())}},{key:"requestUpdate",value:function(e,t){return this.requestUpdateInternal(e,t),this.updateComplete}},{key:"_enqueueUpdate",value:(t=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._updateState=4|this._updateState,e.prev=1,e.next=4,this._updatePromise;case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:if(t=this.performUpdate(),e.t1=null!=t,!e.t1){e.next=13;break}return e.next=13,t;case 13:return e.abrupt("return",!this._hasRequestedUpdate);case 14:case"end":return e.stop()}},e,this,[[1,6]])})),function(){return t.apply(this,arguments)})},{key:"_hasRequestedUpdate",get:function(){return 4&this._updateState}},{key:"hasUpdated",get:function(){return 1&this._updateState}},{key:"performUpdate",value:function(){if(this._hasRequestedUpdate){this._instanceProperties&&this._applyInstanceProperties();var e=!1,t=this._changedProperties;try{(e=this.shouldUpdate(t))?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}}},{key:"_markUpdated",value:function(){this._changedProperties=new Map,this._updateState=-5&this._updateState}},{key:"updateComplete",get:function(){return this._getUpdateComplete()}},{key:"_getUpdateComplete",value:function(){return this.getUpdateComplete()}},{key:"getUpdateComplete",value:function(){return this._updatePromise}},{key:"shouldUpdate",value:function(e){return!0}},{key:"update",value:function(e){var t=this;void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach(function(e,n){return t._propertyToAttribute(n,t[n],e)}),this._reflectingProperties=void 0),this._markUpdated()}},{key:"updated",value:function(e){}},{key:"firstUpdated",value:function(e){}}],[{key:"observedAttributes",get:function(){var e=this;this.finalize();var t=[];return this._classProperties.forEach(function(n,i){var r=e._attributeNameForProperty(i,n);void 0!==r&&(e._attributeToPropertyMap.set(r,i),t.push(r))}),t}},{key:"_ensureClassProperties",value:function(){var e=this;if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;var t=Object.getPrototypeOf(this)._classProperties;void 0!==t&&t.forEach(function(t,n){return e._classProperties.set(n,t)})}}},{key:"createProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wt;if(this._ensureClassProperties(),this._classProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){var n="symbol"==typeof e?Symbol():"__".concat(e),i=this.getPropertyDescriptor(e,n,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}}},{key:"getPropertyDescriptor",value:function(e,t,n){return{get:function(){return this[t]},set:function(i){var r=this[e];this[t]=i,this.requestUpdateInternal(e,r,n)},configurable:!0,enumerable:!0}}},{key:"getPropertyOptions",value:function(e){return this._classProperties&&this._classProperties.get(e)||wt}},{key:"finalize",value:function(){var e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){var t,n=this.properties,i=x([].concat(w(Object.getOwnPropertyNames(n)),w("function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n):[])));try{for(i.s();!(t=i.n()).done;){var r=t.value;this.createProperty(r,n[r])}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_attributeNameForProperty",value:function(e,t){var n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}},{key:"_valueHasChanged",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xt;return n(e,t)}},{key:"_propertyValueFromAttribute",value:function(e,t){var n=t.converter||bt,i="function"==typeof n?n:n.fromAttribute;return i?i(e,t.type):e}},{key:"_propertyValueToAttribute",value:function(e,t){if(void 0!==t.reflect){var n=t.converter;return(n&&n.toAttribute||bt.toAttribute)(e,t.type)}}}]),i}(c(HTMLElement));_t.finalized=!0;function St(e){return function(t,n){return void 0!==n?function(e,t,n){t.constructor.createProperty(n,e)}(e,t,n):function(e,t){return"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher:function(n){n.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer:function(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher:function(n){n.createProperty(t.key,e)}}}(e,t)}}var Mt=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Tt=Symbol(),kt=function(){function e(t,n){if(M(this,e),n!==Tt)throw new Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}return k(e,[{key:"styleSheet",get:function(){return void 0===this._styleSheet&&(Mt?(this._styleSheet=new CSSStyleSheet,this._styleSheet.replaceSync(this.cssText)):this._styleSheet=null),this._styleSheet}},{key:"toString",value:function(){return this.cssText}}]),e}();(window.litElementVersions||(window.litElementVersions=[])).push("2.5.1");var Et={},At=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return k(n,[{key:"initialize",value:function(){p(b(n.prototype),"initialize",this).call(this),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}},{key:"createRenderRoot",value:function(){return this.attachShadow(this.constructor.shadowRootOptions)}},{key:"adoptStyles",value:function(){var e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?Mt?this.renderRoot.adoptedStyleSheets=e.map(function(e){return e instanceof CSSStyleSheet?e:e.styleSheet}):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(function(e){return e.cssText}),this.localName))}},{key:"connectedCallback",value:function(){p(b(n.prototype),"connectedCallback",this).call(this),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}},{key:"update",value:function(e){var t=this,i=this.render();p(b(n.prototype),"update",this).call(this,e),i!==Et&&this.constructor.render(i,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(function(e){var n=document.createElement("style");n.textContent=e.cssText,t.renderRoot.appendChild(n)}))}},{key:"render",value:function(){return Et}}],[{key:"getStyles",value:function(){return this.styles}},{key:"_getUniqueStyles",value:function(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_styles",this))){var e=this.getStyles();if(Array.isArray(e)){var t=function e(t,n){return t.reduceRight(function(t,n){return Array.isArray(n)?e(n,t):(t.add(n),t)},n)}(e,new Set),n=[];t.forEach(function(e){return n.unshift(e)}),this._styles=n}else this._styles=void 0===e?[]:[e];this._styles=this._styles.map(function(e){if(e instanceof CSSStyleSheet&&!Mt){var t=Array.prototype.slice.call(e.cssRules).reduce(function(e,t){return e+t.cssText},"");return new kt(String(t),Tt)}return e})}}}]),n}(_t);At.finalized=!0,At.render=function(e,t,n){if(!n||"object"!=typeof n||!n.scopeName)throw new Error("The `scopeName` option is required.");var i=n.scopeName,r=ct.has(t),a=vt&&11===t.nodeType&&!!t.host,o=a&&!yt.has(i),s=o?document.createDocumentFragment():t;if(ht(e,s,Object.assign({templateFactory:mt(i)},n)),o){var u=ct.get(s);ct.delete(s),function(e,t,n){yt.add(e);var i=n?n.element:document.createElement("template"),r=t.querySelectorAll("style"),a=r.length;if(0!==a){for(var o=document.createElement("style"),s=0;s<a;s++){var u=r[s];u.parentNode.removeChild(u),o.textContent+=u.textContent}!function(e){gt.forEach(function(t){var n=lt.get(ft(t,e));void 0!==n&&n.keyString.forEach(function(e){var t=e.element.content,n=new Set;Array.from(t.querySelectorAll("style")).forEach(function(e){n.add(e)}),Ve(e,n)})})}(e);var l=i.content;n?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.element.content,r=e.parts;if(null!=n)for(var a=document.createTreeWalker(i,133,null,!1),o=ze(r),s=0,u=-1;a.nextNode();)for(u++,a.currentNode===n&&(s=He(t),n.parentNode.insertBefore(t,n));-1!==o&&r[o].index===u;){if(s>0){for(;-1!==o;)r[o].index+=s,o=ze(r,o);return}o=ze(r,o)}else i.appendChild(t)}(n,o,l.firstChild):l.insertBefore(o,l.firstChild),window.ShadyCSS.prepareTemplateStyles(i,e);var c=l.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==c)t.insertBefore(c.cloneNode(!0),t.firstChild);else if(n){l.insertBefore(o,l.firstChild);var h=new Set;h.add(o),Ve(n,h)}}else window.ShadyCSS.prepareTemplateStyles(i,e)}(i,s,u.value instanceof We?u.value.template:void 0),Le(t,t.firstChild),t.appendChild(s),ct.set(t,u)}!r&&a&&window.ShadyCSS.styleElement(t.host)},At.shadowRootOptions={mode:"open"};var Ct=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,Ot=Ct&&self.XRSession.prototype.requestHitTestSource,Lt=null!=self.ResizeObserver,Rt=null!=self.IntersectionObserver,Pt=Ot;(function(){var e=navigator.userAgent||navigator.vendor||self.opera;/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))})(),/\bCrOS\b/.test(navigator.userAgent);var It=/android/i.test(navigator.userAgent),Nt=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,Dt=function(){var e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))}();/Safari\//.test(navigator.userAgent);var Ft=/firefox/i.test(navigator.userAgent),Ut=/OculusBrowser/.test(navigator.userAgent);Nt&&/CriOS\//.test(navigator.userAgent);for(var Bt=It&&!Ft&&!Ut,Vt=dt(e||(e=s(['\n<style>\n:host {\n  display: block;\n  position: relative;\n  contain: strict;\n  width: 300px;\n  height: 150px;\n}\n\n/* NOTE: This ruleset is our integration surface area with the\n * :focus-visible polyfill.\n *\n * @see https://github.com/WICG/focus-visible/pull/196 */\n:host([data-js-focus-visible]:focus:not(.focus-visible)),\n:host([data-js-focus-visible]) :focus:not(.focus-visible) {\n  outline: none;\n}\n\n.container {\n  position: relative;\n}\n\n.userInput {\n  width: 100%;\n  height: 100%;\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\n\ncanvas {\n  position: absolute;\n  display: none;\n  pointer-events: none;\n  /* NOTE(cdata): Chrome 76 and below apparently have a bug\n   * that causes our canvas not to display pixels unless it is\n   * on its own render layer\n   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893\n   */\n  transform: translateZ(0);\n}\n\ncanvas.show {\n  display: block;\n}\n\n/* Adapted from HTML5 Boilerplate\n *\n * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */\n.screen-reader-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  white-space: nowrap;\n  width: 1px;\n}\n\n.slot {\n  position: absolute;\n  pointer-events: none;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.slot > * {\n  pointer-events: initial;\n}\n\n.annotation-wrapper ::slotted(*) {\n  opacity: var(--max-hotspot-opacity, 1);\n  transition: opacity 0.3s;\n}\n\n.pointer-tumbling .annotation-wrapper ::slotted(*) {\n  pointer-events: none;\n}\n\n.annotation-wrapper ::slotted(*) {\n  pointer-events: initial;\n}\n\n.annotation-wrapper.hide ::slotted(*) {\n  opacity: var(--min-hotspot-opacity, 0.25);\n}\n\n.slot.poster {\n  opacity: 0;\n  transition: opacity 0.3s 0.3s;\n  background-color: inherit;\n}\n\n.slot.poster.show {\n  opacity: 1;\n  transition: none;\n}\n\n.slot.poster.quick {\n  transition: none;\n}\n\n.slot.poster > * {\n  pointer-events: initial;\n}\n\n.slot.poster:not(.show) > * {\n  pointer-events: none;\n}\n\n#default-poster {\n  width: 100%;\n  height: 100%;\n  /* The default poster is a <button> so we need to set display\n   * to prevent it from being affected by text-align: */\n  display: block;\n  position: absolute;\n  border: none;\n  padding: 0;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center;\n  background-color: var(--poster-color, #fff);\n  background-image: var(--poster-image, none);\n}\n\n#default-progress-bar {\n  display: block;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  overflow: hidden;\n}\n\n#default-progress-bar > .mask {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: var(--progress-mask, #fff);\n  transition: opacity 0.3s;\n  opacity: 0.2;\n}\n\n#default-progress-bar > .bar {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: var(--progress-bar-height, 5px);\n  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));\n  transition: transform 0.09s;\n  transform-origin: top left;\n  transform: scaleX(0);\n  overflow: hidden;\n}\n\n#default-progress-bar > .bar.hide {\n  transition: opacity 0.3s 1s;\n  opacity: 0;\n}\n\n.slot.interaction-prompt {\n  display: var(--interaction-prompt-display, flex);\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n  align-items: center;\n  justify-content: center;\n\n  opacity: 0;\n  will-change: opacity;\n  overflow: hidden;\n  transition: opacity 0.3s;\n}\n\n.slot.interaction-prompt.visible {\n  opacity: 1;\n}\n\n.slot.interaction-prompt > .animated-container {\n  will-change: transform, opacity;\n}\n\n.slot.interaction-prompt > * {\n  pointer-events: none;\n}\n\n.slot.ar-button {\n  -moz-user-select: none;\n  -webkit-tap-highlight-color: transparent;\n  user-select: none;\n\n  display: var(--ar-button-display, block);\n}\n\n.slot.ar-button:not(.enabled) {\n  display: none;\n}\n\n.fab {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-sizing: border-box;\n  width: 40px;\n  height: 40px;\n  cursor: pointer;\n  background-color: #fff;\n  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);\n  border-radius: 100px;\n}\n\n.fab > * {\n  opacity: 0.87;\n}\n\n#default-ar-button {\n  position: absolute;\n  bottom: 16px;\n  right: 16px;\n  transform: scale(var(--ar-button-scale, 1));\n  transform-origin: bottom right;\n}\n\n.slot.default {\n  pointer-events: none;\n}\n\n.slot.progress-bar {\n  pointer-events: none;\n}\n\n.slot.exit-webxr-ar-button {\n  pointer-events: none;\n}\n\n.slot.exit-webxr-ar-button:not(.enabled) {\n  display: none;\n}\n\n#default-exit-webxr-ar-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  width: 40px;\n  height: 40px;\n  box-sizing: border-box;\n}\n\n#default-exit-webxr-ar-button > svg {\n  fill: #fff;\n}\n</style>\n<div class="container">\n  <div class="userInput" tabindex="0" role="img"\n      aria-label="A depiction of a 3D model"\n      aria-live="polite">\n      <div class="slot canvas">\n        <slot name="canvas">\n          <canvas></canvas>\n        </slot>\n      </div>\n  </div>\n\n  \x3c!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM\n        will have their <slot> elements removed by ShadyCSS --\x3e\n  <div class="slot poster">\n    <slot name="poster">\n      <button type="button" id="default-poster" aria-hidden="true" aria-label="Activate to view in 3D!"></button>\n    </slot>\n  </div>\n\n  <div class="slot ar-button">\n    <slot name="ar-button">\n      <a id="default-ar-button" part="default-ar-button" class="fab"\n          tabindex="2"\n          aria-label="View this 3D model up close">\n        ','\n      </a>\n    </slot>\n  </div>\n\n  <div class="slot interaction-prompt">\n    <div class="animated-container">\n      <slot name="interaction-prompt" aria-hidden="true">\n        ','\n      </slot>\n    </div>\n  </div>\n\n  <div class="slot default">\n    <slot></slot>\n\n    <div class="slot progress-bar">\n      <slot name="progress-bar">\n        <div id="default-progress-bar" aria-hidden="true">\n          <div class="mask" part="default-progress-mask"></div>\n          <div class="bar" part="default-progress-bar"></div>\n        </div>\n      </slot>\n    </div>\n    \n    <div class="slot exit-webxr-ar-button">\n      <slot name="exit-webxr-ar-button">\n        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"\n            tabindex="3"\n            aria-label="Exit AR"\n            aria-hidden="true">\n          ',"\n        </a>\n      </slot>\n    </div>\n  </div>\n</div>"])),dt(t||(t=s(['\n<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"\n\t xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"\n\t viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">\n<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>\n<g id="Art_layer">\n\t<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>\n\t<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>\n\t<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>\n\t<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>\n\t<g>\n\t\t<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3\n\t\t\tl5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62\n\t\t\tl4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>\n\t</g>\n</g>\n</svg>']))),dt(n||(n=s(['\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">\n    <defs>\n        <path id="A" d="M.001.232h24.997V36H.001z" />\n    </defs>\n    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">\n        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />\n        <g transform="translate(11 3)">\n            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />\n            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />\n            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />\n            <g transform="translate(0 .769)">\n                <mask id="B" fill="#fff">\n                    <use xlink:href="#A" />\n                </mask>\n                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />\n            </g>\n        </g>\n    </g>\n</svg>']))),dt(i||(i=s(['\n<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">\n    \x3c!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement\n         support for dynamic re-coloring of UI components --\x3e\n    <defs>\n      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">\n        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>\n        <feOffset dx="0" dy="0" result="offsetblur"/>\n        <feFlood flood-color="#000000"/>\n        <feComposite in2="offsetblur" operator="in"/>\n        <feMerge>\n          <feMergeNode/>\n          <feMergeNode in="SourceGraphic"/>\n        </feMerge>\n      </filter>\n    </defs>\n    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n    <path d="M0 0h24v24H0z" fill="none"/>\n</svg>'])))),Ht=function(){function e(){M(this,e)}return k(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),i=0,r=n.length;i<r;i++)n[i].call(this,e);e.target=null}}}}]),e}(),zt=1234567,Zt=Math.PI/180,Gt=180/Math.PI,jt=[],qt=0;qt<256;qt++)jt[qt]=(qt<16?"0":"")+qt.toString(16);var Wt="undefined"!=typeof crypto&&"randomUUID"in crypto;function Jt(){if(Wt)return crypto.randomUUID().toUpperCase();var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(jt[255&e]+jt[e>>8&255]+jt[e>>16&255]+jt[e>>24&255]+"-"+jt[255&t]+jt[t>>8&255]+"-"+jt[t>>16&15|64]+jt[t>>24&255]+"-"+jt[63&n|128]+jt[n>>8&255]+"-"+jt[n>>16&255]+jt[n>>24&255]+jt[255&i]+jt[i>>8&255]+jt[i>>16&255]+jt[i>>24&255]).toUpperCase()}function Yt(e,t,n){return Math.max(t,Math.min(n,e))}function Xt(e,t){return(e%t+t)%t}function Qt(e,t,n){return(1-n)*e+n*t}function Kt(e){return 0==(e&e-1)&&0!==e}function $t(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function en(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var tn=Object.freeze({__proto__:null,DEG2RAD:Zt,RAD2DEG:Gt,generateUUID:Jt,clamp:Yt,euclideanModulo:Xt,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Qt,damp:function(e,t,n,i){return Qt(e,t,1-Math.exp(-n*i))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Xt(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(zt=e%2147483647),((zt=16807*zt%2147483647)-1)/2147483646},degToRad:function(e){return e*Zt},radToDeg:function(e){return e*Gt},isPowerOfTwo:Kt,ceilPowerOfTwo:$t,floorPowerOfTwo:en,setQuaternionFromProperEuler:function(e,t,n,i,r){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),p=o((t-i)/2),d=a((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(s*c,u*h,u*p,s*l);break;case"YZY":e.set(u*p,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*p,s*c,s*l);break;case"XZX":e.set(s*c,u*f,u*d,s*l);break;case"YXY":e.set(u*d,s*c,u*f,s*l);break;case"ZYZ":e.set(u*f,u*d,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}}),nn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;M(this,t),this.x=e,this.y=n}return k(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){return Math.atan2(-this.y,-this.x)+Math.PI}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}},e,this)})}]),t}();nn.prototype.isVector2=!0;var rn,an=function(){function e(){M(this,e),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return k(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,u){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],p=n[5],d=n[8],f=i[0],v=i[3],m=i[6],g=i[1],y=i[4],b=i[7],x=i[2],w=i[5],_=i[8];return r[0]=a*f+o*g+s*x,r[3]=a*v+o*y+s*w,r[6]=a*m+o*b+s*_,r[1]=u*f+l*g+c*x,r[4]=u*v+l*y+c*w,r[7]=u*m+l*b+c*_,r[2]=h*f+p*g+d*x,r[5]=h*v+p*y+d*w,r[8]=h*m+p*b+d*_,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*r*l+n*o*s+i*r*u-i*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*r,p=u*r-a*s,d=t*c+n*h+i*p;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var f=1/d;return e[0]=c*f,e[1]=(i*u-l*n)*f,e[2]=(o*n-i*a)*f,e[3]=h*f,e[4]=(l*t-i*s)*f,e[5]=(i*r-o*t)*f,e[6]=p*f,e[7]=(n*s-u*t)*f,e[8]=(a*t-n*r)*f,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,i,r,a,o){var s=Math.cos(r),u=Math.sin(r);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-i*u,i*s,-i*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],u=i[4],l=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*u,i[6]=t*o+n*l,i[1]=-n*r+t*s,i[4]=-n*a+t*u,i[7]=-n*o+t*l,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function on(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function sn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}an.prototype.isMatrix3=!0;var un=function(){function e(){M(this,e)}return k(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===rn&&(rn=sn("canvas")),rn.width=e.width,rn.height=e.height;var n=rn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=rn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}]),e}(),ln=0,cn=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1001,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1001,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:3e3;return M(this,n),e=t.call(this),Object.defineProperty(g(e),"id",{value:ln++}),e.uuid=Jt(),e.name="",e.image=i,e.mipmaps=[],e.mapping=r,e.wrapS=a,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=l,e.internalFormat=null,e.type=c,e.offset=new nn(0,0),e.repeat=new nn(1,1),e.center=new nn(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new an,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=p,e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e}return k(n,[{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var i=this.image;if(void 0===i.uuid&&(i.uuid=Jt()),!t&&void 0===e.images[i.uuid]){var r;if(Array.isArray(i)){r=[];for(var a=0,o=i.length;a<o;a++)r.push(hn(i[a].isDataTexture?i[a].image:i[a]))}else r=hn(i);e.images[i.uuid]={uuid:i.uuid,url:r}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Ht);function hn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?un.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}cn.DEFAULT_IMAGE=void 0,cn.DEFAULT_MAPPING=300,cn.prototype.isTexture=!0;var pn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;M(this,t),this.x=e,this.y=n,this.z=i,this.w=r}return k(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],p=s[5],d=s[9],f=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-f)<a&&Math.abs(d-v)<a){if(Math.abs(l+h)<o&&Math.abs(c+f)<o&&Math.abs(d+v)<o&&Math.abs(u+p+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,y=(p+1)/2,b=(m+1)/2,x=(l+h)/4,w=(c+f)/4,_=(d+v)/4;return g>y&&g>b?g<a?(n=0,i=.707106781,r=.707106781):(i=x/(n=Math.sqrt(g)),r=w/n):y>b?y<a?(n=.707106781,i=0,r=.707106781):(n=x/(i=Math.sqrt(y)),r=_/i):b<a?(n=.707106781,i=.707106781,r=0):(n=w/(r=Math.sqrt(b)),i=_/r),this.set(n,i,r,t),this}var S=Math.sqrt((v-d)*(v-d)+(c-f)*(c-f)+(h-l)*(h-l));return Math.abs(S)<.001&&(S=1),this.x=(v-d)/S,this.y=(c-f)/S,this.z=(h-l)/S,this.w=Math.acos((u+p+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}},e,this)})}]),t}();pn.prototype.isVector4=!0;var dn=function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return M(this,n),(r=t.call(this)).width=e,r.height=i,r.depth=1,r.scissor=new pn(0,0,e,i),r.scissorTest=!1,r.viewport=new pn(0,0,e,i),r.texture=new cn(void 0,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),r.texture.isRenderTargetTexture=!0,r.texture.image={width:e,height:i,depth:1},r.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,r.texture.internalFormat=void 0!==a.internalFormat?a.internalFormat:null,r.texture.minFilter=void 0!==a.minFilter?a.minFilter:1006,r.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,r.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,r.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,r}return k(n,[{key:"setTexture",value:function(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}},{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},this.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Ht);dn.prototype.isWebGLRenderTarget=!0,function(e){d(n,e);var t=v(n);function n(e,i,r){var a;M(this,n);var o=(a=t.call(this,e,i)).texture;a.texture=[];for(var s=0;s<r;s++)a.texture[s]=o.clone();return a}return k(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}]),n}(dn).prototype.isWebGLMultipleRenderTargets=!0;var fn=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,i,r)).samples=4,a}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.samples=e.samples,this}}]),n}(dn);fn.prototype.isWebGLMultisampleRenderTarget=!0;var vn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;M(this,e),this._x=t,this._y=n,this._z=i,this._w=r}return k(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(i/2),c=o(r/2),h=s(n/2),p=s(i/2),d=s(r/2);switch(a){case"XYZ":this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d;break;case"YXZ":this._x=h*l*c+u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d;break;case"ZXY":this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c-h*p*d;break;case"ZYX":this._x=h*l*c-u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c+h*p*d;break;case"YZX":this._x=h*l*c+u*p*d,this._y=u*p*c+h*l*d,this._z=u*l*d-h*p*c,this._w=u*l*c-h*p*d;break;case"XZY":this._x=h*l*c-u*p*d,this._y=u*p*c-h*l*d,this._z=u*l*d+h*p*c,this._w=u*l*c+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){var p=.5/Math.sqrt(h+1);this._w=.25/p,this._x=(l-s)*p,this._y=(r-u)*p,this._z=(a-i)*p}else if(n>o&&n>c){var d=2*Math.sqrt(1+n-o-c);this._w=(l-s)/d,this._x=.25*d,this._y=(i+a)/d,this._z=(r+u)/d}else if(o>c){var f=2*Math.sqrt(1+o-n-c);this._w=(r-u)/f,this._x=(i+a)/f,this._y=.25*f,this._z=(s+l)/f}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-i)/v,this._x=(r+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(Yt(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var i=Math.min(1,t/n);return this.slerp(e,i),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+i*u-r*s,this._y=i*l+a*s+r*o-n*u,this._z=r*l+a*u+n*s-i*o,this._w=a*l-n*o-i*s-r*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*i+t*this._y,this._z=u*r+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,p=Math.sin(t*c)/l;return this._w=a*h+this._w*p,this._x=n*h+this._x*p,this._y=i*h+this._y*p,this._z=r*h+this._z*p,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}],[{key:"slerp",value:function(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}},{key:"slerpFlat",value:function(e,t,n,i,r,a,o){var s=n[i+0],u=n[i+1],l=n[i+2],c=n[i+3],h=r[a+0],p=r[a+1],d=r[a+2],f=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=p,e[t+2]=d,void(e[t+3]=f);if(c!==f||s!==h||u!==p||l!==d){var v=1-o,m=s*h+u*p+l*d+c*f,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,m*g);v=Math.sin(v*x)/b,o=Math.sin(o*x)/b}var w=o*g;if(s=s*v+h*w,u=u*v+p*w,l=l*v+d*w,c=c*v+f*w,v===1-o){var _=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=_,u*=_,l*=_,c*=_}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,i,r,a){var o=n[i],s=n[i+1],u=n[i+2],l=n[i+3],c=r[a],h=r[a+1],p=r[a+2],d=r[a+3];return e[t]=o*d+l*c+s*p-u*h,e[t+1]=s*d+l*h+u*c-o*p,e[t+2]=u*d+l*p+o*h-s*c,e[t+3]=l*d-o*c-s*h-u*p,e}}]),e}();vn.prototype.isQuaternion=!0;var mn=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;M(this,t),this.x=e,this.y=n,this.z=i}return k(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(yn.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(yn.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*i-o*n,l=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=u*s+h*-r+l*-o-c*-a,this.y=l*s+h*-a+c*-r-u*-o,this.z=c*s+h*-o+u*-a-l*-r,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return gn.copy(this).projectOnVector(e),this.sub(gn)}},{key:"reflect",value:function(e){return this.sub(gn.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Yt(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}},e,this)})}]),t}();mn.prototype.isVector3=!0;var gn=new mn,yn=new vn,bn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn(-1/0,-1/0,-1/0);M(this,e),this.min=t,this.max=n}return k(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=wn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),_n.copy(t.boundingBox),_n.applyMatrix4(e.matrixWorld),this.union(_n));for(var n=e.children,i=0,r=n.length;i<r;i++)this.expandByObject(n[i]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,wn),wn.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Cn),On.subVectors(this.max,Cn),Sn.subVectors(e.a,Cn),Mn.subVectors(e.b,Cn),Tn.subVectors(e.c,Cn),kn.subVectors(Mn,Sn),En.subVectors(Tn,Mn),An.subVectors(Sn,Tn);var t=[0,-kn.z,kn.y,0,-En.z,En.y,0,-An.z,An.y,kn.z,0,-kn.x,En.z,0,-En.x,An.z,0,-An.x,-kn.y,kn.x,0,-En.y,En.x,0,-An.y,An.x,0];return!!Pn(t,Sn,Mn,Tn,On)&&(!!Pn(t=[1,0,0,0,1,0,0,0,1],Sn,Mn,Tn,On)&&(Ln.crossVectors(kn,En),Pn(t=[Ln.x,Ln.y,Ln.z],Sn,Mn,Tn,On)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return wn.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(wn).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(xn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xn)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();bn.prototype.isBox3=!0;var xn=[new mn,new mn,new mn,new mn,new mn,new mn,new mn,new mn],wn=new mn,_n=new bn,Sn=new mn,Mn=new mn,Tn=new mn,kn=new mn,En=new mn,An=new mn,Cn=new mn,On=new mn,Ln=new mn,Rn=new mn;function Pn(e,t,n,i,r){for(var a=0,o=e.length-3;a<=o;a+=3){Rn.fromArray(e,a);var s=r.x*Math.abs(Rn.x)+r.y*Math.abs(Rn.y)+r.z*Math.abs(Rn.z),u=t.dot(Rn),l=n.dot(Rn),c=i.dot(Rn);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var In=new bn,Nn=new mn,Dn=new mn,Fn=new mn,Un=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;M(this,e),this.center=t,this.radius=n}return k(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):In.setFromPoints(e).getCenter(n);for(var i=0,r=0,a=e.length;r<a;r++)i=Math.max(i,n.distanceToSquared(e[r]));return this.radius=Math.sqrt(i),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){Fn.subVectors(e,this.center);var t=Fn.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),i=.5*(n-this.radius);this.center.add(Fn.multiplyScalar(i/n)),this.radius+=i}return this}},{key:"union",value:function(e){return Dn.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Nn.copy(e.center).add(Dn)),this.expandByPoint(Nn.copy(e.center).sub(Dn)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Bn=new mn,Vn=new mn,Hn=new mn,zn=new mn,Zn=new mn,Gn=new mn,jn=new mn,qn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn(0,0,-1);M(this,e),this.origin=t,this.direction=n}return k(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Bn)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=Bn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Bn.copy(this.direction).multiplyScalar(t).add(this.origin),Bn.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,i){Vn.copy(e).add(t).multiplyScalar(.5),Hn.copy(t).sub(e).normalize(),zn.copy(this.origin).sub(Vn);var r,a,o,s,u=.5*e.distanceTo(t),l=-this.direction.dot(Hn),c=zn.dot(this.direction),h=-zn.dot(Hn),p=zn.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(a=l*c-h,s=u*d,(r=l*h-c)>=0)if(a>=-s)if(a<=s){var f=1/d;o=(r*=f)*(r+l*(a*=f)+2*c)+a*(l*r+a+2*h)+p}else a=u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;else a=-u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;else a<=-s?o=-(r=Math.max(0,-(-l*u+c)))*r+(a=r>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+p:a<=s?(r=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+p):o=-(r=Math.max(0,-(l*u+c)))*r+(a=r>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+p;else a=l>0?-u:u,o=-(r=Math.max(0,-(l*a+c)))*r+a*(a+2*h)+p;return n&&n.copy(this.direction).multiplyScalar(r).add(this.origin),i&&i.copy(Hn).multiplyScalar(a).add(Vn),o}},{key:"intersectSphere",value:function(e,t){Bn.subVectors(e.center,this.origin);var n=Bn.dot(this.direction),i=Bn.dot(Bn)-n*n,r=e.radius*e.radius;if(i>r)return null;var a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:this.at(o<0?s:o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,i,r,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,i=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,i=(e.min.x-h.x)*u),l>=0?(r=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Bn)}},{key:"intersectTriangle",value:function(e,t,n,i,r){Zn.subVectors(t,e),Gn.subVectors(n,e),jn.crossVectors(Zn,Gn);var a,o=this.direction.dot(jn);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}zn.subVectors(this.origin,e);var s=a*this.direction.dot(Gn.crossVectors(zn,Gn));if(s<0)return null;var u=a*this.direction.dot(Zn.cross(zn));if(u<0)return null;if(s+u>o)return null;var l=-a*zn.dot(jn);return l<0?null:this.at(l/o,r)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Wn=function(){function e(){M(this,e),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return k(e,[{key:"set",value:function(e,t,n,i,r,a,o,s,u,l,c,h,p,d,f,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=i,m[1]=r,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=p,m[7]=d,m[11]=f,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,i=1/Jn.setFromMatrixColumn(e,0).length(),r=1/Jn.setFromMatrixColumn(e,1).length(),a=1/Jn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*l,p=a*c,d=o*l,f=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=p+d*u,t[5]=h-f*u,t[9]=-o*s,t[2]=f-h*u,t[6]=d+p*u,t[10]=a*s}else if("YXZ"===e.order){var v=s*l,m=s*c,g=u*l,y=u*c;t[0]=v+y*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=a*s}else if("ZXY"===e.order){var b=s*l,x=s*c,w=u*l,_=u*c;t[0]=b-_*o,t[4]=-a*c,t[8]=w+x*o,t[1]=x+w*o,t[5]=a*l,t[9]=_-b*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var S=a*l,M=a*c,T=o*l,k=o*c;t[0]=s*l,t[4]=T*u-M,t[8]=S*u+k,t[1]=s*c,t[5]=k*u+S,t[9]=M*u-T,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var E=a*s,A=a*u,C=o*s,O=o*u;t[0]=s*l,t[4]=O-E*c,t[8]=C*c+A,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=A*c+C,t[10]=E-O*c}else if("XZY"===e.order){var L=a*s,R=a*u,P=o*s,I=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=L*c+I,t[5]=a*l,t[9]=R*c-P,t[2]=P*c-R,t[6]=o*l,t[10]=I*c+L}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Xn,e,Qn)}},{key:"lookAt",value:function(e,t,n){var i=this.elements;return ei.subVectors(e,t),0===ei.lengthSq()&&(ei.z=1),ei.normalize(),Kn.crossVectors(n,ei),0===Kn.lengthSq()&&(1===Math.abs(n.z)?ei.x+=1e-4:ei.z+=1e-4,ei.normalize(),Kn.crossVectors(n,ei)),Kn.normalize(),$n.crossVectors(ei,Kn),i[0]=Kn.x,i[4]=$n.x,i[8]=ei.x,i[1]=Kn.y,i[5]=$n.y,i[9]=ei.y,i[2]=Kn.z,i[6]=$n.z,i[10]=ei.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],p=n[13],d=n[2],f=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],x=n[15],w=i[0],_=i[4],S=i[8],M=i[12],T=i[1],k=i[5],E=i[9],A=i[13],C=i[2],O=i[6],L=i[10],R=i[14],P=i[3],I=i[7],N=i[11],D=i[15];return r[0]=a*w+o*T+s*C+u*P,r[4]=a*_+o*k+s*O+u*I,r[8]=a*S+o*E+s*L+u*N,r[12]=a*M+o*A+s*R+u*D,r[1]=l*w+c*T+h*C+p*P,r[5]=l*_+c*k+h*O+p*I,r[9]=l*S+c*E+h*L+p*N,r[13]=l*M+c*A+h*R+p*D,r[2]=d*w+f*T+v*C+m*P,r[6]=d*_+f*k+v*O+m*I,r[10]=d*S+f*E+v*L+m*N,r[14]=d*M+f*A+v*R+m*D,r[3]=g*w+y*T+b*C+x*P,r[7]=g*_+y*k+b*O+x*I,r[11]=g*S+y*E+b*L+x*N,r[15]=g*M+y*A+b*R+x*D,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],p=e[14];return e[3]*(+r*s*c-i*u*c-r*o*h+n*u*h+i*o*p-n*s*p)+e[7]*(+t*s*p-t*u*h+r*a*h-i*a*p+i*u*l-r*s*l)+e[11]*(+t*u*c-t*o*p-r*a*c+n*a*p+r*o*l-n*u*l)+e[15]*(-i*o*l-t*s*c+t*o*h+i*a*c-n*a*h+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11],d=e[12],f=e[13],v=e[14],m=e[15],g=c*v*u-f*h*u+f*s*p-o*v*p-c*s*m+o*h*m,y=d*h*u-l*v*u-d*s*p+a*v*p+l*s*m-a*h*m,b=l*f*u-d*c*u+d*o*p-a*f*p-l*o*m+a*c*m,x=d*c*s-l*f*s-d*o*h+a*f*h+l*o*v-a*c*v,w=t*g+n*y+i*b+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var _=1/w;return e[0]=g*_,e[1]=(f*h*r-c*v*r-f*i*p+n*v*p+c*i*m-n*h*m)*_,e[2]=(o*v*r-f*s*r+f*i*u-n*v*u-o*i*m+n*s*m)*_,e[3]=(c*s*r-o*h*r-c*i*u+n*h*u+o*i*p-n*s*p)*_,e[4]=y*_,e[5]=(l*v*r-d*h*r+d*i*p-t*v*p-l*i*m+t*h*m)*_,e[6]=(d*s*r-a*v*r-d*i*u+t*v*u+a*i*m-t*s*m)*_,e[7]=(a*h*r-l*s*r+l*i*u-t*h*u-a*i*p+t*s*p)*_,e[8]=b*_,e[9]=(d*c*r-l*f*r-d*n*p+t*f*p+l*n*m-t*c*m)*_,e[10]=(a*f*r-d*o*r+d*n*u-t*f*u-a*n*m+t*o*m)*_,e[11]=(l*o*r-a*c*r-l*n*u+t*c*u+a*n*p-t*o*p)*_,e[12]=x*_,e[13]=(l*f*i-d*c*i+d*n*h-t*f*h-l*n*v+t*c*v)*_,e[14]=(d*o*i-a*f*i-d*n*s+t*f*s+a*n*v-t*o*v)*_,e[15]=(a*c*i-l*o*i+l*n*s-t*c*s-a*n*h+t*o*h)*_,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,u=r*a,l=r*o;return this.set(u*a+n,u*o-i*s,u*s+i*o,0,u*o+i*s,l*o+n,l*s-i*a,0,u*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,u=r+r,l=a+a,c=o+o,h=r*u,p=r*l,d=r*c,f=a*l,v=a*c,m=o*c,g=s*u,y=s*l,b=s*c,x=n.x,w=n.y,_=n.z;return i[0]=(1-(f+m))*x,i[1]=(p+b)*x,i[2]=(d-y)*x,i[3]=0,i[4]=(p-b)*w,i[5]=(1-(h+m))*w,i[6]=(v+g)*w,i[7]=0,i[8]=(d+y)*_,i[9]=(v-g)*_,i[10]=(1-(h+f))*_,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"decompose",value:function(e,t,n){var i=this.elements,r=Jn.set(i[0],i[1],i[2]).length(),a=Jn.set(i[4],i[5],i[6]).length(),o=Jn.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],Yn.copy(this);var s=1/r,u=1/a,l=1/o;return Yn.elements[0]*=s,Yn.elements[1]*=s,Yn.elements[2]*=s,Yn.elements[4]*=u,Yn.elements[5]*=u,Yn.elements[6]*=u,Yn.elements[8]*=l,Yn.elements[9]*=l,Yn.elements[10]*=l,t.setFromRotationMatrix(Yn),n.x=r,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(n-i),u=(t+e)/(t-e),l=(n+i)/(n-i),c=-(a+r)/(a-r),h=-2*a*r/(a-r);return o[0]=2*r/(t-e),o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=s,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=c,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),u=1/(n-i),l=1/(a-r),c=(t+e)*s,h=(n+i)*u,p=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}();Wn.prototype.isMatrix4=!0;var Jn=new mn,Yn=new Wn,Xn=new mn(0,0,0),Qn=new mn(1,1,1),Kn=new mn,$n=new mn,ei=new mn,ti=new Wn,ni=new vn,ii=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;M(this,e),this._x=t,this._y=n,this._z=i,this._order=r}return k(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],u=i[5],l=i[9],c=i[2],h=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(Yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Yt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(Yt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-Yt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,p),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return ti.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ti,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return ni.setFromEuler(this),this.setFromQuaternion(ni,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new mn(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}}]),e}();ii.prototype.isEuler=!0,ii.DefaultOrder="XYZ",ii.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var ri=function(){function e(){M(this,e),this.mask=1}return k(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!=(this.mask&e.mask)}}]),e}(),ai=0,oi=new mn,si=new vn,ui=new Wn,li=new mn,ci=new mn,hi=new mn,pi=new vn,di=new mn(1,0,0),fi=new mn(0,1,0),vi=new mn(0,0,1),mi={type:"added"},gi={type:"removed"},yi=function(e){d(n,e);var t=v(n);function n(){var e;M(this,n),e=t.call(this),Object.defineProperty(g(e),"id",{value:ai++}),e.uuid=Jt(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var i=new mn,r=new ii,a=new vn,o=new mn(1,1,1);return r._onChange(function(){a.setFromEuler(r,!1)}),a._onChange(function(){r.setFromQuaternion(a,void 0,!1)}),Object.defineProperties(g(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:r},quaternion:{configurable:!0,enumerable:!0,value:a},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Wn},normalMatrix:{value:new an}}),e.matrix=new Wn,e.matrixWorld=new Wn,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new ri,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return k(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return si.setFromAxisAngle(e,t),this.quaternion.multiply(si),this}},{key:"rotateOnWorldAxis",value:function(e,t){return si.setFromAxisAngle(e,t),this.quaternion.premultiply(si),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(di,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(fi,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(vi,e)}},{key:"translateOnAxis",value:function(e,t){return oi.copy(e).applyQuaternion(this.quaternion),this.position.add(oi.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(di,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(fi,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(vi,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(ui.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?li.copy(e):li.set(e,t,n);var i=this.parent;this.updateWorldMatrix(!0,!1),ci.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ui.lookAt(ci,li,this.up):ui.lookAt(li,ci,this.up),this.quaternion.setFromRotationMatrix(ui),i&&(ui.extractRotation(i.matrixWorld),si.setFromRotationMatrix(ui),this.quaternion.premultiply(si.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(mi)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(gi)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(gi)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),ui.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ui.multiply(e.parent.matrixWorld)),e.applyMatrix4(ui),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ci,e,hi),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ci,pi,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var i=this.children,r=0,a=i.length;r<a;r++)i[r].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++)r(e.shapes,o[s]);else r(e.shapes,o)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],c=0,h=this.material.length;c<h;c++)l.push(r(e.materials,this.material[c]));i.material=l}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(var p=0;p<this.children.length;p++)i.children.push(this.children[p].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(var d=0;d<this.animations.length;d++)i.animations.push(r(e.animations,this.animations[d]))}if(t){var f=w(e.geometries),v=w(e.materials),m=w(e.textures),g=w(e.images),y=w(e.shapes),b=w(e.skeletons),x=w(e.animations);f.length>0&&(n.geometries=f),v.length>0&&(n.materials=v),m.length>0&&(n.textures=m),g.length>0&&(n.images=g),y.length>0&&(n.shapes=y),b.length>0&&(n.skeletons=b),x.length>0&&(n.animations=x)}return n.object=i,n;function w(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++)this.add(e.children[n].clone());return this}}]),n}(Ht);yi.DefaultUp=new mn(0,1,0),yi.DefaultMatrixAutoUpdate=!0,yi.prototype.isObject3D=!0;var bi=new mn,xi=new mn,wi=new mn,_i=new mn,Si=new mn,Mi=new mn,Ti=new mn,ki=new mn,Ei=new mn,Ai=new mn,Ci=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn;M(this,e),this.a=t,this.b=n,this.c=i}return k(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return bi.subVectors(this.c,this.b),xi.subVectors(this.a,this.b),.5*bi.cross(xi).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,i,r,a){return e.getUV(t,this.a,this.b,this.c,n,i,r,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,i,r=this.a,a=this.b,o=this.c;Si.subVectors(a,r),Mi.subVectors(o,r),ki.subVectors(e,r);var s=Si.dot(ki),u=Mi.dot(ki);if(s<=0&&u<=0)return t.copy(r);Ei.subVectors(e,a);var l=Si.dot(Ei),c=Mi.dot(Ei);if(l>=0&&c<=l)return t.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(r).addScaledVector(Si,n);Ai.subVectors(e,o);var p=Si.dot(Ai),d=Mi.dot(Ai);if(d>=0&&p<=d)return t.copy(o);var f=p*u-s*d;if(f<=0&&u>=0&&d<=0)return i=u/(u-d),t.copy(r).addScaledVector(Mi,i);var v=l*d-p*c;if(v<=0&&c-l>=0&&p-d>=0)return Ti.subVectors(o,a),i=(c-l)/(c-l+(p-d)),t.copy(a).addScaledVector(Ti,i);var m=1/(v+f+h);return n=f*m,i=h*m,t.copy(r).addScaledVector(Si,n).addScaledVector(Mi,i)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,i){i.subVectors(n,t),bi.subVectors(e,t),i.cross(bi);var r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,i,r){bi.subVectors(i,t),xi.subVectors(n,t),wi.subVectors(e,t);var a=bi.dot(bi),o=bi.dot(xi),s=bi.dot(wi),u=xi.dot(xi),l=xi.dot(wi),c=a*u-o*o;if(0===c)return r.set(-2,-1,-1);var h=1/c,p=(u*s-o*l)*h,d=(a*l-o*s)*h;return r.set(1-p-d,d,p)}},{key:"containsPoint",value:function(e,t,n,i){return this.getBarycoord(e,t,n,i,_i),_i.x>=0&&_i.y>=0&&_i.x+_i.y<=1}},{key:"getUV",value:function(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,_i),s.set(0,0),s.addScaledVector(r,_i.x),s.addScaledVector(a,_i.y),s.addScaledVector(o,_i.z),s}},{key:"isFrontFacing",value:function(e,t,n,i){return bi.subVectors(n,t),xi.subVectors(e,t),bi.cross(xi).dot(i)<0}}]),e}(),Oi=0,Li=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),e=t.call(this),Object.defineProperty(g(e),"id",{value:Oi++}),e.uuid=Jt(),e.name="",e.type="Material",e.fog=!0,e.blending=1,e.side=0,e.vertexColors=!1,e.opacity=1,e.format=1023,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=100,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=7680,e.stencilZFail=7680,e.stencilZPass=7680,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return k(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenTint&&this.sheenTint.isColor&&(n.sheenTint=this.sheenTint.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularTint&&this.specularTint.isColor&&(n.specularTint=this.specularTint.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularTintMap&&this.specularTintMap.isTexture&&(n.specularTintMap=this.specularTintMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationTint&&(n.attenuationTint=this.attenuationTint.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),1023!==this.format&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var r=i(e.textures),a=i(e.images);r.length>0&&(n.textures=r),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(Ht);Li.prototype.isMaterial=!0;var Ri={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Pi={h:0,s:0,l:0},Ii={h:0,s:0,l:0};function Ni(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Di(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fi(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Ui=function(){function e(t,n,i){return M(this,e),void 0===n&&void 0===i?this.set(t):this.setRGB(t,n,i)}return k(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=Xt(e,1),t=Yt(t,0,1),n=Yt(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Ni(r,i,e+1/3),this.g=Ni(r,i,e),this.b=Ni(r,i,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var i,r=n[2];switch(n[1]){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){var a=parseFloat(i[1])/360,o=parseInt(i[2],10)/100,s=parseInt(i[3],10)/100;return t(i[4]),this.setHSL(a,o,s)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var u=n[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=Ri[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=Di(e.r),this.g=Di(e.g),this.b=Di(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Fi(e.r),this.g=Fi(e.g),this.b=Fi(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t,n,i=this.r,r=this.g,a=this.b,o=Math.max(i,r,a),s=Math.min(i,r,a),u=(s+o)/2;if(s===o)t=0,n=0;else{var l=o-s;switch(n=u<=.5?l/(o+s):l/(2-o-s),o){case i:t=(r-a)/l+(r<a?6:0);break;case r:t=(a-i)/l+2;break;case a:t=(i-r)/l+4}t/=6}return e.h=t,e.s=n,e.l=u,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Pi),Pi.h+=e,Pi.s+=t,Pi.l+=n,this.setHSL(Pi.h,Pi.s,Pi.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Pi),e.getHSL(Ii);var n=Qt(Pi.h,Ii.h,t),i=Qt(Pi.s,Ii.s,t),r=Qt(Pi.l,Ii.l,t);return this.setHSL(n,i,r),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();Ui.NAMES=Ri,Ui.prototype.isColor=!0,Ui.prototype.r=1,Ui.prototype.g=1,Ui.prototype.b=1;var Bi=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshBasicMaterial",i.color=new Ui(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Li);Bi.prototype.isMeshBasicMaterial=!0;var Vi=new mn,Hi=new nn,zi=function(){function e(t,n,i){if(M(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}return k(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new Ui),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new nn),t[n++]=a.x,t[n++]=a.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new mn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),a=new pn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Hi.fromBufferAttribute(this,t),Hi.applyMatrix3(e),this.setXY(t,Hi.x,Hi.y);else if(3===this.itemSize)for(var i=0,r=this.count;i<r;i++)Vi.fromBufferAttribute(this,i),Vi.applyMatrix3(e),this.setXYZ(i,Vi.x,Vi.y,Vi.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)Vi.x=this.getX(t),Vi.y=this.getY(t),Vi.z=this.getZ(t),Vi.applyMatrix4(e),this.setXYZ(t,Vi.x,Vi.y,Vi.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Vi.x=this.getX(t),Vi.y=this.getY(t),Vi.z=this.getZ(t),Vi.applyNormalMatrix(e),this.setXYZ(t,Vi.x,Vi.y,Vi.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Vi.x=this.getX(t),Vi.y=this.getY(t),Vi.z=this.getZ(t),Vi.transformDirection(e),this.setXYZ(t,Vi.x,Vi.y,Vi.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}();zi.prototype.isBufferAttribute=!0;var Zi=function(e){d(n,e);var t=v(n);function n(e,i,r){return M(this,n),t.call(this,new Uint16Array(e),i,r)}return n}(zi),Gi=function(e){d(n,e);var t=v(n);function n(e,i,r){return M(this,n),t.call(this,new Uint32Array(e),i,r)}return n}(zi);(function(e){d(n,e);var t=v(n);function n(e,i,r){return M(this,n),t.call(this,new Uint16Array(e),i,r)}return n})(zi).prototype.isFloat16BufferAttribute=!0;var ji=function(e){d(n,e);var t=v(n);function n(e,i,r){return M(this,n),t.call(this,new Float32Array(e),i,r)}return n}(zi),qi=0,Wi=new Wn,Ji=new yi,Yi=new mn,Xi=new bn,Qi=new bn,Ki=new mn,$i=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),e=t.call(this),Object.defineProperty(g(e),"id",{value:qi++}),e.uuid=Jt(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return k(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return this.index=Array.isArray(e)?new(on(e)>65535?Gi:Zi)(e,1):e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new an).getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}var r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return Wi.makeRotationFromQuaternion(e),this.applyMatrix4(Wi),this}},{key:"rotateX",value:function(e){return Wi.makeRotationX(e),this.applyMatrix4(Wi),this}},{key:"rotateY",value:function(e){return Wi.makeRotationY(e),this.applyMatrix4(Wi),this}},{key:"rotateZ",value:function(e){return Wi.makeRotationZ(e),this.applyMatrix4(Wi),this}},{key:"translate",value:function(e,t,n){return Wi.makeTranslation(e,t,n),this.applyMatrix4(Wi),this}},{key:"scale",value:function(e,t,n){return Wi.makeScale(e,t,n),this.applyMatrix4(Wi),this}},{key:"lookAt",value:function(e){return Ji.lookAt(e),Ji.updateMatrix(),this.applyMatrix4(Ji.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Yi).negate(),this.translate(Yi.x,Yi.y,Yi.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new ji(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new bn);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new mn(-1/0,-1/0,-1/0),new mn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,i=t.length;n<i;n++)Xi.setFromBufferAttribute(t[n]),this.morphTargetsRelative?(Ki.addVectors(this.boundingBox.min,Xi.min),this.boundingBox.expandByPoint(Ki),Ki.addVectors(this.boundingBox.max,Xi.max),this.boundingBox.expandByPoint(Ki)):(this.boundingBox.expandByPoint(Xi.min),this.boundingBox.expandByPoint(Xi.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new Un);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new mn,1/0);if(e){var n=this.boundingSphere.center;if(Xi.setFromBufferAttribute(e),t)for(var i=0,r=t.length;i<r;i++)Qi.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(Ki.addVectors(Xi.min,Qi.min),Xi.expandByPoint(Ki),Ki.addVectors(Xi.max,Qi.max),Xi.expandByPoint(Ki)):(Xi.expandByPoint(Qi.min),Xi.expandByPoint(Qi.max));Xi.getCenter(n);for(var a=0,o=0,s=e.count;o<s;o++)Ki.fromBufferAttribute(e,o),a=Math.max(a,n.distanceToSquared(Ki));if(t)for(var u=0,l=t.length;u<l;u++)for(var c=t[u],h=this.morphTargetsRelative,p=0,d=c.count;p<d;p++)Ki.fromBufferAttribute(c,p),h&&(Yi.fromBufferAttribute(e,p),Ki.add(Yi)),a=Math.max(a,n.distanceToSquared(Ki));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new zi(new Float32Array(4*o),4));for(var s=t.tangent.array,u=[],l=[],c=0;c<o;c++)u[c]=new mn,l[c]=new mn;var h=new mn,p=new mn,d=new mn,f=new nn,v=new nn,m=new nn,g=new mn,y=new mn,b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(var x=0,w=b.length;x<w;++x)for(var _=b[x],S=_.start,M=S,T=S+_.count;M<T;M+=3)D(n[M+0],n[M+1],n[M+2]);for(var k=new mn,E=new mn,A=new mn,C=new mn,O=0,L=b.length;O<L;++O)for(var R=b[O],P=R.start,I=P,N=P+R.count;I<N;I+=3)F(n[I+0]),F(n[I+1]),F(n[I+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function D(e,t,n){h.fromArray(i,3*e),p.fromArray(i,3*t),d.fromArray(i,3*n),f.fromArray(a,2*e),v.fromArray(a,2*t),m.fromArray(a,2*n),p.sub(h),d.sub(h),v.sub(f),m.sub(f);var r=1/(v.x*m.y-m.x*v.y);isFinite(r)&&(g.copy(p).multiplyScalar(m.y).addScaledVector(d,-v.y).multiplyScalar(r),y.copy(d).multiplyScalar(v.x).addScaledVector(p,-m.x).multiplyScalar(r),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(y),l[t].add(y),l[n].add(y))}function F(e){A.fromArray(r,3*e),C.copy(A);var t=u[e];k.copy(t),k.sub(A.multiplyScalar(A.dot(t))).normalize(),E.crossVectors(C,t);var n=E.dot(l[e])<0?-1:1;s[4*e]=k.x,s[4*e+1]=k.y,s[4*e+2]=k.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new zi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var i=0,r=n.count;i<r;i++)n.setXYZ(i,0,0,0);var a=new mn,o=new mn,s=new mn,u=new mn,l=new mn,c=new mn,h=new mn,p=new mn;if(e)for(var d=0,f=e.count;d<f;d+=3){var v=e.getX(d+0),m=e.getX(d+1),g=e.getX(d+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),p.subVectors(a,o),h.cross(p),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,b=t.count;y<b;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),p.subVectors(a,o),h.cross(p),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,u=Math.min(o.length,r.length-s),l=0,c=s;l<u;l++,c++)r[c]=o[l];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Ki.fromBufferAttribute(e,t),Ki.normalize(),e.setXYZ(t,Ki.x,Ki.y,Ki.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i),o=0,s=0,u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*i;for(var c=0;c<i;c++)a[s++]=n[o++]}return new zi(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,i=this.index.array,r=this.attributes;for(var a in r){var o=e(r[a],i);t.setAttribute(a,o)}var s=this.morphAttributes;for(var u in s){for(var l=[],c=s[u],h=0,p=c.length;h<p;h++){var d=e(c[h],i);l.push(d)}t.morphAttributes[u]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var f=this.groups,v=0,m=f.length;v<m;v++){var g=f[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;null!==i&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var r=this.attributes;for(var a in r)e.data.attributes[a]=r[a].toJSON(e.data);var o={},s=!1;for(var u in this.morphAttributes){for(var l=this.morphAttributes[u],c=[],h=0,p=l.length;h<p;h++)c.push(l[h].toJSON(e.data));c.length>0&&(o[u]=c,s=!0)}s&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(e.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(e.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var i=e.attributes;for(var r in i)this.setAttribute(r,i[r].clone(t));var a=e.morphAttributes;for(var o in a){for(var s=[],u=a[o],l=0,c=u.length;l<c;l++)s.push(u[l].clone(t));this.morphAttributes[o]=s}this.morphTargetsRelative=e.morphTargetsRelative;for(var h=e.groups,p=0,d=h.length;p<d;p++){var f=h[p];this.addGroup(f.start,f.count,f.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var m=e.boundingSphere;return null!==m&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Ht);$i.prototype.isBufferGeometry=!0;var er=new Wn,tr=new qn,nr=new Un,ir=new mn,rr=new mn,ar=new mn,or=new mn,sr=new mn,ur=new mn,lr=new mn,cr=new mn,hr=new mn,pr=new nn,dr=new nn,fr=new nn,vr=new mn,mr=new mn,gr=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bi;return M(this,n),(e=t.call(this)).type="Mesh",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"raycast",value:function(e,t){var n,i=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===i.boundingSphere&&i.computeBoundingSphere(),nr.copy(i.boundingSphere),nr.applyMatrix4(a),!1!==e.ray.intersectsSphere(nr)&&(er.copy(a).invert(),tr.copy(e.ray).applyMatrix4(er),null===i.boundingBox||!1!==tr.intersectsBox(i.boundingBox))))if(i.isBufferGeometry){var o=i.index,s=i.attributes.position,u=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,h=i.attributes.uv2,p=i.groups,d=i.drawRange;if(null!==o)if(Array.isArray(r))for(var f=0,v=p.length;f<v;f++)for(var m=p[f],g=r[m.materialIndex],y=Math.max(m.start,d.start),b=Math.min(o.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3){var x=o.getX(y),w=o.getX(y+1),_=o.getX(y+2);(n=yr(this,g,e,tr,s,u,l,c,h,x,w,_))&&(n.faceIndex=Math.floor(y/3),n.face.materialIndex=m.materialIndex,t.push(n))}else for(var S=Math.max(0,d.start),M=Math.min(o.count,d.start+d.count);S<M;S+=3){var T=o.getX(S),k=o.getX(S+1),E=o.getX(S+2);(n=yr(this,r,e,tr,s,u,l,c,h,T,k,E))&&(n.faceIndex=Math.floor(S/3),t.push(n))}else if(void 0!==s)if(Array.isArray(r))for(var A=0,C=p.length;A<C;A++)for(var O=p[A],L=r[O.materialIndex],R=Math.max(O.start,d.start),P=Math.min(s.count,Math.min(O.start+O.count,d.start+d.count));R<P;R+=3)(n=yr(this,L,e,tr,s,u,l,c,h,R,R+1,R+2))&&(n.faceIndex=Math.floor(R/3),n.face.materialIndex=O.materialIndex,t.push(n));else for(var I=Math.max(0,d.start),N=Math.min(s.count,d.start+d.count);I<N;I+=3)(n=yr(this,r,e,tr,s,u,l,c,h,I,I+1,I+2))&&(n.faceIndex=Math.floor(I/3),t.push(n))}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}]),n}(yi);function yr(e,t,n,i,r,a,o,s,u,l,c,h){ir.fromBufferAttribute(r,l),rr.fromBufferAttribute(r,c),ar.fromBufferAttribute(r,h);var p=e.morphTargetInfluences;if(a&&p){lr.set(0,0,0),cr.set(0,0,0),hr.set(0,0,0);for(var d=0,f=a.length;d<f;d++){var v=p[d],m=a[d];0!==v&&(or.fromBufferAttribute(m,l),sr.fromBufferAttribute(m,c),ur.fromBufferAttribute(m,h),o?(lr.addScaledVector(or,v),cr.addScaledVector(sr,v),hr.addScaledVector(ur,v)):(lr.addScaledVector(or.sub(ir),v),cr.addScaledVector(sr.sub(rr),v),hr.addScaledVector(ur.sub(ar),v)))}ir.add(lr),rr.add(cr),ar.add(hr)}e.isSkinnedMesh&&(e.boneTransform(l,ir),e.boneTransform(c,rr),e.boneTransform(h,ar));var g=function(e,t,n,i,r,a,o,s){if(null===(1===t.side?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,2!==t.side,s)))return null;mr.copy(s),mr.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(mr);return u<n.near||u>n.far?null:{distance:u,point:mr.clone(),object:e}}(e,t,n,i,ir,rr,ar,vr);if(g){s&&(pr.fromBufferAttribute(s,l),dr.fromBufferAttribute(s,c),fr.fromBufferAttribute(s,h),g.uv=Ci.getUV(vr,ir,rr,ar,pr,dr,fr,new nn)),u&&(pr.fromBufferAttribute(u,l),dr.fromBufferAttribute(u,c),fr.fromBufferAttribute(u,h),g.uv2=Ci.getUV(vr,ir,rr,ar,pr,dr,fr,new nn));var y={a:l,b:c,c:h,normal:new mn,materialIndex:0};Ci.getNormal(ir,rr,ar,y.normal),g.face=y}return g}gr.prototype.isMesh=!0;var br=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;M(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:i,height:r,depth:a,widthSegments:o,heightSegments:s,depthSegments:u};var l=g(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var c=[],h=[],p=[],d=[],f=0,v=0;function m(e,t,n,i,r,a,o,s,u,m,g){for(var y=a/u,b=o/m,x=a/2,w=o/2,_=s/2,S=u+1,M=m+1,T=0,k=0,E=new mn,A=0;A<M;A++)for(var C=A*b-w,O=0;O<S;O++)E[e]=(O*y-x)*i,E[t]=C*r,E[n]=_,h.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[n]=s>0?1:-1,p.push(E.x,E.y,E.z),d.push(O/u),d.push(1-A/m),T+=1;for(var L=0;L<m;L++)for(var R=0;R<u;R++){var P=f+R+S*(L+1),I=f+(R+1)+S*(L+1),N=f+(R+1)+S*L;c.push(f+R+S*L,P,N),c.push(P,I,N),k+=6}l.addGroup(v,k,g),v+=k,f+=T}return m("z","y","x",-1,-1,a,r,i,u,s,0),m("z","y","x",1,-1,a,r,-i,u,s,1),m("x","z","y",1,1,i,a,r,o,u,2),m("x","z","y",1,-1,i,a,-r,o,u,3),m("x","y","z",1,-1,i,r,a,o,s,4),m("x","y","z",-1,-1,i,r,-a,o,s,5),e.setIndex(c),e.setAttribute("position",new ji(h,3)),e.setAttribute("normal",new ji(p,3)),e.setAttribute("uv",new ji(d,2)),e}return k(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}($i);function xr(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var r=e[n][i];t[n][i]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}return t}function wr(e){for(var t={},n=0;n<e.length;n++){var i=xr(e[n]);for(var r in i)t[r]=i[r]}return t}var _r={clone:xr,merge:wr},Sr=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="ShaderMaterial",i.defines={},i.uniforms={},i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),i.setValues(e)),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=xr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);for(var i in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[i].value;t.uniforms[i]=r&&r.isTexture?{type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?{type:"c",value:r.getHex()}:r&&r.isVector2?{type:"v2",value:r.toArray()}:r&&r.isVector3?{type:"v3",value:r.toArray()}:r&&r.isVector4?{type:"v4",value:r.toArray()}:r&&r.isMatrix3?{type:"m3",value:r.toArray()}:r&&r.isMatrix4?{type:"m4",value:r.toArray()}:{value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),n}(Li);Sr.prototype.isShaderMaterial=!0;var Mr=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="Camera",e.matrixWorldInverse=new Wn,e.projectionMatrix=new Wn,e.projectionMatrixInverse=new Wn,e}return k(n,[{key:"copy",value:function(e,t){return p(b(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){p(b(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){p(b(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(yi);Mr.prototype.isCamera=!0;var Tr=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return M(this,n),(e=t.call(this)).type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=a,e.far=o,e.focus=10,e.aspect=r,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return k(n,[{key:"copy",value:function(e,t){return p(b(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Gt*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*Zt*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*Gt*Math.atan(Math.tan(.5*Zt*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*Zt*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(Mr);Tr.prototype.isPerspectiveCamera=!0;var kr=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;if(M(this,n),(a=t.call(this)).type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return m(a,void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."));a.renderTarget=r;var o=new Tr(90,1,e,i);o.layers=a.layers,o.up.set(0,-1,0),o.lookAt(new mn(1,0,0)),a.add(o);var s=new Tr(90,1,e,i);s.layers=a.layers,s.up.set(0,-1,0),s.lookAt(new mn(-1,0,0)),a.add(s);var u=new Tr(90,1,e,i);u.layers=a.layers,u.up.set(0,0,1),u.lookAt(new mn(0,1,0)),a.add(u);var l=new Tr(90,1,e,i);l.layers=a.layers,l.up.set(0,0,-1),l.lookAt(new mn(0,-1,0)),a.add(l);var c=new Tr(90,1,e,i);c.layers=a.layers,c.up.set(0,-1,0),c.lookAt(new mn(0,0,1)),a.add(c);var h=new Tr(90,1,e,i);return h.layers=a.layers,h.up.set(0,-1,0),h.lookAt(new mn(0,0,-1)),a.add(h),m(a)}return k(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=r(this.children,6),a=i[0],o=i[1],s=i[2],u=i[3],l=i[4],c=i[5],h=e.xr.enabled,p=e.getRenderTarget();e.xr.enabled=!1;var d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,s),e.setRenderTarget(n,3),e.render(t,u),e.setRenderTarget(n,4),e.render(t,l),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(p),e.xr.enabled=h}}]),n}(yi),Er=function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s,u,l,c,h){var p;return M(this,n),(p=t.call(this,e=void 0!==e?e:[],i=void 0!==i?i:301,r,a,o,s,u,l,c,h)).flipY=!1,p}return k(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(cn);Er.prototype.isCubeTexture=!0;var Ar=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),Number.isInteger(i)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),i=r),(a=t.call(this,e,e,i)).texture=new Er(void 0,(i=i||{}).mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture.isRenderTargetTexture=!0,a.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,a.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,a.texture._needsFlipEnvMap=!1,a}return k(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n=new br(5,5,5),i=new Sr({name:"CubemapFromEquirect",uniforms:xr({tEquirect:{value:null}}),vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",side:1,blending:0});i.uniforms.tEquirect.value=t;var r=new gr(n,i),a=t.minFilter;return 1008===t.minFilter&&(t.minFilter=1006),new kr(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}},{key:"clear",value:function(e,t,n,i){for(var r=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(r)}}]),n}(dn);Ar.prototype.isWebGLCubeRenderTarget=!0;var Cr=new mn,Or=new mn,Lr=new an,Rr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;M(this,e),this.normal=t,this.constant=n}return k(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var i=Cr.subVectors(n,t).cross(Or.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(Cr),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Lr.getNormalMatrix(e),i=this.coplanarPoint(Cr).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();Rr.prototype.isPlane=!0;var Pr=new Un,Ir=new mn,Nr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Rr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rr,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Rr,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Rr,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Rr,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Rr;M(this,e),this.planes=[t,n,i,r,a,o]}return k(e,[{key:"set",value:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],p=n[9],d=n[10],f=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-i,c-s,f-h,y-v).normalize(),t[1].setComponents(o+i,c+s,f+h,y+v).normalize(),t[2].setComponents(o+r,c+u,f+p,y+m).normalize(),t[3].setComponents(o-r,c-u,f-p,y-m).normalize(),t[4].setComponents(o-a,c-l,f-d,y-g).normalize(),t[5].setComponents(o+a,c+l,f+d,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Pr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Pr)}},{key:"intersectsSprite",value:function(e){return Pr.center.set(0,0,0),Pr.radius=.7071067811865476,Pr.applyMatrix4(e.matrixWorld),this.intersectsSphere(Pr)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++)if(t[r].distanceToPoint(n)<i)return!1;return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var i=t[n];if(Ir.x=i.normal.x>0?e.max.x:e.min.x,Ir.y=i.normal.y>0?e.max.y:e.min.y,Ir.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ir)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function Dr(){var e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Fr(e,t){var n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){var a=i.get(t);(!a||a.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=i.get(t);void 0===o?i.set(t,function(t,i){var r=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,a),t.onUploadCallback();var s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):o.version<t.version&&(function(t,i,r){var a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,r),o.version=t.version)}}}}var Ur=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;M(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:i,height:r,widthSegments:a,heightSegments:o};for(var s=i/2,u=r/2,l=Math.floor(a),c=Math.floor(o),h=l+1,p=c+1,d=i/l,f=r/c,v=[],m=[],g=[],y=[],b=0;b<p;b++)for(var x=b*f-u,w=0;w<h;w++)m.push(w*d-s,-x,0),g.push(0,0,1),y.push(w/l),y.push(1-b/c);for(var _=0;_<c;_++)for(var S=0;S<l;S++){var T=S+h*(_+1),k=S+1+h*(_+1),E=S+1+h*_;v.push(S+h*_,T,E),v.push(T,k,E)}return e.setIndex(v),e.setAttribute("position",new ji(m,3)),e.setAttribute("normal",new ji(g,3)),e.setAttribute("uv",new ji(y,2)),e}return k(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}($i),Br={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenTint, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenTint * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularTintFactor = specularTint;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARTINTMAP\n\t\t\tspecularTintFactor *= specularTintMapTexelToLinear( texture2D( specularTintMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularTintFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularTintFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenTint = sheenTint;\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenTint;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenTint, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationTint, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationTint;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularTint;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARTINTMAP\n\t\tuniform sampler2D specularTintMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenTint;\n\tuniform float sheenRoughness;\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Vr={common:{diffuse:{value:new Ui(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new an},uv2Transform:{value:new an},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new nn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ui(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ui(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new an}},sprite:{diffuse:{value:new Ui(16777215)},opacity:{value:1},center:{value:new nn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new an}}},Hr={basic:{uniforms:wr([Vr.common,Vr.specularmap,Vr.envmap,Vr.aomap,Vr.lightmap,Vr.fog]),vertexShader:Br.meshbasic_vert,fragmentShader:Br.meshbasic_frag},lambert:{uniforms:wr([Vr.common,Vr.specularmap,Vr.envmap,Vr.aomap,Vr.lightmap,Vr.emissivemap,Vr.fog,Vr.lights,{emissive:{value:new Ui(0)}}]),vertexShader:Br.meshlambert_vert,fragmentShader:Br.meshlambert_frag},phong:{uniforms:wr([Vr.common,Vr.specularmap,Vr.envmap,Vr.aomap,Vr.lightmap,Vr.emissivemap,Vr.bumpmap,Vr.normalmap,Vr.displacementmap,Vr.fog,Vr.lights,{emissive:{value:new Ui(0)},specular:{value:new Ui(1118481)},shininess:{value:30}}]),vertexShader:Br.meshphong_vert,fragmentShader:Br.meshphong_frag},standard:{uniforms:wr([Vr.common,Vr.envmap,Vr.aomap,Vr.lightmap,Vr.emissivemap,Vr.bumpmap,Vr.normalmap,Vr.displacementmap,Vr.roughnessmap,Vr.metalnessmap,Vr.fog,Vr.lights,{emissive:{value:new Ui(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Br.meshphysical_vert,fragmentShader:Br.meshphysical_frag},toon:{uniforms:wr([Vr.common,Vr.aomap,Vr.lightmap,Vr.emissivemap,Vr.bumpmap,Vr.normalmap,Vr.displacementmap,Vr.gradientmap,Vr.fog,Vr.lights,{emissive:{value:new Ui(0)}}]),vertexShader:Br.meshtoon_vert,fragmentShader:Br.meshtoon_frag},matcap:{uniforms:wr([Vr.common,Vr.bumpmap,Vr.normalmap,Vr.displacementmap,Vr.fog,{matcap:{value:null}}]),vertexShader:Br.meshmatcap_vert,fragmentShader:Br.meshmatcap_frag},points:{uniforms:wr([Vr.points,Vr.fog]),vertexShader:Br.points_vert,fragmentShader:Br.points_frag},dashed:{uniforms:wr([Vr.common,Vr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Br.linedashed_vert,fragmentShader:Br.linedashed_frag},depth:{uniforms:wr([Vr.common,Vr.displacementmap]),vertexShader:Br.depth_vert,fragmentShader:Br.depth_frag},normal:{uniforms:wr([Vr.common,Vr.bumpmap,Vr.normalmap,Vr.displacementmap,{opacity:{value:1}}]),vertexShader:Br.meshnormal_vert,fragmentShader:Br.meshnormal_frag},sprite:{uniforms:wr([Vr.sprite,Vr.fog]),vertexShader:Br.sprite_vert,fragmentShader:Br.sprite_frag},background:{uniforms:{uvTransform:{value:new an},t2D:{value:null}},vertexShader:Br.background_vert,fragmentShader:Br.background_frag},cube:{uniforms:wr([Vr.envmap,{opacity:{value:1}}]),vertexShader:Br.cube_vert,fragmentShader:Br.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Br.equirect_vert,fragmentShader:Br.equirect_frag},distanceRGBA:{uniforms:wr([Vr.common,Vr.displacementmap,{referencePosition:{value:new mn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Br.distanceRGBA_vert,fragmentShader:Br.distanceRGBA_frag},shadow:{uniforms:wr([Vr.lights,Vr.fog,{color:{value:new Ui(0)},opacity:{value:1}}]),vertexShader:Br.shadow_vert,fragmentShader:Br.shadow_frag}};function zr(e,t,n,i,r){var a,o,s=new Ui(0),u=0,l=null,c=0,h=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),p(s,u=t)},getClearAlpha:function(){return u},setClearAlpha:function(e){p(s,u=e)},render:function(n,r){var d=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=t.get(f));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(f=null),null===f?p(s,u):f&&f.isColor&&(p(f,1),d=!0),(e.autoClear||d)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||306===f.mapping)?(void 0===o&&((o=new gr(new br(1,1,1),new Sr({name:"BackgroundCubeMaterial",uniforms:xr(Hr.cube.uniforms),vertexShader:Hr.cube.vertexShader,fragmentShader:Hr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(o)),o.material.uniforms.envMap.value=f,o.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,l===f&&c===f.version&&h===e.toneMapping||(o.material.needsUpdate=!0,l=f,c=f.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):f&&f.isTexture&&(void 0===a&&((a=new gr(new Ur(2,2),new Sr({name:"BackgroundMaterial",uniforms:xr(Hr.background.uniforms),vertexShader:Hr.background.vertexShader,fragmentShader:Hr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&c===f.version&&h===e.toneMapping||(a.material.needsUpdate=!0,l=f,c=f.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Zr(e,t,n,i){var r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},u=p(null),l=u;function c(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){for(var t=[],n=[],i=[],a=0;a<r;a++)t[a]=0,n[a]=0,i[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function d(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function f(e){v(e,0)}function v(n,r){var a=l.enabledAttributes,o=l.attributeDivisors;l.newAttributes[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),o[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),o[n]=r)}function m(){for(var t=l.newAttributes,n=l.enabledAttributes,i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function g(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function y(){b(),l!==u&&c((l=u).object)}function b(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(r,u,h,y,b){var x=!1;if(o){var w=function(t,n,r){var o=!0===r.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];return void 0===c&&(c=p(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=c),c}(y,h,u);l!==w&&c((l=w).object),(x=function(e,t){var n=l.attributes,i=e.attributes,r=0;for(var a in i){var o=n[a],s=i[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;r++}return l.attributesNum!==r||l.index!==t}(y,b))&&function(e,t){var n={},i=e.attributes,r=0;for(var a in i){var o=i[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,r++}l.attributes=n,l.attributesNum=r,l.index=t}(y,b)}else{var _=!0===u.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===_||(l.geometry=y.id,l.program=h.id,l.wireframe=_,x=!0)}!0===r.isInstancedMesh&&(x=!0),null!==b&&n.update(b,34963),x&&(function(r,a,o,s){if(!1!==i.isWebGL2||!r.isInstancedMesh&&!s.isInstancedBufferGeometry||null!==t.get("ANGLE_instanced_arrays")){d();var u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(var h in l){var p=l[h];if(p.location>=0){var y=u[h];if(void 0===y&&("instanceMatrix"===h&&r.instanceMatrix&&(y=r.instanceMatrix),"instanceColor"===h&&r.instanceColor&&(y=r.instanceColor)),void 0!==y){var b=y.normalized,x=y.itemSize,w=n.get(y);if(void 0===w)continue;var _=w.buffer,S=w.type,M=w.bytesPerElement;if(y.isInterleavedBufferAttribute){var T=y.data,k=T.stride,E=y.offset;if(T&&T.isInstancedInterleavedBuffer){for(var A=0;A<p.locationSize;A++)v(p.location+A,T.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=T.meshPerAttribute*T.count)}else for(var C=0;C<p.locationSize;C++)f(p.location+C);e.bindBuffer(34962,_);for(var O=0;O<p.locationSize;O++)g(p.location+O,x/p.locationSize,S,b,k*M,(E+x/p.locationSize*O)*M)}else{if(y.isInstancedBufferAttribute){for(var L=0;L<p.locationSize;L++)v(p.location+L,y.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=y.meshPerAttribute*y.count)}else for(var R=0;R<p.locationSize;R++)f(p.location+R);e.bindBuffer(34962,_);for(var P=0;P<p.locationSize;P++)g(p.location+P,x/p.locationSize,S,b,x*M,x/p.locationSize*P*M)}}else if(void 0!==c){var I=c[h];if(void 0!==I)switch(I.length){case 2:e.vertexAttrib2fv(p.location,I);break;case 3:e.vertexAttrib3fv(p.location,I);break;case 4:e.vertexAttrib4fv(p.location,I);break;default:e.vertexAttrib1fv(p.location,I)}}}}m()}}(r,u,h,y),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){for(var e in y(),s){var t=s[e];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var i=t[n];for(var r in i)h(i[r].object),delete i[r];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var i=n[e.id];for(var r in i)h(i[r].object),delete i[r];delete n[e.id]}}},initAttributes:d,enableAttribute:f,disableUnusedAttributes:m}}function Gr(e,t,n,i){var r,a=i.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,s){if(0!==s){var u,l;if(a)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](r,i,o,s),n.update(o,r,s)}}}function jr(e,t,n){var i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),p=e.getParameter(3379),d=e.getParameter(34076),f=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),y=h>0,b=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:p,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:a?e.getParameter(36183):0}}function qr(e){var t=this,n=null,i=0,r=!1,a=!1,o=new Rr,s=new an,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(e,n,i,r){var a=null!==e?e.length:0,l=null;if(0!==a){if(l=u.value,!0!==r||null===l){var c=i+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var p=0,d=i;p!==a;++p,d+=4)o.copy(e[p]).applyMatrix4(h,s),o.normal.toArray(l,d),l[d+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==i||r;return r=t,n=c(e,a,0),i=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,l()},this.setState=function(t,o,s){var h=t.clippingPlanes,p=t.clipIntersection,d=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||a&&!d)a?c(null):l();else{var v=a?0:i,m=4*v,g=f.clippingState||null;u.value=g,g=c(h,o,m,s);for(var y=0;y!==m;++y)g[y]=n[y];f.clippingState=g,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=v}}}function Wr(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping;if(303===a||304===a){if(t.has(r))return n(t.get(r).texture,r.mapping);var o=r.image;if(o&&o.height>0){var s=e.getRenderTarget(),u=new Ar(o.height/2);return u.fromEquirectangularTexture(e,r),t.set(r,u),e.setRenderTarget(s),r.addEventListener("dispose",i),n(u.texture,r.mapping)}return null}}return r},dispose:function(){t=new WeakMap}}}Hr.physical={uniforms:wr([Hr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new nn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenTint:{value:new Ui(0)},sheenRoughness:{value:0},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new nn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationTint:{value:new Ui(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularTint:{value:new Ui(1,1,1)},specularTintMap:{value:null}}]),vertexShader:Br.meshphysical_vert,fragmentShader:Br.meshphysical_frag};var Jr=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return M(this,n),(e=t.call(this)).type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=r,e.top=a,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return k(n,[{key:"copy",value:function(e,t){return p(b(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(Mr);Jr.prototype.isOrthographicCamera=!0;var Yr=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).type="RawShaderMaterial",i}return n}(Sr);Yr.prototype.isRawShaderMaterial=!0;var Xr=Math.pow(2,8),Qr=[.125,.215,.35,.446,.526,.582],Kr=5+Qr.length,$r={3e3:0,3001:1,3002:2,3004:3,3005:4,3006:5,3007:6},ea=new Jr,ta=function(){for(var e=[],t=[],n=[],i=8,r=0;r<Kr;r++){var a=Math.pow(2,i);t.push(a);var o=1/a;r>4?o=Qr[r-8+4-1]:0==r&&(o=0),n.push(o);for(var s=1/(a-1),u=-s/2,l=1+s/2,c=[u,u,l,u,l,l,u,u,l,l,u,l],h=new Float32Array(108),p=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var v=f%3*2/3-1,m=f>2?0:-1;h.set([v,m,0,v+2/3,m,0,v+2/3,m+1,0,v,m,0,v+2/3,m+1,0,v,m+1,0],18*f),p.set(c,12*f),d.set([f,f,f,f,f,f],6*f)}var g=new $i;g.setAttribute("position",new zi(h,3)),g.setAttribute("uv",new zi(p,2)),g.setAttribute("faceIndex",new zi(d,1)),e.push(g),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),na=ta._lodPlanes,ia=ta._sizeLods,ra=ta._sigmas,aa=new Ui,oa=null,sa=(1+Math.sqrt(5))/2,ua=1/sa,la=[new mn(1,1,1),new mn(-1,1,1),new mn(1,1,-1),new mn(-1,1,-1),new mn(0,sa,ua),new mn(0,sa,-ua),new mn(ua,0,sa),new mn(-ua,0,sa),new mn(sa,ua,0),new mn(-sa,ua,0)],ca=function(){function e(t){M(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(e){var t=new Float32Array(20),n=new mn(0,1,0);return new Yr({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:$r[3e3]},outputEncoding:{value:$r[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}return k(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;oa=this._renderer.getRenderTarget();var r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}},{key:"fromEquirectangular",value:function(e){return this._fromTexture(e)}},{key:"fromCubemap",value:function(e){return this._fromTexture(e)}},{key:"compileCubemapShader",value:function(){null===this._cubemapShader&&(this._cubemapShader=va(),this._compileMaterial(this._cubemapShader))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectShader&&(this._equirectShader=fa(),this._compileMaterial(this._equirectShader))}},{key:"dispose",value:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var e=0;e<na.length;e++)na[e].dispose()}},{key:"_cleanup",value:function(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(oa),e.scissorTest=!1,da(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e){oa=this._renderer.getRenderTarget();var t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}},{key:"_allocateTargets",value:function(e){var t={magFilter:1003,minFilter:1003,generateMipmaps:!1,type:1009,format:1023,encoding:ha(e)?e.encoding:3002,depthBuffer:!1},n=pa(t);return n.depthBuffer=!e,this._pingPongRenderTarget=pa(t),n}},{key:"_compileMaterial",value:function(e){var t=new gr(na[0],e);this._renderer.compile(t,ea)}},{key:"_sceneToCubeUV",value:function(e,t,n,i){var r=new Tr(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.outputEncoding,c=s.toneMapping;s.getClearColor(aa),s.toneMapping=0,s.outputEncoding=3e3,s.autoClear=!1;var h=new Bi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new gr(new br,h),d=!1,f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,d=!0):(h.color.copy(aa),d=!0);for(var v=0;v<6;v++){var m=v%3;0==m?(r.up.set(0,a[v],0),r.lookAt(o[v],0,0)):1==m?(r.up.set(0,0,a[v]),r.lookAt(0,o[v],0)):(r.up.set(0,a[v],0),r.lookAt(0,0,o[v])),da(i,m*Xr,v>2?Xr:0,Xr,Xr),s.setRenderTarget(i),d&&s.render(p,r),s.render(e,r)}p.geometry.dispose(),p.material.dispose(),s.toneMapping=c,s.outputEncoding=l,s.autoClear=u,e.background=f}},{key:"_setEncoding",value:function(e,t){e.value=!0===this._renderer.capabilities.isWebGL2&&1023===t.format&&1009===t.type&&3001===t.encoding?$r[3e3]:$r[t.encoding]}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer;e.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=va()):null==this._equirectShader&&(this._equirectShader=fa());var i=e.isCubeTexture?this._cubemapShader:this._equirectShader,r=new gr(na[0],i),a=i.uniforms;a.envMap.value=e,e.isCubeTexture||a.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(a.inputEncoding,e),this._setEncoding(a.outputEncoding,t.texture),da(t,0,0,3*Xr,2*Xr),n.setRenderTarget(t),n.render(r,ea)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var i=1;i<Kr;i++){var r=Math.sqrt(ra[i]*ra[i]-ra[i-1]*ra[i-1]);this._blur(e,i-1,i,r,la[(i-1)%la.length])}t.autoClear=n}},{key:"_blur",value:function(e,t,n,i,r){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}},{key:"_halfBlur",value:function(e,t,n,i,r,a,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new gr(na[i],u),c=u.uniforms,h=ia[n]-1,p=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,d=r/p,f=isFinite(r)?1+Math.floor(3*d):20;f>20&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to 20"));for(var v=[],m=0,g=0;g<20;++g){var y=g/d,b=Math.exp(-y*y/2);v.push(b),0==g?m+=b:g<f&&(m+=2*b)}for(var x=0;x<v.length;x++)v[x]=v[x]/m;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=v,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=p,c.mipInt.value=8-n,this._setEncoding(c.inputEncoding,e.texture),this._setEncoding(c.outputEncoding,e.texture);var w=ia[i];da(t,3*Math.max(0,Xr-2*w),(0===i?0:2*Xr)+2*w*(i>4?i-8+4:0),3*w,2*w),s.setRenderTarget(t),s.render(l,ea)}}]),e}();function ha(e){return void 0!==e&&1009===e.type&&(3e3===e.encoding||3001===e.encoding||3007===e.encoding)}function pa(e){var t=new dn(3*Xr,3*Xr,e);return t.texture.mapping=306,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function da(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function fa(){var e=new nn(1,1);return new Yr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:$r[3e3]},outputEncoding:{value:$r[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function va(){return new Yr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:$r[3e3]},outputEncoding:{value:$r[3e3]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ma(e){var t=new WeakMap,n=null;function i(e){var n=e.target;n.removeEventListener("dispose",i);var r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){var a=r.mapping,o=303===a||304===a,s=301===a||302===a;if(o||s){if(t.has(r))return t.get(r).texture;var u=r.image;if(o&&u&&u.height>0||s&&u&&function(e){for(var t=0,n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(u)){var l=e.getRenderTarget();null===n&&(n=new ca(e));var c=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,c),e.setRenderTarget(l),r.addEventListener("dispose",i),c.texture}return null}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ga(e){var t={};function n(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ya(e,t,n,i){var r={},a=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete r[s.id];var l=a.get(s);l&&(t.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],i=e.index,r=e.attributes.position,o=0;if(null!==i){var s=i.array;o=i.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],p=s[u+2];n.push(c,h,h,p,p,c)}}else{o=r.version;for(var d=0,f=r.array.length/3-1;d<f;d+=3){var v=d+0,m=d+1,g=d+2;n.push(v,m,m,g,g,v)}}var y=new(on(n)>65535?Gi:Zi)(n,1);y.version=o;var b=a.get(e);b&&t.remove(b),a.set(e,y)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var i in n)t.update(n[i],34962);var r=e.morphAttributes;for(var a in r)for(var o=r[a],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function ba(e,t,n,i){var r,a,o,s=i.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*o),n.update(i,r,1)},this.renderInstances=function(i,u,l){if(0!==l){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](r,u,a,i*o,l),n.update(u,r,l)}}}function xa(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}var wa=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return M(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=1003,e.minFilter=1003,e.wrapR=1001,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return n}(cn);function _a(e,t){return e[0]-t[0]}function Sa(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ma(e,t){var n=1,i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function Ta(e,t,n){for(var i={},r=new Float32Array(8),a=new WeakMap,o=new mn,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c,h){var p=u.morphTargetInfluences;if(!0===t.isWebGL2){var d=l.morphAttributes.position.length,f=a.get(l);if(void 0===f||f.count!==d){void 0!==f&&f.texture.dispose();var v=void 0!==l.morphAttributes.normal,m=l.morphAttributes.position,g=l.morphAttributes.normal||[],y=!0===v?2:1,b=l.attributes.position.count*y,x=1;b>t.maxTextureSize&&(x=Math.ceil(b/t.maxTextureSize),b=t.maxTextureSize);var w=new Float32Array(b*x*4*d),_=new wa(w,b,x,d);_.format=1023,_.type=1015;for(var S=4*y,M=0;M<d;M++)for(var T=m[M],k=g[M],E=b*x*4*M,A=0;A<T.count;A++){o.fromBufferAttribute(T,A),!0===T.normalized&&Ma(o,T);var C=A*S;w[E+C+0]=o.x,w[E+C+1]=o.y,w[E+C+2]=o.z,w[E+C+3]=0,!0===v&&(o.fromBufferAttribute(k,A),!0===k.normalized&&Ma(o,k),w[E+C+4]=o.x,w[E+C+5]=o.y,w[E+C+6]=o.z,w[E+C+7]=0)}f={count:d,texture:_,size:new nn(b,x)},a.set(l,f)}for(var O=0,L=0;L<p.length;L++)O+=p[L];var R=l.morphTargetsRelative?1:1-O;h.getUniforms().setValue(e,"morphTargetBaseInfluence",R),h.getUniforms().setValue(e,"morphTargetInfluences",p),h.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{var P=void 0===p?0:p.length,I=i[l.id];if(void 0===I||I.length!==P){I=[];for(var N=0;N<P;N++)I[N]=[N,0];i[l.id]=I}for(var D=0;D<P;D++){var F=I[D];F[0]=D,F[1]=p[D]}I.sort(Sa);for(var U=0;U<8;U++)U<P&&I[U][1]?(s[U][0]=I[U][0],s[U][1]=I[U][1]):(s[U][0]=Number.MAX_SAFE_INTEGER,s[U][1]=0);s.sort(_a);for(var B=l.morphAttributes.position,V=l.morphAttributes.normal,H=0,z=0;z<8;z++){var Z=s[z],G=Z[0],j=Z[1];G!==Number.MAX_SAFE_INTEGER&&j?(B&&l.getAttribute("morphTarget"+z)!==B[G]&&l.setAttribute("morphTarget"+z,B[G]),V&&l.getAttribute("morphNormal"+z)!==V[G]&&l.setAttribute("morphNormal"+z,V[G]),r[z]=j,H+=j):(B&&!0===l.hasAttribute("morphTarget"+z)&&l.deleteAttribute("morphTarget"+z),V&&!0===l.hasAttribute("morphNormal"+z)&&l.deleteAttribute("morphNormal"+z),r[z]=0)}var q=l.morphTargetsRelative?1:1-H;h.getUniforms().setValue(e,"morphTargetBaseInfluence",q),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function ka(e,t,n,i){var r=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=i.render.frame,s=t.get(e,e.geometry);return r.get(s)!==o&&(t.update(s),r.set(s,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),s},dispose:function(){r=new WeakMap}}}wa.prototype.isDataTexture2DArray=!0;var Ea=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return M(this,n),(e=t.call(this,null)).image={data:i,width:r,height:a,depth:o},e.magFilter=1003,e.minFilter=1003,e.wrapR=1001,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return n}(cn);Ea.prototype.isDataTexture3D=!0;var Aa=new cn,Ca=new wa,Oa=new Ea,La=new Er,Ra=[],Pa=[],Ia=new Float32Array(16),Na=new Float32Array(9),Da=new Float32Array(4);function Fa(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=Ra[r];if(void 0===a&&(a=new Float32Array(r),Ra[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Ua(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Ba(e,t){for(var n=0,i=t.length;n<i;n++)e[n]=t[n]}function Va(e,t){var n=Pa[t];void 0===n&&(n=new Int32Array(t),Pa[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Ha(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function za(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Ua(n,t))return;e.uniform2fv(this.addr,t),Ba(n,t)}}function Za(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Ua(n,t))return;e.uniform3fv(this.addr,t),Ba(n,t)}}function Ga(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Ua(n,t))return;e.uniform4fv(this.addr,t),Ba(n,t)}}function ja(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Ua(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Ba(n,t)}else{if(Ua(n,i))return;Da.set(i),e.uniformMatrix2fv(this.addr,!1,Da),Ba(n,i)}}function qa(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Ua(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Ba(n,t)}else{if(Ua(n,i))return;Na.set(i),e.uniformMatrix3fv(this.addr,!1,Na),Ba(n,i)}}function Wa(e,t){var n=this.cache,i=t.elements;if(void 0===i){if(Ua(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Ba(n,t)}else{if(Ua(n,i))return;Ia.set(i),e.uniformMatrix4fv(this.addr,!1,Ia),Ba(n,i)}}function Ja(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ya(e,t){var n=this.cache;Ua(n,t)||(e.uniform2iv(this.addr,t),Ba(n,t))}function Xa(e,t){var n=this.cache;Ua(n,t)||(e.uniform3iv(this.addr,t),Ba(n,t))}function Qa(e,t){var n=this.cache;Ua(n,t)||(e.uniform4iv(this.addr,t),Ba(n,t))}function Ka(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function $a(e,t){var n=this.cache;Ua(n,t)||(e.uniform2uiv(this.addr,t),Ba(n,t))}function eo(e,t){var n=this.cache;Ua(n,t)||(e.uniform3uiv(this.addr,t),Ba(n,t))}function to(e,t){var n=this.cache;Ua(n,t)||(e.uniform4uiv(this.addr,t),Ba(n,t))}function no(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||Aa,r)}function io(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Oa,r)}function ro(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||La,r)}function ao(e,t,n){var i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||Ca,r)}function oo(e,t){e.uniform1fv(this.addr,t)}function so(e,t){var n=Fa(t,this.size,2);e.uniform2fv(this.addr,n)}function uo(e,t){var n=Fa(t,this.size,3);e.uniform3fv(this.addr,n)}function lo(e,t){var n=Fa(t,this.size,4);e.uniform4fv(this.addr,n)}function co(e,t){var n=Fa(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function ho(e,t){var n=Fa(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function po(e,t){var n=Fa(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function fo(e,t){e.uniform1iv(this.addr,t)}function vo(e,t){e.uniform2iv(this.addr,t)}function mo(e,t){e.uniform3iv(this.addr,t)}function go(e,t){e.uniform4iv(this.addr,t)}function yo(e,t){e.uniform1uiv(this.addr,t)}function bo(e,t){e.uniform2uiv(this.addr,t)}function xo(e,t){e.uniform3uiv(this.addr,t)}function wo(e,t){e.uniform4uiv(this.addr,t)}function _o(e,t,n){var i=t.length,r=Va(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTexture2D(t[a]||Aa,r[a])}function So(e,t,n){var i=t.length,r=Va(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.safeSetTextureCube(t[a]||La,r[a])}function Mo(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Ha;case 35664:return za;case 35665:return Za;case 35666:return Ga;case 35674:return ja;case 35675:return qa;case 35676:return Wa;case 5124:case 35670:return Ja;case 35667:case 35671:return Ya;case 35668:case 35672:return Xa;case 35669:case 35673:return Qa;case 5125:return Ka;case 36294:return $a;case 36295:return eo;case 36296:return to;case 35678:case 36198:case 36298:case 36306:case 35682:return no;case 35679:case 36299:case 36307:return io;case 35680:case 36300:case 36308:case 36293:return ro;case 36289:case 36303:case 36311:case 36292:return ao}}(t.type)}function To(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return oo;case 35664:return so;case 35665:return uo;case 35666:return lo;case 35674:return co;case 35675:return ho;case 35676:return po;case 5124:case 35670:return fo;case 35667:case 35671:return vo;case 35668:case 35672:return mo;case 35669:case 35673:return go;case 5125:return yo;case 36294:return bo;case 36295:return xo;case 36296:return wo;case 35678:case 36198:case 36298:case 36306:case 35682:return _o;case 35680:case 36300:case 36308:case 36293:return So}}(t.type)}function ko(e){this.id=e,this.seq=[],this.map={}}To.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Ba(t,e)},ko.prototype.setValue=function(e,t,n){for(var i=this.seq,r=0,a=i.length;r!==a;++r){var o=i[r];o.setValue(e,t[o.id],n)}};var Eo=/(\w+)(\])?(\[|\.)?/g;function Ao(e,t){e.seq.push(t),e.map[t.id]=t}function Co(e,t,n){var i=e.name,r=i.length;for(Eo.lastIndex=0;;){var a=Eo.exec(i),o=Eo.lastIndex,s=a[1],u=a[3];if("]"===a[2]&&(s|=0),void 0===u||"["===u&&o+2===r){Ao(n,void 0===u?new Mo(s,e,t):new To(s,e,t));break}var l=n.map[s];void 0===l&&Ao(n,l=new ko(s)),n=l}}function Oo(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),i=0;i<n;++i){var r=e.getActiveUniform(t,i);Co(r,e.getUniformLocation(t,r.name),this)}}function Lo(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}Oo.prototype.setValue=function(e,t,n,i){var r=this.map[t];void 0!==r&&r.setValue(e,n,i)},Oo.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},Oo.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,i)}},Oo.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var Ro=0;function Po(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Io(e,t,n){var i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function No(e,t){var n=Po(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Do(e,t){var n=Po(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Fo(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Uo(e){return""!==e}function Bo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Vo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ho=/^[ \t]*#include +<([\w\d./]+)>/gm;function zo(e){return e.replace(Ho,Zo)}function Zo(e,t){var n=Br[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return zo(n)}var Go=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,jo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function qo(e){return e.replace(jo,Jo).replace(Go,Wo)}function Wo(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Jo(0,t,n,i)}function Jo(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function Yo(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Xo(e,t,n,i){var r,a,o=e.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),p=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),f=e.gammaFactor>0?e.gammaFactor:1,v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Uo).join("\n")}(n),m=function(e){var t=[];for(var n in e){var i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((r=[m].filter(Uo).join("\n")).length>0&&(r+="\n"),(a=[v,m].filter(Uo).join("\n")).length>0&&(a+="\n")):(r=[Yo(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Uo).join("\n"),a=[v,Yo(n),"#define SHADER_NAME "+n.shaderName,m,"#define GAMMA_FACTOR "+f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+p:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularTintMap?"#define USE_SPECULARTINTMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Br.tonemapping_pars_fragment:"",0!==n.toneMapping?Fo("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",1022===n.format?"#define OPAQUE":"",Br.encodings_pars_fragment,n.map?No("mapTexelToLinear",n.mapEncoding):"",n.matcap?No("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?No("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?No("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularTintMap?No("specularTintMapTexelToLinear",n.specularTintMapEncoding):"",n.lightMap?No("lightMapTexelToLinear",n.lightMapEncoding):"",Do("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Uo).join("\n")),u=Vo(u=Bo(u=zo(u),n),n),l=Vo(l=Bo(l=zo(l),n),n),u=qo(u),l=qo(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var b,x,w=y+a+l,_=Lo(o,35633,y+r+u),S=Lo(o,35632,w);if(o.attachShader(g,_),o.attachShader(g,S),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var M=o.getProgramInfoLog(g).trim(),T=o.getShaderInfoLog(_).trim(),k=o.getShaderInfoLog(S).trim(),E=!0,A=!0;if(!1===o.getProgramParameter(g,35714)){E=!1;var C=Io(o,_,"vertex"),O=Io(o,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+M+"\n"+C+"\n"+O)}else""!==M?console.warn("THREE.WebGLProgram: Program Info Log:",M):""!==T&&""!==k||(A=!1);A&&(this.diagnostics={runnable:E,programLog:M,vertexShader:{log:T,prefix:r},fragmentShader:{log:k,prefix:a}})}return o.deleteShader(_),o.deleteShader(S),this.getUniforms=function(){return void 0===b&&(b=new Oo(o,g)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},i=e.getProgramParameter(t,35721),r=0;r<i;r++){var a=e.getActiveAttrib(t,r),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=Ro++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=_,this.fragmentShader=S,this}function Qo(e,t,n,i,r,a,o){var s=[],u=r.isWebGL2,l=r.logarithmicDepthBuffer,c=r.floatVertexTextures,h=r.maxVertexUniforms,p=r.vertexTextures,d=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","specularIntensityMap","specularTintMap","specularTintMapEncoding","roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","sheen","transmission","transmissionMap","thicknessMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,u&&e&&e.isTexture&&1023===e.format&&1009===e.type&&3001===e.encoding&&(t=3e3),t}return{getParameters:function(a,s,v,g,y){var b,x,w=g.fog,_=(a.isMeshStandardMaterial?n:t).get(a.envMap||(a.isMeshStandardMaterial?g.environment:null)),S=f[a.type],M=y.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(c)return 1024;var n=Math.floor((h-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(y):0;if(null!==a.precision&&((d=r.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",d,"instead.")),S){var T=Hr[S];b=T.vertexShader,x=T.fragmentShader}else b=a.vertexShader,x=a.fragmentShader;var k=e.getRenderTarget(),E=a.alphaTest>0,A=a.clearcoat>0;return{isWebGL2:u,shaderID:S,shaderName:a.type,vertexShader:b,fragmentShader:x,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:d,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:p,outputEncoding:null!==k?m(k.texture):e.outputEncoding,map:!!a.map,mapEncoding:m(a.map),matcap:!!a.matcap,matcapEncoding:m(a.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:m(_),envMapCubeUV:!!_&&(306===_.mapping||307===_.mapping),lightMap:!!a.lightMap,lightMapEncoding:m(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:m(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,clearcoat:A,clearcoatMap:A&&!!a.clearcoatMap,clearcoatRoughnessMap:A&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:A&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularTintMap:!!a.specularTintMap,specularTintMapEncoding:m(a.specularTintMap),alphaMap:!!a.alphaMap,alphaTest:E,gradientMap:!!a.gradientMap,sheen:a.sheen>0,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.geometry&&!!y.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.geometry&&!!y.geometry.attributes.color&&4===y.geometry.attributes.color.itemSize,vertexUvs:!!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatMap||a.clearcoatRoughnessMap||a.clearcoatNormalMap||a.displacementMap||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularTintMap),uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularTintMap||!a.displacementMap),fog:!!w,useFog:a.fog,fogExp2:w&&w.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:l,skinning:!0===y.isSkinnedMesh&&M>0,maxBones:M,useVertexTexture:c,morphTargets:!!y.geometry&&!!y.geometry.morphAttributes.position,morphNormals:!!y.geometry&&!!y.geometry.morphAttributes.normal,morphTargetsCount:y.geometry&&y.geometry.morphAttributes.position?y.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&v.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);if(!1===t.isRawShaderMaterial){for(var r=0;r<v.length;r++)n.push(t[v[r]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t=f[e.type];return t?_r.clone(Hr[t].uniforms):e.uniforms},acquireProgram:function(t,n){for(var i,r=0,o=s.length;r<o;r++){var u=s[r];if(u.cacheKey===n){++(i=u).usedTimes;break}}return void 0===i&&(i=new Xo(e,n,t,a),s.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){var t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function Ko(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function $o(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function es(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ts(e){var t=[],n=0,i=[],r=[],a=[],o={id:-1};function s(i,r,a,s,u,l){var c=t[n],h=e.get(a);return void 0===c?(c={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:u,group:l},t[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=u,c.group=l),n++,c}return{opaque:i,transmissive:r,transparent:a,init:function(){n=0,i.length=0,r.length=0,a.length=0},push:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?r.push(c):!0===n.transparent?a.push(c):i.push(c)},unshift:function(e,t,n,o,u,l){var c=s(e,t,n,o,u,l);n.transmission>0?r.unshift(c):!0===n.transparent?a.unshift(c):i.unshift(c)},finish:function(){for(var e=n,i=t.length;e<i;e++){var r=t[e];if(null===r.id)break;r.id=null,r.object=null,r.geometry=null,r.material=null,r.program=null,r.group=null}},sort:function(e,t){i.length>1&&i.sort(e||$o),r.length>1&&r.sort(t||es),a.length>1&&a.sort(t||es)}}}function ns(e){var t=new WeakMap;return{get:function(n,i){var r;return!1===t.has(n)?(r=new ts(e),t.set(n,[r])):i>=t.get(n).length?(r=new ts(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function is(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new mn,color:new Ui};break;case"SpotLight":n={position:new mn,direction:new mn,color:new Ui,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new mn,color:new Ui,distance:0,decay:0};break;case"HemisphereLight":n={direction:new mn,skyColor:new Ui,groundColor:new Ui};break;case"RectAreaLight":n={color:new Ui,position:new mn,halfWidth:new mn,halfHeight:new mn}}return e[t.id]=n,n}}}var rs=0;function as(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function os(e,t){for(var n=new is,i=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new nn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)r.probe.push(new mn);var o=new mn,s=new Wn,u=new Wn;return{setup:function(a,o){for(var s=0,u=0,l=0,c=0;c<9;c++)r.probe[c].set(0,0,0);var h=0,p=0,d=0,f=0,v=0,m=0,g=0,y=0;a.sort(as);for(var b=!0!==o?Math.PI:1,x=0,w=a.length;x<w;x++){var _=a[x],S=_.color,M=_.intensity,T=_.distance,k=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=S.r*M*b,u+=S.g*M*b,l+=S.b*M*b;else if(_.isLightProbe)for(var E=0;E<9;E++)r.probe[E].addScaledVector(_.sh.coefficients[E],M);else if(_.isDirectionalLight){var A=n.get(_);if(A.color.copy(_.color).multiplyScalar(_.intensity*b),_.castShadow){var C=_.shadow,O=i.get(_);O.shadowBias=C.bias,O.shadowNormalBias=C.normalBias,O.shadowRadius=C.radius,O.shadowMapSize=C.mapSize,r.directionalShadow[h]=O,r.directionalShadowMap[h]=k,r.directionalShadowMatrix[h]=_.shadow.matrix,m++}r.directional[h]=A,h++}else if(_.isSpotLight){var L=n.get(_);if(L.position.setFromMatrixPosition(_.matrixWorld),L.color.copy(S).multiplyScalar(M*b),L.distance=T,L.coneCos=Math.cos(_.angle),L.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),L.decay=_.decay,_.castShadow){var R=_.shadow,P=i.get(_);P.shadowBias=R.bias,P.shadowNormalBias=R.normalBias,P.shadowRadius=R.radius,P.shadowMapSize=R.mapSize,r.spotShadow[d]=P,r.spotShadowMap[d]=k,r.spotShadowMatrix[d]=_.shadow.matrix,y++}r.spot[d]=L,d++}else if(_.isRectAreaLight){var I=n.get(_);I.color.copy(S).multiplyScalar(M),I.halfWidth.set(.5*_.width,0,0),I.halfHeight.set(0,.5*_.height,0),r.rectArea[f]=I,f++}else if(_.isPointLight){var N=n.get(_);if(N.color.copy(_.color).multiplyScalar(_.intensity*b),N.distance=_.distance,N.decay=_.decay,_.castShadow){var D=_.shadow,F=i.get(_);F.shadowBias=D.bias,F.shadowNormalBias=D.normalBias,F.shadowRadius=D.radius,F.shadowMapSize=D.mapSize,F.shadowCameraNear=D.camera.near,F.shadowCameraFar=D.camera.far,r.pointShadow[p]=F,r.pointShadowMap[p]=k,r.pointShadowMatrix[p]=_.shadow.matrix,g++}r.point[p]=N,p++}else if(_.isHemisphereLight){var U=n.get(_);U.skyColor.copy(_.color).multiplyScalar(M*b),U.groundColor.copy(_.groundColor).multiplyScalar(M*b),r.hemi[v]=U,v++}}f>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Vr.LTC_FLOAT_1,r.rectAreaLTC2=Vr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Vr.LTC_HALF_1,r.rectAreaLTC2=Vr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=u,r.ambient[2]=l;var B=r.hash;B.directionalLength===h&&B.pointLength===p&&B.spotLength===d&&B.rectAreaLength===f&&B.hemiLength===v&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===y||(r.directional.length=h,r.spot.length=d,r.rectArea.length=f,r.point.length=p,r.hemi.length=v,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=y,r.spotShadowMap.length=y,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=y,B.directionalLength=h,B.pointLength=p,B.spotLength=d,B.rectAreaLength=f,B.hemiLength=v,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=y,r.version=rs++)},setupView:function(e,t){for(var n=0,i=0,a=0,l=0,c=0,h=t.matrixWorldInverse,p=0,d=e.length;p<d;p++){var f=e[p];if(f.isDirectionalLight){var v=r.directional[n];v.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(f.isSpotLight){var m=r.spot[a];m.position.setFromMatrixPosition(f.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(f.matrixWorld),o.setFromMatrixPosition(f.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),a++}else if(f.isRectAreaLight){var g=r.rectArea[l];g.position.setFromMatrixPosition(f.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(f.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*f.width,0,0),g.halfHeight.set(0,.5*f.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),l++}else if(f.isPointLight){var y=r.point[i];y.position.setFromMatrixPosition(f.matrixWorld),y.position.applyMatrix4(h),i++}else if(f.isHemisphereLight){var b=r.hemi[c];b.direction.setFromMatrixPosition(f.matrixWorld),b.direction.transformDirection(h),b.direction.normalize(),c++}}},state:r}}function ss(e,t){var n=new os(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function us(e,t){var n=new WeakMap;return{get:function(i){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(r=new ss(e,t),n.set(i,[r])):a>=n.get(i).length?(r=new ss(e,t),n.get(i).push(r)):r=n.get(i)[a],r},dispose:function(){n=new WeakMap}}}var ls=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshDepthMaterial",i.depthPacking=3200,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(Li);ls.prototype.isMeshDepthMaterial=!0;var cs=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshDistanceMaterial",i.referencePosition=new mn,i.nearDistance=1,i.farDistance=1e3,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.fog=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(Li);function hs(e,t,n){var i=new Nr,r=new nn,a=new nn,o=new pn,s=new ls({depthPacking:3201}),u=new cs,l={},c=n.maxTextureSize,h={0:1,1:0,2:2},p=new Sr({uniforms:{shadow_pass:{value:null},resolution:{value:new nn},radius:{value:4},samples:{value:8}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\nuniform float samples;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=p.clone();d.defines.HORIZONTAL_PASS=1;var f=new $i;f.setAttribute("position",new zi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new gr(f,p),m=this;function g(n,i){var r=t.update(v);p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,p.uniforms.samples.value=n.blurSamples,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,p,v,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,d.uniforms.samples.value=n.blurSamples,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,d,v,null)}function y(t,n,i,r,a,o,c){var p=null,d=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(p=void 0!==d?d:!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){var f=p.uuid,v=i.uuid,m=l[f];void 0===m&&(m={},l[f]=m);var g=m[v];void 0===g&&(g=p.clone(),m[v]=g),p=g}return p.visible=i.visible,p.wireframe=i.wireframe,p.side=3===c?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:h[i.side],p.alphaMap=i.alphaMap,p.alphaTest=i.alphaTest,p.clipShadows=i.clipShadows,p.clippingPlanes=i.clippingPlanes,p.clipIntersection=i.clipIntersection,p.displacementMap=i.displacementMap,p.displacementScale=i.displacementScale,p.displacementBias=i.displacementBias,p.wireframeLinewidth=i.wireframeLinewidth,p.linewidth=i.linewidth,!0===r.isPointLight&&!0===p.isMeshDistanceMaterial&&(p.referencePosition.setFromMatrixPosition(r.matrixWorld),p.nearDistance=a,p.farDistance=o),p}function b(n,r,a,o,s){if(!1!==n.visible){if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,p=c.length;h<p;h++){var d=c[h],f=l[d.materialIndex];if(f&&f.visible){var v=y(n,0,f,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,v,n,d)}}else if(l.visible){var m=y(n,0,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,x=0,w=g.length;x<w;x++)b(g[x],r,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=t.length;d<f;d++){var v=t[d],y=v.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){r.copy(y.mapSize);var x=y.getFrameExtents();if(r.multiply(x),a.copy(y.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(a.x=Math.floor(c/x.x),r.x=a.x*x.x,y.mapSize.x=a.x),r.y>c&&(a.y=Math.floor(c/x.y),r.y=a.y*x.y,y.mapSize.y=a.y)),null===y.map&&!y.isPointLightShadow&&3===this.type){var w={minFilter:1006,magFilter:1006,format:1023};y.map=new dn(r.x,r.y,w),y.map.texture.name=v.name+".shadowMap",y.mapPass=new dn(r.x,r.y,w),y.camera.updateProjectionMatrix()}null===y.map&&(y.map=new dn(r.x,r.y,{minFilter:1003,magFilter:1003,format:1023}),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()),e.setRenderTarget(y.map),e.clear();for(var _=y.getViewportCount(),S=0;S<_;S++){var M=y.getViewport(S);o.set(a.x*M.x,a.y*M.y,a.x*M.z,a.y*M.w),p.viewport(o),y.updateMatrices(v,S),i=y.getFrustum(),b(n,s,y.camera,v,this.type)}y.isPointLightShadow||3!==this.type||g(y,s),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,l,h)}}}function ps(e,t,n){var i=n.isWebGL2,r=new function(){var t=!1,n=new pn,i=null,r=new pn(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){var t=!1,n=null,i=null,r=null;return{setTest:function(e){e?F(2929):U(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},o=new function(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?F(2960):U(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&u===i||(e.stencilOp(t,n,i),o=t,s=n,u=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null}}},s={},u=null,l={},c=null,h=!1,p=null,d=null,f=null,v=null,m=null,g=null,y=null,b=!1,x=null,w=null,_=null,S=null,M=null,T=e.getParameter(35661),k=!1,E=0,A=e.getParameter(7938);-1!==A.indexOf("WebGL")?(E=parseFloat(/^WebGL (\d)/.exec(A)[1]),k=E>=1):-1!==A.indexOf("OpenGL ES")&&(E=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),k=E>=2);var C=null,O={},L=e.getParameter(3088),R=e.getParameter(2978),P=(new pn).fromArray(L),I=(new pn).fromArray(R);function N(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<i;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,r);return a}var D={};function F(t){!0!==s[t]&&(e.enable(t),s[t]=!0)}function U(t){!1!==s[t]&&(e.disable(t),s[t]=!1)}D[3553]=N(3553,3553,1),D[34067]=N(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),o.setClear(0),F(2929),a.setFunc(3),Z(!1),G(1),F(2884),z(0);var B={100:32774,101:32778,102:32779};if(i)B[103]=32775,B[104]=32776;else{var V=t.get("EXT_blend_minmax");null!==V&&(B[103]=V.MIN_EXT,B[104]=V.MAX_EXT)}var H={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function z(t,n,i,r,a,o,s,u){if(0!==t){if(!1===h&&(F(3042),h=!0),5===t)a=a||n,o=o||i,s=s||r,n===d&&a===m||(e.blendEquationSeparate(B[n],B[a]),d=n,m=a),i===f&&r===v&&o===g&&s===y||(e.blendFuncSeparate(H[i],H[r],H[o],H[s]),f=i,v=r,g=o,y=s),p=t,b=null;else if(t!==p||u!==b){if(100===d&&100===m||(e.blendEquation(32774),d=100,m=100),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,v=null,g=null,y=null,p=t,b=u}}else!0===h&&(U(3042),h=!1)}function Z(t){x!==t&&(e.frontFace(t?2304:2305),x=t)}function G(t){0!==t?(F(2884),t!==w&&e.cullFace(1===t?1029:2===t?1028:1032)):U(2884),w=t}function j(t,n,i){t?(F(32823),S===n&&M===i||(e.polygonOffset(n,i),S=n,M=i)):U(32823)}function q(t){void 0===t&&(t=33984+T-1),C!==t&&(e.activeTexture(t),C=t)}return{buffers:{color:r,depth:a,stencil:o},enable:F,disable:U,bindFramebuffer:function(t,n){return null===n&&null!==u&&(n=u),l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,i&&(36009===t&&(l[36160]=n),36160===t&&(l[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==u&&(e.bindFramebuffer(36160,t),u=t)},useProgram:function(t){return c!==t&&(e.useProgram(t),c=t,!0)},setBlending:z,setMaterial:function(e,t){2===e.side?U(2884):F(2884);var n=1===e.side;t&&(n=!n),Z(n),1===e.blending&&!1===e.transparent?z(0):z(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite);var i=e.stencilWrite;o.setTest(i),i&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),j(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(32926):U(32926)},setFlipSided:Z,setCullFace:G,setLineWidth:function(t){t!==_&&(k&&e.lineWidth(t),_=t)},setPolygonOffset:j,setScissorTest:function(e){e?F(3089):U(3089)},activeTexture:q,bindTexture:function(t,n){null===C&&q();var i=O[C];void 0===i&&(i={type:void 0,texture:void 0},O[C]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||D[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=O[C];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===I.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),I.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),s={},C=null,O={},u=null,l={},c=null,h=!1,p=null,d=null,f=null,v=null,m=null,g=null,y=null,b=!1,x=null,w=null,_=null,S=null,M=null,P.set(0,0,e.canvas.width,e.canvas.height),I.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),o.reset()}}}function ds(e,t,n,i,r,a,o){var s,u=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,p=r.maxSamples,d=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function v(e,t){return f?new OffscreenCanvas(e,t):sn("canvas")}function m(e,t,n,i){var r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?en:Math.floor,o=a(r*e.width),u=a(r*e.height);void 0===s&&(s=v(o,u));var l=n?v(o,u):s;return l.width=o,l.height=u,l.getContext("2d").drawImage(e,0,0,o,u),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+u+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return Kt(e.width)&&Kt(e.height)}function y(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function b(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,a,o))}function x(n,i,r,a){if(!1===u)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=3001===a?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function w(e){return 1003===e||1004===e||1005===e?9728:9729}function _(t){var n=t.target;n.removeEventListener("dispose",_),function(t){var n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&d.delete(n),o.memory.textures--}function S(t){var n=t.target;n.removeEventListener("dispose",S),function(t){var n=t.texture,r=i.get(t),a=i.get(n);if(t){if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(r.__webglFramebuffer[s]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[s]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(var u=0,l=n.length;u<l;u++){var c=i.get(n[u]);c.__webglTexture&&(e.deleteTexture(c.__webglTexture),o.memory.textures--),i.remove(n[u])}i.remove(n),i.remove(t)}}(n)}var M=0;function T(e,t){var r=i.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void L(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function k(t,r){var o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6===i.image.length){O(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);for(var o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),s=i.image[0]&&i.image[0].isDataTexture,l=[],h=0;h<6;h++)l[h]=o||s?s?i.image[h].image:i.image[h]:m(i.image[h],!1,!0,c);var p,d=l[0],f=g(d)||u,v=a.convert(i.format),w=a.convert(i.type),_=x(i.internalFormat,v,w,i.encoding);if(C(34067,i,f),o){for(var S=0;S<6;S++){p=l[S].mipmaps;for(var M=0;M<p.length;M++){var T=p[M];1023!==i.format&&1022!==i.format?null!==v?n.compressedTexImage2D(34069+S,M,_,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+S,M,_,T.width,T.height,0,v,w,T.data)}}t.__maxMipLevel=p.length-1}else{p=i.mipmaps;for(var k=0;k<6;k++)if(s){n.texImage2D(34069+k,0,_,l[k].width,l[k].height,0,v,w,l[k].data);for(var E=0;E<p.length;E++){var A=p[E].image[k].image;n.texImage2D(34069+k,E+1,_,A.width,A.height,0,v,w,A.data)}}else{n.texImage2D(34069+k,0,_,v,w,l[k]);for(var L=0;L<p.length;L++)n.texImage2D(34069+k,L+1,_,v,w,p[L].image[k])}t.__maxMipLevel=p.length}y(i,f)&&b(34067,i,d.width,d.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}var E={1e3:10497,1001:33071,1002:33648},A={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987};function C(n,a,o){if(o?(e.texParameteri(n,10242,E[a.wrapS]),e.texParameteri(n,10243,E[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,E[a.wrapR]),e.texParameteri(n,10240,A[a.magFilter]),e.texParameteri(n,10241,A[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),1001===a.wrapS&&1001===a.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(a.magFilter)),e.texParameteri(n,10241,w(a.minFilter)),1003!==a.minFilter&&1006!==a.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(1015===a.type&&!1===t.has("OES_texture_float_linear"))return;if(!1===u&&1016===a.type&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function O(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_),t.__webglTexture=e.createTexture(),o.memory.textures++)}function L(t,i,r){var o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),O(t,i),n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);var s,l=function(e){return!u&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(i)&&!1===g(i.image),c=m(i.image,l,!1,h),p=g(c)||u,d=a.convert(i.format),f=a.convert(i.type),v=x(i.internalFormat,d,f,i.encoding);C(o,i,p);var w=i.mipmaps;if(i.isDepthTexture)v=6402,u?v=1015===i.type?36012:1014===i.type?33190:1020===i.type?35056:33189:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&6402===v&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,f=a.convert(i.type)),1027===i.format&&6402===v&&(v=34041,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,f=a.convert(i.type))),n.texImage2D(3553,0,v,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(w.length>0&&p){for(var _=0,S=w.length;_<S;_++)s=w[_],n.texImage2D(3553,_,v,s.width,s.height,0,d,f,s.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,v,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(var M=0,T=w.length;M<T;M++)s=w[M],1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(3553,M,v,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,M,v,s.width,s.height,0,d,f,s.data);t.__maxMipLevel=w.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,v,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,v,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(w.length>0&&p){for(var k=0,E=w.length;k<E;k++)s=w[k],n.texImage2D(3553,k,v,d,f,s);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,v,d,f,c),t.__maxMipLevel=0;y(i,p)&&b(o,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function R(t,r,o,s,u){var l=a.convert(o.format),c=a.convert(o.type),h=x(o.internalFormat,l,c,o.encoding);32879===u||35866===u?n.texImage3D(u,0,h,r.width,r.height,r.depth,0,l,c,null):n.texImage2D(u,0,h,r.width,r.height,0,l,c,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,u,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function P(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var r=33189;if(i){var o=n.depthTexture;o&&o.isDepthTexture&&(1015===o.type?r=36012:1014===o.type&&(r=33190));var s=I(n);e.renderbufferStorageMultisample(36161,s,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){var u=I(n);e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var l=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,c=a.convert(l.format),h=a.convert(l.type),p=x(l.internalFormat,c,h,l.encoding);if(i){var d=I(n);e.renderbufferStorageMultisample(36161,d,p,n.width,n.height)}else e.renderbufferStorage(36161,p,n.width,n.height)}e.bindRenderbuffer(36161,null)}function I(e){return u&&e.isWebGLMultisampleRenderTarget?Math.min(p,e.samples):0}var N=!1,D=!1;this.allocateTextureUnit=function(){var e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){var r=i.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=k,this.setupRenderTarget=function(t){var s=t.texture,l=i.get(t),c=i.get(s);t.addEventListener("dispose",S),!0!==t.isWebGLMultipleRenderTargets&&(c.__webglTexture=e.createTexture(),c.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,p=!0===t.isWebGLMultipleRenderTargets,d=!0===t.isWebGLMultisampleRenderTarget,f=s.isDataTexture3D||s.isDataTexture2DArray,v=g(t)||u;if(!u||1022!==s.format||1015!==s.type&&1016!==s.type||(s.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){l.__webglFramebuffer=[];for(var m=0;m<6;m++)l.__webglFramebuffer[m]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),p)if(r.drawBuffers)for(var w=t.texture,_=0,M=w.length;_<M;_++){var k=i.get(w[_]);void 0===k.__webglTexture&&(k.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(d)if(u){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);var E=a.convert(s.format),A=a.convert(s.type),O=x(s.internalFormat,E,A,s.encoding),L=I(t);e.renderbufferStorageMultisample(36161,L,O,t.width,t.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),P(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,c.__webglTexture),C(34067,s,v);for(var N=0;N<6;N++)R(l.__webglFramebuffer[N],t,s,36064,34069+N);y(s,v)&&b(34067,s,t.width,t.height),n.unbindTexture()}else if(p){for(var D=t.texture,F=0,U=D.length;F<U;F++){var B=D[F],V=i.get(B);n.bindTexture(3553,V.__webglTexture),C(3553,B,v),R(l.__webglFramebuffer,t,B,36064+F,3553),y(B,v)&&b(3553,B,t.width,t.height)}n.unbindTexture()}else{var H=3553;f&&(u?H=s.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(H,c.__webglTexture),C(H,s,v),R(l.__webglFramebuffer,t,s,36064,H),y(s,v)&&b(H,s,t.width,t.height,t.depth),n.unbindTexture()}t.depthBuffer&&function(t){var r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);var a=i.get(r.depthTexture).__webglTexture;if(1026===r.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(1027!==r.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),P(r.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),P(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){for(var t=g(e)||u,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=r.length;a<o;a++){var s=r[a];if(y(s,t)){var l=e.isWebGLCubeRenderTarget?34067:3553,c=i.get(s).__webglTexture;n.bindTexture(l,c),b(l,s,e.width,e.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(u){var r=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);var s=i.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===N&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),N=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===D&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),D=!0),e=e.texture),k(e,t)}}function fs(e,t,n){var i=n.isWebGL2;return{convert:function(e){var n;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e)return i?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:1020===e?i?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}cs.prototype.isMeshDistanceMaterial=!0;var vs=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return M(this,n),(e=t.call(this)).cameras=i,e}return n}(Tr);vs.prototype.isArrayCamera=!0;var ms=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="Group",e}return n}(yi);ms.prototype.isGroup=!0;var gs={type:"move"},ys=function(){function e(){M(this,e),this._targetRay=null,this._grip=null,this._hand=null}return k(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new ms,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new ms,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new mn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new mn),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new ms,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new mn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new mn),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var i=null,r=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(null!==(i=t.getPose(e.targetRaySpace,n))&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(gs))),u&&e.hand){a=!0;var l,c=x(e.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,p=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var d=new ms;d.matrixAutoUpdate=!1,d.visible=!1,u.joints[h.jointName]=d,u.add(d)}var f=u.joints[h.jointName];null!==p&&(f.matrix.fromArray(p.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.jointRadius=p.radius),f.visible=null!==p}}catch(m){c.e(m)}finally{c.f()}var v=u.joints["index-finger-tip"].position.distanceTo(u.joints["thumb-tip"].position);u.inputState.pinching&&v>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&v<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(null!==(r=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==u&&(u.visible=null!==a),this}}]),e}(),bs=function(e){d(n,e);var t=v(n);function n(e,i){var r;M(this,n);var a=g(r=t.call(this)),o=e.state,s=null,u=1,c=null,h="local-floor",p=null,d=null,f=null,v=null,m=null,y=!1,b=null,x=null,w=null,_=null,S=null,T=null,k=[],E=new Map,A=new Tr;A.layers.enable(1),A.viewport=new pn;var C=new Tr;C.layers.enable(2),C.viewport=new pn;var O=[A,C],L=new vs;L.layers.enable(1),L.layers.enable(2);var R=null,P=null;function I(e){var t=E.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function N(){E.forEach(function(e,t){e.disconnect(t)}),E.clear(),R=null,P=null,o.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),f&&i.deleteFramebuffer(f),b&&i.deleteFramebuffer(b),x&&i.deleteRenderbuffer(x),w&&i.deleteRenderbuffer(w),f=null,b=null,x=null,w=null,m=null,v=null,d=null,s=null,H.stop(),a.isPresenting=!1,a.dispatchEvent({type:"sessionend"})}function D(e){for(var t=s.inputSources,n=0;n<k.length;n++)E.set(t[n],k[n]);for(var i=0;i<e.removed.length;i++){var r=e.removed[i],a=E.get(r);a&&(a.dispatchEvent({type:"disconnected",data:r}),E.delete(r))}for(var o=0;o<e.added.length;o++){var u=e.added[o],l=E.get(u);l&&l.dispatchEvent({type:"connected",data:u})}}r.cameraAutoUpdate=!0,r.enabled=!1,r.isPresenting=!1,r.getController=function(e){var t=k[e];return void 0===t&&(t=new ys,k[e]=t),t.getTargetRaySpace()},r.getControllerGrip=function(e){var t=k[e];return void 0===t&&(t=new ys,k[e]=t),t.getGripSpace()},r.getHand=function(e){var t=k[e];return void 0===t&&(t=new ys,k[e]=t),t.getHandSpace()},r.setFramebufferScaleFactor=function(e){u=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},r.setReferenceSpaceType=function(e){h=e,!0===a.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},r.getReferenceSpace=function(){return c},r.getBaseLayer=function(){return null!==v?v:m},r.getBinding=function(){return d},r.getFrame=function(){return _},r.getSession=function(){return s},r.setSession=function(){var e=l(regeneratorRuntime.mark(function e(t){var n,r,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(s=t)){e.next=19;break}if(s.addEventListener("select",I),s.addEventListener("selectstart",I),s.addEventListener("selectend",I),s.addEventListener("squeeze",I),s.addEventListener("squeezestart",I),s.addEventListener("squeezeend",I),s.addEventListener("end",N),s.addEventListener("inputsourceschange",D),n=i.getContextAttributes(),e.t0=!0!==n.xrCompatible,!e.t0){e.next=7;break}return e.next=7,i.makeXRCompatible();case 7:if(void 0!==s.renderState.layers){e.next=11;break}m=new XRWebGLLayer(s,i,{antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u}),s.updateRenderState({baseLayer:m}),e.next=12;break;case 11:i instanceof WebGLRenderingContext?(m=new XRWebGLLayer(s,i,{antialias:!0,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferScaleFactor:u}),s.updateRenderState({layers:[m]})):(y=n.antialias,r=null,n.depth&&(T=256,n.stencil&&(T|=1024),S=n.stencil?33306:36096,r=n.stencil?35056:33190),l={colorFormat:n.alpha?32856:32849,depthFormat:r,scaleFactor:u},d=new XRWebGLBinding(s,i),v=d.createProjectionLayer(l),f=i.createFramebuffer(),s.updateRenderState({layers:[v]}),y&&(b=i.createFramebuffer(),x=i.createRenderbuffer(),i.bindRenderbuffer(36161,x),i.renderbufferStorageMultisample(36161,4,32856,v.textureWidth,v.textureHeight),o.bindFramebuffer(36160,b),i.framebufferRenderbuffer(36160,36064,36161,x),i.bindRenderbuffer(36161,null),null!==r&&(w=i.createRenderbuffer(),i.bindRenderbuffer(36161,w),i.renderbufferStorageMultisample(36161,4,r,v.textureWidth,v.textureHeight),i.framebufferRenderbuffer(36160,S,36161,w),i.bindRenderbuffer(36161,null)),o.bindFramebuffer(36160,null)));case 12:return e.next=14,s.requestReferenceSpace(h);case 14:c=e.sent,H.setContext(s),H.start(),a.isPresenting=!0,a.dispatchEvent({type:"sessionstart"});case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();var F=new mn,U=new mn;function B(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}r.updateCamera=function(e){if(null!==s){L.near=C.near=A.near=e.near,L.far=C.far=A.far=e.far,R===L.near&&P===L.far||(s.updateRenderState({depthNear:L.near,depthFar:L.far}),R=L.near,P=L.far);var t=e.parent,n=L.cameras;B(L,t);for(var i=0;i<n.length;i++)B(n[i],t);L.matrixWorld.decompose(L.position,L.quaternion,L.scale),e.position.copy(L.position),e.quaternion.copy(L.quaternion),e.scale.copy(L.scale),e.matrix.copy(L.matrix),e.matrixWorld.copy(L.matrixWorld);for(var r=e.children,a=0,o=r.length;a<o;a++)r[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){F.setFromMatrixPosition(t.matrixWorld),U.setFromMatrixPosition(n.matrixWorld);var i=F.distanceTo(U),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),u=(r[9]+1)/r[5],l=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],p=o*c,d=o*h,f=i/(-c+h),v=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+f,g=s+f;e.projectionMatrix.makePerspective(p-v,d+(i-v),u*s/g*m,l*s/g*m,m,g)}(L,A,C):L.projectionMatrix.copy(A.projectionMatrix)}},r.getCamera=function(){return L},r.getFoveation=function(){return null!==v?v.fixedFoveation:null!==m?m.fixedFoveation:void 0},r.setFoveation=function(e){null!==v&&(v.fixedFoveation=e),null!==m&&void 0!==m.fixedFoveation&&(m.fixedFoveation=e)};var V=null,H=new Dr;return H.setAnimationLoop(function(e,t){if(p=t.getViewerPose(c),_=t,null!==p){var n=p.views;null!==m&&o.bindXRFramebuffer(m.framebuffer);var r=!1;n.length!==L.cameras.length&&(L.cameras.length=0,r=!0);for(var a=0;a<n.length;a++){var u=n[a],l=null;if(null!==m)l=m.getViewport(u);else{var h=d.getViewSubImage(v,u);o.bindXRFramebuffer(f),void 0!==h.depthStencilTexture&&i.framebufferTexture2D(36160,S,3553,h.depthStencilTexture,0),i.framebufferTexture2D(36160,36064,3553,h.colorTexture,0),l=h.viewport}var g=O[a];g.matrix.fromArray(u.transform.matrix),g.projectionMatrix.fromArray(u.projectionMatrix),g.viewport.set(l.x,l.y,l.width,l.height),0===a&&L.matrix.copy(g.matrix),!0===r&&L.cameras.push(g)}y&&(o.bindXRFramebuffer(b),null!==T&&i.clear(T))}for(var x=s.inputSources,w=0;w<k.length;w++)k[w].update(x[w],t,c);if(V&&V(e,t),y){var M=v.textureWidth,E=v.textureHeight;o.bindFramebuffer(36008,b),o.bindFramebuffer(36009,f),i.invalidateFramebuffer(36008,[S]),i.invalidateFramebuffer(36009,[S]),i.blitFramebuffer(0,0,M,E,0,0,M,E,16384,9728),i.invalidateFramebuffer(36008,[36064]),o.bindFramebuffer(36008,null),o.bindFramebuffer(36009,null),o.bindFramebuffer(36160,b)}_=null}),r.setAnimationLoop=function(e){V=e},r.dispose=function(){},r}return n}(Ht);function xs(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);var i,r,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularTintMap?i=n.specularTintMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap&&(i=n.thicknessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenTint.value.copy(t.sheenTint).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate())),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationTint.value.copy(t.attenuationTint)),e.specularIntensity.value=t.specularIntensity,e.specularTint.value.copy(t.specularTint),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularTintMap&&(e.specularTintMap.value=t.specularTintMap)}(e,i,o):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){var r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){var n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function ws(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=void 0!==e.canvas?e.canvas:function(){var e=sn("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,p=null,d=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;var v=this,m=!1,g=0,y=0,b=null,x=-1,w=null,_=new pn,S=new pn,M=null,T=t.width,k=t.height,E=1,A=null,C=null,O=new pn(0,0,T,k),L=new pn(0,0,T,k),R=!1,P=[],I=new Nr,N=!1,D=!1,F=null,U=new Wn,B=new mn,V={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function H(){return null===b?E:1}var z,Z,G,j,q,W,J,Y,X,Q,K,$,ee,te,ne,ie,re,ae,oe,se,ue,le,ce,he=n;function pe(e,n){for(var i=0;i<e.length;i++){var r=t.getContext(e[i],n);if(null!==r)return r}return null}try{var de={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",ge,!1),t.addEventListener("webglcontextrestored",ye,!1),null===he){var fe=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&fe.shift(),null===(he=pe(fe,de)))throw pe(fe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ve(){z=new ga(he),Z=new jr(he,z,e),z.init(Z),le=new fs(he,z,Z),G=new ps(he,z,Z),P[0]=1029,j=new xa(he),q=new Ko,W=new ds(he,z,G,q,Z,le,j),J=new Wr(v),Y=new ma(v),X=new Fr(he,Z),ce=new Zr(he,z,X,Z),Q=new ya(he,X,j,ce),K=new ka(he,Q,X,j),oe=new Ta(he,Z,W),ie=new qr(q),$=new Qo(v,J,Y,z,Z,ce,ie),ee=new xs(q),te=new ns(q),ne=new us(z,Z),ae=new zr(v,J,G,K,s),re=new hs(v,K,Z),se=new Gr(he,z,j,Z),ue=new ba(he,z,j,Z),j.programs=$.programs,v.capabilities=Z,v.extensions=z,v.properties=q,v.renderLists=te,v.shadowMap=re,v.state=G,v.info=j}ve();var me=new bs(v,he);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=j.autoReset,t=re.enabled,n=re.autoUpdate,i=re.needsUpdate,r=re.type;ve(),j.autoReset=e,re.enabled=t,re.autoUpdate=n,re.needsUpdate=i,re.type=r}function be(e){var t=e.target;t.removeEventListener("dispose",be),function(e){(function(e){var t=q.get(e).programs;void 0!==t&&t.forEach(function(e){$.releaseProgram(e)})})(e),q.remove(e)}(t)}this.xr=me,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){var e=z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return E},this.setPixelRatio=function(e){void 0!==e&&(E=e,this.setSize(T,k,!1))},this.getSize=function(e){return e.set(T,k)},this.setSize=function(e,n,i){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(T=e,k=n,t.width=Math.floor(e*E),t.height=Math.floor(n*E),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(T*E,k*E).floor()},this.setDrawingBufferSize=function(e,n,i){T=e,k=n,E=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(_)},this.getViewport=function(e){return e.copy(O)},this.setViewport=function(e,t,n,i){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,i),G.viewport(_.copy(O).multiplyScalar(E).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),G.scissor(S.copy(L).multiplyScalar(E).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){G.setScissorTest(R=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),he.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ge,!1),t.removeEventListener("webglcontextrestored",ye,!1),te.dispose(),ne.dispose(),q.dispose(),J.dispose(),Y.dispose(),K.dispose(),ce.dispose(),me.dispose(),me.removeEventListener("sessionstart",we),me.removeEventListener("sessionend",_e),F&&(F.dispose(),F=null),Se.stop()},this.renderBufferImmediate=function(e,t){ce.initAttributes();var n=q.get(e);e.hasPositions&&!n.position&&(n.position=he.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=he.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=he.createBuffer()),e.hasColors&&!n.color&&(n.color=he.createBuffer());var i=t.getAttributes();e.hasPositions&&(he.bindBuffer(34962,n.position),he.bufferData(34962,e.positionArray,35048),ce.enableAttribute(i.position.location),he.vertexAttribPointer(i.position.location,3,5126,!1,0,0)),e.hasNormals&&(he.bindBuffer(34962,n.normal),he.bufferData(34962,e.normalArray,35048),ce.enableAttribute(i.normal.location),he.vertexAttribPointer(i.normal.location,3,5126,!1,0,0)),e.hasUvs&&(he.bindBuffer(34962,n.uv),he.bufferData(34962,e.uvArray,35048),ce.enableAttribute(i.uv.location),he.vertexAttribPointer(i.uv.location,2,5126,!1,0,0)),e.hasColors&&(he.bindBuffer(34962,n.color),he.bufferData(34962,e.colorArray,35048),ce.enableAttribute(i.color.location),he.vertexAttribPointer(i.color.location,3,5126,!1,0,0)),ce.disableUnusedAttributes(),he.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=V);var o=r.isMesh&&r.matrixWorld.determinant()<0,s=Oe(e,t,n,i,r);G.setMaterial(i,o);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var c,h=1;!0===i.wireframe&&(u=Q.getWireframeAttribute(n),h=2),ce.setup(r,i,s,n,u);var p=se;null!==u&&(c=X.get(u),(p=ue).setIndex(c));var d=null!==u?u.count:l.count,f=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,y=Math.max(f,m),b=Math.min(d,f+v,m+g)-1,x=Math.max(0,b-y+1);if(0!==x){if(r.isMesh)!0===i.wireframe?(G.setLineWidth(i.wireframeLinewidth*H()),p.setMode(1)):p.setMode(4);else if(r.isLine){var w=i.linewidth;void 0===w&&(w=1),G.setLineWidth(w*H()),p.setMode(r.isLineSegments?1:r.isLineLoop?2:3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(y,x,r.count);else if(n.isInstancedBufferGeometry){var _=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(y,x,_)}else p.render(y,x)}},this.compile=function(e,t){(p=ne.get(e)).init(),f.push(p),e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(p.pushLight(e),e.castShadow&&p.pushShadow(e))}),p.setupLights(v.physicallyCorrectLights),e.traverse(function(t){var n=t.material;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++)Ae(n[i],e,t);else Ae(n,e,t)}),f.pop(),p=null};var xe=null;function we(){Se.stop()}function _e(){Se.start()}var Se=new Dr;function Me(e,t,n,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);var r=K.update(e),a=e.material;a.visible&&h.push(e,r,a,n,B.z,null)}}else if(e.isImmediateRenderObject)i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),h.push(e,null,e.material,n,B.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||I.intersectsObject(e))){i&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);var o=K.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var d=u[l],f=s[d.materialIndex];f&&f.visible&&h.push(e,o,f,n,B.z,d)}else s.visible&&h.push(e,o,s,n,B.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Me(v[m],t,n,i)}}function Te(e,t,n,i){var r=e.opaque,a=e.transmissive,s=e.transparent;p.setupLightsView(n),a.length>0&&function(e,t,n){null===F&&(F=new(!0===o&&!0===Z.isWebGL2?fn:dn)(1024,1024,{generateMipmaps:!0,type:null!==le.convert(1016)?1016:1009,minFilter:1008,magFilter:1003,wrapS:1001,wrapT:1001}));var i=v.getRenderTarget();v.setRenderTarget(F),v.clear();var r=v.toneMapping;v.toneMapping=0,ke(e,t,n),v.toneMapping=r,W.updateMultisampleRenderTarget(F),W.updateRenderTargetMipmap(F),v.setRenderTarget(i)}(r,t,n),i&&G.viewport(_.copy(i)),r.length>0&&ke(r,t,n),a.length>0&&ke(a,t,n),s.length>0&&ke(s,t,n)}function ke(e,t,n){for(var i=!0===t.isScene?t.overrideMaterial:null,r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,u=o.geometry,l=null===i?o.material:i,c=o.group;s.layers.test(n.layers)&&Ee(s,t,n,u,l,c)}}function Ee(e,t,n,i,r,a){if(e.onBeforeRender(v,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(v,t,n,i,e,a),e.isImmediateRenderObject){var o=Oe(n,t,i,r,e);G.setMaterial(r),ce.reset(),function(e,t){e.render(function(e){v.renderBufferImmediate(e,t)})}(e,o)}else!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,a),r.side=0,r.needsUpdate=!0,v.renderBufferDirect(n,t,i,r,e,a),r.side=2):v.renderBufferDirect(n,t,i,r,e,a);e.onAfterRender(v,t,n,i,r,a)}function Ae(e,t,n){!0!==t.isScene&&(t=V);var i=q.get(e),r=p.state.lights,a=r.state.version,o=$.getParameters(e,r.state,p.state.shadowsArray,t,n),s=$.getProgramCacheKey(o),u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?Y:J).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",be),u=new Map,i.programs=u);var l=u.get(s);if(void 0!==l){if(i.currentProgram===l&&i.lightsStateVersion===a)return Ce(e,o),l}else o.uniforms=$.getUniforms(e),e.onBuild(o,v),e.onBeforeCompile(o,v),l=$.acquireProgram(o,s),u.set(s,l),i.uniforms=o.uniforms;var c=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(c.clippingPlanes=ie.uniform),Ce(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(c.ambientLightColor.value=r.state.ambient,c.lightProbe.value=r.state.probe,c.directionalLights.value=r.state.directional,c.directionalLightShadows.value=r.state.directionalShadow,c.spotLights.value=r.state.spot,c.spotLightShadows.value=r.state.spotShadow,c.rectAreaLights.value=r.state.rectArea,c.ltc_1.value=r.state.rectAreaLTC1,c.ltc_2.value=r.state.rectAreaLTC2,c.pointLights.value=r.state.point,c.pointLightShadows.value=r.state.pointShadow,c.hemisphereLights.value=r.state.hemi,c.directionalShadowMap.value=r.state.directionalShadowMap,c.directionalShadowMatrix.value=r.state.directionalShadowMatrix,c.spotShadowMap.value=r.state.spotShadowMap,c.spotShadowMatrix.value=r.state.spotShadowMatrix,c.pointShadowMap.value=r.state.pointShadowMap,c.pointShadowMatrix.value=r.state.pointShadowMatrix);var h=l.getUniforms(),d=Oo.seqWithValue(h.seq,c);return i.currentProgram=l,i.uniformsList=d,l}function Ce(e,t){var n=q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}function Oe(e,t,n,i,r){!0!==t.isScene&&(t=V),W.resetTextureUnits();var a=t.fog,o=null===b?v.outputEncoding:b.texture.encoding,s=(i.isMeshStandardMaterial?Y:J).get(i.envMap||(i.isMeshStandardMaterial?t.environment:null)),u=!0===i.vertexColors&&!!n&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!i.normalMap&&!!n&&!!n.attributes.tangent,c=!!n&&!!n.morphAttributes.position,h=!!n&&!!n.morphAttributes.normal,d=n&&n.morphAttributes.position?n.morphAttributes.position.length:0,f=q.get(i),m=p.state.lights;!0!==N||!0!==D&&e===w||ie.setState(i,e,e===w&&i.id===x);var g=!1;i.version===f.__version?f.needsLights&&f.lightsStateVersion!==m.state.version||f.outputEncoding!==o||r.isInstancedMesh&&!1===f.instancing?g=!0:r.isInstancedMesh||!0!==f.instancing?r.isSkinnedMesh&&!1===f.skinning?g=!0:r.isSkinnedMesh||!0!==f.skinning?f.envMap!==s||i.fog&&f.fog!==a?g=!0:void 0===f.numClippingPlanes||f.numClippingPlanes===ie.numPlanes&&f.numIntersection===ie.numIntersection?(f.vertexAlphas!==u||f.vertexTangents!==l||f.morphTargets!==c||f.morphNormals!==h||!0===Z.isWebGL2&&f.morphTargetsCount!==d)&&(g=!0):g=!0:g=!0:g=!0:(g=!0,f.__version=i.version);var y=f.currentProgram;!0===g&&(y=Ae(i,t,r));var _,S,M=!1,T=!1,A=!1,C=y.getUniforms(),O=f.uniforms;if(G.useProgram(y.program)&&(M=!0,T=!0,A=!0),i.id!==x&&(x=i.id,T=!0),M||w!==e){if(C.setValue(he,"projectionMatrix",e.projectionMatrix),Z.logarithmicDepthBuffer&&C.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,T=!0,A=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){var L=C.map.cameraPosition;void 0!==L&&L.setValue(he,B.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&C.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&C.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){C.setOptional(he,r,"bindMatrix"),C.setOptional(he,r,"bindMatrixInverse");var R=r.skeleton;R&&(Z.floatVertexTextures?(null===R.boneTexture&&R.computeBoneTexture(),C.setValue(he,"boneTexture",R.boneTexture,W),C.setValue(he,"boneTextureSize",R.boneTextureSize)):C.setOptional(he,R,"boneMatrices"))}return!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||oe.update(r,n,i,y),(T||f.receiveShadow!==r.receiveShadow)&&(f.receiveShadow=r.receiveShadow,C.setValue(he,"receiveShadow",r.receiveShadow)),T&&(C.setValue(he,"toneMappingExposure",v.toneMappingExposure),f.needsLights&&((_=O).ambientLightColor.needsUpdate=S=A,_.lightProbe.needsUpdate=S,_.directionalLights.needsUpdate=S,_.directionalLightShadows.needsUpdate=S,_.pointLights.needsUpdate=S,_.pointLightShadows.needsUpdate=S,_.spotLights.needsUpdate=S,_.spotLightShadows.needsUpdate=S,_.rectAreaLights.needsUpdate=S,_.hemisphereLights.needsUpdate=S),a&&i.fog&&ee.refreshFogUniforms(O,a),ee.refreshMaterialUniforms(O,i,E,k,F),Oo.upload(he,f.uniformsList,O,W)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Oo.upload(he,f.uniformsList,O,W),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&C.setValue(he,"center",r.center),C.setValue(he,"modelViewMatrix",r.modelViewMatrix),C.setValue(he,"normalMatrix",r.normalMatrix),C.setValue(he,"modelMatrix",r.matrixWorld),y}Se.setAnimationLoop(function(e){xe&&xe(e)}),"undefined"!=typeof window&&Se.setContext(window),this.setAnimationLoop=function(e){xe=e,me.setAnimationLoop(e),null===e?Se.stop():Se.start()},me.addEventListener("sessionstart",we),me.addEventListener("sessionend",_e),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){if(!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,b),(p=ne.get(e,f.length)).init(),f.push(p),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(U),D=this.localClippingEnabled,N=ie.init(this.clippingPlanes,D,t),(h=te.get(e,d.length)).init(),d.push(h),Me(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(A,C),!0===N&&ie.beginShadows(),re.render(p.state.shadowsArray,e,t),!0===N&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(h,e),p.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var n=t.cameras,i=0,r=n.length;i<r;i++){var a=n[i];Te(h,e,a,a.viewport)}else Te(h,e,t);null!==b&&(W.updateMultisampleRenderTarget(b),W.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(v,e,t),G.buffers.depth.setTest(!0),G.buffers.depth.setMask(!0),G.buffers.color.setMask(!0),G.setPolygonOffset(!1),ce.resetDefaultState(),x=-1,w=null,f.pop(),p=f.length>0?f[f.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,g=t,y=n,e&&void 0===q.get(e).__webglFramebuffer&&W.setupRenderTarget(e);var i=null,r=!1,a=!1;if(e){var o=e.texture;(o.isDataTexture3D||o.isDataTexture2DArray)&&(a=!0);var s=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=s[t],r=!0):i=e.isWebGLMultisampleRenderTarget?q.get(e).__webglMultisampledFramebuffer:s,_.copy(e.viewport),S.copy(e.scissor),M=e.scissorTest}else _.copy(O).multiplyScalar(E).floor(),S.copy(L).multiplyScalar(E).floor(),M=R;if(G.bindFramebuffer(36160,i)&&Z.drawBuffers){var u=!1;if(e)if(e.isWebGLMultipleRenderTargets){var l=e.texture;if(P.length!==l.length||36064!==P[0]){for(var c=0,h=l.length;c<h;c++)P[c]=36064+c;P.length=l.length,u=!0}}else 1===P.length&&36064===P[0]||(P[0]=36064,P.length=1,u=!0);else 1===P.length&&1029===P[0]||(P[0]=1029,P.length=1,u=!0);u&&(Z.isWebGL2?he.drawBuffers(P):z.get("WEBGL_draw_buffers").drawBuffersWEBGL(P))}if(G.viewport(_),G.scissor(S),G.setScissorTest(M),r){var p=q.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,p.__webglTexture,n)}else if(a){var d=q.get(e.texture);he.framebufferTextureLayer(36160,36064,d.__webglTexture,n||0,t||0)}x=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(e&&e.isWebGLRenderTarget){var s=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){G.bindFramebuffer(36160,s);try{var u=e.texture,l=u.format,c=u.type;if(1023!==l&&le.convert(l)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=1016===c&&(z.has("EXT_color_buffer_half_float")||Z.isWebGL2&&z.has("EXT_color_buffer_float"));if(!(1009===c||le.convert(c)===he.getParameter(35738)||1015===c&&(Z.isWebGL2||z.has("OES_texture_float")||z.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===he.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&he.readPixels(t,n,i,r,le.convert(l),le.convert(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{var p=null!==b?q.get(b).__webglFramebuffer:null;G.bindFramebuffer(36160,p)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i),o=le.convert(t.format);Z.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),W.setTexture2D(t,0),he.copyTexImage2D(3553,n,o,e.x,e.y,r,a,0),G.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,o=le.convert(n.format),s=le.convert(n.type);W.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&he.generateMipmap(3553),G.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,l=le.convert(i.format),c=le.convert(i.type);if(i.isDataTexture3D)W.setTexture3D(i,0),a=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");W.setTexture2DArray(i,0),a=35866}he.pixelStorei(37440,i.flipY),he.pixelStorei(37441,i.premultiplyAlpha),he.pixelStorei(3317,i.unpackAlignment);var h=he.getParameter(3314),p=he.getParameter(32878),d=he.getParameter(3316),f=he.getParameter(3315),m=he.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;he.pixelStorei(3314,g.width),he.pixelStorei(32878,g.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?he.texSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,g.data)):he.texSubImage3D(a,r,t.x,t.y,t.z,o,s,u,l,c,g),he.pixelStorei(3314,h),he.pixelStorei(32878,p),he.pixelStorei(3316,d),he.pixelStorei(3315,f),he.pixelStorei(32877,m),0===r&&i.generateMipmaps&&he.generateMipmap(a),G.unbindTexture()}},this.initTexture=function(e){W.setTexture2D(e,0),G.unbindTexture()},this.resetState=function(){g=0,y=0,b=null,G.reset(),ce.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n})(ws).prototype.isWebGL1Renderer=!0;var _s=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:g(e)})),e}return k(n,[{key:"copy",value:function(e,t){return p(b(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(yi);_s.prototype.isScene=!0;var Ss=function(){function e(t,n){M(this,e),this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Jt()}return k(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Jt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Jt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}();Ss.prototype.isInterleavedBuffer=!0;var Ms=new mn,Ts=function(){function e(t,n,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];M(this,e),this.name="",this.data=t,this.itemSize=n,this.offset=i,this.normalized=!0===r}return k(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)Ms.x=this.getX(t),Ms.y=this.getY(t),Ms.z=this.getZ(t),Ms.applyMatrix4(e),this.setXYZ(t,Ms.x,Ms.y,Ms.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Ms.x=this.getX(t),Ms.y=this.getY(t),Ms.z=this.getZ(t),Ms.applyNormalMatrix(e),this.setXYZ(t,Ms.x,Ms.y,Ms.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Ms.x=this.getX(t),Ms.y=this.getY(t),Ms.z=this.getZ(t),Ms.transformDirection(e),this.setXYZ(t,Ms.x,Ms.y,Ms.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}},{key:"setXYZW",value:function(e,t,n,i,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var n=[],i=0;i<this.count;i++)for(var r=i*this.data.stride+this.offset,a=0;a<this.itemSize;a++)n.push(this.data.array[r+a]);return new zi(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var i=n*this.data.stride+this.offset,r=0;r<this.itemSize;r++)t.push(this.data.array[i+r]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}();Ts.prototype.isInterleavedBufferAttribute=!0;var ks,Es=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="SpriteMaterial",i.color=new Ui(16777215),i.map=null,i.alphaMap=null,i.rotation=0,i.sizeAttenuation=!0,i.transparent=!0,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(Li);Es.prototype.isSpriteMaterial=!0;var As=new mn,Cs=new mn,Os=new mn,Ls=new nn,Rs=new nn,Ps=new Wn,Is=new mn,Ns=new mn,Ds=new mn,Fs=new nn,Us=new nn,Bs=new nn;function Vs(e,t,n,i,r,a){Ls.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(Rs.x=a*Ls.x-r*Ls.y,Rs.y=r*Ls.x+a*Ls.y):Rs.copy(Ls),e.copy(t),e.x+=Rs.x,e.y+=Rs.y,e.applyMatrix4(Ps)}(function(e){d(n,e);var t=v(n);function n(e){var i;if(M(this,n),(i=t.call(this)).type="Sprite",void 0===ks){ks=new $i;var r=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),a=new Ss(r,5);ks.setIndex([0,1,2,0,2,3]),ks.setAttribute("position",new Ts(a,3,0,!1)),ks.setAttribute("uv",new Ts(a,2,3,!1))}return i.geometry=ks,i.material=void 0!==e?e:new Es,i.center=new nn(.5,.5),m(i)}return k(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Cs.setFromMatrixScale(this.matrixWorld),Ps.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Os.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Cs.multiplyScalar(-Os.z);var n,i,r=this.material.rotation;0!==r&&(i=Math.cos(r),n=Math.sin(r));var a=this.center;Vs(Is.set(-.5,-.5,0),Os,a,Cs,n,i),Vs(Ns.set(.5,-.5,0),Os,a,Cs,n,i),Vs(Ds.set(.5,.5,0),Os,a,Cs,n,i),Fs.set(0,0),Us.set(1,0),Bs.set(1,1);var o=e.ray.intersectTriangle(Is,Ns,Ds,!1,As);if(null!==o||(Vs(Ns.set(-.5,.5,0),Os,a,Cs,n,i),Us.set(0,1),null!==(o=e.ray.intersectTriangle(Is,Ds,Ns,!1,As)))){var s=e.ray.origin.distanceTo(As);s<e.near||s>e.far||t.push({distance:s,point:As.clone(),uv:Ci.getUV(As,Is,Ns,Ds,Fs,Us,Bs,new nn),face:null,object:this})}}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n})(yi).prototype.isSprite=!0;var Hs=new mn,zs=new pn,Zs=new pn,Gs=new mn,js=new Wn,qs=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this,e,i)).type="SkinnedMesh",r.bindMode="attached",r.bindMatrix=new Wn,r.bindMatrixInverse=new Wn,r}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new pn,t=this.geometry.attributes.skinWeight,n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){p(b(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,i=this.geometry;zs.fromBufferAttribute(i.attributes.skinIndex,e),Zs.fromBufferAttribute(i.attributes.skinWeight,e),Hs.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var r=0;r<4;r++){var a=Zs.getComponent(r);if(0!==a){var o=zs.getComponent(r);js.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Gs.copy(Hs).applyMatrix4(js),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(gr);qs.prototype.isSkinnedMesh=!0;var Ws=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="Bone",e}return n}(yi);Ws.prototype.isBone=!0;var Js=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1003,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1003,d=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0;return M(this,n),(e=t.call(this,null,u,l,c,h,p,o,s,d,f)).image={data:i,width:r,height:a},e.magFilter=h,e.minFilter=p,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e.needsUpdate=!0,e}return n}(cn);Js.prototype.isDataTexture=!0;var Ys=new Wn,Xs=new Wn,Qs=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];M(this,e),this.uuid=Jt(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return k(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Wn)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new Wn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var i=0,r=this.bones.length;i<r;i++){var a=this.bones[i];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture,r=0,a=e.length;r<a;r++)Ys.multiplyMatrices(e[r]?e[r].matrixWorld:Xs,t[r]),Ys.toArray(n,16*r);null!==i&&(i.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=$t(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new Js(t,e,e,1023,1015);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var i=this.bones[t];if(i.name===e)return i}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,i=e.bones.length;n<i;n++){var r=e.bones[n],a=t[r];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),a=new Ws),this.bones.push(a),this.boneInverses.push((new Wn).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,i=0,r=t.length;i<r;i++)e.bones.push(t[i].uuid),e.boneInverses.push(n[i].toArray());return e}}]),e}(),Ks=function(e){d(n,e);var t=v(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return M(this,n),"number"==typeof r&&(o=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(a=t.call(this,e,i,r)).meshPerAttribute=o,a}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(zi);Ks.prototype.isInstancedBufferAttribute=!0;var $s=new Wn,eu=new Wn,tu=[],nu=new gr;(function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,i)).instanceMatrix=new Ks(new Float32Array(16*r),16),a.instanceColor=null,a.count=r,a.frustumCulled=!1,a}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,i=this.count;if(nu.geometry=this.geometry,nu.material=this.material,void 0!==nu.material)for(var r=0;r<i;r++){this.getMatrixAt(r,$s),eu.multiplyMatrices(n,$s),nu.matrixWorld=eu,nu.raycast(e,tu);for(var a=0,o=tu.length;a<o;a++){var s=tu[a];s.instanceId=r,s.object=this,t.push(s)}tu.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new Ks(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n})(gr).prototype.isInstancedMesh=!0;var iu=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="LineBasicMaterial",i.color=new Ui(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}]),n}(Li);iu.prototype.isLineBasicMaterial=!0;var ru=new mn,au=new mn,ou=new Wn,su=new qn,uu=new Un,lu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new iu;return M(this,n),(e=t.call(this)).type="Line",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],i=1,r=t.count;i<r;i++)ru.fromBufferAttribute(t,i-1),au.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=ru.distanceTo(au);e.setAttribute("lineDistance",new ji(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),uu.copy(n.boundingSphere),uu.applyMatrix4(i),uu.radius+=r,!1!==e.ray.intersectsSphere(uu)){ou.copy(i).invert(),su.copy(e.ray).applyMatrix4(ou);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new mn,l=new mn,c=new mn,h=new mn,p=this.isLineSegments?2:1;if(n.isBufferGeometry){var d=n.index,f=n.attributes.position;if(null!==d)for(var v=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count)-1;v<m;v+=p){var g=d.getX(v),y=d.getX(v+1);if(u.fromBufferAttribute(f,g),l.fromBufferAttribute(f,y),!(su.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,a.start),w=Math.min(f.count,a.start+a.count)-1;x<w;x+=p)if(u.fromBufferAttribute(f,x),l.fromBufferAttribute(f,x+1),!(su.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(h);_<e.near||_>e.far||t.push({distance:_,point:c.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(yi);lu.prototype.isLine=!0;var cu=new mn,hu=new mn,pu=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this,e,i)).type="LineSegments",r}return k(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],i=0,r=t.count;i<r;i+=2)cu.fromBufferAttribute(t,i),hu.fromBufferAttribute(t,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+cu.distanceTo(hu);e.setAttribute("lineDistance",new ji(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}]),n}(lu);pu.prototype.isLineSegments=!0;var du=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this,e,i)).type="LineLoop",r}return n}(lu);du.prototype.isLineLoop=!0;var fu=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="PointsMaterial",i.color=new Ui(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}]),n}(Li);fu.prototype.isPointsMaterial=!0;var vu=new Wn,mu=new qn,gu=new Un,yu=new mn,bu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new $i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fu;return M(this,n),(e=t.call(this)).type="Points",e.geometry=i,e.material=r,e.updateMorphTargets(),e}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),gu.copy(n.boundingSphere),gu.applyMatrix4(i),gu.radius+=r,!1!==e.ray.intersectsSphere(gu)){vu.copy(i).invert(),mu.copy(e.ray).applyMatrix4(vu);var o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){var u=n.index,l=n.attributes.position;if(null!==u)for(var c=Math.max(0,a.start),h=Math.min(u.count,a.start+a.count);c<h;c++){var p=u.getX(c);yu.fromBufferAttribute(l,p),xu(yu,p,s,i,e,t,this)}else for(var d=Math.max(0,a.start),f=Math.min(l.count,a.start+a.count);d<f;d++)yu.fromBufferAttribute(l,d),xu(yu,d,s,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}},{key:"updateMorphTargets",value:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var i=t[n[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=i.length;r<a;r++){var o=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=r}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}]),n}(yi);function xu(e,t,n,i,r,a,o){var s=mu.distanceSqToPoint(e);if(s<n){var u=new mn;mu.closestPointToPoint(e,u),u.applyMatrix4(i);var l=r.ray.origin.distanceTo(u);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}bu.prototype.isPoints=!0,function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s,u,l,c){var h;M(this,n),(h=t.call(this,e,i,r,a,o,s,u,l,c)).format=void 0!==u?u:1022,h.minFilter=void 0!==s?s:1006,h.magFilter=void 0!==o?o:1006,h.generateMipmaps=!1;var p=g(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){p.needsUpdate=!0,e.requestVideoFrameCallback(t)}),h}return k(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;0=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(cn).prototype.isVideoTexture=!0;var wu=function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s,u,l,c,h,p,d){var f;return M(this,n),(f=t.call(this,null,s,u,l,c,h,a,o,p,d)).image={width:i,height:r},f.mipmaps=e,f.flipY=!1,f.generateMipmaps=!1,f}return n}(cn);wu.prototype.isCompressedTexture=!0,function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s,u,l,c){var h;return M(this,n),(h=t.call(this,e,i,r,a,o,s,u,l,c)).needsUpdate=!0,h}return n}(cn).prototype.isCanvasTexture=!0,function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s,u,l,c,h){var p;if(M(this,n),1026!==(h=void 0!==h?h:1026)&&1027!==h)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===r&&1026===h&&(r=1012),void 0===r&&1027===h&&(r=1020),(p=t.call(this,null,a,o,s,u,l,h,r,c)).image={width:e,height:i},p.magFilter=void 0!==u?u:1003,p.minFilter=void 0!==l?l:1003,p.flipY=!1,p.generateMipmaps=!1,p}return n}(cn).prototype.isDepthTexture=!0,new mn,new mn,new mn,new Ci;var _u=function(){function e(){M(this,e),this.type="Curve",this.arcLengthDivisions=200}return k(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],i=this.getPoint(0),r=0;n.push(0);for(var a=1;a<=e;a++)r+=(t=this.getPoint(a/e)).distanceTo(i),n.push(r),i=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t||e*i[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=i[r=Math.floor(s+(u-s)/2)]-n)<0)s=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(i[r=u]===n)return r/(a-1);var l=i[r];return(r+(n-l)/(i[r+1]-l))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);var a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new nn:new mn);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new mn,i=[],r=[],a=[],o=new mn,s=new Wn,u=0;u<=e;u++)i[u]=this.getTangentAt(u/e,new mn);r[0]=new mn,a[0]=new mn;var l=Number.MAX_VALUE,c=Math.abs(i[0].x),h=Math.abs(i[0].y),p=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),p<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(var d=1;d<=e;d++){if(r[d]=r[d-1].clone(),a[d]=a[d-1].clone(),o.crossVectors(i[d-1],i[d]),o.length()>Number.EPSILON){o.normalize();var f=Math.acos(Yt(i[d-1].dot(i[d]),-1,1));r[d].applyMatrix4(s.makeRotationAxis(o,f))}a[d].crossVectors(i[d],r[d])}if(!0===t){var v=Math.acos(Yt(r[0].dot(r[e]),-1,1));v/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(v=-v);for(var m=1;m<=e;m++)r[m].applyMatrix4(s.makeRotationAxis(i[m],v*m)),a[m].crossVectors(i[m],r[m])}return{tangents:i,normals:r,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),Su=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return M(this,n),(e=t.call(this)).type="EllipseCurve",e.aX=i,e.aY=r,e.xRadius=a,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=l,e.aRotation=c,e}return k(n,[{key:"getPoint",value:function(e,t){for(var n=t||new nn,i=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);var o=this.aStartAngle+e*r,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,p=u-this.aY;s=h*l-p*c+this.aX,u=h*c+p*l+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(_u);Su.prototype.isEllipseCurve=!0;var Mu=function(e){d(n,e);var t=v(n);function n(e,i,r,a,o,s){var u;return M(this,n),(u=t.call(this,e,i,r,r,a,o,s)).type="ArcCurve",u}return n}(Su);function Tu(){var e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){var u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(i-t)/(o+s)+(i-n)/s;r(t,n,u*=o,l*=o)},calc:function(r){var a=r*r;return e+t*r+n*a+i*(a*r)}}}Mu.prototype.isArcCurve=!0;var ku=new mn,Eu=new Tu,Au=new Tu,Cu=new Tu,Ou=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return M(this,n),(e=t.call(this)).type="CatmullRomCurve3",e.points=i,e.closed=r,e.curveType=a,e.tension=o,e}return k(n,[{key:"getPoint",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,r=i,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,u=Math.floor(s),l=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===l&&u===o-1&&(u=o-2,l=1),this.closed||u>0?t=a[(u-1)%o]:(ku.subVectors(a[0],a[1]).add(a[0]),t=ku);var c=a[u%o],h=a[(u+1)%o];if(this.closed||u+2<o?n=a[(u+2)%o]:(ku.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=ku),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(c),p),f=Math.pow(c.distanceToSquared(h),p),v=Math.pow(h.distanceToSquared(n),p);f<1e-4&&(f=1),d<1e-4&&(d=f),v<1e-4&&(v=f),Eu.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,d,f,v),Au.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,d,f,v),Cu.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,d,f,v)}else"catmullrom"===this.curveType&&(Eu.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),Au.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),Cu.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return r.set(Eu.calc(l),Au.calc(l),Cu.calc(l)),r}},{key:"copy",value:function(e){p(b(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){p(b(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new mn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(_u);function Lu(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function Ru(e,t,n,i){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Pu(e,t,n,i,r){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}Ou.prototype.isCatmullRomCurve3=!0;var Iu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new nn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new nn;return M(this,n),(e=t.call(this)).type="CubicBezierCurve",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Pu(e,i.x,r.x,a.x,o.x),Pu(e,i.y,r.y,a.y,o.y)),n}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(_u);Iu.prototype.isCubicBezierCurve=!0;var Nu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mn;return M(this,n),(e=t.call(this)).type="CubicBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e.v3=o,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(Pu(e,i.x,r.x,a.x,o.x),Pu(e,i.y,r.y,a.y,o.y),Pu(e,i.z,r.z,a.z,o.z)),n}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(_u);Nu.prototype.isCubicBezierCurve3=!0;var Du=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn;return M(this,n),(e=t.call(this)).type="LineCurve",e.v1=i,e.v2=r,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new nn;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(_u);Du.prototype.isLineCurve=!0;var Fu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new nn;return M(this,n),(e=t.call(this)).type="QuadraticBezierCurve",e.v0=i,e.v1=r,e.v2=a,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(Ru(e,i.x,r.x,a.x),Ru(e,i.y,r.y,a.y)),n}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(_u);Fu.prototype.isQuadraticBezierCurve=!0;var Uu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new mn;return M(this,n),(e=t.call(this)).type="QuadraticBezierCurve3",e.v0=i,e.v1=r,e.v2=a,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(Ru(e,i.x,r.x,a.x),Ru(e,i.y,r.y,a.y),Ru(e,i.z,r.z,a.z)),n}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(_u);Uu.prototype.isQuadraticBezierCurve3=!0;var Bu=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return M(this,n),(e=t.call(this)).type="SplineCurve",e.points=i,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nn,n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],u=i[a],l=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return n.set(Lu(o,s.x,u.x,l.x,c.x),Lu(o,s.y,u.y,l.y,c.y)),n}},{key:"copy",value:function(e){p(b(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e}},{key:"fromJSON",value:function(e){p(b(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new nn).fromArray(r))}return this}}]),n}(_u);Bu.prototype.isSplineCurve=!0;var Vu=Object.freeze({__proto__:null,ArcCurve:Mu,CatmullRomCurve3:Ou,CubicBezierCurve:Iu,CubicBezierCurve3:Nu,EllipseCurve:Su,LineCurve:Du,LineCurve3:function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new mn,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn;return M(this,n),(e=t.call(this)).type="LineCurve3",e.isLineCurve3=!0,e.v1=i,e.v2=r,e}return k(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new mn,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(_u),QuadraticBezierCurve:Fu,QuadraticBezierCurve3:Uu,SplineCurve:Bu}),Hu=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="Path",i.currentPoint=new nn,e&&i.setFromPoints(e),i}return k(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Du(this.currentPoint.clone(),new nn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,i){var r=new Fu(this.currentPoint.clone(),new nn(e,t),new nn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}},{key:"bezierCurveTo",value:function(e,t,n,i,r,a){var o=new Iu(this.currentPoint.clone(),new nn(e,t),new nn(n,i),new nn(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Bu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,i,r,a){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,n,i,r,a),this}},{key:"absarc",value:function(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}},{key:"ellipse",value:function(e,t,n,i,r,a,o,s){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,n,i,r,a,o,s),this}},{key:"absellipse",value:function(e,t,n,i,r,a,o,s){var u=new Su(e,t,n,i,r,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return p(b(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return k(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Du(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=n){var a=i[r]-n,o=this.curves[r],s=o.getLength();return o.getPointAt(0===s?0:1-a/s,t)}r++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a.getPoints(a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t),s=0;s<o.length;s++){var u=o[s];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){p(b(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e}},{key:"fromJSON",value:function(e){p(b(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new Vu[r.type]).fromJSON(r))}return this}}]),n}(_u)),zu=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).uuid=Jt(),i.type="Shape",i.holes=[],i}return k(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){p(b(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e}},{key:"fromJSON",value:function(e){p(b(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new Hu).fromJSON(r))}return this}}]),n}(Hu);function Zu(e,t,n,i,r){var a,o;if(r===function(e,t,n,i){for(var r=0,a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=cl(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=cl(a,e[a],e[a+1],o);return o&&rl(o,o.next)&&(hl(o),o=o.next),o}function Gu(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!rl(i,i.next)&&0!==il(i.prev,i,i.next))i=i.next;else{if(hl(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function ju(e,t,n,i,r,a,o){if(e){!o&&a&&function(e,t,n,i){var r=e;do{null===r.z&&(r.z=$u(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ);t++);for(u=l;s>0||u>0&&i;)0!==s&&(0===u||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,u--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(e,i,r,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?Wu(e,i,r,a):qu(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),hl(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?ju(e=Ju(Gu(e),t,n),t,n,i,r,a,2):2===o&&Yu(e,t,n,i,r,a):ju(Gu(e),t,n,i,r,a,1);break}}}function qu(e){var t=e.prev,n=e,i=e.next;if(il(t,n,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(tl(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&il(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Wu(e,t,n,i){var r=e.prev,a=e,o=e.next;if(il(r,a,o)>=0)return!1;for(var s=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,l=$u(r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,t,n,i),c=$u(s,u,t,n,i),h=e.prevZ,p=e.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==e.prev&&h!==e.next&&tl(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&il(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==e.prev&&p!==e.next&&tl(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&il(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==e.prev&&h!==e.next&&tl(r.x,r.y,a.x,a.y,o.x,o.y,h.x,h.y)&&il(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==e.prev&&p!==e.next&&tl(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&il(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ju(e,t,n){var i=e;do{var r=i.prev,a=i.next.next;!rl(r,a)&&al(r,i,i.next,a)&&ul(r,a)&&ul(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),hl(i),hl(i.next),i=e=a),i=i.next}while(i!==e);return Gu(i)}function Yu(e,t,n,i,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&nl(o,s)){var u=ll(o,s);return o=Gu(o,o.next),u=Gu(u,u.next),ju(o,t,n,i,r,a),void ju(u,t,n,i,r,a)}s=s.next}o=o.next}while(o!==e)}function Xu(e,t){return e.x-t.x}function Qu(e,t){if(t=function(e,t){var n,i=t,r=e.x,a=e.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=r&&s>o){if(o=s,s===r){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(r===o)return n;var u,l=n,c=n.x,h=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=c&&r!==i.x&&tl(a<h?r:o,a,c,h,a<h?o:r,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(r-i.x),ul(i,e)&&(u<p||u===p&&(i.x>n.x||i.x===n.x&&Ku(n,i)))&&(n=i,p=u)),i=i.next}while(i!==l);return n}(e,t)){var n=ll(t,e);Gu(t,t.next),Gu(n,n.next)}}function Ku(e,t){return il(e.prev,e,t.prev)<0&&il(t.next,e,e.next)<0}function $u(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function el(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function tl(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function nl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&al(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(ul(e,t)&&ul(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(il(e.prev,e,t.prev)||il(e,t.prev,t))||rl(e,t)&&il(e.prev,e,e.next)>0&&il(t.prev,t,t.next)>0)}function il(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function rl(e,t){return e.x===t.x&&e.y===t.y}function al(e,t,n,i){var r=sl(il(e,t,n)),a=sl(il(e,t,i)),o=sl(il(n,i,e)),s=sl(il(n,i,t));return r!==a&&o!==s||!(0!==r||!ol(e,n,t))||!(0!==a||!ol(e,i,t))||!(0!==o||!ol(n,e,i))||!(0!==s||!ol(n,t,i))}function ol(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function sl(e){return e>0?1:e<0?-1:0}function ul(e,t){return il(e.prev,e,e.next)<0?il(e,t,e.next)>=0&&il(e,e.prev,t)>=0:il(e,t,e.prev)<0||il(e,e.next,t)<0}function ll(e,t){var n=new pl(e.i,e.x,e.y),i=new pl(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function cl(e,t,n,i){var r=new pl(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function hl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function pl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var dl=function(){function e(){M(this,e)}return k(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],i=[],r=[];fl(e),vl(n,e);var a=e.length;t.forEach(fl);for(var o=0;o<t.length;o++)i.push(a),a+=t[o].length,vl(n,t[o]);for(var s=function(e,t){var n,i,r,a,o,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*l:e.length,p=Zu(e,0,h,l,!0),d=[];if(!p||p.next===p.prev)return d;if(c&&(p=function(e,t,n,i){var r,a,o,s=[];for(r=0,a=t.length;r<a;r++)(o=Zu(e,t[r]*i,r<a-1?t[r+1]*i:e.length,i,!1))===o.next&&(o.steiner=!0),s.push(el(o));for(s.sort(Xu),r=0;r<s.length;r++)Qu(s[r],n),n=Gu(n,n.next);return n}(e,t,p,l)),e.length>80*l){n=r=e[0],i=a=e[1];for(var f=l;f<h;f+=l)(o=e[f])<n&&(n=o),(s=e[f+1])<i&&(i=s),o>r&&(r=o),s>a&&(a=s);u=0!==(u=Math.max(r-n,a-i))?1/u:0}return ju(p,d,l,n,i,u),d}(n,i),u=0;u<s.length;u+=3)r.push(s.slice(u,u+3));return r}}]),e}();function fl(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function vl(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var ml=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zu([new nn(.5,.5),new nn(-.5,.5),new nn(-.5,-.5),new nn(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};M(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:i,options:r},i=Array.isArray(i)?i:[i];for(var a=g(e),o=[],s=[],u=0,l=i.length;u<l;u++)c(i[u]);function c(e){var t=[],n=void 0!==r.curveSegments?r.curveSegments:12,i=void 0!==r.steps?r.steps:1,u=void 0!==r.depth?r.depth:1,l=void 0===r.bevelEnabled||r.bevelEnabled,c=void 0!==r.bevelThickness?r.bevelThickness:.2,h=void 0!==r.bevelSize?r.bevelSize:c-.1,p=void 0!==r.bevelOffset?r.bevelOffset:0,d=void 0!==r.bevelSegments?r.bevelSegments:3,f=r.extrudePath,v=void 0!==r.UVGenerator?r.UVGenerator:gl;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=r.amount);var m,g,y,b,x,w=!1;f&&(m=f.getSpacedPoints(i),w=!0,l=!1,g=f.computeFrenetFrames(i,!1),y=new mn,b=new mn,x=new mn),l||(d=0,c=0,h=0,p=0);var _=e.extractPoints(n),S=_.shape,M=_.holes;if(!dl.isClockWise(S)){S=S.reverse();for(var T=0,k=M.length;T<k;T++){var E=M[T];dl.isClockWise(E)&&(M[T]=E.reverse())}}for(var A=dl.triangulateShape(S,M),C=S,O=0,L=M.length;O<L;O++)S=S.concat(M[O]);function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var P=S.length,I=A.length;function N(e,t,n){var i,r,a,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=o*o+s*s;if(Math.abs(o*l-s*u)>Number.EPSILON){var h=Math.sqrt(c),p=Math.sqrt(u*u+l*l),d=t.x-s/h,f=t.y+o/h,v=((n.x-l/p-d)*l-(n.y+u/p-f)*u)/(o*l-s*u),m=(i=d+o*v-e.x)*i+(r=f+s*v-e.y)*r;if(m<=2)return new nn(i,r);a=Math.sqrt(m/2)}else{var g=!1;o>Number.EPSILON?u>Number.EPSILON&&(g=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(l)&&(g=!0),g?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new nn(i/a,r/a)}for(var D=[],F=0,U=C.length,B=U-1,V=F+1;F<U;F++,B++,V++)B===U&&(B=0),V===U&&(V=0),D[F]=N(C[F],C[B],C[V]);for(var H,z=[],Z=D.concat(),G=0,j=M.length;G<j;G++){var q=M[G];H=[];for(var W=0,J=q.length,Y=J-1,X=W+1;W<J;W++,Y++,X++)Y===J&&(Y=0),X===J&&(X=0),H[W]=N(q[W],q[Y],q[X]);z.push(H),Z=Z.concat(H)}for(var Q=0;Q<d;Q++){for(var K=Q/d,$=c*Math.cos(K*Math.PI/2),ee=h*Math.sin(K*Math.PI/2)+p,te=0,ne=C.length;te<ne;te++){var ie=R(C[te],D[te],ee);Oe(ie.x,ie.y,-$)}for(var re=0,ae=M.length;re<ae;re++){var oe=M[re];H=z[re];for(var se=0,ue=oe.length;se<ue;se++){var le=R(oe[se],H[se],ee);Oe(le.x,le.y,-$)}}}for(var ce=h+p,he=0;he<P;he++){var pe=l?R(S[he],Z[he],ce):S[he];w?(b.copy(g.normals[0]).multiplyScalar(pe.x),y.copy(g.binormals[0]).multiplyScalar(pe.y),x.copy(m[0]).add(b).add(y),Oe(x.x,x.y,x.z)):Oe(pe.x,pe.y,0)}for(var de=1;de<=i;de++)for(var fe=0;fe<P;fe++){var ve=l?R(S[fe],Z[fe],ce):S[fe];w?(b.copy(g.normals[de]).multiplyScalar(ve.x),y.copy(g.binormals[de]).multiplyScalar(ve.y),x.copy(m[de]).add(b).add(y),Oe(x.x,x.y,x.z)):Oe(ve.x,ve.y,u/i*de)}for(var me=d-1;me>=0;me--){for(var ge=me/d,ye=c*Math.cos(ge*Math.PI/2),be=h*Math.sin(ge*Math.PI/2)+p,xe=0,we=C.length;xe<we;xe++){var _e=R(C[xe],D[xe],be);Oe(_e.x,_e.y,u+ye)}for(var Se=0,Me=M.length;Se<Me;Se++){var Te=M[Se];H=z[Se];for(var ke=0,Ee=Te.length;ke<Ee;ke++){var Ae=R(Te[ke],H[ke],be);w?Oe(Ae.x,Ae.y+m[i-1].y,m[i-1].x+ye):Oe(Ae.x,Ae.y,u+ye)}}}function Ce(e,t){for(var n=e.length;--n>=0;){var r=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=i+2*d;o<s;o++){var u=P*o,l=P*(o+1);Re(t+r+u,t+a+u,t+a+l,t+r+l)}}}function Oe(e,n,i){t.push(e),t.push(n),t.push(i)}function Le(e,t,n){Pe(e),Pe(t),Pe(n);var i=o.length/3,r=v.generateTopUV(a,o,i-3,i-2,i-1);Ie(r[0]),Ie(r[1]),Ie(r[2])}function Re(e,t,n,i){Pe(e),Pe(t),Pe(i),Pe(t),Pe(n),Pe(i);var r=o.length/3,s=v.generateSideWallUV(a,o,r-6,r-3,r-2,r-1);Ie(s[0]),Ie(s[1]),Ie(s[3]),Ie(s[1]),Ie(s[2]),Ie(s[3])}function Pe(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Ie(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(l){for(var t=0,n=P*t,r=0;r<I;r++){var s=A[r];Le(s[2]+n,s[1]+n,s[0]+n)}n=P*(t=i+2*d);for(var u=0;u<I;u++){var c=A[u];Le(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<I;h++){var p=A[h];Le(p[2],p[1],p[0])}for(var f=0;f<I;f++){var v=A[f];Le(v[0]+P*i,v[1]+P*i,v[2]+P*i)}}a.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Ce(C,t),t+=C.length;for(var n=0,i=M.length;n<i;n++){var r=M[n];Ce(r,t),t+=r.length}a.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new ji(o,3)),e.setAttribute("uv",new ji(s,2)),e.computeVertexNormals(),e}return k(n,[{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++)n.shapes.push(e[i].uuid);else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++)i.push(t[e.shapes[r]]);var o=e.options.extrudePath;return void 0!==o&&(e.options.extrudePath=(new Vu[o.type]).fromJSON(o)),new n(i,e.options)}}]),n}($i),gl={generateTopUV:function(e,t,n,i,r){var a=t[3*i],o=t[3*i+1],s=t[3*r],u=t[3*r+1];return[new nn(t[3*n],t[3*n+1]),new nn(a,o),new nn(s,u)]},generateSideWallUV:function(e,t,n,i,r,a){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*i],c=t[3*i+1],h=t[3*i+2],p=t[3*r],d=t[3*r+1],f=t[3*r+2],v=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-l)?[new nn(o,1-u),new nn(l,1-h),new nn(p,1-f),new nn(v,1-g)]:[new nn(s,1-u),new nn(c,1-h),new nn(d,1-f),new nn(m,1-g)]}},yl=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new zu([new nn(0,.5),new nn(-.5,-.5),new nn(.5,-.5)]),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;M(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:i,curveSegments:r};var a=[],o=[],s=[],u=[],l=0,c=0;if(!1===Array.isArray(i))p(i);else for(var h=0;h<i.length;h++)p(i[h]),e.addGroup(l,c,h),l+=c,c=0;function p(e){var t=o.length/3,n=e.extractPoints(r),i=n.shape,l=n.holes;!1===dl.isClockWise(i)&&(i=i.reverse());for(var h=0,p=l.length;h<p;h++){var d=l[h];!0===dl.isClockWise(d)&&(l[h]=d.reverse())}for(var f=dl.triangulateShape(i,l),v=0,m=l.length;v<m;v++)i=i.concat(l[v]);for(var g=0,y=i.length;g<y;g++){var b=i[g];o.push(b.x,b.y,0),s.push(0,0,1),u.push(b.x,b.y)}for(var x=0,w=f.length;x<w;x++){var _=f[x];a.push(_[0]+t,_[1]+t,_[2]+t),c+=3}}return e.setIndex(a),e.setAttribute("position",new ji(o,3)),e.setAttribute("normal",new ji(s,3)),e.setAttribute("uv",new ji(u,2)),e}return k(n,[{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,i=e.length;n<i;n++)t.shapes.push(e[n].uuid);else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var i=[],r=0,a=e.shapes.length;r<a;r++)i.push(t[e.shapes[r]]);return new n(i,e.curveSegments)}}]),n}($i),bl=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="ShadowMaterial",i.color=new Ui(0),i.transparent=!0,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this}}]),n}(Li);bl.prototype.isShadowMaterial=!0;var xl=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new Ui(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Ui(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new nn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(Li);xl.prototype.isMeshStandardMaterial=!0;var wl=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).defines={STANDARD:"",PHYSICAL:""},i.type="MeshPhysicalMaterial",i.clearcoatMap=null,i.clearcoatRoughness=0,i.clearcoatRoughnessMap=null,i.clearcoatNormalScale=new nn(1,1),i.clearcoatNormalMap=null,i.ior=1.5,Object.defineProperty(g(i),"reflectivity",{get:function(){return Yt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),i.sheenTint=new Ui(0),i.sheenRoughness=1,i.transmissionMap=null,i.thickness=.01,i.thicknessMap=null,i.attenuationDistance=0,i.attenuationTint=new Ui(1,1,1),i.specularIntensity=1,i.specularIntensityMap=null,i.specularTint=new Ui(1,1,1),i.specularTintMap=null,i._sheen=0,i._clearcoat=0,i._transmission=0,i.setValues(e),i}return k(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenTint.copy(e.sheenTint),this.sheenRoughness=e.sheenRoughness,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationTint.copy(e.attenuationTint),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularTint.copy(e.specularTint),this.specularTintMap=e.specularTintMap,this}}]),n}(xl);wl.prototype.isMeshPhysicalMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshPhongMaterial",i.color=new Ui(16777215),i.specular=new Ui(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Ui(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new nn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}]),n}(Li).prototype.isMeshPhongMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).defines={TOON:""},i.type="MeshToonMaterial",i.color=new Ui(16777215),i.map=null,i.gradientMap=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Ui(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new nn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Li).prototype.isMeshToonMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshNormalMaterial",i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new nn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.flatShading=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(Li).prototype.isMeshNormalMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="MeshLambertMaterial",i.color=new Ui(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Ui(0),i.emissiveIntensity=1,i.emissiveMap=null,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}]),n}(Li).prototype.isMeshLambertMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).defines={MATCAP:""},i.type="MeshMatcapMaterial",i.color=new Ui(16777215),i.matcap=null,i.map=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new nn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.alphaMap=null,i.flatShading=!1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}]),n}(Li).prototype.isMeshMatcapMaterial=!0,function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="LineDashedMaterial",i.scale=1,i.dashSize=3,i.gapSize=1,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(iu).prototype.isLineDashedMaterial=!0;var _l={arraySlice:function(e,t,n){return _l.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),i=0;i!==t;++i)n[i]=i;return n.sort(function(t,n){return e[t]-e[n]}),n},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,u=0;u!==t;++u)r[o++]=e[s+u];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[i])&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[i])&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{void 0!==(o=a[i])&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)}},subclip:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var u=a.tracks[s],l=u.getValueSize(),c=[],h=[],p=0;p<u.times.length;++p){var d=u.times[p]*r;if(!(d<n||d>=i)){c.push(u.times[p]);for(var f=0;f<l;++f)h.push(u.values[p*l+f])}}0!==c.length&&(u.times=_l.convertArray(c,u.times.constructor),u.values=_l.convertArray(h,u.values.constructor),o.push(u))}a.tracks=o;for(var v=1/0,m=0;m<a.tracks.length;++m)v>a.tracks[m].times[0]&&(v=a.tracks[m].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*v);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);for(var r=n.tracks.length,a=t/i,o=function(t){var i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)return"continue";var o=e.tracks.find(function(e){return e.name===i.name&&e.ValueTypeName===r});if(void 0===o)return"continue";var s=0,u=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);var l=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);var h=i.times.length-1,p=void 0;if(a<=i.times[0])p=_l.arraySlice(i.values,s,u-s);else if(a>=i.times[h]){var d=h*u+s;p=_l.arraySlice(i.values,d,d+u-s)}else{var f=i.createInterpolant(),v=s,m=u-s;f.evaluate(a),p=_l.arraySlice(f.resultBuffer,v,m)}"quaternion"===r&&(new vn).fromArray(p).normalize().conjugate().toArray(p);for(var g=o.times.length,y=0;y<g;++y){var b=y*c+l;if("quaternion"===r)vn.multiplyQuaternionsFlat(o.values,b,p,0,o.values,b);else for(var x=c-2*l,w=0;w<x;++w)o.values[b+w]-=p[w]}},s=0;s<r;++s)o(s);return e.blendMode=2501,e}},Sl=function(){function e(t,n,i,r){M(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new n.constructor(i),this.sampleValues=n,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return k(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,e<(i=t[++n]))break t}a=t.length;break n}if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var u=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===u)break;if(i=r,e>=(r=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],void 0===(r=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}();Sl.prototype.beforeStart_=Sl.prototype.copySampleValue_,Sl.prototype.afterEnd_=Sl.prototype.copySampleValue_;var Ml=function(e){d(n,e);var t=v(n);function n(e,i,r,a){var o;return M(this,n),(o=t.call(this,e,i,r,a))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:2400,endingEnd:2400},o}return k(n,[{key:"intervalChanged_",value:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:r=e,o=2*t-n;break;case 2402:o=t+i[r=i.length-2]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case 2401:a=e,s=2*n-t;break;case 2402:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l}},{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(n-t)/(i-t),f=d*d,v=f*d,m=-h*v+2*h*f-h*d,g=(1+h)*v+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*v+(1.5+p)*f+.5*d,b=p*v-p*f,x=0;x!==o;++x)r[x]=m*a[l+x]+g*a[u+x]+y*a[s+x]+b*a[c+x];return r}}]),n}(Sl),Tl=function(e){d(n,e);var t=v(n);function n(e,i,r,a){return M(this,n),t.call(this,e,i,r,a)}return k(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(i-t),c=1-l,h=0;h!==o;++h)r[h]=a[u+h]*c+a[s+h]*l;return r}}]),n}(Sl),kl=function(e){d(n,e);var t=v(n);function n(e,i,r,a){return M(this,n),t.call(this,e,i,r,a)}return k(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(Sl),El=function(){function e(t,n,i,r){if(M(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=_l.convertArray(n,this.TimeBufferType),this.values=_l.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}return k(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new kl(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new Tl(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new Ml(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(r=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=_l.arraySlice(n,r,a),this.values=_l.arraySlice(this.values,r*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&_l.isTypedArray(i))for(var u=0,l=i.length;u!==l;++u){var c=i[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=_l.arraySlice(this.times),t=_l.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),r=e.length-1,a=1,o=1;o<r;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(i)s=!0;else for(var l=o*n,c=l-n,h=l+n,p=0;p!==n;++p){var d=t[l+p];if(d!==t[c+p]||d!==t[h+p]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var f=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[f+m]}++a}}if(r>0){e[a]=e[r];for(var g=r*n,y=a*n,b=0;b!==n;++b)t[y+b]=t[g+b];++a}return a!==e.length?(this.times=_l.arraySlice(e,0,a),this.values=_l.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=_l.arraySlice(this.times,0),t=_l.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:_l.convertArray(e.times,Array),values:_l.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}]),e}();El.prototype.TimeBufferType=Float32Array,El.prototype.ValueBufferType=Float32Array,El.prototype.DefaultInterpolation=2301;var Al=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(El);Al.prototype.ValueTypeName="bool",Al.prototype.ValueBufferType=Array,Al.prototype.DefaultInterpolation=2300,Al.prototype.InterpolantFactoryMethodLinear=void 0,Al.prototype.InterpolantFactoryMethodSmooth=void 0;var Cl=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(El);Cl.prototype.ValueTypeName="color";var Ol=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(El);Ol.prototype.ValueTypeName="number";var Ll=function(e){d(n,e);var t=v(n);function n(e,i,r,a){return M(this,n),t.call(this,e,i,r,a)}return k(n,[{key:"interpolate_",value:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t),u=e*o,l=u+o;u!==l;u+=4)vn.slerpFlat(r,0,a,u-o,a,u,s);return r}}]),n}(Sl),Rl=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return k(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new Ll(this.times,this.values,this.getValueSize(),e)}}]),n}(El);Rl.prototype.ValueTypeName="quaternion",Rl.prototype.DefaultInterpolation=2301,Rl.prototype.InterpolantFactoryMethodSmooth=void 0;var Pl=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(El);Pl.prototype.ValueTypeName="string",Pl.prototype.ValueBufferType=Array,Pl.prototype.DefaultInterpolation=2300,Pl.prototype.InterpolantFactoryMethodLinear=void 0,Pl.prototype.InterpolantFactoryMethodSmooth=void 0;var Il=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return n}(El);Il.prototype.ValueTypeName="vector";var Nl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2500;M(this,e),this.name=t,this.tracks=i,this.duration=n,this.blendMode=r,this.uuid=Jt(),this.duration<0&&this.resetDuration()}return k(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(Dl(n[r]).scale(i));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},r=0,a=n.length;r!==a;++r)t.push(El.toJSON(n[r]));return i}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],u=[];s.push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);var l=_l.getKeyframeOrder(s);s=_l.sortedArray(s,1,l),u=_l.sortedArray(u,1,l),i||0!==s[0]||(s.push(r),u.push(u[0])),a.push(new Ol(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(r);if(u&&u.length>1){var l=u[1],c=i[l];c||(i[l]=c=[]),c.push(s)}}var h=[];for(var p in i)h.push(this.CreateFromMorphTargetSequence(p,i[p],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];_l.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},p=void 0;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(var d=0;d<c[p].morphTargets.length;d++)h[c[p].morphTargets[d]]=-1;for(var f in h){for(var v=[],m=[],g=0;g!==c[p].morphTargets.length;++g){var y=c[p];v.push(y.time),m.push(y.morphTarget===f?1:0)}i.push(new Ol(".morphTargetInfluence["+f+"]",v,m))}s=h.length*(a||1)}else{var b=".bones["+t[l].name+"]";n(Il,b+".position",c,"pos",i),n(Rl,b+".quaternion",c,"rot",i),n(Il,b+".scale",c,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}}]),e}();function Dl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ol;case"vector":case"vector2":case"vector3":case"vector4":return Il;case"color":return Cl;case"quaternion":return Rl;case"bool":case"boolean":return Al;case"string":return Pl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],i=[];_l.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var Fl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ul=new(function(){return function e(t,n,i){M(this,e);var r,a=this,o=!1,s=0,u=0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=i,this.itemStart=function(e){u++,!1===o&&void 0!==a.onStart&&a.onStart(e,s,u),o=!0},this.itemEnd=function(e){s++,void 0!==a.onProgress&&a.onProgress(e,s,u),s===u&&(o=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var i=l[t],r=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return r}return null}}}()),Bl=function(){function e(t){M(this,e),this.manager=void 0!==t?t:Ul,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return k(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise(function(i,r){n.load(e,i,t,r)})}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),Vl={},Hl=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Fl.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;if(void 0===Vl[e]){var o,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var u=s[1],l=!!s[2],c=s[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var h,p=(this.responseType||"").toLowerCase();switch(p){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),f=0;f<c.length;f++)d[f]=c.charCodeAt(f);h="blob"===p?new Blob([d.buffer],{type:u}):d.buffer;break;case"document":var v=new DOMParser;h=v.parseFromString(c,u);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout(function(){t&&t(h),r.manager.itemEnd(e)},0)}catch(t){setTimeout(function(){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{for(var m in Vl[e]=[],Vl[e].push({onLoad:t,onProgress:n,onError:i}),(o=new XMLHttpRequest).open("GET",e,!0),o.addEventListener("load",function(t){var n=this.response,i=Vl[e];if(delete Vl[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Fl.add(e,n);for(var a=0,o=i.length;a<o;a++){var s=i[a];s.onLoad&&s.onLoad(n)}r.manager.itemEnd(e)}else{for(var u=0,l=i.length;u<l;u++){var c=i[u];c.onError&&c.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)}},!1),o.addEventListener("progress",function(t){for(var n=Vl[e],i=0,r=n.length;i<r;i++){var a=n[i];a.onProgress&&a.onProgress(t)}},!1),o.addEventListener("error",function(t){var n=Vl[e];delete Vl[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),o.addEventListener("abort",function(t){var n=Vl[e];delete Vl[e];for(var i=0,a=n.length;i<a;i++){var o=n[i];o.onError&&o.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(m,this.requestHeader[m]);o.send(null)}return r.manager.itemStart(e),o}Vl[e].push({onLoad:t,onProgress:n,onError:i})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(Bl),zl=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Fl.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o=sn("img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),Fl.add(e,this),t&&t(this),r.manager.itemEnd(e)}function u(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}]),n}(Bl),Zl=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){var r=new Er,a=new zl(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],function(e){r.images[n]=e,6===++o&&(r.needsUpdate=!0,t&&t(r))},void 0,i)}for(var u=0;u<e.length;++u)s(u);return r}}]),n}(Bl),Gl=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Js,o=new Hl(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,function(e){var n=r.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:1001,a.wrapT=void 0!==n.wrapT?n.wrapT:1001,a.magFilter=void 0!==n.magFilter?n.magFilter:1006,a.minFilter=void 0!==n.minFilter?n.minFilter:1006,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=1008),1===n.mipmapCount&&(a.minFilter=1006),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))},n,i),a}}]),n}(Bl),jl=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){var r=new cn,a=new zl(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)},n,i),r}}]),n}(Bl),ql=function(e){d(n,e);var t=v(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return M(this,n),(i=t.call(this)).type="Light",i.color=new Ui(e),i.intensity=r,i}return k(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(yi);ql.prototype.isLight=!0,function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this,e,r)).type="HemisphereLight",a.position.copy(yi.DefaultUp),a.updateMatrix(),a.groundColor=new Ui(i),a}return k(n,[{key:"copy",value:function(e){return ql.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}]),n}(ql).prototype.isHemisphereLight=!0;var Wl=new Wn,Jl=new mn,Yl=new mn,Xl=function(){function e(t){M(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nn(512,512),this.map=null,this.mapPass=null,this.matrix=new Wn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Nr,this._frameExtents=new nn(1,1),this._viewportCount=1,this._viewports=[new pn(0,0,1,1)]}return k(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;Jl.setFromMatrixPosition(e.matrixWorld),t.position.copy(Jl),Yl.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Yl),t.updateMatrixWorld(),Wl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Wl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),Ql=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this,new Tr(50,1,.5,500))).focus=1,e}return k(n,[{key:"updateMatrices",value:function(e){var t=this.camera,i=2*Gt*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;i===t.fov&&r===t.aspect&&a===t.far||(t.fov=i,t.aspect=r,t.far=a,t.updateProjectionMatrix()),p(b(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(Xl);Ql.prototype.isSpotLightShadow=!0;var Kl=function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return M(this,n),(r=t.call(this,e,i)).type="SpotLight",r.position.copy(yi.DefaultUp),r.updateMatrix(),r.target=new yi,r.distance=a,r.angle=o,r.penumbra=s,r.decay=u,r.shadow=new Ql,r}return k(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(ql);Kl.prototype.isSpotLight=!0;var $l=new Wn,ec=new mn,tc=new mn,nc=function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this,new Tr(90,1,.5,500)))._frameExtents=new nn(4,2),e._viewportCount=6,e._viewports=[new pn(2,1,1,1),new pn(0,1,1,1),new pn(3,1,1,1),new pn(1,1,1,1),new pn(3,0,1,1),new pn(1,0,1,1)],e._cubeDirections=[new mn(1,0,0),new mn(-1,0,0),new mn(0,0,1),new mn(0,0,-1),new mn(0,1,0),new mn(0,-1,0)],e._cubeUps=[new mn(0,1,0),new mn(0,1,0),new mn(0,1,0),new mn(0,1,0),new mn(0,0,1),new mn(0,0,-1)],e}return k(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),ec.setFromMatrixPosition(e.matrixWorld),n.position.copy(ec),tc.copy(n.position),tc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(tc),n.updateMatrixWorld(),i.makeTranslation(-ec.x,-ec.y,-ec.z),$l.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix($l)}}]),n}(Xl);nc.prototype.isPointLightShadow=!0;var ic=function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return M(this,n),(r=t.call(this,e,i)).type="PointLight",r.distance=a,r.decay=o,r.shadow=new nc,r}return k(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(ql);ic.prototype.isPointLight=!0;var rc=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.call(this,new Jr(-5,5,5,-5,.5,500))}return n}(Xl);rc.prototype.isDirectionalLightShadow=!0;var ac=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this,e,i)).type="DirectionalLight",r.position.copy(yi.DefaultUp),r.updateMatrix(),r.target=new yi,r.shadow=new rc,r}return k(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(ql);ac.prototype.isDirectionalLight=!0,function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this,e,i)).type="AmbientLight",r}return n}(ql).prototype.isAmbientLight=!0,function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return M(this,n),(r=t.call(this,e,i)).type="RectAreaLight",r.width=a,r.height=o,r}return k(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(ql).prototype.isRectAreaLight=!0;var oc=function(){function e(){M(this,e),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new mn)}return k(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}]),e}();oc.prototype.isSphericalHarmonics3=!0;var sc=function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new oc,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return M(this,n),(e=t.call(this,void 0,r)).sh=i,e}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(ql);sc.prototype.isLightProbe=!0;var uc=function(){function e(){M(this,e)}return k(e,null,[{key:"decodeText",value:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}}]),e}();(function(e){d(n,e);var t=v(n);function n(){var e;return M(this,n),(e=t.call(this)).type="InstancedBufferGeometry",e.instanceCount=1/0,e}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=p(b(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n})($i).prototype.isInstancedBufferGeometry=!0;var lc,cc=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),i=t.call(this,e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),i.options={premultiplyAlpha:"none"},i}return k(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,a=Fl.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(n){Fl.add(e,n),t&&t(n),r.manager.itemEnd(e)}).catch(function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}),r.manager.itemStart(e)}}]),n}(Bl);cc.prototype.isImageBitmapLoader=!0;var hc=function(e){d(n,e);var t=v(n);function n(e){return M(this,n),t.call(this,e)}return k(n,[{key:"load",value:function(e,t,n,i){var r=this,a=new Hl(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){try{var a=n.slice(0);(void 0===lc&&(lc=new(window.AudioContext||window.webkitAudioContext)),lc).decodeAudioData(a,function(e){t(e)})}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}},n,i)}}]),n}(Bl);(function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;M(this,n),r=t.call(this,void 0,a);var o=(new Ui).set(e),s=(new Ui).set(i),u=new mn(o.r,o.g,o.b),l=new mn(s.r,s.g,s.b),c=Math.sqrt(Math.PI),h=c*Math.sqrt(.75);return r.sh.coefficients[0].copy(u).add(l).multiplyScalar(c),r.sh.coefficients[1].copy(u).sub(l).multiplyScalar(h),r}return n})(sc).prototype.isHemisphereLightProbe=!0,function(e){d(n,e);var t=v(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;M(this,n),i=t.call(this,void 0,r);var a=(new Ui).set(e);return i.sh.coefficients[0].set(a.r,a.g,a.b).multiplyScalar(2*Math.sqrt(Math.PI)),i}return n}(sc).prototype.isAmbientLightProbe=!0;var pc=function(){function e(t,n,i){var r,a,o;switch(M(this,e),this.binding=t,this.valueSize=i,n){case"quaternion":r=this._slerp,a=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:r=this._lerp,a=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return k(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else a+=t,this._mixBufferRegion(n,r,0,t/a,i);this.cumulativeWeight=a}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1&&this._mixBufferRegion(n,i,t*this._origIndex,1-r,t),a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(var s=t,u=t+t;s!==u;++s)if(n[s]!==n[s+t]){o.setValue(n,i);break}}},{key:"saveOriginalState",value:function(){var e=this.buffer,t=this.valueSize,n=t*this._origIndex;this.binding.getValue(e,n);for(var i=t,r=n;i!==r;++i)e[i]=e[n+i%t];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){this.binding.setValue(this.buffer,3*this.valueSize)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]}},{key:"_slerp",value:function(e,t,n,i){vn.slerpFlat(e,t,e,t,e,n,i)}},{key:"_slerpAdditive",value:function(e,t,n,i,r){var a=this._workIndex*r;vn.multiplyQuaternionsFlat(e,a,e,t,e,n),vn.slerpFlat(e,t,e,t,e,a,i)}},{key:"_lerp",value:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}},{key:"_lerpAdditive",value:function(e,t,n,i,r){for(var a=0;a!==r;++a){var o=t+a;e[o]=e[o]+e[n+a]*i}}}]),e}(),dc=new RegExp("[\\[\\]\\.:\\/]","g"),fc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",vc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),mc=/(WCOD+)?/.source.replace("WCOD",fc),gc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),yc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),bc=new RegExp("^"+vc+mc+gc+yc+"$"),xc=["material","materials","bones"],wc=function(){function e(t,n,i){M(this,e),this.path=n,this.parsedPath=i||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return k(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,i=n.objectName,r=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(i){var o=n.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[r];if(void 0!==u){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(c=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else console.error("THREE.PropertyBinding: Trying to update property for track: "+n.nodeName+"."+r+" but it wasn't found.",t)}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,i){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,i):new e(t,n,i)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(dc,"")}},{key:"parseTrackName",value:function(e){var t=bc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var r=n.nodeName.substring(i+1);-1!==xc.indexOf(r)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var i=function e(n){for(var i=0;i<n.length;i++){var r=n[i];if(r.name===t||r.uuid===t)return r;var a=e(r.children);if(a)return a}return null}(e.children);if(i)return i}return null}}]),e}();wc.Composite=function(){function e(t,n,i){M(this,e);var r=i||wc.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,r)}return k(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._bindings[this._targetGroup.nCachedObjects_];void 0!==n&&n.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),wc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},wc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},wc.prototype.GetterByBindingType=[wc.prototype._getValue_direct,wc.prototype._getValue_array,wc.prototype._getValue_arrayElement,wc.prototype._getValue_toArray],wc.prototype.SetterByBindingTypeAndVersioning=[[wc.prototype._setValue_direct,wc.prototype._setValue_direct_setNeedsUpdate,wc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[wc.prototype._setValue_array,wc.prototype._setValue_array_setNeedsUpdate,wc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[wc.prototype._setValue_arrayElement,wc.prototype._setValue_arrayElement_setNeedsUpdate,wc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[wc.prototype._setValue_fromArray,wc.prototype._setValue_fromArray_setNeedsUpdate,wc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var _c=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;M(this,e),this._mixer=t,this._clip=n,this._localRoot=i,this.blendMode=r;for(var a=n.tracks,o=a.length,s=new Array(o),u={endingStart:2400,endingEnd:2400},l=0;l!==o;++l){var c=a[l].createInterpolant(null);s[l]=c,c.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return k(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=i/r;e.warp(1,r/i,t),this.warp(a,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var i=this._mixer,r=i.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=r,s[1]=r+n,u[0]=e/a,u[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,i){if(this.enabled){var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var u=this._interpolants,l=this._propertyBindings;if(2501===this.blendMode)for(var c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulateAdditive(s);else for(var p=0,d=u.length;p!==d;++p)u[p].evaluate(o),l[p].accumulate(i,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,i=this.time+e,r=this._loopCount,a=2202===n;if(0===e)return-1===r?i:a&&1==(1&r)?t-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){var o=Math.floor(i/t);i-=t*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=i;if(a&&1==(1&r))return t-i}return i}},{key:"_setEndings",value:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=2401,i.endingEnd=2401):(i.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,i.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}},{key:"_scheduleFading",value:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}]),e}(),Sc=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this))._root=e,i._initMemoryManager(),i._accuIndex=0,i.time=0,i.timeScale=1,i}return k(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==r;++c){var h=i[c],p=h.name,d=l[p];if(void 0!==d)a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}++(d=new pc(wc.create(n,p,t&&t._propertyBindings[c].binding.parsedPath),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),a[c]=d}o[c].resultBuffer=d.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0==--r.referenceCount&&this._removeInactiveBinding(r)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_addInactiveBinding",value:function(e,t,n){var i=this._bindingsByRootAndName,r=this._bindings,a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Tl(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}},{key:"clipAction",value:function(e,t,n){var i=t||this._root,r=i.uuid,a="string"==typeof e?Nl.findByName(i,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==a?a.blendMode:2500),void 0!==s){var l=s.actionByRoot[r];if(void 0!==l&&l.blendMode===n)return l;u=s.knownActions[0],null===a&&(a=u._clip)}if(null===a)return null;var c=new _c(this,a,t,n);return this._bindAction(c,u),this._addInactiveAction(c,o,r),c}},{key:"existingAction",value:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?Nl.findByName(n,e):e,a=this._actionsByClip[r?r.uuid:e];return void 0!==a&&a.actionByRoot[i]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){for(var t=this._actions,n=this._nActiveActions,i=this.time+=e*=this.timeScale,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o)t[o]._update(i,e,r,a);for(var s=this._bindings,u=this._nActiveBindings,l=0;l!==u;++l)s[l].apply(a);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(Ht);function Mc(e,t){return e.distance-t.distance}function Tc(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i)for(var r=e.children,a=0,o=r.length;a<o;a++)Tc(r[a],t,n,!0)}Sc.prototype._controlInterpolantsResultBuffer=new Float32Array(1),function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return M(this,n),(r=t.call(this,e,i)).meshPerAttribute=a,r}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=p(b(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=p(b(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(Ss).prototype.isInstancedInterleavedBuffer=!0;var kc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return M(this,e),this.radius=t,this.phi=n,this.theta=i,this}return k(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Yt(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();(function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).material=e,i.render=function(){},i.hasPositions=!1,i.hasNormals=!1,i.hasColors=!1,i.hasUvs=!1,i.positionArray=null,i.normalArray=null,i.colorArray=null,i.uvArray=null,i.count=0,i}return n})(yi).prototype.isImmediateRenderObject=!0;var Ec=new mn,Ac=new Wn,Cc=new Wn;function Oc(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,Oc(e.children[n]));return t}var Lc=new Float32Array(1),Rc=new Int32Array(Lc.buffer),Pc=function(){function e(){M(this,e)}return k(e,null,[{key:"toHalfFloat",value:function(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Lc[0]=e;var t=Rc[0],n=t>>16&32768,i=t>>12&2047,r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&t):r<113?n|=((i|=2048)>>114-r)+(i>>113-r&1):(n|=r-112<<10|i>>1,n+=1&i)}}]),e}();_u.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(_u.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Hu.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},function(e){d(n,e);var t=v(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;M(this,n),a=new Ui(a),o=new Ui(o);for(var s=r/2,u=i/r,l=i/2,c=[],h=[],p=0,d=0,f=-l;p<=r;p++,f+=u){c.push(-l,0,f,l,0,f),c.push(f,0,-l,f,0,l);var v=p===s?a:o;v.toArray(h,d),d+=3,v.toArray(h,d),d+=3,v.toArray(h,d),d+=3,v.toArray(h,d),d+=3}var m=new $i;return m.setAttribute("position",new ji(c,3)),m.setAttribute("color",new ji(h,3)),(e=t.call(this,m,new iu({vertexColors:!0,toneMapped:!1}))).type="GridHelper",e}return n}(pu).prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},function(e){d(n,e);var t=v(n);function n(e){var i;M(this,n);for(var r=Oc(e),a=new $i,o=[],s=[],u=new Ui(0,0,1),l=new Ui(0,1,0),c=0;c<r.length;c++){var h=r[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(u.r,u.g,u.b),s.push(l.r,l.g,l.b))}return a.setAttribute("position",new ji(o,3)),a.setAttribute("color",new ji(s,3)),(i=t.call(this,a,new iu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0}))).type="SkeletonHelper",i.isSkeletonHelper=!0,i.root=e,i.bones=r,i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i}return k(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,i=this.geometry,r=i.getAttribute("position");Cc.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(Ac.multiplyMatrices(Cc,s.matrixWorld),Ec.setFromMatrixPosition(Ac),r.setXYZ(o,Ec.x,Ec.y,Ec.z),Ac.multiplyMatrices(Cc,s.parent.matrixWorld),Ec.setFromMatrixPosition(Ac),r.setXYZ(o+1,Ec.x,Ec.y,Ec.z),o+=2)}i.getAttribute("position").needsUpdate=!0,p(b(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(pu).prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Bl.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),uc.extractUrlBase(e)},Bl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},bn.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},bn.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},bn.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},bn.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},bn.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Un.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Nr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},an.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},an.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},an.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},an.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},an.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},an.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Wn.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Wn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Wn.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new mn).setFromMatrixColumn(this,3)},Wn.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Wn.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Wn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wn.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Wn.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Wn.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wn.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Wn.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Wn.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Wn.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Wn.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Wn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Wn.prototype.makeFrustum=function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)},Wn.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Rr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},vn.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},vn.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},qn.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},qn.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},qn.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Ci.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Ci.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Ci.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Ci.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Ci.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Ci.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ci.getBarycoord(e,t,n,i,r)},Ci.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ci.getNormal(e,t,n,i)},zu.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},zu.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ml(this,e)},zu.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new yl(this,e)},nn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},nn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},nn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},mn.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},mn.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},mn.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},mn.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},mn.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},mn.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},mn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},mn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},mn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},pn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},pn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},yi.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},yi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},yi.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},yi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},yi.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(yi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),gr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(gr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),qs.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Tr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ql.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(zi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),zi.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},zi.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},zi.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},$i.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},$i.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new zi(arguments[1],arguments[2])))},$i.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},$i.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},$i.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},$i.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},$i.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties($i.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Ss.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?35048:35044),this},Ss.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ml.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ml.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ml.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},_s.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Object.defineProperties(Li.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ui}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Sr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),ws.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},ws.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},ws.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},ws.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},ws.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},ws.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},ws.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},ws.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},ws.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},ws.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},ws.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},ws.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},ws.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},ws.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},ws.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},ws.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},ws.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},ws.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},ws.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},ws.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},ws.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},ws.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},ws.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},ws.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},ws.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(ws.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?3001:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(hs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(dn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).type="Audio",i.listener=e,i.context=e.context,i.gain=i.context.createGain(),i.gain.connect(e.getInput()),i.autoplay=!1,i.buffer=null,i.detune=0,i.loop=!1,i.loopStart=0,i.loopEnd=0,i.offset=0,i.duration=void 0,i.playbackRate=1,i.isPlaying=!1,i.hasPlaybackControl=!0,i.source=null,i.sourceType="empty",i._startedAt=0,i._progress=0,i._connected=!1,i.filters=[],i}return k(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(yi).prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new hc).load(e,function(e){t.setBuffer(e)}),this},kr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},kr.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},un.crossOrigin=void 0,un.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new jl;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},un.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Zl;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},un.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},un.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"133"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="133");var Ic=new WeakMap;function Nc(){var e,t;function n(e,t,n,i,r,a){var o=a.num_components(),s=n.num_points()*o,u=s*r.BYTES_PER_ELEMENT,l=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),c=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,a,l,u,c);var h=new r(e.HEAPF32.buffer,c,s).slice();return e._free(c),{name:i,array:h,itemSize:o}}onmessage=function(i){var r=i.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":var a=r.buffer,o=r.taskConfig;t.then(function(e){var t=e.draco,i=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var u=function(e,t,i,r){var a,o,s=r.attributeIDs,u=r.attributeTypes,l=t.GetEncodedGeometryType(i);if(l===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(i,a);else{if(l!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var c={index:null,attributes:[]};for(var h in s){var p=self[u[h]],d=void 0,f=void 0;if(r.useUniqueIDs)f=s[h],d=t.GetAttributeByUniqueId(a,f);else{if(-1===(f=t.GetAttributeId(a,e[s[h]])))continue;d=t.GetAttribute(a,f)}c.attributes.push(n(e,t,a,h,p,d))}return l===e.TRIANGULAR_MESH&&(c.index=function(e,t,n){var i=3*n.num_faces(),r=4*i,a=e._malloc(r);t.GetTrianglesUInt32Array(n,r,a);var o=new Uint32Array(e.HEAPF32.buffer,a,i).slice();return e._free(a),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),c}(t,i,s,o),l=u.attributes.map(function(e){return e.array.buffer});u.index&&l.push(u.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:u},l)}catch(e){console.error(e),self.postMessage({type:"error",id:r.id,error:e.message})}finally{t.destroy(s),t.destroy(i)}})}}}var Dc=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).dracoLoader=null,i.ktx2Loader=null,i.meshoptDecoder=null,i.pluginCallbacks=[],i.register(function(e){return new Hc(e)}),i.register(function(e){return new qc(e)}),i.register(function(e){return new Wc(e)}),i.register(function(e){return new zc(e)}),i.register(function(e){return new Zc(e)}),i.register(function(e){return new Gc(e)}),i.register(function(e){return new jc(e)}),i.register(function(e){return new Bc(e)}),i.register(function(e){return new Jc(e)}),i}return k(n,[{key:"load",value:function(e,t,n,i){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:uc.extractUrlBase(e),this.manager.itemStart(e);var o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new Hl(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){try{a.parse(n,r,function(n){t(n),a.manager.itemEnd(e)},o)}catch(e){o(e)}},n,o)}},{key:"setDRACOLoader",value:function(e){return this.dracoLoader=e,this}},{key:"setDDSLoader",value:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}},{key:"setKTX2Loader",value:function(e){return this.ktx2Loader=e,this}},{key:"setMeshoptDecoder",value:function(e){return this.meshoptDecoder=e,this}},{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n,i){var r,a={},o={};if("string"==typeof e)r=e;else if(uc.decodeText(new Uint8Array(e,0,4))===Yc){try{a[Uc.KHR_BINARY_GLTF]=new Xc(e)}catch(e){return void(i&&i(e))}r=a[Uc.KHR_BINARY_GLTF].content}else r=uc.decodeText(new Uint8Array(e));var s=JSON.parse(r);if(void 0===s.asset||s.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new xh(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var l=0;l<this.pluginCallbacks.length;l++){var c=this.pluginCallbacks[l](u);o[c.name]=c,a[c.name]=!0}if(s.extensionsUsed)for(var h=0;h<s.extensionsUsed.length;++h){var p=s.extensionsUsed[h],d=s.extensionsRequired||[];switch(p){case Uc.KHR_MATERIALS_UNLIT:a[p]=new Vc;break;case Uc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[p]=new eh;break;case Uc.KHR_DRACO_MESH_COMPRESSION:a[p]=new Qc(s,this.dracoLoader);break;case Uc.KHR_TEXTURE_TRANSFORM:a[p]=new Kc;break;case Uc.KHR_MESH_QUANTIZATION:a[p]=new th;break;default:d.indexOf(p)>=0&&void 0===o[p]&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}u.setExtensions(a),u.setPlugins(o),u.parse(n,i)}}}]),n}(Bl);function Fc(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var Uc={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},Bc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}return k(e,[{key:"_markDefs",value:function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var r=t[n];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&e._addNodeRef(this.cache,r.extensions[this.name].light)}}},{key:"_loadLight",value:function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var r,a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new Ui(16777215);void 0!==o.color&&s.fromArray(o.color);var u=void 0!==o.range?o.range:0;switch(o.type){case"directional":(r=new ac(s)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new ic(s)).distance=u;break;case"spot":(r=new Kl(s)).distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,r.angle=o.spot.outerConeAngle,r.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return r.position.set(0,0,0),r.decay=2,void 0!==o.intensity&&(r.intensity=o.intensity),r.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(r),t.cache.add(n,i),i}},{key:"createNodeAttachment",value:function(e){var t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(e){return n._getNodeRef(t.cache,r,e)})}}]),e}(),Vc=function(){function e(){M(this,e),this.name=Uc.KHR_MATERIALS_UNLIT}return k(e,[{key:"getMaterialType",value:function(){return Bi}},{key:"extendParams",value:function(e,t,n){var i=[];e.color=new Ui(1,1,1),e.opacity=1;var r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var a=r.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}void 0!==r.baseColorTexture&&i.push(n.assignTexture(e,"map",r.baseColorTexture))}return Promise.all(i)}}]),e}(),Hc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_MATERIALS_CLEARCOAT}return k(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?wl:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new nn(o,o)}return Promise.all(r)}}]),e}(),zc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_MATERIALS_TRANSMISSION}return k(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?wl:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}]),e}(),Zc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_MATERIALS_VOLUME}return k(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?wl:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&r.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;var o=a.attenuationColor||[1,1,1];return t.attenuationTint=new Ui(o[0],o[1],o[2]),Promise.all(r)}}]),e}(),Gc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_MATERIALS_IOR}return k(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?wl:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}]),e}(),jc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_MATERIALS_SPECULAR}return k(e,[{key:"getMaterialType",value:function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?wl:null}},{key:"extendMaterialParams",value:function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var r=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&r.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));var o=a.specularColorFactor||[1,1,1];return t.specularTint=new Ui(o[0],o[1],o[2]),void 0!==a.specularColorTexture&&r.push(n.assignTexture(t,"specularTintMap",a.specularColorTexture).then(function(e){e.encoding=3001})),Promise.all(r)}}]),e}(),qc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.KHR_TEXTURE_BASISU}return k(e,[{key:"loadTexture",value:function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var r=n.images[i.extensions[this.name].source],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,a)}}]),e}(),Wc=function(){function e(t){M(this,e),this.parser=t,this.name=Uc.EXT_TEXTURE_WEBP,this.isSupported=null}return k(e,[{key:"loadTexture",value:function(e){var t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;var a=i.images[r.extensions[t].source],o=n.textureLoader;if(a.uri){var s=n.options.manager.getHandler(a.uri);null!==s&&(o=s)}return this.detectSupport().then(function(r){if(r)return n.loadTextureImage(e,a,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}},{key:"detectSupport",value:function(){return this.isSupported||(this.isSupported=new Promise(function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}]),e}(),Jc=function(){function e(t){M(this,e),this.name=Uc.EXT_MESHOPT_COMPRESSION,this.parser=t}return k(e,[{key:"loadBufferView",value:function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],r=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,a.ready]).then(function(e){var t=i.byteOffset||0,n=i.byteLength||0,r=i.count,o=i.byteStride,s=new ArrayBuffer(r*o),u=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),r,o,u,i.mode,i.filter),s})}return null}}]),e}(),Yc="glTF",Xc=function e(t){M(this,e),this.name=Uc.KHR_BINARY_GLTF,this.content=null,this.body=null;var n=new DataView(t,0,12);if(this.header={magic:uc.decodeText(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Yc)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,r=new DataView(t,12),a=0;a<i;){var o=r.getUint32(a,!0);a+=4;var s=r.getUint32(a,!0);if(a+=4,1313821514===s){var u=new Uint8Array(t,12+a,o);this.content=uc.decodeText(u)}else if(5130562===s){var l=12+a;this.body=t.slice(l,l+o)}a+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")},Qc=function(){function e(t,n){if(M(this,e),!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Uc.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}return k(e,[{key:"decodePrimitive",value:function(e,t){var n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},u={};for(var l in a){var c=lh[l]||l.toLowerCase();o[c]=a[l]}for(var h in e.attributes){var p=lh[h]||h.toLowerCase();if(void 0!==a[h]){var d=n.accessors[e.attributes[h]];u[p]=ah[d.componentType],s[p]=!0===d.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(t){i.decodeDracoFile(e,function(e){for(var n in e.attributes){var i=e.attributes[n],r=s[n];void 0!==r&&(i.normalized=r)}t(e)},o,u)})})}}]),e}(),Kc=function(){function e(){M(this,e),this.name=Uc.KHR_TEXTURE_TRANSFORM}return k(e,[{key:"extendTexture",value:function(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}]),e}(),$c=function(e){d(n,e);var t=v(n);function n(e){var i;M(this,n),(i=t.call(this)).isGLTFSpecularGlossinessMaterial=!0;var r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),a=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),u=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),l={specular:{value:(new Ui).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return i._extraUniforms=l,i.onBeforeCompile=function(e){for(var t in l)e.uniforms[t]=l[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",a).replace("#include <roughnessmap_fragment>",o).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",u)},Object.defineProperties(g(i),{specular:{get:function(){return l.specular.value},set:function(e){l.specular.value=e}},specularMap:{get:function(){return l.specularMap.value},set:function(e){l.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return l.glossiness.value},set:function(e){l.glossiness.value=e}},glossinessMap:{get:function(){return l.glossinessMap.value},set:function(e){l.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete i.metalness,delete i.roughness,delete i.metalnessMap,delete i.roughnessMap,i.setValues(e),i}return k(n,[{key:"copy",value:function(e){return p(b(n.prototype),"copy",this).call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}]),n}(xl),eh=function(){function e(){M(this,e),this.name=Uc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}return k(e,[{key:"getMaterialType",value:function(){return $c}},{key:"extendParams",value:function(e,t,n){var i=t.extensions[this.name];e.color=new Ui(1,1,1),e.opacity=1;var r=[];if(Array.isArray(i.diffuseFactor)){var a=i.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(void 0!==i.diffuseTexture&&r.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new Ui(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new Ui(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var o=i.specularGlossinessTexture;r.push(n.assignTexture(e,"glossinessMap",o)),r.push(n.assignTexture(e,"specularMap",o))}return Promise.all(r)}},{key:"createMaterial",value:function(e){var t=new $c(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}]),e}(),th=function e(){M(this,e),this.name=Uc.KHR_MESH_QUANTIZATION},nh=function(e){d(n,e);var t=v(n);function n(e,i,r,a){return M(this,n),t.call(this,e,i,r,a)}return k(n,[{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i,a=0;a!==i;a++)t[a]=n[r+a];return t}}]),n}(Sl);nh.prototype.beforeStart_=nh.prototype.copySampleValue_,nh.prototype.afterEnd_=nh.prototype.copySampleValue_,nh.prototype.interpolate_=function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,u=3*o,l=i-t,c=(n-t)/l,h=c*c,p=h*c,d=e*u,f=d-u,v=-2*p+3*h,m=p-h,g=1-v,y=m-h+c,b=0;b!==o;b++)r[b]=g*a[f+b+o]+y*(a[f+b+s]*l)+v*a[d+b+o]+m*(a[d+b]*l);return r};var ih=new vn,rh=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return k(n,[{key:"interpolate_",value:function(e,t,i,r){var a=p(b(n.prototype),"interpolate_",this).call(this,e,t,i,r);return ih.fromArray(a).normalize().toArray(a),a}}]),n}(nh),ah={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},oh={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},sh={33071:1001,33648:1002,10497:1e3},uh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lh={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ch={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},hh={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300};function ph(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function dh(e){return void 0===e.DefaultMaterial&&(e.DefaultMaterial=new xl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),e.DefaultMaterial}function fh(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function vh(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function mh(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(var a=0,o=r.length;a<o;a++)e.morphTargetDictionary[r[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function gh(e){var t=e.extensions&&e.extensions[Uc.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+yh(t.attributes):e.indices+":"+yh(e.attributes)+":"+e.mode}function yh(e){for(var t="",n=Object.keys(e).sort(),i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function bh(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var xh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};M(this,e),this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Fc,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},this.textureLoader="undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?new cc(this.options.manager):new jl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}return k(e,[{key:"setExtensions",value:function(e){this.extensions=e}},{key:"setPlugins",value:function(e){this.plugins=e}},{key:"parse",value:function(e,t){var n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(t){var a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};fh(r,a,i),vh(a,i),Promise.all(n._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){e(a)})}).catch(t)}},{key:"_markDefs",value:function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,r=t.length;i<r;i++)for(var a=t[i].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var u=0,l=e.length;u<l;u++){var c=e[u];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}}},{key:"_addNodeRef",value:function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}},{key:"_getNodeRef",value:function(e,t,n){var i=this;if(e.refs[t]<=1)return n;var a=n.clone();return function e(t,n){var a=i.associations.get(t);null!=a&&i.associations.set(n,a);var o,s=x(t.children.entries());try{for(s.s();!(o=s.n()).done;){var u=r(o.value,2),l=u[0];e(u[1],n.children[l])}}catch(c){s.e(c)}finally{s.f()}}(n,a),a.name+="_instance_"+e.uses[t]++,a}},{key:"_invokeOne",value:function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}return null}},{key:"_invokeAll",value:function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var r=e(t[i]);r&&n.push(r)}return n}},{key:"getDependency",value:function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}},{key:"getDependencies",value:function(e){var t=this.cache.get(e);if(!t){var n=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}},{key:"loadBuffer",value:function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[Uc.KHR_BINARY_GLTF].body);var i=this.options;return new Promise(function(e,r){n.load(ph(t.uri,i.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}},{key:"loadBufferView",value:function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var n=t.byteOffset||0;return e.slice(n,n+(t.byteLength||0))})}},{key:"loadAccessor",value:function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var r=[];return r.push(void 0!==i.bufferView?this.getDependency("bufferView",i.bufferView):null),void 0!==i.sparse&&(r.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(r).then(function(e){var r,a,o=e[0],s=uh[i.type],u=ah[i.componentType],l=u.BYTES_PER_ELEMENT,c=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(h&&h!==l*s){var d=Math.floor(c/h),f="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+d+":"+i.count,v=t.cache.get(f);v||(r=new u(o,d*h,i.count*h/l),v=new Ss(r,h/l),t.cache.add(f,v)),a=new Ts(v,s,c%h/l,p)}else r=null===o?new u(i.count*s):new u(o,c,i.count*s),a=new zi(r,s,p);if(void 0!==i.sparse){var m=i.sparse.values.byteOffset||0,g=new(0,ah[i.sparse.indices.componentType])(e[1],i.sparse.indices.byteOffset||0,i.sparse.count*uh.SCALAR),y=new u(e[2],m,i.sparse.count*s);null!==o&&(a=new zi(a.array.slice(),a.itemSize,a.normalized));for(var b=0,x=g.length;b<x;b++){var w=g[b];if(a.setX(w,y[b*s]),s>=2&&a.setY(w,y[b*s+1]),s>=3&&a.setZ(w,y[b*s+2]),s>=4&&a.setW(w,y[b*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})}},{key:"loadTexture",value:function(e){var t=this.json,n=t.images[t.textures[e].source],i=this.textureLoader;if(n.uri){var r=this.options.manager.getHandler(n.uri);null!==r&&(i=r)}return this.loadTextureImage(e,n,i)}},{key:"loadTextureImage",value:function(e,t,n){var i=this,r=this.json,a=this.options,o=r.textures[e],s=(t.uri||t.bufferView)+":"+o.sampler;if(this.textureCache[s])return this.textureCache[s];var u=self.URL||self.webkitURL,l=t.uri||"",c=!1;if(void 0!==t.bufferView)l=i.getDependency("bufferView",t.bufferView).then(function(e){c=!0;var n=new Blob([e],{type:t.mimeType});return l=u.createObjectURL(n)});else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");var h=Promise.resolve(l).then(function(e){return new Promise(function(t,i){var r=t;!0===n.isImageBitmapLoader&&(r=function(e){var n=new cn(e);n.needsUpdate=!0,t(n)}),n.load(ph(e,a.path),r,void 0,i)})}).then(function(t){!0===c&&u.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name);var n=(r.samplers||{})[o.sampler]||{};return t.magFilter=oh[n.magFilter]||1006,t.minFilter=oh[n.minFilter]||1008,t.wrapS=sh[n.wrapS]||1e3,t.wrapT=sh[n.wrapT]||1e3,i.associations.set(t,{textures:e}),t}).catch(function(){return console.error("THREE.GLTFLoader: Couldn't load texture",l),null});return this.textureCache[s]=h,h}},{key:"assignTexture",value:function(e,t,n){var i=this;return this.getDependency("texture",n.index).then(function(r){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[Uc.KHR_TEXTURE_TRANSFORM]){var a=void 0!==n.extensions?n.extensions[Uc.KHR_TEXTURE_TRANSFORM]:void 0;if(a){var o=i.associations.get(r);r=i.extensions[Uc.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,o)}}return e[t]=r,r})}},{key:"assignFinalMaterial",value:function(e){var t=e.geometry,n=e.material,i=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){var o="PointsMaterial:"+n.uuid,s=this.cache.get(o);s||(s=new fu,Li.prototype.copy.call(s,n),s.color.copy(n.color),s.map=n.map,s.sizeAttenuation=!1,this.cache.add(o,s)),n=s}else if(e.isLine){var u="LineBasicMaterial:"+n.uuid,l=this.cache.get(u);l||(l=new iu,Li.prototype.copy.call(l,n),l.color.copy(n.color),this.cache.add(u,l)),n=l}if(i||r||a){var c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),i&&(c+="derivative-tangents:"),r&&(c+="vertex-colors:"),a&&(c+="flat-shading:");var h=this.cache.get(c);h||(h=n.clone(),r&&(h.vertexColors=!0),a&&(h.flatShading=!0),i&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(c,h),this.associations.set(h,this.associations.get(n))),n=h}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}},{key:"getMaterialType",value:function(){return xl}},{key:"loadMaterial",value:function(e){var t,n=this,i=this.extensions,r=this.json.materials[e],a={},o=r.extensions||{},s=[];if(o[Uc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=i[Uc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=u.getMaterialType(),s.push(u.extendParams(a,r,n))}else if(o[Uc.KHR_MATERIALS_UNLIT]){var l=i[Uc.KHR_MATERIALS_UNLIT];t=l.getMaterialType(),s.push(l.extendParams(a,r,n))}else{var c=r.pbrMetallicRoughness||{};if(a.color=new Ui(1,1,1),a.opacity=1,Array.isArray(c.baseColorFactor)){var h=c.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}void 0!==c.baseColorTexture&&s.push(n.assignTexture(a,"map",c.baseColorTexture)),a.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,a.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture&&(s.push(n.assignTexture(a,"metalnessMap",c.metallicRoughnessTexture)),s.push(n.assignTexture(a,"roughnessMap",c.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),s.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)})))}!0===r.doubleSided&&(a.side=2);var p=r.alphaMode||"OPAQUE";if("BLEND"===p?(a.transparent=!0,a.depthWrite=!1):(a.format=1022,a.transparent=!1,"MASK"===p&&(a.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&t!==Bi&&(s.push(n.assignTexture(a,"normalMap",r.normalTexture)),a.normalScale=new nn(1,1),void 0!==r.normalTexture.scale)){var d=r.normalTexture.scale;a.normalScale.set(d,d)}return void 0!==r.occlusionTexture&&t!==Bi&&(s.push(n.assignTexture(a,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(a.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&t!==Bi&&(a.emissive=(new Ui).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&t!==Bi&&s.push(n.assignTexture(a,"emissiveMap",r.emissiveTexture)),Promise.all(s).then(function(){var o;return o=t===$c?i[Uc.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),r.name&&(o.name=r.name),o.map&&(o.map.encoding=3001),o.emissiveMap&&(o.emissiveMap.encoding=3001),vh(o,r),n.associations.set(o,{materials:e}),r.extensions&&fh(i,o,r),o})}},{key:"createUniqueName",value:function(e){for(var t=wc.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n}},{key:"loadGeometries",value:function(e){var t=this,n=this.extensions,i=this.primitiveCache;function r(e){return n[Uc.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(n){return _h(n,e,t)})}for(var a=[],o=0,s=e.length;o<s;o++){var u=e[o],l=gh(u),c=i[l];if(c)a.push(c.promise);else{var h;h=u.extensions&&u.extensions[Uc.KHR_DRACO_MESH_COMPRESSION]?r(u):_h(new $i,u,t),i[l]={primitive:u,promise:h},a.push(h)}}return Promise.all(a)}},{key:"loadMesh",value:function(e){for(var t=this,n=this.extensions,i=this.json.meshes[e],r=i.primitives,a=[],o=0,s=r.length;o<s;o++){var u=void 0===r[o].material?dh(this.cache):this.getDependency("material",r[o].material);a.push(u)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(a){for(var o=a.slice(0,a.length-1),s=a[a.length-1],u=[],l=0,c=s.length;l<c;l++){var h=s[l],p=r[l],d=void 0,f=o[l];if(4===p.mode||5===p.mode||6===p.mode||void 0===p.mode)!0!==(d=!0===i.isSkinnedMesh?new qs(h,f):new gr(h,f)).isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),5===p.mode?d.geometry=Sh(d.geometry,1):6===p.mode&&(d.geometry=Sh(d.geometry,2));else if(1===p.mode)d=new pu(h,f);else if(3===p.mode)d=new lu(h,f);else if(2===p.mode)d=new du(h,f);else{if(0!==p.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);d=new bu(h,f)}Object.keys(d.geometry.morphAttributes).length>0&&mh(d,i),d.name=t.createUniqueName(i.name||"mesh_"+e),vh(d,i),p.extensions&&fh(n,d,p),t.assignFinalMaterial(d),u.push(d)}for(var v=0,m=u.length;v<m;v++)t.associations.set(u[v],{meshes:e,primitives:v});if(1===u.length)return u[0];var g=new ms;t.associations.set(g,{meshes:e});for(var y=0,b=u.length;y<b;y++)g.add(u[y]);return g})}},{key:"loadCamera",value:function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Tr(tn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Jr(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),vh(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}},{key:"loadSkin",value:function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return n.inverseBindMatrices=e,n})}},{key:"loadAnimation",value:function(e){for(var t=this.json.animations[e],n=[],i=[],r=[],a=[],o=[],s=0,u=t.channels.length;s<u;s++){var l=t.channels[s],c=t.samplers[l.sampler],h=l.target,p=void 0!==t.parameters?t.parameters[c.input]:c.input,d=void 0!==t.parameters?t.parameters[c.output]:c.output;n.push(this.getDependency("node",void 0!==h.node?h.node:h.id)),i.push(this.getDependency("accessor",p)),r.push(this.getDependency("accessor",d)),a.push(c),o.push(h)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(o)]).then(function(n){for(var i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=[],l=function(e,t){var n=i[e],l=r[e],c=a[e],h=o[e],p=s[e];if(void 0===n)return"continue";var d=void 0;switch(n.updateMatrix(),n.matrixAutoUpdate=!0,ch[p.path]){case ch.weights:d=Ol;break;case ch.rotation:d=Rl;break;default:d=Il}var f=n.name?n.name:n.uuid,v=void 0!==h.interpolation?hh[h.interpolation]:2301,m=[];ch[p.path]===ch.weights?n.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)}):m.push(f);var g=c.array;if(c.normalized){for(var y=bh(g.constructor),b=new Float32Array(g.length),x=0,w=g.length;x<w;x++)b[x]=g[x]*y;g=b}for(var _=0,S=m.length;_<S;_++){var M=new d(m[_]+"."+ch[p.path],l.array,g,v);"CUBICSPLINE"===h.interpolation&&(M.createInterpolant=function(e){return new(this instanceof Rl?rh:nh)(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(M)}},c=0,h=i.length;c<h;c++)l(c);return new Nl(t.name?t.name:"animation_"+e,void 0,u)})}},{key:"createNodeMesh",value:function(e){var t=this,n=this.json.nodes[e];return void 0===n.mesh?null:t.getDependency("mesh",n.mesh).then(function(e){var i=t._getNodeRef(t.meshCache,n.mesh,e);return void 0!==n.weights&&i.traverse(function(e){if(e.isMesh)for(var t=0,i=n.weights.length;t<i;t++)e.morphTargetInfluences[t]=n.weights[t]}),i})}},{key:"loadNode",value:function(e){var t=this.extensions,n=this,i=this.json.nodes[e],r=i.name?n.createUniqueName(i.name):"";return function(){var t=[],r=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return r&&t.push(r),void 0!==i.camera&&t.push(n.getDependency("camera",i.camera).then(function(e){return n._getNodeRef(n.cameraCache,i.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){t.push(e)}),Promise.all(t)}().then(function(a){var o;if((o=!0===i.isBone?new Ws:a.length>1?new ms:1===a.length?a[0]:new yi)!==a[0])for(var s=0,u=a.length;s<u;s++)o.add(a[s]);if(i.name&&(o.userData.name=i.name,o.name=r),vh(o,i),i.extensions&&fh(t,o,i),void 0!==i.matrix){var l=new Wn;l.fromArray(i.matrix),o.applyMatrix4(l)}else void 0!==i.translation&&o.position.fromArray(i.translation),void 0!==i.rotation&&o.quaternion.fromArray(i.rotation),void 0!==i.scale&&o.scale.fromArray(i.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o})}},{key:"loadScene",value:function(e){var t=this.json,n=this.extensions,i=this.json.scenes[e],a=this,o=new ms;i.name&&(o.name=a.createUniqueName(i.name)),vh(o,i),i.extensions&&fh(n,o,i);for(var s=i.nodes||[],u=[],l=0,c=s.length;l<c;l++)u.push(wh(s[l],o,t,a));return Promise.all(u).then(function(){return a.associations=function(e){var t,n=new Map,i=x(a.associations);try{for(i.s();!(t=i.n()).done;){var o=r(t.value,2),s=o[0],u=o[1];(s instanceof Li||s instanceof cn)&&n.set(s,u)}}catch(l){i.e(l)}finally{i.f()}return e.traverse(function(e){var t=a.associations.get(e);null!=t&&n.set(e,t)}),n}(o),o})}}]),e}();function wh(e,t,n,i){var r=n.nodes[e];return i.getDependency("node",e).then(function(e){return void 0===r.skin?e:i.getDependency("skin",r.skin).then(function(e){for(var n=[],r=0,a=(t=e).joints.length;r<a;r++)n.push(i.getDependency("node",t.joints[r]));return Promise.all(n)}).then(function(n){return e.traverse(function(e){if(e.isMesh){for(var i=[],r=[],a=0,o=n.length;a<o;a++){var s=n[a];if(s){i.push(s);var u=new Wn;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*a),r.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}e.bind(new Qs(i,r),e.matrixWorld)}}),e});var t}).then(function(e){t.add(e);var a=[];if(r.children)for(var o=r.children,s=0,u=o.length;s<u;s++)a.push(wh(o[s],e,n,i));return Promise.all(a)})}function _h(e,t,n){var i=t.attributes,r=[];function a(t,i){return n.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}for(var o in i){var s=lh[o]||o.toLowerCase();s in e.attributes||r.push(a(i[o],s))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});r.push(u)}return vh(e,t),function(e,t,n){var i=t.attributes,r=new bn;if(void 0!==i.POSITION){var a=n.json.accessors[i.POSITION],o=a.min,s=a.max;if(void 0!==o&&void 0!==s){if(r.set(new mn(o[0],o[1],o[2]),new mn(s[0],s[1],s[2])),a.normalized){var u=bh(ah[a.componentType]);r.min.multiplyScalar(u),r.max.multiplyScalar(u)}var l=t.targets;if(void 0!==l){for(var c=new mn,h=new mn,p=0,d=l.length;p<d;p++){var f=l[p];if(void 0!==f.POSITION){var v=n.json.accessors[f.POSITION],m=v.min,g=v.max;if(void 0!==m&&void 0!==g){if(h.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),h.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),h.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),v.normalized){var y=bh(ah[v.componentType]);h.multiplyScalar(y)}c.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}e.boundingBox=r;var b=new Un;r.getCenter(b.center),b.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=b}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(r).then(function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,r=!1,a=0,o=t.length;a<o;a++){var s=t[a];if(void 0!==s.POSITION&&(i=!0),void 0!==s.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(e);for(var u=[],l=[],c=0,h=t.length;c<h;c++){var p=t[c];if(i){var d=void 0!==p.POSITION?n.getDependency("accessor",p.POSITION):e.attributes.position;u.push(d)}if(r){var f=void 0!==p.NORMAL?n.getDependency("accessor",p.NORMAL):e.attributes.normal;l.push(f)}}return Promise.all([Promise.all(u),Promise.all(l)]).then(function(t){var n=t[1];return i&&(e.morphAttributes.position=t[0]),r&&(e.morphAttributes.normal=n),e.morphTargetsRelative=!0,e})}(e,t.targets,n):e})}function Sh(e,t){var n=e.getIndex();if(null===n){var i=[],r=e.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var a=0;a<r.count;a++)i.push(a);e.setIndex(i),n=e.getIndex()}var o=n.count-2,s=[];if(2===t)for(var u=1;u<=o;u++)s.push(n.getX(0)),s.push(n.getX(u)),s.push(n.getX(u+1));else for(var l=0;l<o;l++)l%2==0?(s.push(n.getX(l)),s.push(n.getX(l+1)),s.push(n.getX(l+2))):(s.push(n.getX(l+2)),s.push(n.getX(l+1)),s.push(n.getX(l)));s.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var c=e.clone();return c.setIndex(s),c}var Mh,Th,kh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;M(this,e),this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}return k(e,[{key:"_initWorker",value:function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}},{key:"_getIdleWorker",value:function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}},{key:"_onMessage",value:function(e,t){var n=this.workersResolve[e];if(n&&n(t),this.queue.length){var i=this.queue.shift(),r=i.resolve,a=i.msg,o=i.transfer;this.workersResolve[e]=r,this.workers[e].postMessage(a,o)}else this.workerStatus^=1<<e}},{key:"setWorkerCreator",value:function(e){this.workerCreator=e}},{key:"setWorkerLimit",value:function(e){this.pool=e}},{key:"postMessage",value:function(e,t){var n=this;return new Promise(function(i){var r=n._getIdleWorker();-1!==r?(n._initWorker(r),n.workerStatus|=1<<r,n.workersResolve[r]=i,n.workers[r].postMessage(e,t)):n.queue.push({resolve:i,msg:e,transfer:t})})}},{key:"dispose",value:function(){this.workers.forEach(function(e){return e.terminate()}),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}]),e}(),Eh=new WeakMap,Ah=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).transcoderPath="",i.transcoderBinary=null,i.transcoderPending=null,i.workerPool=new kh,i.workerSourceURL="",i.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.'),i}return k(n,[{key:"setTranscoderPath",value:function(e){return this.transcoderPath=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerPool.setWorkerLimit(e),this}},{key:"detectSupport",value:function(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}},{key:"dispose",value:function(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),this}},{key:"init",value:function(){var e=this;if(!this.transcoderPending){var t=new Hl(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);var i=t.loadAsync("basis_transcoder.js"),a=new Hl(this.manager);a.setPath(this.transcoderPath),a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);var o=a.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,o]).then(function(t){var i=r(t,2),a=i[0],o=i[1],s=n.BasisWorker.toString(),u=["/* constants */","let _EngineFormat = "+JSON.stringify(n.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(n.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(n.BasisFormat),"/* basis_transcoder.js */",a,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([u])),e.transcoderBinary=o,e.workerPool.setWorkerCreator(function(){var t=new Worker(e.workerSourceURL),n=e.transcoderBinary.slice(0);return t.postMessage({type:"init",config:e.workerConfig,transcoderBinary:n},[n]),t})})}return this.transcoderPending}},{key:"load",value:function(e,t,n,i){var r=this;if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");var a=new Hl(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);var o=new wu;return a.load(e,function(e){if(Eh.has(e))return Eh.get(e).promise.then(t).catch(i);r._createTexture([e]).then(function(e){o.copy(e),o.needsUpdate=!0,t&&t(o)}).catch(i)},n,i),o}},{key:"_createTextureFrom",value:function(e){var t=e.mipmaps,n=e.width,i=e.height,r=e.format,a=e.type,o=e.error,s=e.dfdTransferFn,u=e.dfdFlags;if("error"===a)return Promise.reject(o);var l=new wu(t,n,i,r,1009);return l.minFilter=1===t.length?1006:1008,l.magFilter=1006,l.generateMipmaps=!1,l.needsUpdate=!0,l.encoding=2===s?3001:3e3,l.premultiplyAlpha=!!(1&u),l}},{key:"_createTexture",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n,r=this.init().then(function(){return t.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:i},e)}).then(function(e){return t._createTextureFrom(e.data)});return Eh.set(e[0],{promise:r}),r}}]),n}(Bl);Ah.BasisFormat={ETC1S:0,UASTC_4x4:1},Ah.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ah.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Ah.BasisWorker=function(){var e,t,n,i=_EngineFormat,r=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(o){var c,h=o.data;switch(h.type){case"init":e=h.config,c=h.transcoderBinary,t=new Promise(function(e){n={wasmBinary:c,onRuntimeInitialized:e},BASIS(n)}).then(function(){n.initializeBasis(),void 0===n.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(function(){try{for(var t=function(t){var o=new n.KTX2File(new Uint8Array(t));function c(){o.close(),o.delete()}if(!o.isValid())throw c(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");var h=o.isUASTC()?a.UASTC_4x4:a.ETC1S,p=o.getWidth(),d=o.getHeight(),f=o.getLevels(),v=o.getHasAlpha(),m=o.getDFDTransferFunc(),g=o.getDFDFlags(),y=function(t,n,o,c){for(var h=t===a.ETC1S?s:u,p=0;p<h.length;p++){var d=h[p];if(e[d.if]&&d.basisFormat.includes(t)&&(!d.needsPowerOfTwo||l(n)&&l(o)))return{transcoderFormat:d.transcoderFormat[c?1:0],engineFormat:d.engineFormat[c?1:0]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:r.RGBA32,engineFormat:i.RGBAFormat}}(h,p,d,v),b=y.transcoderFormat,x=y.engineFormat;if(!p||!d||!f)throw c(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw c(),new Error("THREE.KTX2Loader: .startTranscoding failed");for(var w=[],_=0;_<f;_++){var S=o.getImageLevelInfo(_,0,0),M=S.origWidth,T=S.origHeight,k=new Uint8Array(o.getImageTranscodedSizeInBytes(_,0,0,b));if(!o.transcodeImage(k,_,0,0,b,0,-1,-1))throw c(),new Error("THREE.KTX2Loader: .transcodeImage failed.");w.push({data:k,width:M,height:T})}return c(),{width:p,height:d,hasAlpha:v,mipmaps:w,format:x,dfdTransferFn:m,dfdFlags:g}}(h.buffers[0]),o=t.width,c=t.height,p=t.hasAlpha,d=t.mipmaps,f=t.format,v=t.dfdTransferFn,m=t.dfdFlags,g=[],y=0;y<d.length;++y)g.push(d[y].data.buffer);self.postMessage({type:"transcode",id:h.id,width:o,height:c,hasAlpha:p,mipmaps:d,format:f,dfdTransferFn:v,dfdFlags:m},g)}catch(e){console.error(e),self.postMessage({type:"error",id:h.id,error:e.message})}})}});var o=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC1],engineFormat:[i.RGB_ETC1_Format,i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),u=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function l(e){return e<=2||0==(e&e-1)&&0!==e}};var Ch,Oh,Lh,Rh,Ph,Ih,Nh=Symbol("retainerCount"),Dh=Symbol("recentlyUsed"),Fh=Symbol("evict"),Uh=Symbol("evictionThreshold"),Bh=Symbol("cache"),Vh=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;M(this,t),this[Mh]=new Map,this[Th]=[],this[Bh]=e,this[Uh]=n}return k(t,[{key:"evictionThreshold",get:function(){return this[Uh]},set:function(e){this[Uh]=e,this[Fh]()}},{key:"cache",get:function(){return this[Bh]}},{key:"retainerCount",value:function(e){return this[Nh].get(e)||0}},{key:"reset",value:function(){this[Nh].clear(),this[Dh]=[]}},{key:"retain",value:function(e){this[Nh].has(e)||this[Nh].set(e,0),this[Nh].set(e,this[Nh].get(e)+1);var t=this[Dh].indexOf(e);-1!==t&&this[Dh].splice(t,1),this[Dh].unshift(e),this[Fh]()}},{key:"release",value:function(e){this[Nh].has(e)&&this[Nh].set(e,Math.max(this[Nh].get(e)-1,0)),this[Fh]()}},{key:e,value:function(){if(!(this[Dh].length<this[Uh]))for(var e=this[Dh].length-1;e>=this[Uh];--e){var t=this[Dh][e];0===this[Nh].get(t)&&(this[Bh].delete(t),this[Dh].splice(e,1))}}}]),t}((Mh=Nh,Th=Dh,Fh)),Hh=function(e,t){var n,i=new Map,r=x(e.mappings);try{for(r.s();!(n=r.n()).done;){var a,o=n.value,s=x(o.variants);try{for(s.s();!(a=s.n()).done;){var u=a.value;i.set(t[u],{material:null,gltfMaterialIndex:o.material})}}catch(l){s.e(l)}finally{s.f()}}}catch(l){r.e(l)}finally{r.f()}return i},zh=function(){function e(t){M(this,e),this.parser=t,this.name="KHR_materials_variants"}return k(e,[{key:"afterRoot",value:function(e){var t=this,n=this.parser,i=n.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;var r,a=function(e){var t,n=[],i=new Set,r=x(e);try{for(r.s();!(t=r.n()).done;){for(var a=t.value,o=a,s=0;i.has(o);)o=a+"."+ ++s;i.add(o),n.push(o)}}catch(u){r.e(u)}finally{r.f()}return n}((i.extensions[this.name].variants||[]).map(function(e){return e.name})),o=x(e.scenes);try{for(o.s();!(r=o.n()).done;){r.value.traverse(function(e){var r=n.associations.get(e);if(null!=r&&null!=r.meshes)for(var o=i.meshes[r.meshes].primitives,s=("isMesh"in e?[e]:e.children),u=0;u<o.length;u++){var l=o[u].extensions;l&&l[t.name]&&(s[u].userData.variantMaterials=Hh(l[t.name],a))}})}}catch(s){o.e(s)}finally{o.f()}return e.userData.variants=a,Promise.resolve()}}]),e}(),Zh=new Map,Gh=new Map,jh=new(function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).decoderPath="",i.decoderConfig={},i.decoderBinary=null,i.decoderPending=null,i.workerLimit=4,i.workerPool=[],i.workerNextTaskID=1,i.workerSourceURL="",i.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},i.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},i}return k(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,i){var r=this,a=new Hl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(e){r.decodeGeometry(e,{attributeIDs:r.defaultAttributeIDs,attributeTypes:r.defaultAttributeTypes,useUniqueIDs:!1}).then(t).catch(i)},n,i)}},{key:"decodeDracoFile",value:function(e,t,n,i){this.decodeGeometry(e,{attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n}).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var i in t.attributeTypes){var r=t.attributeTypes[i];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=r.name)}var a,o=JSON.stringify(t);if(Ic.has(e)){var s=Ic.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,l=this._getWorker(u,e.byteLength).then(function(n){return a=n,new Promise(function(n,i){a._callbacks[u]={resolve:n,reject:i},a.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])})}).then(function(e){return n._createGeometry(e.geometry)});return l.catch(function(){return!0}).then(function(){a&&u&&n._releaseTask(a,u)}),Ic.set(e,{key:o,promise:l}),l}},{key:"_createGeometry",value:function(e){var t=new $i;e.index&&t.setIndex(new zi(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];t.setAttribute(i.name,new zi(i.array,i.itemSize))}return t}},{key:"_loadLibrary",value:function(e,t){var n=new Hl(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise(function(t,i){n.load(e,t,void 0,i)})}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var r=Nc.toString(),a=["/* draco decoder */",i,"","/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then(function(){if(n.workerPool.length<n.workerLimit){var i=new Worker(n.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});var r=n.workerPool[n.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map(function(e){return e._taskLoad}))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(Bl)),qh=new Ah,Wh=Symbol("loader"),Jh=Symbol("evictionPolicy"),Yh=Symbol("GLTFInstance"),Xh=function(e,t){d(o,e);var n,i,r,a=v(o);function o(e){var t;return M(this,o),(t=a.call(this))[Oh]=(new Dc).register(function(e){return new zh(e)}),t[Yh]=e,t[Wh].setDRACOLoader(jh),t[Wh].setKTX2Loader(qh),t}return k(o,[{key:t,get:function(){return this.constructor[Jh]}},{key:"preload",value:(r=l(regeneratorRuntime.mark(function e(t,n){var i,r,a,o,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>2&&void 0!==s[2]?s[2]:function(){},this.dispatchEvent({type:"preload",element:n,src:t}),Zh.has(t)){e.next=11;break}if(e.t0=null!=Ih,!e.t0){e.next=9;break}return e.t1=this[Wh],e.next=7,Ih;case 7:e.t2=e.sent,e.t1.setMeshoptDecoder.call(e.t1,e.t2);case 9:r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},i=function(e){var t=e.loaded/e.total;n(Math.max(0,Math.min(1,isFinite(t)?t:1)))};return new Promise(function(n,r){t.load(e,n,i,r)})}(t,this[Wh],function(e){i(.8*e)}),a=this[Yh],o=r.then(function(e){return a.prepare(e)}).then(function(e){return i(.9),new a(e)}),Zh.set(t,o);case 11:return e.next=13,Zh.get(t);case 13:Gh.set(t,!0),i&&i(1);case 15:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"load",value:(i=l(regeneratorRuntime.mark(function e(t,n){var i,r,a,o=this,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:function(){},e.next=3,this.preload(t,n,i);case 3:return e.next=5,Zh.get(t);case 5:return r=e.sent,e.next=8,r.clone();case 8:return a=e.sent,e.abrupt("return",(this[Jh].retain(t),a.dispose=function(){var e=a.dispose,n=!1;return function(){n||(n=!0,e.apply(a),o[Jh].release(t))}}(),a));case 10:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})}],[{key:"setDRACODecoderLocation",value:function(e){Lh=e,jh.setDecoderPath(e)}},{key:"getDRACODecoderLocation",value:function(){return Lh}},{key:"setKTX2TranscoderLocation",value:function(e){Rh=e,qh.setTranscoderPath(e)}},{key:"getKTX2TranscoderLocation",value:function(){return Rh}},{key:"setMeshoptDecoderLocation",value:function(e){var t;Ph!==e&&(Ph=e,Ih=(t=e,new Promise(function(e,n){var i=document.createElement("script");document.body.appendChild(i),i.onload=e,i.onerror=n,i.async=!0,i.src=t})).then(function(){return MeshoptDecoder.ready}).then(function(){return MeshoptDecoder}))}},{key:"getMeshoptDecoderLocation",value:function(){return Ph}},{key:"initializeKTX2Loader",value:function(e){qh.detectSupport(e)}},{key:"cache",get:function(){return Zh}},{key:"clearCache",value:function(){var e=this;Zh.forEach(function(t,n){e.delete(n)}),this[Jh].reset()}},{key:"has",value:function(e){return Zh.has(e)}},{key:"delete",value:(n=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.has(t)){e.next=2;break}return e.abrupt("return");case 2:return n=Zh.get(t),Gh.delete(t),Zh.delete(t),e.next=7,n;case 7:e.sent.dispose();case 8:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"hasFinishedLoading",value:function(e){return!!Gh.get(e)}}]),o}(Ht,(Ch=Jh,Oh=Wh,Jh));Xh[Ch]=new Vh(Xh);var Qh=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this)).element=e||document.createElement("div"),i.element.style.position="absolute",i.element.style.userSelect="none",i.element.setAttribute("draggable",!1),i.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)})}),i}return k(n,[{key:"copy",value:function(e,t){return p(b(n.prototype),"copy",this).call(this,e,t),this.element=e.element.cloneNode(!0),this}}]),n}(yi);Qh.prototype.isCSS2DObject=!0;var Kh=new mn,$h=new Wn,ep=new Wn,tp=new mn,np=new mn,ip=function e(){M(this,e);var t,n,i,r,a=this,o={objects:new WeakMap},s=document.createElement("div");function u(e,t,n){if(e.isCSS2DObject){e.onBeforeRender(a,t,n),Kh.setFromMatrixPosition(e.matrixWorld),Kh.applyMatrix4(ep);var c=e.element;c.style.transform=/apple/i.test(navigator.vendor)?"translate(-50%,-50%) translate("+Math.round(Kh.x*i+i)+"px,"+Math.round(-Kh.y*r+r)+"px)":"translate(-50%,-50%) translate("+(Kh.x*i+i)+"px,"+(-Kh.y*r+r)+"px)",c.style.display=e.visible&&Kh.z>=-1&&Kh.z<=1?"":"none";var h={distanceToCameraSquared:l(n,e)};o.objects.set(e,h),c.parentNode!==s&&s.appendChild(c),e.onAfterRender(a,t,n)}for(var p=0,d=e.children.length;p<d;p++)u(e.children[p],t,n)}function l(e,t){return tp.setFromMatrixPosition(e.matrixWorld),np.setFromMatrixPosition(t.matrixWorld),tp.distanceToSquared(np)}s.style.overflow="hidden",this.domElement=s,this.getSize=function(){return{width:t,height:n}},this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),$h.copy(t.matrixWorldInverse),ep.multiplyMatrices(t.projectionMatrix,$h),u(e,e,t),function(e){for(var t=function(e){var t=[];return e.traverse(function(e){e.isCSS2DObject&&t.push(e)}),t}(e).sort(function(e,t){return o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),n=t.length,i=0,r=t.length;i<r;i++)t[i].element.style.zIndex=n-i}(e)},this.setSize=function(e,a){i=(t=e)/2,r=(n=a)/2,s.style.width=e+"px",s.style.height=a+"px"}},rp=function(e){return e&&"null"!==e?op(e):null},ap=function(){if(!Pt){var e=[];throw Ct||e.push("WebXR Device API"),Ot||e.push("WebXR Hit Test API"),new Error("The following APIs are required for AR, but are missing in this browser: ".concat(e.join(", ")))}},op=function(e){return new URL(e,window.location.toString()).toString()},sp=function(e,t){var n=null;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];null!=n&&self.clearTimeout(n),n=self.setTimeout(function(){n=null,e.apply(void 0,r)},t)}},up=function(e,t,n){return Math.max(t,Math.min(n,e))},lp=function(){var e=function(){var e,t=x(null!=document.head?Array.from(document.head.querySelectorAll("meta")):[]);try{for(t.s();!(e=t.n()).done;){if("viewport"===e.value.name)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}();return e||console.warn('No <meta name="viewport"> detected; <model-viewer> will cap pixel density at 1.'),function(){return e?window.devicePixelRatio:1}}(),cp=function(){var e=new RegExp("[?&]model-viewer-debug-mode(&|$)");return function(){return self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(e)}}(),hp=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){return setTimeout(t,e)})},pp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;M(this,e),this.velocity=0,this.naturalFrequency=0,this.setDecayTime(t)}return k(e,[{key:"setDecayTime",value:function(e){this.naturalFrequency=1/Math.max(.001,e)}},{key:"update",value:function(e,t,n,i){var r=2e-4*this.naturalFrequency;if(null==e||0===i)return t;if(e===t&&0===this.velocity)return t;if(n<0)return e;var a=e-t,o=this.velocity+this.naturalFrequency*a,s=a+n*o,u=Math.exp(-this.naturalFrequency*n),l=(o-this.naturalFrequency*s)*u,c=-this.naturalFrequency*(l+o*u);return Math.abs(l)<r*Math.abs(i)&&c*a>=0?(this.velocity=0,t):(this.velocity=l,t+s*u)}}]),e}(),dp=function(e,t){return{type:"number",number:e,unit:t}},fp=function(){var e={};return function(t){var n=t;if(n in e)return e[n];for(var i=[],r=0;t;){if(++r>1e3){t="";break}var a=vp(t),o=a.nodes[0];if(null==o||0===o.terms.length)break;i.push(o),t=a.remainingInput}return e[n]=i}}(),vp=function(){var e=/^(\-\-|[a-z\u0240-\uffff])/i,t=/^([\*\+\/]|[\-]\s)/i,n=/^[\),]/;return function(i){for(var r=[];i.length&&(i=i.trim(),!n.test(i));)if("("===i[0]){var a=bp(i),o=a.nodes;i=a.remainingInput,r.push({type:"function",name:{type:"ident",value:"calc"},arguments:o})}else if(e.test(i)){var s=mp(i),u=s.nodes[0];if("("===(i=s.remainingInput)[0]){var l=bp(i),c=l.nodes,h=l.remainingInput;r.push({type:"function",name:u,arguments:c}),i=h}else r.push(u)}else if(t.test(i))r.push({type:"operator",value:i[0]}),i=i.slice(1);else{var p="#"===i[0]?yp(i):gp(i),d=p.nodes,f=p.remainingInput;if(0===d.length)break;r.push(d[0]),i=f}return{nodes:[{type:"expression",terms:r}],remainingInput:i}}}(),mp=function(){var e=/[^a-z0-9_\-\u0240-\uffff]/i;return function(t){var n=t.match(e);return{nodes:[{type:"ident",value:null==n?t:t.substr(0,n.index)}],remainingInput:null==n?"":t.substr(n.index)}}}(),gp=function(){var e=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,t=/^[a-z%]+/i,n=/^(m|mm|cm|rad|deg|[%])$/;return function(i){var r=i.match(e),a=null==r?"0":r[0],o=(i=null==a?i:i.slice(a.length)).match(t),s=null!=o&&""!==o[0]?o[0]:null,u=null==o?i:i.slice(s.length);return null==s||n.test(s)||(s=null),{nodes:[{type:"number",number:parseFloat(a)||0,unit:s}],remainingInput:u}}}(),yp=function(){var e=/^[a-f0-9]*/i;return function(t){var n=(t=t.slice(1).trim()).match(e);return{nodes:null==n?[]:[{type:"hex",value:n[0]}],remainingInput:null==n?t:t.slice(n[0].length)}}}(),bp=function(e){var t=[];for(e=e.slice(1).trim();e.length;){var n=vp(e);if(t.push(n.nodes[0]),","===(e=n.remainingInput.trim())[0])e=e.slice(1).trim();else if(")"===e[0]){e=e.slice(1);break}}return{nodes:t,remainingInput:e}},xp=Symbol("visitedTypes"),wp=function(){function e(t){M(this,e),this[xp]=t}return k(e,[{key:"walk",value:function(e,t){for(var n=e.slice();n.length;){var i=n.shift();switch(this[xp].indexOf(i.type)>-1&&t(i),i.type){case"expression":n.unshift.apply(n,w(i.terms));break;case"function":n.unshift.apply(n,[i.name].concat(w(i.arguments)))}}}}]),e}(),_p=Object.freeze({type:"number",number:0,unit:null}),Sp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.number,i=e.unit;if(isFinite(n)){if("rad"===e.unit||null==e.unit)return e}else n=t,i="rad";return{type:"number",number:("deg"===i&&null!=n?n:0)*Math.PI/180,unit:"rad"}},Mp=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.number,r=e.unit;if(isFinite(i)){if("m"===e.unit)return e}else i=n,r="m";switch(r){default:t=1;break;case"cm":t=.01;break;case"mm":t=.001}return{type:"number",number:t*i,unit:"m"}},Tp=function(){var e=function(e){return e},t={rad:e,deg:Sp,m:e,mm:Mp,cm:Mp};return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_p;isFinite(e.number)||(e.number=n.number,e.unit=n.unit);var i=e.unit;if(null==i)return e;var r=t[i];return null==r?n:r(e)}}(),kp=function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,document.createElement("div"))).normal=new mn(0,1,0),i.initialized=!1,i.referenceCount=1,i.pivot=document.createElement("div"),i.slot=document.createElement("slot"),i.element.classList.add("annotation-wrapper"),i.slot.name=e.name,i.element.appendChild(i.pivot),i.pivot.appendChild(i.slot),i.updatePosition(e.position),i.updateNormal(e.normal),i}return k(n,[{key:"facingCamera",get:function(){return!this.element.classList.contains("hide")}},{key:"show",value:function(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}},{key:"hide",value:function(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}},{key:"increment",value:function(){this.referenceCount++}},{key:"decrement",value:function(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}},{key:"updatePosition",value:function(e){if(null!=e){for(var t=fp(e)[0].terms,n=0;n<3;++n)this.position.setComponent(n,Tp(t[n]).number);this.updateMatrixWorld()}}},{key:"updateNormal",value:function(e){if(null!=e)for(var t=fp(e)[0].terms,n=0;n<3;++n)this.normal.setComponent(n,Tp(t[n]).number)}},{key:"orient",value:function(e){this.pivot.style.transform="rotate(".concat(e,"rad)")}},{key:"updateVisibility",value:function(e){e?this.element.classList.remove("hide"):this.element.classList.add("hide"),this.slot.assignedNodes().forEach(function(t){if(t.nodeType===Node.ELEMENT_NODE){var n=t,i=n.dataset.visibilityAttribute;if(null!=i){var r="data-".concat(i);e?n.setAttribute(r,""):n.removeAttribute(r)}n.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:e}}))}}),this.initialized=!0}}]),n}(Qh),Ep=function(e,t,n){var i=n,r=new mn;return e.traverse(function(e){var n,a;e.updateWorldMatrix(!1,!1);var o=e.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(n=0,a=s.length;n<a;n++)r.copy(s[n]),r.applyMatrix4(e.matrixWorld),i=t(i,r)}else if(o.isBufferGeometry){var u=o.attributes.position;if(void 0!==u){var l=function(e){if(!e.normalized)return 1;var t=e.array;return t instanceof Int8Array?1/127:t instanceof Uint8Array?1/255:t instanceof Int16Array?1/32767:t instanceof Uint16Array?1/65535:1}(u);for(n=0,a=u.count;n<a;n++)r.fromBufferAttribute(u,n),r.multiplyScalar(l),r.applyMatrix4(e.matrixWorld),i=t(i,r)}}}),i},Ap=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this)).shadowMaterial=new bl,a.boundingBox=new bn,a.size=new mn,a.shadowScale=1,a.isAnimated=!1,a.side="bottom",a.needsUpdate=!1,a.intensity=0,a.castShadow=!0,a.frustumCulled=!1,a.floor=new gr(new Ur,a.shadowMaterial),a.floor.rotateX(-Math.PI/2),a.floor.receiveShadow=!0,a.floor.castShadow=!1,a.floor.frustumCulled=!1,a.add(a.floor),e.target.add(g(a)),a.target=e.target,a.setScene(e,i,r),a}return k(n,[{key:"setScene",value:function(e,t,n){if(this.side=n,this.isAnimated=e.animationNames.length>0,this.boundingBox.copy(e.boundingBox),this.size.copy(e.size),"back"===this.side){var i,r,a,o=this.boundingBox,s=o.min,u=o.max;i=[s.z,s.y],s.y=i[0],s.z=i[1],r=[u.z,u.y],u.y=r[0],u.z=r[1],a=[this.size.z,this.size.y],this.size.y=a[0],this.size.z=a[1],this.rotation.x=Math.PI/2,this.rotation.y=Math.PI}else this.rotation.x=0,this.rotation.y=0;var l=this.boundingBox,c=this.size;if(this.isAnimated){var h=2*Math.max(c.x,c.y,c.z);c.y=h,l.expandByVector(c.subScalar(h).multiplyScalar(-.5)),l.max.y=l.min.y+h,c.set(h,h,h)}l.getCenter(this.floor.position);var p=l.max.y+.002*c.y;"bottom"===n?(this.position.y=p,this.position.z=0):(this.position.y=0,this.position.z=p),this.setSoftness(t)}},{key:"setSoftness",value:function(e){var t=Math.pow(2,9-3*e);this.setMapSize(t)}},{key:"setMapSize",value:function(e){var t=this.shadow,n=t.camera,i=t.mapSize,r=t.map,a=this.size,o=this.boundingBox;null!=r&&(r.dispose(),this.shadow.map=null),this.isAnimated&&(e*=2);var s=Math.floor(a.x>a.z?e:e*a.x/a.z),u=Math.floor(a.x>a.z?e*a.z/a.x:e);i.set(s,u);var l=2.5*a.x/s,c=2.5*a.z/u;n.left=-o.max.x-l,n.right=-o.min.x+l,n.bottom=o.min.z-c,n.top=o.max.z+c,this.setScaleAndOffset(this.shadowScale,0),this.floor.scale.set(a.x+2*l,a.z+2*c,1),this.needsUpdate=!0,this.shadow.needsUpdate=!0}},{key:"setIntensity",value:function(e){this.shadowMaterial.opacity=e,e>0?(this.visible=!0,this.floor.visible=!0):(this.visible=!1,this.floor.visible=!1)}},{key:"getIntensity",value:function(){return this.shadowMaterial.opacity}},{key:"setRotation",value:function(e){if("bottom"!==this.side)return this.shadow.camera.up.set(0,1,0),void this.shadow.updateMatrices(this);this.shadow.camera.up.set(Math.sin(e),0,Math.cos(e)),this.shadow.updateMatrices(this)}},{key:"setScaleAndOffset",value:function(e,t){var n=this.size.y,i=this.shadow.camera;this.shadowScale=e,i.near=0,i.far=n-t/e,i.updateProjectionMatrix(),i.scale.setScalar(e),this.floor.position.y=.002*n*2-i.far}}]),n}(ac),Cp=22.5*Math.PI/180,Op=Math.sin(Cp),Lp=Math.tan(Cp),Rp=new mn,Pp=new mn,Ip=new mn,Np=new(function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;M(this,e),this.ray=new qn(t,n),this.near=i,this.far=r,this.camera=null,this.layers=new ri,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return k(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Tc(e,this,n,t),n.sort(Mc),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=0,r=e.length;i<r;i++)Tc(e[i],this,n,t);return n.sort(Mc),n}}]),e}()),Dp=new mn,Fp=new nn,Up=function(e){d(a,e);var t,n,i,r=v(a);function a(e){var t,n=e.canvas,i=e.element,o=e.width,s=e.height;M(this,a),(t=r.call(this)).context=null,t.annotationRenderer=new ip,t.schemaElement=document.createElement("script"),t.width=1,t.height=1,t.aspect=1,t.renderCount=0,t.externalRenderer=null,t.camera=new Tr(45,1,.1,100),t.xrCamera=null,t.url=null,t.target=new yi,t.modelContainer=new yi,t.animationNames=[],t.boundingBox=new bn,t.size=new mn,t.idealCameraDistance=0,t.fieldOfViewAspect=0,t.framedFieldOfView=45,t.shadow=null,t.shadowIntensity=0,t.shadowSoftness=1,t.exposure=1,t.canScale=!0,t.tightBounds=!1,t.isDirty=!1,t.goalTarget=new mn,t.targetDamperX=new pp,t.targetDamperY=new pp,t.targetDamperZ=new pp,t._currentGLTF=null,t.cancelPendingSourceChange=null,t.animationsByName=new Map,t.currentAnimationAction=null,t.name="ModelScene",t.element=i,t.canvas=n,t.camera=new Tr(45,1,.1,100),t.camera.name="MainCamera",t.add(t.target),t.setSize(o,s),t.target.name="Target",t.modelContainer.name="ModelContainer",t.target.add(t.modelContainer),t.mixer=new Sc(t.modelContainer);var u=t.annotationRenderer.domElement,l=u.style;return l.display="none",l.pointerEvents="none",l.position="absolute",l.top="0",t.element.shadowRoot.querySelector(".default").appendChild(u),t.schemaElement.setAttribute("type","application/ld+json"),t}return k(a,[{key:"createContext",value:function(){this.context=this.canvas.getContext("2d")}},{key:"getCamera",value:function(){return null!=this.xrCamera?this.xrCamera:this.camera}},{key:"queueRender",value:function(){this.isDirty=!0}},{key:"shouldRender",value:function(){return this.isDirty}},{key:"hasRendered",value:function(){this.isDirty=!1}},{key:"setObject",value:(i=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.reset(),this.modelContainer.add(t),e.next=4,this.setupScene();case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"setSource",value:(n=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,u,c,h,p=this,d=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:function(){},t&&t!==this.url){e.next=3;break}return e.abrupt("return",void n(1));case 3:if(this.reset(),this.url=t,null==this.externalRenderer){e.next=8;break}return e.next=6,this.externalRenderer.load(n);case 6:return i=e.sent,e.abrupt("return",(this.idealCameraDistance=i.framedRadius/Op,this.fieldOfViewAspect=i.fieldOfViewAspect,this.frameModel(),void this.dispatchEvent({type:"model-load",url:this.url})));case 8:return null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null),e.prev=9,e.next=12,new Promise(function(){var e=l(regeneratorRuntime.mark(function e(i,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.cancelPendingSourceChange=function(){return r()},e.prev=1,e.t0=i,e.next=5,p.element[Ef].loader.load(t,p.element,n);case 5:e.t1=e.sent,(0,e.t0)(e.t1),e.next=12;break;case 9:e.prev=9,e.t2=e.catch(1),r(e.t2);case 12:case"end":return e.stop()}},e,null,[[1,9]])}));return function(t,n){return e.apply(this,arguments)}}());case 12:r=e.sent,e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),null!=e.t0){e.next=19;break}return e.abrupt("return");case 19:throw e.t0;case 20:this.reset(),this.url=t,this._currentGLTF=r,null!=r&&this.modelContainer.add(r.scene),a=r.animations,o=new Map,s=[],u=x(a);try{for(u.s();!(c=u.n()).done;)h=c.value,o.set(h.name,h),s.push(h.name)}catch(f){u.e(f)}finally{u.f()}return this.animations=a,this.animationsByName=o,this.animationNames=s,e.next=29,this.setupScene();case 29:case"end":return e.stop()}},e,this,[[9,15]])})),function(e){return n.apply(this,arguments)})},{key:"setupScene",value:(t=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateBoundingBox(),t=null,e.t0=!0===this.tightBounds,!e.t0){e.next=7;break}return e.next=6,this.element.requestUpdate("cameraTarget");case 6:t=this.getTarget();case 7:this.updateFraming(t),this.frameModel(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.dispatchEvent({type:"model-load",url:this.url});case 12:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"reset",value:function(){this.url=null,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0);var e=this._currentGLTF;if(null!=e){var t,n=x(this.modelContainer.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.modelContainer.remove(i)}}catch(r){n.e(r)}finally{n.f()}e.dispose(),this._currentGLTF=null}null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}},{key:"currentGLTF",get:function(){return this._currentGLTF}},{key:"setSize",value:function(e,t){if(this.width!==e||this.height!==t){if(this.width=Math.max(e,1),this.height=Math.max(t,1),this.annotationRenderer.setSize(e,t),this.aspect=this.width/this.height,this.frameModel(),null!=this.externalRenderer){var n=lp();this.externalRenderer.resize(e*n,t*n)}this.queueRender()}}},{key:"updateBoundingBox",value:function(){this.target.remove(this.modelContainer),!0===this.tightBounds?this.boundingBox=Ep(this.modelContainer,function(e,t){return e.expandByPoint(t)},new bn):this.boundingBox.setFromObject(this.modelContainer),this.boundingBox.getSize(this.size),this.target.add(this.modelContainer)}},{key:"updateFraming",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.target.remove(this.modelContainer),null==t&&(t=this.boundingBox.getCenter(new mn));var n=Math.sqrt(Ep(this.modelContainer,function(e,n){return Math.max(e,t.distanceToSquared(n))},0));this.idealCameraDistance=n/Op,this.fieldOfViewAspect=Ep(this.modelContainer,function(n,i){i.sub(t);var r=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(n,r/(e.idealCameraDistance-Math.abs(i.y)))},0)/Lp,this.target.add(this.modelContainer)}},{key:"frameModel",value:function(){var e=Lp*Math.max(1,this.fieldOfViewAspect/this.aspect);this.framedFieldOfView=2*Math.atan(e)*180/Math.PI}},{key:"getNDC",value:function(e,t){if(null!=this.xrCamera)Fp.set(e/window.screen.width,t/window.screen.height);else{var n=this.element.getBoundingClientRect();Fp.set((e-n.x)/this.width,(t-n.y)/this.height)}return Fp.multiplyScalar(2).subScalar(1),Fp.y*=-1,Fp}},{key:"getSize",value:function(){return{width:this.width,height:this.height}}},{key:"setTarget",value:function(e,t,n){this.goalTarget.set(-e,-t,-n)}},{key:"setTargetDamperDecayTime",value:function(e){this.targetDamperX.setDecayTime(e),this.targetDamperY.setDecayTime(e),this.targetDamperZ.setDecayTime(e)}},{key:"getTarget",value:function(){return Dp.copy(this.goalTarget).multiplyScalar(-1)}},{key:"jumpToGoal",value:function(){this.updateTarget(1e4)}},{key:"updateTarget",value:function(e){var t=this.goalTarget,n=this.target.position;if(!t.equals(n)){var i=this.idealCameraDistance,r=n.x,a=n.y,o=n.z;r=this.targetDamperX.update(r,t.x,e,i),a=this.targetDamperY.update(a,t.y,e,i),o=this.targetDamperZ.update(o,t.z,e,i),this.target.position.set(r,a,o),this.target.updateMatrixWorld(),this.setShadowRotation(this.yaw),this.queueRender()}}},{key:"pointTowards",value:function(e,t){var n=this.position,i=n.x,r=n.z;this.yaw=Math.atan2(e-i,t-r)}},{key:"yaw",get:function(){return this.rotation.y},set:function(e){this.rotation.y=e,this.updateMatrixWorld(!0),this.setShadowRotation(e),this.queueRender()}},{key:"animationTime",get:function(){return null!=this.currentAnimationAction?this.currentAnimationAction.time:0},set:function(e){this.mixer.setTime(e)}},{key:"duration",get:function(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}},{key:"hasActiveAnimation",get:function(){return null!=this.currentAnimationAction}},{key:"playAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(null!=this._currentGLTF){var n=this.animations;if(null!=n&&0!==n.length){var i=null;null!=e&&(i=this.animationsByName.get(e)),null==i&&(i=n[0]);try{var r=this.currentAnimationAction,a=this.mixer.clipAction(i,this);this.currentAnimationAction=a,this.element.paused?this.mixer.stopAllAction():null!=r&&a!==r&&a.crossFadeFrom(r,t,!1),a.enabled=!0,a.play()}catch(e){console.error(e)}}else console.warn("Cannot play animation (model does not have any animations)")}}},{key:"stopAnimation",value:function(){this.currentAnimationAction=null,this.mixer.stopAllAction()}},{key:"updateAnimation",value:function(e){this.mixer.update(e)}},{key:"updateShadow",value:function(){var e=this.shadow;null!=e&&(e.setScene(this,this.shadowSoftness,"wall"===this.element.arPlacement?"back":"bottom"),e.setRotation(this.yaw))}},{key:"setShadowIntensity",value:function(e){this.shadowIntensity=e,null==this._currentGLTF||e<=0&&null==this.shadow||(null==this.shadow&&(this.shadow=new Ap(this,this.shadowSoftness,"wall"===this.element.arPlacement?"back":"bottom"),this.shadow.setRotation(this.yaw)),this.shadow.setIntensity(e))}},{key:"setShadowSoftness",value:function(e){this.shadowSoftness=e;var t=this.shadow;null!=t&&t.setSoftness(e)}},{key:"setShadowRotation",value:function(e){var t=this.shadow;null!=t&&t.setRotation(e)}},{key:"isShadowDirty",value:function(){var e=this.shadow;if(null==e)return!1;var t=e.needsUpdate;return e.needsUpdate=!1,t}},{key:"setShadowScaleAndOffset",value:function(e,t){var n=this.shadow;null!=n&&n.setScaleAndOffset(e,t)}},{key:"raycaster",get:function(){return Np}},{key:"positionAndNormalFromPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;this.raycaster.setFromCamera(e,this.getCamera());var n=this.raycaster.intersectObject(t,!0);if(0===n.length)return null;var i=n[0];return null==i.face?null:(i.face.normal.applyNormalMatrix((new an).getNormalMatrix(i.object.matrixWorld)),{position:i.point,normal:i.face.normal})}},{key:"addHotspot",value:function(e){this.target.add(e),this.annotationRenderer.domElement.appendChild(e.element)}},{key:"removeHotspot",value:function(e){this.target.remove(e)}},{key:"forHotspots",value:function(e){for(var t=this.target.children,n=0,i=t.length;n<i;n++){var r=t[n];r instanceof kp&&e(r)}}},{key:"updateHotspots",value:function(e){var t=this;this.forHotspots(function(n){Rp.copy(e),Pp.setFromMatrixPosition(n.matrixWorld),Rp.sub(Pp),Ip.copy(n.normal).transformDirection(t.target.matrixWorld),Rp.dot(Ip)<0?n.hide():n.show()})}},{key:"orientHotspots",value:function(e){this.forHotspots(function(t){t.orient(e)})}},{key:"setHotspotsVisibility",value:function(e){this.forHotspots(function(t){t.visible=e})}},{key:"updateSchema",value:function(e){var t,n=this.schemaElement,i=this.element,r=i.alt,a=i.poster,o=i.iosSrc;if(null!=e){var s=[{"@type":"MediaObject",contentUrl:e,encodingFormat:"gltf"===(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];o&&s.push({"@type":"MediaObject",contentUrl:o,encodingFormat:"model/vnd.usdz+zip"}),n.textContent=JSON.stringify({"@context":"http://schema.org/","@type":"3DModel",image:null!=a?a:void 0,name:null!=r?r:void 0,encoding:s}),document.head.appendChild(n)}else null!=n.parentElement&&n.parentElement.removeChild(n)}}]),a}(_s),Bp=function(){var e=new Yr({uniforms:{roughnessMap:{value:null},normalMap:{value:null},texelSize:{value:new nn(1,1)}},vertexShader:"\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tattribute vec3 position;\n\t\t\tattribute vec2 uv;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tvoid main() {\n\n\t\t\t\tvUv = uv;\n\n\t\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t\t}\n\t\t",fragmentShader:"\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec2 vUv;\n\n\t\t\tuniform sampler2D roughnessMap;\n\t\t\tuniform sampler2D normalMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\n\t\t\tvec4 envMapTexelToLinear( vec4 a ) { return a; }\n\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tfloat roughnessToVariance( float roughness ) {\n\n\t\t\t\tfloat variance = 0.0;\n\n\t\t\t\tif ( roughness >= r1 ) {\n\n\t\t\t\t\tvariance = ( r0 - roughness ) * ( v1 - v0 ) / ( r0 - r1 ) + v0;\n\n\t\t\t\t} else if ( roughness >= r4 ) {\n\n\t\t\t\t\tvariance = ( r1 - roughness ) * ( v4 - v1 ) / ( r1 - r4 ) + v1;\n\n\t\t\t\t} else if ( roughness >= r5 ) {\n\n\t\t\t\t\tvariance = ( r4 - roughness ) * ( v5 - v4 ) / ( r4 - r5 ) + v4;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tfloat roughness2 = roughness * roughness;\n\n\t\t\t\t\tvariance = 1.79 * roughness2 * roughness2;\n\n\t\t\t\t}\n\n\t\t\t\treturn variance;\n\n\t\t\t}\n\n\t\t\tfloat varianceToRoughness( float variance ) {\n\n\t\t\t\tfloat roughness = 0.0;\n\n\t\t\t\tif ( variance >= v1 ) {\n\n\t\t\t\t\troughness = ( v0 - variance ) * ( r1 - r0 ) / ( v0 - v1 ) + r0;\n\n\t\t\t\t} else if ( variance >= v4 ) {\n\n\t\t\t\t\troughness = ( v1 - variance ) * ( r4 - r1 ) / ( v1 - v4 ) + r1;\n\n\t\t\t\t} else if ( variance >= v5 ) {\n\n\t\t\t\t\troughness = ( v4 - variance ) * ( r5 - r4 ) / ( v4 - v5 ) + r4;\n\n\t\t\t\t} else {\n\n\t\t\t\t\troughness = pow( 0.559 * variance, 0.25 ); // 0.559 = 1.0 / 1.79\n\n\t\t\t\t}\n\n\t\t\t\treturn roughness;\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = texture2D( roughnessMap, vUv, - 1.0 );\n\n\t\t\t\tif ( texelSize.x == 0.0 ) return;\n\n\t\t\t\tfloat roughness = gl_FragColor.g;\n\n\t\t\t\tfloat variance = roughnessToVariance( roughness );\n\n\t\t\t\tvec3 avgNormal;\n\n\t\t\t\tfor ( float x = - 1.0; x < 2.0; x += 2.0 ) {\n\n\t\t\t\t\tfor ( float y = - 1.0; y < 2.0; y += 2.0 ) {\n\n\t\t\t\t\t\tvec2 uv = vUv + vec2( x, y ) * 0.25 * texelSize;\n\n\t\t\t\t\t\tavgNormal += normalize( texture2D( normalMap, uv, - 1.0 ).xyz - 0.5 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tvariance += 1.0 - 0.25 * length( avgNormal );\n\n\t\t\t\tgl_FragColor.g = varianceToRoughness( variance );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return e.type="RoughnessMipmapper",e}(),Vp=new gr(new Ur(2,2),Bp),Hp=new Jr(0,1,0,1,0,1),zp=null,Zp=null,Gp=function(){function e(t){M(this,e),(Zp=t).compile(Vp,Hp)}return k(e,[{key:"generateMipmaps",value:function(e){if("roughnessMap"in e!=0){var t=e.roughnessMap,n=e.normalMap;if(null!==t&&null!==n&&t.generateMipmaps&&!e.userData.roughnessUpdated){e.userData.roughnessUpdated=!0;var i=Math.max(t.image.width,n.image.width),r=Math.max(t.image.height,n.image.height);if(tn.isPowerOfTwo(i)&&tn.isPowerOfTwo(r)){var a=Zp.getRenderTarget(),o=Zp.autoClear;if(Zp.autoClear=!1,null!==zp&&zp.width===i&&zp.height===r||(null!==zp&&zp.dispose(),(zp=new dn(i,r,{depthBuffer:!1})).scissorTest=!0),i!==t.image.width||r!==t.image.height){var s=new dn(i,r,{wrapS:t.wrapS,wrapT:t.wrapT,magFilter:t.magFilter,minFilter:t.minFilter,depthBuffer:!1});s.texture.generateMipmaps=!0,Zp.setRenderTarget(s),e.roughnessMap=s.texture,e.metalnessMap==t&&(e.metalnessMap=e.roughnessMap),e.aoMap==t&&(e.aoMap=e.roughnessMap),e.roughnessMap.offset.copy(t.offset),e.roughnessMap.repeat.copy(t.repeat),e.roughnessMap.center.copy(t.center),e.roughnessMap.rotation=t.rotation,e.roughnessMap.matrixAutoUpdate=t.matrixAutoUpdate,e.roughnessMap.matrix.copy(t.matrix)}Bp.uniforms.roughnessMap.value=t,Bp.uniforms.normalMap.value=n;for(var u=new nn(0,0),l=Bp.uniforms.texelSize.value,c=0;i>=1&&r>=1;++c,i/=2,r/=2)l.set(1/i,1/r),0==c&&l.set(0,0),zp.viewport.set(u.x,u.y,i,r),zp.scissor.set(u.x,u.y,i,r),Zp.setRenderTarget(zp),Zp.render(Vp,Hp),Zp.copyFramebufferToTexture(u,e.roughnessMap,c),Bp.uniforms.roughnessMap.value=e.roughnessMap;t!==e.roughnessMap&&t.dispose(),Zp.setRenderTarget(a),Zp.autoClear=o}}}}},{key:"dispose",value:function(){Bp.dispose(),Vp.geometry.dispose(),null!=zp&&zp.dispose()}}]),e}(),jp=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},qp=Symbol("currentEnvironmentMap"),Wp=Symbol("applyEnvironmentMap"),Jp=Symbol("updateEnvironment"),Yp=Symbol("cancelEnvironmentUpdate"),Xp=Symbol("onPreload"),Qp=function(){function e(t,n,i,r,a){var o=this;M(this,e),this.xrLight=t,this.renderer=n,this.lightProbe=i,this.xrWebGLBinding=null,this.estimationStartCallback=a,this.frameCallback=this.onXRFrame.bind(this);var s=n.xr.getSession();if(r&&"XRWebGLBinding"in window){var u=new Ar(16);t.environment=u.texture;var l=n.getContext();switch(s.preferredReflectionFormat){case"srgba8":l.getExtension("EXT_sRGB");break;case"rgba16f":l.getExtension("OES_texture_half_float")}this.xrWebGLBinding=new XRWebGLBinding(s,l),this.lightProbe.addEventListener("reflectionchange",function(){o.updateReflection()})}s.requestAnimationFrame(this.frameCallback)}return k(e,[{key:"updateReflection",value:function(){var e=this.renderer.properties.get(this.xrLight.environment);if(e){var t=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);t&&(e.__webglTexture=t)}}},{key:"onXRFrame",value:function(e,t){if(this.xrLight){t.session.requestAnimationFrame(this.frameCallback);var n=t.getLightEstimate(this.lightProbe);if(n){this.xrLight.lightProbe.sh.fromArray(n.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;var i=Math.max(1,Math.max(n.primaryLightIntensity.x,Math.max(n.primaryLightIntensity.y,n.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(n.primaryLightIntensity.x/i,n.primaryLightIntensity.y/i,n.primaryLightIntensity.z/i),this.xrLight.directionalLight.intensity=i,this.xrLight.directionalLight.position.copy(n.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}}},{key:"dispose",value:function(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}]),e}(),Kp=function(e){d(n,e);var t=v(n);function n(e){var i,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];M(this,n),(i=t.call(this)).lightProbe=new sc,i.lightProbe.intensity=0,i.add(i.lightProbe),i.directionalLight=new ac,i.directionalLight.intensity=0,i.add(i.directionalLight),i.environment=null;var a=null,o=!1;return e.xr.addEventListener("sessionstart",function(){var t=e.xr.getSession();"requestLightProbe"in t&&t.requestLightProbe({reflectionFormat:t.preferredReflectionFormat}).then(function(t){a=new Qp(g(i),e,t,r,function(){o=!0,i.dispatchEvent({type:"estimationstart"})})})}),e.xr.addEventListener("sessionend",function(){a&&(a.dispose(),a=null),o&&i.dispatchEvent({type:"estimationend"})}),i.dispose=function(){a&&(a.dispose(),a=null),i.remove(i.lightProbe),i.lightProbe=null,i.remove(i.directionalLight),i.directionalLight=null,i.environment=null},i}return n}(ms),$p=Math.PI/24,ed=new nn,td=function(e,t,n){for(var i=t>0?n>0?0:-Math.PI/2:n>0?Math.PI/2:Math.PI,r=0;r<=12;++r)e.push(t+.17*Math.cos(i),n+.17*Math.sin(i),0,t+.2*Math.cos(i),n+.2*Math.sin(i),0),i+=$p},nd=function(e){d(n,e);var t=v(n);function n(e,i){var r;M(this,n);var a=new $i,o=[],s=[],u=e.size,l=e.boundingBox,c=u.x/2,h=("back"===i?u.y:u.z)/2;td(s,c,h),td(s,-c,h),td(s,-c,-h),td(s,c,-h);for(var p=s.length/3,d=0;d<p-2;d+=2)o.push(d,d+1,d+3,d,d+3,d+2);var f=p-2;o.push(f,f+1,1,f,1,0),a.setAttribute("position",new ji(s,3)),a.setIndex(o),(r=t.call(this,a)).side=i;var v=r.material;switch(v.side=2,v.transparent=!0,v.opacity=0,r.goalOpacity=0,r.opacityDamper=new pp,r.hitPlane=new gr(new Ur(2*(c+.2),2*(h+.2))),r.hitPlane.visible=!1,r.add(r.hitPlane),l.getCenter(r.position),i){case"bottom":r.rotateX(-Math.PI/2),r.shadowHeight=l.min.y,r.position.y=r.shadowHeight;break;case"back":r.shadowHeight=l.min.z,r.position.z=r.shadowHeight}return e.target.add(g(r)),r}return k(n,[{key:"getHit",value:function(e,t,n){ed.set(t,-n),this.hitPlane.visible=!0;var i=e.positionAndNormalFromPoint(ed,this.hitPlane);return this.hitPlane.visible=!1,null==i?null:i.position}},{key:"getExpandedHit",value:function(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);var i=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),i}},{key:"offsetHeight",get:function(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight},set:function(e){"back"===this.side?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}},{key:"show",set:function(e){this.goalOpacity=e?.75:0}},{key:"updateOpacity",value:function(e){var t=this.material;t.opacity=this.opacityDamper.update(t.opacity,this.goalOpacity,e,1),this.visible=t.opacity>0}},{key:"dispose",value:function(){var e,t=this.hitPlane,n=t.geometry,i=t.material;n.dispose(),i.dispose(),this.geometry.dispose(),this.material.dispose(),null===(e=this.parent)||void 0===e||e.remove(this)}}]),n}(gr),id="not-presenting",rd="session-started",ad="tracking",od=new mn,sd=new Wn,ud=new mn,ld=new Tr(45,1,.1,100),cd=function(e){d(o,e);var t,n,i,r,a=v(o);function o(e){var t;return M(this,o),(t=a.call(this)).renderer=e,t.currentSession=null,t.placeOnWall=!1,t.placementBox=null,t.lastTick=null,t.turntableRotation=null,t.oldShadowIntensity=null,t.oldBackground=null,t.oldEnvironment=null,t.frame=null,t.initialHitSource=null,t.transientHitTestSource=null,t.inputSource=null,t._presentedScene=null,t.resolveCleanup=null,t.exitWebXRButtonContainer=null,t.overlay=null,t.xrLight=null,t.tracking=!0,t.frames=0,t.initialized=!1,t.oldTarget=new mn,t.oldFramedFieldOfView=45,t.placementComplete=!1,t.isTranslating=!1,t.isRotating=!1,t.isTwoFingering=!1,t.lastDragPosition=new mn,t.firstRatio=0,t.lastAngle=0,t.goalPosition=new mn,t.goalYaw=0,t.goalScale=1,t.xDamper=new pp,t.yDamper=new pp,t.zDamper=new pp,t.yawDamper=new pp,t.scaleDamper=new pp,t.onExitWebXRButtonContainerClick=function(){return t.stopPresenting()},t.onUpdateScene=function(){null!=t.placementBox&&t.isPresenting&&(t.placementBox.dispose(),t.placementBox=new nd(t.presentedScene,t.placeOnWall?"back":"bottom"))},t.onSelectStart=function(e){var n=t.transientHitTestSource;if(null!=n){var i=t.frame.getHitTestResultsForTransientInput(n),r=t.presentedScene,a=t.placementBox;if(1===i.length){t.inputSource=e.inputSource;var o=t.inputSource.gamepad.axes,s=a.getHit(t.presentedScene,o[0],o[1]);a.show=!0,null!=s?(t.isTranslating=!0,t.lastDragPosition.copy(s)):!1===t.placeOnWall&&(t.isRotating=!0,t.lastAngle=1.5*o[0])}else if(2===i.length){a.show=!0,t.isTwoFingering=!0;var u=t.fingerPolar(i).separation;t.firstRatio=u/r.scale.x}}},t.onSelectEnd=function(){t.isTranslating=!1,t.isRotating=!1,t.isTwoFingering=!1,t.inputSource=null,t.goalPosition.y+=t.placementBox.offsetHeight*t.presentedScene.scale.x,t.placementBox.show=!1},t.threeRenderer=e.threeRenderer,t.threeRenderer.xr.enabled=!0,t}return k(o,[{key:"resolveARSession",value:(r=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ap(),e.next=3,navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay","light-estimation"],domOverlay:{root:this.overlay}});case 3:return t=e.sent,this.threeRenderer.xr.setReferenceSpaceType("local"),e.next=7,this.threeRenderer.xr.setSession(t);case 7:return this.threeRenderer.xr.cameraAutoUpdate=!1,e.abrupt("return",t);case 9:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"presentedScene",get:function(){return this._presentedScene}},{key:"supportsPresentation",value:(i=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,ap(),e.next=4,navigator.xr.isSessionSupported("immersive-ar");case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",(console.warn("Request to present in WebXR denied:"),console.warn(e.t0),console.warn("Falling back to next ar-mode"),!1));case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return i.apply(this,arguments)})},{key:"present",value:(n=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,u,l=this,c=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]&&c[1],this.isPresenting&&console.warn("Cannot present while a model is already presenting"),i=new Promise(function(e,t){requestAnimationFrame(function(){return e()})}),t.setHotspotsVisibility(!1),t.queueRender(),e.next=7,i;case 7:return this._presentedScene=t,this.overlay=t.element.shadowRoot.querySelector("div.default"),!0===n&&(this.xrLight=new Kp(this.threeRenderer),this.xrLight.addEventListener("estimationstart",function(){if(l.isPresenting&&null!=l.xrLight){var e=l.presentedScene;e.add(l.xrLight),l.oldEnvironment=e.environment,e.environment=l.xrLight.environment}})),e.next=12,this.resolveARSession();case 12:return(r=e.sent).addEventListener("end",function(){l.postSessionCleanup()},{once:!0}),(a=t.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button")).classList.add("enabled"),a.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=a,e.next=18,r.requestReferenceSpace("viewer");case 18:o=e.sent,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=t.yaw,this.goalYaw=t.yaw,this.goalScale=1,this.oldBackground=t.background,t.background=null,this.oldShadowIntensity=t.shadowIntensity,t.setShadowIntensity(0),this.oldTarget.copy(t.getTarget()),this.oldFramedFieldOfView=t.framedFieldOfView,t.addEventListener("model-load",this.onUpdateScene),s=20*Math.PI/180,u=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(s),z:-Math.cos(s)}),r.requestHitTestSource({space:o,offsetRay:u}).then(function(e){l.initialHitSource=e}),this.currentSession=r,this.placementBox=new nd(t,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:rd});case 22:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"stopPresenting",value:(t=l(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPresenting){e.next=2;break}return e.abrupt("return");case 2:return t=new Promise(function(e){n.resolveCleanup=e}),e.prev=3,e.next=6,this.currentSession.end();case 6:return e.next=8,t;case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.warn("Error while trying to end WebXR AR session"),console.warn(e.t0),this.postSessionCleanup();case 13:case"end":return e.stop()}},e,this,[[3,10]])})),function(){return t.apply(this,arguments)})},{key:"isPresenting",get:function(){return null!=this.presentedScene}},{key:"target",get:function(){return this.oldTarget}},{key:"updateTarget",value:function(){var e=this.presentedScene;if(null!=e){var t=e.getTarget();this.oldTarget.copy(t),this.placeOnWall?t.z=e.boundingBox.min.z:t.y=e.boundingBox.min.y,e.setTarget(t.x,t.y,t.z)}}},{key:"postSessionCleanup",value:function(){var e=this.currentSession;null!=e&&(e.removeEventListener("selectstart",this.onSelectStart),e.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);var t=this.presentedScene;if(null!=t){var n=t.element;null!=this.xrLight&&(t.remove(this.xrLight),null!=this.oldEnvironment&&(t.environment=this.oldEnvironment,this.oldEnvironment=null),this.xrLight.dispose(),this.xrLight=null),t.position.set(0,0,0),t.scale.set(1,1,1),t.setShadowScaleAndOffset(1,0);var i=this.turntableRotation;null!=i&&(t.yaw=i);var r=this.oldShadowIntensity;null!=r&&t.setShadowIntensity(r);var a=this.oldBackground;null!=a&&(t.background=a);var o=this.oldTarget;t.setTarget(o.x,o.y,o.z),t.framedFieldOfView=this.oldFramedFieldOfView,t.xrCamera=null,t.removeEventListener("model-load",this.onUpdateScene),t.orientHotspots(0),n.requestUpdate("cameraTarget"),n.requestUpdate("maxCameraOrbit"),n[kf](n.getBoundingClientRect())}this.renderer.height=0;var s=this.exitWebXRButtonContainer;null!=s&&(s.classList.remove("enabled"),s.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);var u=this.transientHitTestSource;null!=u&&(u.cancel(),this.transientHitTestSource=null);var l=this.initialHitSource;null!=l&&(l.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.oldBackground=null,this._presentedScene=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:id})}},{key:"updateView",value:function(e){var t=this.presentedScene,n=this.threeRenderer.xr;n.updateCamera(ld),t.xrCamera=n.getCamera();var i=t.getCamera().matrixWorld.elements;t.orientHotspots(Math.atan2(i[1],i[5])),this.initialized||(this.placeInitially(),this.initialized=!0),e.requestViewportScale&&e.recommendedViewportScale&&e.requestViewportScale(Math.max(e.recommendedViewportScale,.25));var r=this.currentSession.renderState.baseLayer.getViewport(e);this.threeRenderer.setViewport(r.x,r.y,r.width,r.height)}},{key:"placeInitially",value:function(){var e=this,t=this.presentedScene,n=t.position,i=t.element,r=t.getCamera(),a=this.overlay.getBoundingClientRect(),o=a.width,s=a.height;t.setSize(o,s),r.projectionMatrixInverse.copy(r.projectionMatrix).invert();var u=i.getCameraOrbit(),l=u.theta,c=u.radius,h=r.getWorldDirection(od);t.yaw=Math.atan2(-h.x,-h.z)-l,this.goalYaw=t.yaw,n.copy(r.position).add(h.multiplyScalar(c)),this.updateTarget();var p=t.getTarget();n.add(p).sub(this.oldTarget),this.goalPosition.copy(n),t.setHotspotsVisibility(!0);var d=this.frame.session;d.addEventListener("selectstart",this.onSelectStart),d.addEventListener("selectend",this.onSelectEnd),d.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(function(t){e.transientHitTestSource=t})}},{key:"getTouchLocation",value:function(){var e=this.inputSource.gamepad.axes,t=this.placementBox.getExpandedHit(this.presentedScene,e[0],e[1]);return null!=t&&(od.copy(t).sub(this.presentedScene.getCamera().position),od.length()>10)?null:t}},{key:"getHitPoint",value:function(e){var t=this.threeRenderer.xr.getReferenceSpace(),n=e.getPose(t);if(null==n)return null;var i=sd.fromArray(n.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(i.elements[4],i.elements[6])),i.elements[5]>.75!==this.placeOnWall?ud.setFromMatrixPosition(i):null}},{key:"moveToFloor",value:function(e){var t=this.initialHitSource;if(null!=t){var n=e.getHitTestResults(t);if(0!=n.length){var i=this.getHitPoint(n[0]);null!=i&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(i):this.goalPosition.y=i.y),t.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:"object-placed"}))}}}},{key:"fingerPolar",value:function(e){var t=e[0].inputSource.gamepad.axes,n=e[1].inputSource.gamepad.axes,i=n[0]-t[0],r=n[1]-t[1],a=Math.atan2(r,i),o=this.lastAngle-a;return o>Math.PI?o-=2*Math.PI:o<-Math.PI&&(o+=2*Math.PI),this.lastAngle=a,{separation:Math.sqrt(i*i+r*r),deltaYaw:o}}},{key:"processInput",value:function(e){var t=this,n=this.transientHitTestSource;if(null!=n&&(this.isTranslating||this.isTwoFingering||this.isRotating)){var i=e.getHitTestResultsForTransientInput(n),r=this.presentedScene,a=r.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{var o=this.fingerPolar(i),s=o.separation,u=o.deltaYaw;if(!1===this.placeOnWall&&(this.goalYaw+=u),r.canScale){var l=s/this.firstRatio;this.goalScale=l<1.3&&l>.7692307692307692?1:l}}else if(2!==i.length)if(this.isRotating){var c=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=c-this.lastAngle,this.lastAngle=c}else this.isTranslating&&i.forEach(function(e){if(e.inputSource===t.inputSource){var n=null;if(e.results.length>0&&(n=t.getHitPoint(e.results[0])),null==n&&(n=t.getTouchLocation()),null!=n){if(t.goalPosition.sub(t.lastDragPosition),!1===t.placeOnWall){var i=n.y-t.lastDragPosition.y;if(i<0){t.placementBox.offsetHeight=i/a,t.presentedScene.setShadowScaleAndOffset(a,i);var o=od.copy(r.getCamera().position),s=-i/(o.y-n.y);o.multiplyScalar(s),n.multiplyScalar(1-s).add(o)}}t.goalPosition.add(n),t.lastDragPosition.copy(n)}}});else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;var h=this.fingerPolar(i).separation;this.firstRatio=h/a}}}},{key:"moveScene",value:function(e){var t=this.presentedScene,n=t.position,i=t.yaw,r=t.idealCameraDistance,a=this.goalPosition,o=t.scale.x,s=this.placementBox;if(!a.equals(n)||this.goalScale!==o){var u=n.x,l=n.y,c=n.z;u=this.xDamper.update(u,a.x,e,r),l=this.yDamper.update(l,a.y,e,r),c=this.zDamper.update(c,a.z,e,r),n.set(u,l,c);var h=this.scaleDamper.update(o,this.goalScale,e,1);if(t.scale.set(h,h,h),!this.isTranslating){var p=a.y-l;this.placementComplete&&!1===this.placeOnWall?(s.offsetHeight=p/h,t.setShadowScaleAndOffset(h,p)):0===p&&(this.placementComplete=!0,s.show=!1,t.setShadowIntensity(.3))}}s.updateOpacity(e),t.updateTarget(e),t.yaw=this.yawDamper.update(i,this.goalYaw,e,Math.PI)}},{key:"onWebXRFrame",value:function(e,t){this.frame=t,++this.frames;var n=this.threeRenderer.xr.getReferenceSpace(),i=t.getViewerPose(n);null==i&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:"not-tracking"}));var r=this.presentedScene;if(null!=i&&null!=r&&r.element[Rf]()){!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:ad}));var a,o=!0,s=x(i.views);try{for(s.s();!(a=s.n()).done;){var u=a.value;if(this.updateView(u),o){this.moveToFloor(t),this.processInput(t);var l=e-this.lastTick;this.moveScene(l),this.renderer.preRender(r,e,l),this.lastTick=e}var c=this.threeRenderer.getContext();c.depthMask(!1),c.clear(c.DEPTH_BUFFER_BIT),c.depthMask(!0),this.threeRenderer.render(r,r.getCamera()),o=!1}}catch(h){s.e(h)}finally{s.f()}}else this.threeRenderer.clear()}}]),o}(Ht),hd=function(){function e(t){M(this,e),t.threeRenderer.debug={checkShaderErrors:!0},Promise.resolve().then(function(){self.dispatchEvent(new CustomEvent("model-viewer-renderer-debug",{detail:{renderer:t,THREE:{ShaderMaterial:Sr,Texture:cn,Mesh:gr,Scene:_s,PlaneBufferGeometry:Ur,OrthographicCamera:Jr,WebGLRenderTarget:dn}}}))})}return k(e,[{key:"addScene",value:function(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-added-debug",{detail:{scene:e}}))}},{key:"removeScene",value:function(e){self.dispatchEvent(new CustomEvent("model-viewer-scene-removed-debug",{detail:{scene:e}}))}}]),e}();function pd(e){var t=new Map,n=new Map,i=e.clone();return dd(e,i,function(e,i){t.set(i,e),n.set(e,i)}),i.traverse(function(e){if(e.isSkinnedMesh){var i=e,r=t.get(e),a=r.skeleton.bones;i.skeleton=r.skeleton.clone(),i.bindMatrix.copy(r.bindMatrix),i.skeleton.bones=a.map(function(e){return n.get(e)}),i.bind(i.skeleton,i.bindMatrix)}}),i}function dd(e,t,n){n(e,t);for(var i=0;i<e.children.length;i++)dd(e.children[i],t.children[i],n)}var fd=Symbol("prepared"),vd=Symbol("prepare"),md=Symbol("preparedGLTF"),gd=Symbol("clone"),yd=function(){function e(t){M(this,e),this[md]=t}return k(e,[{key:"parser",get:function(){return this[md].parser}},{key:"animations",get:function(){return this[md].animations}},{key:"scene",get:function(){return this[md].scene}},{key:"scenes",get:function(){return this[md].scenes}},{key:"cameras",get:function(){return this[md].cameras}},{key:"asset",get:function(){return this[md].asset}},{key:"userData",get:function(){return this[md].userData}},{key:"clone",value:function(){return new(0,this.constructor)(this[gd]())}},{key:"dispose",value:function(){this.scenes.forEach(function(e){e.traverse(function(e){if(e.isMesh){var t=e;(Array.isArray(t.material)?t.material:[t.material]).forEach(function(e){for(var t in e){var n=e[t];n instanceof cn&&n.dispose()}e.dispose()}),t.geometry.dispose()}})})}},{key:gd,value:function(){var e=this[md],t=pd(this.scene);bd(t,this.scene);var n=[t],i=e.userData?Object.assign({},e.userData):{};return Object.assign(Object.assign({},e),{scene:t,scenes:n,userData:i})}}],[{key:"prepare",value:function(e){if(null==e.scene)throw new Error("Model does not have a scene");if(e[fd])return e;var t=this[vd](e);return t[fd]=!0,t}},{key:vd,value:function(e){var t=e.scene,n=[t];return Object.assign(Object.assign({},e),{scene:t,scenes:n})}}]),e}(),bd=function(e,t){xd(e,t,function(e,t){void 0!==t.userData.variantMaterials&&(e.userData.variantMaterials=new Map(t.userData.variantMaterials)),void 0!==t.userData.originalMaterial&&(e.userData.originalMaterial=t.userData.originalMaterial)})},xd=function e(t,n,i){i(t,n);for(var r=0;r<t.children.length;r++)e(t.children[r],n.children[r],i)},wd=Symbol("threeGLTF"),_d=Symbol("gltf"),Sd=Symbol("gltfElementMap"),Md=Symbol("threeObjectMap"),Td=Symbol("parallelTraverseThreeScene"),kd=Symbol("correlateOriginalThreeGLTF"),Ed=Symbol("correlateCloneThreeGLTF"),Ad=function(){function e(t,n,i,r){M(this,e),this[wd]=t,this[_d]=n,this[Sd]=r,this[Md]=i}return k(e,[{key:"threeGLTF",get:function(){return this[wd]}},{key:"gltf",get:function(){return this[_d]}},{key:"gltfElementMap",get:function(){return this[Sd]}},{key:"threeObjectMap",get:function(){return this[Md]}}],[{key:"from",value:function(e,t){return null!=t?this[Ed](e,t):this[kd](e)}},{key:kd,value:function(t){var n,i=t.parser.json,a=t.parser.associations,o=new Map,s={name:"Default"},u={type:"materials",index:-1},l=x(a.keys());try{for(l.s();!(n=l.n()).done;){var c=n.value;c instanceof Li&&null==a.get(c)&&(u.index<0&&(null==i.materials&&(i.materials=[]),u.index=i.materials.length,i.materials.push(s)),c.name=s.name,a.set(c,{materials:u.index}))}}catch(w){l.e(w)}finally{l.f()}var h,p=x(a);try{for(p.s();!(h=p.n()).done;){var d=r(h.value,2),f=d[0],v=d[1];if(v){var m=f;m.userData=m.userData||{},m.userData.associations=v}for(var g in v)if(null!=g&&"primitives"!==g){var y=(i[g]||[])[v[g]];if(null==y)continue;var b=o.get(y);null==b&&(b=new Set,o.set(y,b)),b.add(f)}}}catch(w){p.e(w)}finally{p.f()}return new e(t,i,a,o)}},{key:Ed,value:function(t,n){for(var i=n.threeGLTF,r=JSON.parse(JSON.stringify(n.gltf)),a=new Map,o=new Map,s=0;s<i.scenes.length;s++)this[Td](i.scenes[s],t.scenes[s],function(e,t){var i=n.threeObjectMap.get(e);if(null!=i)for(var s in i)if(null!=s&&"primitives"!==s){var u=s,l=i[u],c=r[u][l],h=a.get(t)||{};h[u]=l,a.set(t,h);var p=o.get(c)||new Set;p.add(t),o.set(c,p)}});return new e(t,r,a,o)}},{key:Td,value:function(e,t,n){!function e(t,i){if(n(t,i),t.isObject3D){if(t.isMesh)if(Array.isArray(t.material))for(var r=0;r<t.material.length;++r)e(t.material[r],i.material[r]);else e(t.material,i.material);for(var a=0;a<t.children.length;++a)e(t.children[a],i.children[a])}}(e,t)}}]),e}(),Cd=Symbol("cloneAndPatchMaterial"),Od=Symbol("correlatedSceneGraph"),Ld=function(e){d(n,e);var t=v(n);function n(){return M(this,n),t.apply(this,arguments)}return k(n,[{key:"correlatedSceneGraph",get:function(){return this[md][Od]}},{key:gd,value:function(){var e=this,t=p(b(n.prototype),gd,this).call(this),i=new Map;return t.scene.traverse(function(t){if(t.isMesh){var n=t;Array.isArray(n.material)?n.material=n.material.map(function(t){return e[Cd](t,i)}):null!=n.material&&(n.material=e[Cd](n.material,i))}}),t[Od]=Ad.from(t,this.correlatedSceneGraph),t}},{key:Cd,value:function(e,t){if(t.has(e.uuid))return t.get(e.uuid);var n=e.clone();null!=e.map&&(n.map=e.map.clone(),n.map.needsUpdate=!0),null!=e.normalMap&&(n.normalMap=e.normalMap.clone(),n.normalMap.needsUpdate=!0),null!=e.emissiveMap&&(n.emissiveMap=e.emissiveMap.clone(),n.emissiveMap.needsUpdate=!0);var i=null;if(null!=e.roughnessMap&&(i=e.roughnessMap.clone()),null!=i){i.needsUpdate=!0,n.roughnessMap=i;var r=Hd.singleton,a=r.threeRenderer,o=r.roughnessMipmapper,s=a.xr.enabled;a.xr.enabled=!1;var u=n.roughnessMap.image;o.generateMipmaps(n),n.roughnessMap.image=u,a.xr.enabled=s}return e.roughnessMap===e.metalnessMap?n.metalnessMap=i:null!=e.metalnessMap&&(n.metalnessMap=e.metalnessMap.clone(),n.metalnessMap.needsUpdate=!0),e.roughnessMap===e.aoMap?n.aoMap=i:null!=e.aoMap&&(n.aoMap=e.aoMap.clone(),n.aoMap.needsUpdate=!0),n.shadowSide=0,t.set(e.uuid,n),n}}],[{key:vd,value:function(e){var t=p(b(n),vd,this).call(this,e);null==t[Od]&&(t[Od]=Ad.from(t));var i=t.scene,r=new Un(void 0,1/0);return i.traverse(function(e){e.renderOrder=1e3,e.frustumCulled=!1,e.name||(e.name=e.uuid);var t=e;t.isMesh&&(t.castShadow=!0,t.isSkinnedMesh&&(t.geometry.boundingSphere=r,t.geometry.boundingBox=null))}),t}}]),n}(yd),Rd=function(e){d(n,e);var t=v(n);function n(){var e;M(this,n),(e=t.call(this)).position.y=-3.5;var i=new br;i.deleteAttribute("uv");var r=new xl({metalness:0,side:1}),a=new xl({metalness:0}),o=new ic(16777215,500,28,2);o.position.set(.418,16.199,.3),e.add(o);var s=new gr(i,r);s.position.set(-.757,13.219,.717),s.scale.set(31.713,28.305,28.591),e.add(s);var u=new gr(i,a);u.position.set(-10.906,2.009,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),e.add(u);var l=new gr(i,a);l.position.set(-5.607,-.754,-.758),l.rotation.set(0,.994,0),l.scale.set(1.97,1.534,3.955),e.add(l);var c=new gr(i,a);c.position.set(6.167,.857,7.803),c.rotation.set(0,.561,0),c.scale.set(3.927,6.285,3.687),e.add(c);var h=new gr(i,a);h.position.set(-2.017,.018,6.124),h.rotation.set(0,.333,0),h.scale.set(2.002,4.566,2.064),e.add(h);var p=new gr(i,a);p.position.set(2.291,-.756,-2.621),p.rotation.set(0,-.286,0),p.scale.set(1.546,1.552,1.496),e.add(p);var d=new gr(i,a);d.position.set(-2.193,-.369,-5.547),d.rotation.set(0,.516,0),d.scale.set(3.875,3.487,2.986),e.add(d);var f=new gr(i,e.createAreaLightMaterial(50));f.position.set(-16.116,14.37,8.208),f.scale.set(.1,2.428,2.739),e.add(f);var v=new gr(i,e.createAreaLightMaterial(50));v.position.set(-16.109,18.021,-8.207),v.scale.set(.1,2.425,2.751),e.add(v);var m=new gr(i,e.createAreaLightMaterial(17));m.position.set(14.904,12.198,-1.832),m.scale.set(.15,4.265,6.331),e.add(m);var g=new gr(i,e.createAreaLightMaterial(43));g.position.set(-.462,8.89,14.52),g.scale.set(4.38,5.441,.088),e.add(g);var y=new gr(i,e.createAreaLightMaterial(20));y.position.set(3.235,11.486,-12.541),y.scale.set(2.5,2,.1),e.add(y);var b=new gr(i,e.createAreaLightMaterial(100));return b.position.set(0,20,0),b.scale.set(1,.1,1),e.add(b),e}return k(n,[{key:"createAreaLightMaterial",value:function(e){var t=new Bi;return t.color.setScalar(e),t}}]),n}(_s),Pd=function(e){d(n,e);var t=v(n);function n(){var e;M(this,n),(e=t.call(this)).position.y=-3.5;var i=new br;i.deleteAttribute("uv");var r=new xl({metalness:0,side:1}),a=new xl({metalness:0}),o=new ic(16777215,400,28,2);o.position.set(.5,14,.5),e.add(o);var s=new gr(i,r);s.position.set(0,13.2,0),s.scale.set(31.5,28.5,31.5),e.add(s);var u=new gr(i,a);u.position.set(-10.906,-1,1.846),u.rotation.set(0,-.195,0),u.scale.set(2.328,7.905,4.651),e.add(u);var l=new gr(i,a);l.position.set(-5.607,-.754,-.758),l.rotation.set(0,.994,0),l.scale.set(1.97,1.534,3.955),e.add(l);var c=new gr(i,a);c.position.set(6.167,-.16,7.803),c.rotation.set(0,.561,0),c.scale.set(3.927,6.285,3.687),e.add(c);var h=new gr(i,a);h.position.set(-2.017,.018,6.124),h.rotation.set(0,.333,0),h.scale.set(2.002,4.566,2.064),e.add(h);var p=new gr(i,a);p.position.set(2.291,-.756,-2.621),p.rotation.set(0,-.286,0),p.scale.set(1.546,1.552,1.496),e.add(p);var d=new gr(i,a);d.position.set(-2.193,-.369,-5.547),d.rotation.set(0,.516,0),d.scale.set(3.875,3.487,2.986),e.add(d);var f=new gr(i,e.createAreaLightMaterial(80));f.position.set(-14,10,8),f.scale.set(.1,2.5,2.5),e.add(f);var v=new gr(i,e.createAreaLightMaterial(80));v.position.set(-14,14,-4),v.scale.set(.1,2.5,2.5),e.add(v);var m=new gr(i,e.createAreaLightMaterial(23));m.position.set(14,12,0),m.scale.set(.1,5,5),e.add(m);var g=new gr(i,e.createAreaLightMaterial(16));g.position.set(0,9,14),g.scale.set(5,5,.1),e.add(g);var y=new gr(i,e.createAreaLightMaterial(80));y.position.set(7,8,-14),y.scale.set(2.5,2.5,.1),e.add(y);var b=new gr(i,e.createAreaLightMaterial(80));b.position.set(-7,16,-14),b.scale.set(2.5,2.5,.1),e.add(b);var x=new gr(i,e.createAreaLightMaterial(1));return x.position.set(0,20,0),x.scale.set(.1,.1,.1),e.add(x),e}return k(n,[{key:"createAreaLightMaterial",value:function(e){var t=new Bi;return t.color.setScalar(e),t}}]),n}(_s),Id=/\.hdr(\.js)?$/,Nd=new jl,Dd=new(function(e){d(n,e);var t=v(n);function n(e){var i;return M(this,n),(i=t.call(this,e)).type=1016,i}return k(n,[{key:"parse",value:function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var i=e.pos,r=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));0>(r=s.indexOf("\n"))&&a<t&&i<e.byteLength;)o+=s,a+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<r&&(!1!==n&&(e.pos+=a+r+1),o+s.slice(0,r))},i=function(e,t,n,i){var r=Math.pow(2,e[t+3]-128)/255;n[i+0]=e[t+0]*r,n[i+1]=e[t+1]*r,n[i+2]=e[t+2]*r},r=function(e,t,n,i){var r=Math.pow(2,e[t+3]-128)/255;n[i+0]=Pc.toHalfFloat(Math.min(e[t+0]*r,65504)),n[i+1]=Pc.toHalfFloat(Math.min(e[t+1]*r,65504)),n[i+2]=Pc.toHalfFloat(Math.min(e[t+2]*r,65504))},a=new Uint8Array(e);a.pos=0;var o=function(e){var i,r,a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(i=n(e)))return t(1,"no header found");if(!(r=i.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(l.valid|=1,l.programtype=r[1],l.string+=i+"\n";!1!==(i=n(e));)if(l.string+=i+"\n","#"!==i.charAt(0)){if((r=i.match(a))&&(l.gamma=parseFloat(r[1],10)),(r=i.match(o))&&(l.exposure=parseFloat(r[1],10)),(r=i.match(s))&&(l.valid|=2,l.format=r[1]),(r=i.match(u))&&(l.valid|=4,l.height=parseInt(r[1],10),l.width=parseInt(r[2],10)),2&l.valid&&4&l.valid)break}else l.comments+=i+"\n";return 2&l.valid?4&l.valid?l:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(-1!==o){var s=o.width,u=o.height,l=function(e,n,i){var r=n;if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");var a=new Uint8Array(4*n*i);if(!a.length)return t(4,"unable to allocate buffer space");for(var o=0,s=0,u=4*r,l=new Uint8Array(4),c=new Uint8Array(u),h=i;h>0&&s<e.byteLength;){if(s+4>e.byteLength)return t(1);if(l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],l[3]=e[s++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=r)return t(3,"bad rgbe scanline format");for(var p=void 0,d=0;d<u&&s<e.byteLength;){var f=(p=e[s++])>128;if(f&&(p-=128),0===p||d+p>u)return t(3,"bad scanline data");if(f)for(var v=e[s++],m=0;m<p;m++)c[d++]=v;else c.set(e.subarray(s,s+p),d),d+=p,s+=p}for(var g=r,y=0;y<g;y++){var b=0;a[o]=c[y+b],b+=r,a[o+1]=c[y+b],b+=r,a[o+2]=c[y+b],b+=r,a[o+3]=c[y+b],o+=4}h--}return a}(a.subarray(a.pos),s,u);if(-1!==l){var c,h,p,d;switch(this.type){case 1009:c=l,h=1023,p=1009;break;case 1015:d=l.length/4;for(var f=new Float32Array(3*d),v=0;v<d;v++)i(l,4*v,f,3*v);c=f,h=1022,p=1015;break;case 1016:d=l.length/4;for(var m=new Uint16Array(3*d),g=0;g<d;g++)r(l,4*g,m,3*g);c=m,h=1022,p=1016;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:s,height:u,data:c,header:o.string,gamma:o.gamma,exposure:o.exposure,format:h,type:p}}}return null}},{key:"setDataType",value:function(e){return this.type=e,this}},{key:"load",value:function(e,t,i,r){return p(b(n.prototype),"load",this).call(this,e,function(e,n){switch(e.type){case 1009:e.encoding=3002,e.minFilter=1003,e.magFilter=1003,e.generateMipmaps=!1,e.flipY=!0;break;case 1015:case 1016:e.encoding=3e3,e.minFilter=1006,e.magFilter=1006,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)},i,r)}}]),n}(Gl));Dd.setDataType(1016);var Fd,Ud,Bd=function(e){d(f,e);var t,n,i,a,o,s,u,c,h,p=v(f);function f(e){var t;return M(this,f),(t=p.call(this)).threeRenderer=e,t.generatedEnvironmentMap=null,t.generatedEnvironmentMapAlt=null,t.skyboxCache=new Map,t.blurMaterial=null,t.blurScene=null,t}return k(f,[{key:"load",value:(h=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:function(){},e.prev=1,i=Id.test(t),r=i?Dd:Nd,e.next=6,new Promise(function(e,i){return r.load(t,e,function(e){n(e.loaded/e.total*.9)},i)});case 6:return a=e.sent,e.abrupt("return",(n(1),a.name=t,a.mapping=303,i||(a.encoding=3007),a));case 8:return e.prev=8,n&&n(1),e.finish(8);case 11:case"end":return e.stop()}},e,null,[[1,,8,11]])})),function(e){return h.apply(this,arguments)})},{key:"generateEnvironmentMapAndSkybox",value:(c=l(regeneratorRuntime.mark(function e(){var t,n,i,a,o,s,u,l,c,h,p,d,f,v=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:null,n=v.length>1&&void 0!==v[1]?v[1]:null,i=v.length>2&&void 0!==v[2]?v[2]:{},a=i.progressTracker,o=null!=a?a.beginActivity():function(){},!0==(s="neutral"===n)&&(n=null),u=rp(n),e.prev=6,c=Promise.resolve(null),t&&(c=this.loadEquirectFromUrl(t,a)),l=u?this.loadEquirectFromUrl(u,a):t?this.loadEquirectFromUrl(t,a):!0===s?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap(),e.next=11,Promise.all([l,c]);case 11:if(h=e.sent,p=r(h,2),d=p[0],f=p[1],null!=d){e.next=17;break}throw new Error("Failed to load environment map.");case 17:return e.abrupt("return",{environmentMap:d,skybox:f});case 18:return e.prev=18,o(1),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[6,,18,21]])})),function(){return c.apply(this,arguments)})},{key:"loadEquirectFromUrl",value:(u=l(regeneratorRuntime.mark(function e(t,n){var i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.skyboxCache.has(t)||(i=n?n.beginActivity():function(){},r=this.load(t,i),this.skyboxCache.set(t,r)),e.abrupt("return",this.skyboxCache.get(t));case 2:case"end":return e.stop()}},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"GenerateEnvironmentMap",value:(s=l(regeneratorRuntime.mark(function e(t,n){var i,r,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hp();case 2:return i=this.threeRenderer,r=new Ar(256,{generateMipmaps:!1,type:1016,format:1023,encoding:3e3,depthBuffer:!0}),a=new kr(.1,100,r),(o=a.renderTarget.texture).name=n,o.isRenderTargetTexture=!1,o.images=[1,1,1,1,1,1],t.scale.setComponent(0,-1),s=i.outputEncoding,u=i.toneMapping,i.toneMapping=0,i.outputEncoding=3e3,a.update(i,t),e.next=10,this.blurCubemap(r,.04);case 10:return i.toneMapping=u,i.outputEncoding=s,e.abrupt("return",o);case 13:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"loadGeneratedEnvironmentMap",value:(o=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new Rd,"default")),this.generatedEnvironmentMap));case 1:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"loadGeneratedEnvironmentMapAlt",value:(a=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new Pd,"neutral")),this.generatedEnvironmentMapAlt));case 1:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"blurCubemap",value:(i=l(regeneratorRuntime.mark(function e(t,n){var i,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null==this.blurMaterial&&(this.blurMaterial=this.getBlurShader(20),i=new br,r=new gr(i,this.blurMaterial),this.blurScene=new _s,this.blurScene.add(r)),a=t.clone(),this.halfblur(t,a,n,"latitudinal"),this.halfblur(a,t,n,"longitudinal");case 3:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"halfblur",value:(n=l(regeneratorRuntime.mark(function e(t,n,i,r){var a,o,s,u,l,c,h,p,d,f,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.width,o=isFinite(i)?Math.PI/(2*a):2*Math.PI/39,s=i/o,(u=isFinite(i)?1+Math.floor(3*s):20)>20&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(u," samples when the maximum is set to 20")),l=[],c=0,h=0;h<20;++h)p=h/s,d=Math.exp(-p*p/2),l.push(d),0==h?c+=d:h<u&&(c+=2*d);for(f=0;f<l.length;f++)l[f]=l[f]/c;(v=this.blurMaterial.uniforms).envMap.value=t.texture,v.samples.value=u,v.weights.value=l,v.latitudinal.value="latitudinal"===r,v.dTheta.value=o,new kr(.1,100,n).update(this.threeRenderer,this.blurScene);case 8:case"end":return e.stop()}},e,this)})),function(e,t,i,r){return n.apply(this,arguments)})},{key:"getBlurShader",value:function(e){var t=new Float32Array(e),n=new mn(0,1,0);return new Sr({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:n}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:0,depthTest:!1,depthWrite:!1,side:1})}},{key:"dispose",value:(t=l(regeneratorRuntime.mark(function e(){var t,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=x(this.skyboxCache),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=10;break}return i=r(n.value,2),a=i[1],e.next=7,a;case 7:e.sent.dispose();case 8:e.next=3;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),t.e(e.t0);case 15:return e.prev=15,t.f(),e.finish(15);case 18:if(e.t1=null!=this.generatedEnvironmentMap,!e.t1){e.next=24;break}return e.next=22,this.generatedEnvironmentMap;case 22:e.sent.dispose(),this.generatedEnvironmentMap=null;case 24:if(e.t2=null!=this.generatedEnvironmentMapAlt,!e.t2){e.next=30;break}return e.next=28,this.generatedEnvironmentMapAlt;case 28:e.sent.dispose(),this.generatedEnvironmentMapAlt=null;case 30:null!=this.blurMaterial&&this.blurMaterial.dispose();case 31:case"end":return e.stop()}},e,this,[[1,12,15,18]])})),function(){return t.apply(this,arguments)})}]),f}(Ht),Vd=[1,.79,.62,.5,.4,.31,.25],Hd=function(e){d(n,e);var t=v(n);function n(e){var i;M(this,n),(i=t.call(this)).loader=new Xh(Ld),i.width=0,i.height=0,i.dpr=1,i.debugger=null,i.scenes=new Set,i.multipleScenesVisible=!1,i.scaleStep=0,i.lastStep=3,i.avgFrameDuration=22,i.onWebGLContextLost=function(e){i.dispatchEvent({type:"contextlost",sourceEvent:e})},i.onWebGLContextRestored=function(){var e;null===(e=i.textureUtils)||void 0===e||e.dispose(),i.textureUtils=new Bd(i.threeRenderer),i.roughnessMipmapper=new Gp(i.threeRenderer);var t,n=x(i.scenes);try{for(n.s();!(t=n.n()).done;){t.value.element[Jp]()}}catch(r){n.e(r)}finally{n.f()}i.threeRenderer.shadowMap.needsUpdate=!0},i.dpr=lp(),i.canvas3D=document.createElement("canvas"),i.canvas3D.id="webgl-canvas";try{i.threeRenderer=new ws({canvas:i.canvas3D,alpha:!0,antialias:!0,powerPreference:e.powerPreference,preserveDrawingBuffer:!0}),i.threeRenderer.autoClear=!0,i.threeRenderer.outputEncoding=3007,i.threeRenderer.physicallyCorrectLights=!0,i.threeRenderer.setPixelRatio(1),i.threeRenderer.shadowMap.enabled=!0,i.threeRenderer.shadowMap.type=2,i.threeRenderer.shadowMap.autoUpdate=!1,i.debugger=e.debug?new hd(g(i)):null,i.threeRenderer.debug={checkShaderErrors:!!i.debugger},i.threeRenderer.toneMapping=4}catch(e){console.warn(e)}return i.arRenderer=new cd(g(i)),i.textureUtils=i.canRender?new Bd(i.threeRenderer):null,i.roughnessMipmapper=new Gp(i.threeRenderer),Xh.initializeKTX2Loader(i.threeRenderer),i.canvas3D.addEventListener("webglcontextlost",i.onWebGLContextLost),i.canvas3D.addEventListener("webglcontextrestored",i.onWebGLContextRestored),i.updateRendererSize(),i.lastTick=performance.now(),i.avgFrameDuration=0,i}return k(n,[{key:"canRender",get:function(){return null!=this.threeRenderer}},{key:"scaleFactor",get:function(){return Vd[this.scaleStep]}},{key:"minScale",set:function(e){for(var t=1;t<Vd.length&&!(Vd[t]<e);)++t;this.lastStep=t-1}},{key:"updateRendererSize",value:function(){var e=lp();if(e!==this.dpr){var t,n=x(this.scenes);try{for(n.s();!(t=n.n()).done;){var i=t.value.element;i[hf](i.getBoundingClientRect())}}catch(m){n.e(m)}finally{n.f()}}var r,a=0,o=0,s=x(this.scenes);try{for(s.s();!(r=s.n()).done;){var u=r.value;a=Math.max(a,u.width),o=Math.max(o,u.height)}}catch(m){s.e(m)}finally{s.f()}if(a!==this.width||o!==this.height||e!==this.dpr){this.width=a,this.height=o,this.dpr=e,this.canRender&&this.threeRenderer.setSize(a*e,o*e,!1);var l=this.scaleFactor,c=a/l,h=o/l;this.canvas3D.style.width="".concat(c,"px"),this.canvas3D.style.height="".concat(h,"px");var p,d=x(this.scenes);try{for(d.s();!(p=d.n()).done;){var f=p.value,v=f.canvas;v.width=Math.round(a*e),v.height=Math.round(o*e),v.style.width="".concat(c,"px"),v.style.height="".concat(h,"px"),f.queueRender()}}catch(m){d.e(m)}finally{d.f()}}}},{key:"updateRendererScale",value:function(){var e=this.scaleStep;if(this.avgFrameDuration>26?++this.scaleStep:this.avgFrameDuration<18&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),e!=this.scaleStep){var t=this.scaleFactor;this.avgFrameDuration=22;var n=this.width/t,i=this.height/t;this.canvas3D.style.width="".concat(n,"px"),this.canvas3D.style.height="".concat(i,"px");var r,a=x(this.scenes);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.canvas.style;s.width="".concat(n,"px"),s.height="".concat(i,"px"),o.queueRender()}}catch(u){a.e(u)}finally{a.f()}}}},{key:"registerScene",value:function(e){var t=this;this.scenes.add(e);var n=e.canvas,i=this.scaleFactor;n.width=Math.round(this.width*this.dpr),n.height=Math.round(this.height*this.dpr),n.style.width=this.width/i+"px",n.style.height=this.height/i+"px",this.multipleScenesVisible&&n.classList.add("show"),e.queueRender(),this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(function(e,n){return t.render(e,n)}),null!=this.debugger&&this.debugger.addScene(e)}},{key:"unregisterScene",value:function(e){this.scenes.delete(e),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null),null!=this.debugger&&this.debugger.removeScene(e)}},{key:"displayCanvas",value:function(e){return this.multipleScenesVisible?e.element[wf]:this.canvas3D}},{key:"selectCanvas",value:function(){var e,t=0,n=null,i=x(this.scenes);try{for(i.s();!(e=i.n()).done;){var r=e.value;r.element.modelIsVisible&&null==r.externalRenderer&&(++t,n=r.canvas)}}catch(h){i.e(h)}finally{i.f()}if(null!=n){var a=t>1,o=this.canvas3D;if(a!==this.multipleScenesVisible||!a&&o.parentElement!==n.parentElement){this.multipleScenesVisible=a,a&&o.classList.remove("show");var s,u=x(this.scenes);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(null==l.externalRenderer){var c=l.element[wf];a?(c.classList.add("show"),l.queueRender()):l.canvas===n&&(l.canvas.parentElement.appendChild(o),o.classList.add("show"),c.classList.remove("show"),l.queueRender())}}}catch(h){u.e(h)}finally{u.f()}}}}},{key:"orderedScenes",value:function(){for(var e=[],t=0,n=[!1,!0];t<n.length;t++){var i,r=n[t],a=x(this.scenes);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.element.modelIsVisible===r&&e.push(o)}}catch(s){a.e(s)}finally{a.f()}}return e}},{key:"isPresenting",get:function(){return this.arRenderer.isPresenting}},{key:"preRender",value:function(e,t,n){var i=e.element,r=e.exposure;i[Mf](t,n);var a="number"==typeof r&&!self.isNaN(r);this.threeRenderer.toneMappingExposure=a?r:1,e.isShadowDirty()&&(this.threeRenderer.shadowMap.needsUpdate=!0)}},{key:"render",value:function(e,t){if(null==t){var n=e-this.lastTick;if(this.lastTick=e,this.canRender&&!this.isPresenting){this.avgFrameDuration+=up(.2*(n-this.avgFrameDuration),-2,2),this.selectCanvas(),this.updateRendererSize(),this.updateRendererScale();var i,r=this.dpr,a=this.scaleFactor,o=x(this.orderedScenes());try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.element;if((u.modelIsVisible||!(s.renderCount>0))&&(this.preRender(s,e,n),s.shouldRender()))if(null==s.externalRenderer){if(!u.modelIsVisible&&!this.multipleScenesVisible){var l,c=x(this.scenes);try{for(c.s();!(l=c.n()).done;){var h=l.value;h.element.modelIsVisible&&h.queueRender()}}catch(w){c.e(w)}finally{c.f()}}var p=Math.min(Math.ceil(s.width*a*r),this.canvas3D.width),d=Math.min(Math.ceil(s.height*a*r),this.canvas3D.height);if(this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.floor(this.height*r)-d,p,d),this.threeRenderer.render(s,s.camera),this.multipleScenesVisible){null==s.context&&s.createContext();var f=s.context;f.clearRect(0,0,p,d),f.drawImage(this.canvas3D,0,0,p,d,0,0,p,d)}s.hasRendered(),u.loaded&&++s.renderCount}else{var v=s.getCamera();v.updateMatrix();var m=v.matrix,g=v.projectionMatrix,y=m.elements.slice(),b=s.getTarget();y[12]+=b.x,y[13]+=b.y,y[14]+=b.z,s.externalRenderer.render({viewMatrix:y,projectionMatrix:g.elements})}}}catch(w){o.e(w)}finally{o.f()}}}else this.arRenderer.onWebXRFrame(e,t)}},{key:"dispose",value:function(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.roughnessMipmapper&&this.roughnessMipmapper.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;var e,t=[],n=x(this.scenes);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(i.element)}}catch(r){n.e(r)}finally{n.f()}return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),t}}],[{key:"singleton",get:function(){return this._singleton}},{key:"resetSingleton",value:function(){var e,t=this._singleton.dispose(),i=x(t);try{for(i.s();!(e=i.n()).done;){e.value.disconnectedCallback()}}catch(o){i.e(o)}finally{i.f()}this._singleton=new n({powerPreference:(self.ModelViewerElement||{}).powerPreference||"high-performance",debug:cp()});var r,a=x(t);try{for(a.s();!(r=a.n()).done;){r.value.connectedCallback()}}catch(o){a.e(o)}finally{a.f()}}}]),n}(Ht);Hd._singleton=new Hd({powerPreference:(self.ModelViewerElement||{}).powerPreference||"high-performance",debug:cp()});var zd,Zd,Gd,jd,qd,Wd,Jd,Yd,Xd,Qd,Kd=Symbol("ongoingActivities"),$d=Symbol("announceTotalProgress"),ef=Symbol("eventDelegate"),tf=function(e){function t(){var e=this;M(this,t),this[Fd]=document.createDocumentFragment(),this.addEventListener=function(){var t;return(t=e[ef]).addEventListener.apply(t,arguments)},this.removeEventListener=function(){var t;return(t=e[ef]).removeEventListener.apply(t,arguments)},this.dispatchEvent=function(){var t;return(t=e[ef]).dispatchEvent.apply(t,arguments)},this[Ud]=new Set}return k(t,[{key:"ongoingActivityCount",get:function(){return this[Kd].size}},{key:"beginActivity",value:function(){var e=this,t={progress:0};return this[Kd].add(t),1===this.ongoingActivityCount&&this[$d](),function(n){var i;return(i=Math.max(up(n,0,1),t.progress))!==t.progress&&(t.progress=i,e[$d]()),t.progress}}},{key:e,value:function(){var e,t=0,n=0,i=0,r=x(this[Kd]);try{for(r.s();!(e=r.n()).done;){var a=e.value.progress;t+=a*(.5/Math.pow(2,n++)),1===a&&i++}}catch(o){r.e(o)}finally{r.f()}i===this.ongoingActivityCount&&(t=1,this[Kd].clear()),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:t}}))}}]),t}((Fd=ef,Ud=Kd,$d)),nf=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rf=document.createElement("canvas"),af=Symbol("fallbackResizeHandler"),of=Symbol("defaultAriaLabel"),sf=Symbol("resizeObserver"),uf=Symbol("clearModelTimeout"),lf=Symbol("onContextLost"),cf=Symbol("loaded"),hf=Symbol("updateSize"),pf=Symbol("intersectionObserver"),df=Symbol("isElementInViewport"),ff=Symbol("announceModelVisibility"),vf=Symbol("ariaLabel"),mf=Symbol("loadedTime"),gf=Symbol("updateSource"),yf=Symbol("markLoaded"),bf=Symbol("container"),xf=Symbol("input"),wf=Symbol("canvas"),_f=Symbol("scene"),Sf=Symbol("needsRender"),Mf=Symbol("tick"),Tf=Symbol("onModelLoad"),kf=Symbol("onResize"),Ef=Symbol("renderer"),Af=Symbol("progressTracker"),Cf=Symbol("getLoaded"),Of=Symbol("getModelIsVisible"),Lf=Symbol("shouldAttemptPreload"),Rf=Symbol("sceneIsReady"),Pf=Symbol("hasTransitioned"),If=function(e){return{x:e.x,y:e.y,z:e.z,toString:function(){return"".concat(this.x,"m ").concat(this.y,"m ").concat(this.z,"m")}}},Nf=function(e,t,n){d(o,e);var i,r,a=v(o);function o(){var e;M(this,o),(e=a.call(this)).alt=null,e.src=null,e[zd]=!1,e[Zd]=!1,e[Gd]=0,e[jd]=null,e[qd]=sp(function(){var t=e.getBoundingClientRect();e[hf](t)},50),e[Wd]=sp(function(t){var n=e.modelIsVisible;n!==t&&e.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:n}}))},0),e[Jd]=null,e[Yd]=null,e[Xd]=new tf,e[Qd]=function(t){e.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:t.sourceEvent}}))},e.attachShadow({mode:"open"});var t,n,i=e.shadowRoot;if(function(e){ht(Vt,e)}(i),e[bf]=i.querySelector(".container"),e[xf]=i.querySelector(".userInput"),e[wf]=i.querySelector("canvas"),e[of]=e[xf].getAttribute("aria-label"),e.isConnected){var r=e.getBoundingClientRect();t=r.width,n=r.height}else t=300,n=150;return e[_f]=new Up({canvas:e[wf],element:g(e),width:t,height:n}),e[_f].addEventListener("model-load",function(){var t=l(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e[yf](),e[Tf](),t.next=4,hp();case 4:e.dispatchEvent(new CustomEvent("load",{detail:{url:n.url}}));case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),Promise.resolve().then(function(){e[hf](e.getBoundingClientRect())}),Lt&&(e[sf]=new ResizeObserver(function(t){if(!e[Ef].isPresenting){var n,i=x(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.target===g(e)&&e[hf](r.contentRect)}}catch(a){i.e(a)}finally{i.f()}}})),Rt?e[pf]=new IntersectionObserver(function(t){var n,i=x(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.target===g(e)){var a=e.modelIsVisible;e[df]=r.isIntersecting,e[ff](a),e[df]&&!e[Rf]()&&e[gf]()}}}catch(o){i.e(o)}finally{i.f()}},{root:null,rootMargin:"0px",threshold:0}):e[df]=!0,e}return k(o,[{key:"loaded",get:function(){return this[Cf]()}},{key:t,get:function(){return Hd.singleton}},{key:"modelIsVisible",get:function(){return this[Of]()}},{key:"connectedCallback",value:function(){p(b(o.prototype),"connectedCallback",this)&&p(b(o.prototype),"connectedCallback",this).call(this),Lt?this[sf].observe(this):self.addEventListener("resize",this[af]),Rt&&this[pf].observe(this);var e=this[Ef];e.addEventListener("contextlost",this[lf]),e.registerScene(this[_f]),null!=this[uf]&&(self.clearTimeout(this[uf]),this[uf]=null,this.requestUpdate("src",null))}},{key:"disconnectedCallback",value:function(){var e=this;p(b(o.prototype),"disconnectedCallback",this)&&p(b(o.prototype),"disconnectedCallback",this).call(this),Lt?this[sf].unobserve(this):self.removeEventListener("resize",this[af]),Rt&&this[pf].unobserve(this);var t=this[Ef];t.removeEventListener("contextlost",this[lf]),t.unregisterScene(this[_f]),this[uf]=self.setTimeout(function(){e[_f].reset()},1e3)}},{key:"updated",value:function(e){p(b(o.prototype),"updated",this).call(this,e),e.has("src")&&(null==this.src?(this[cf]=!1,this[mf]=0,this[_f].reset()):this.src!==this[_f].url&&(this[cf]=!1,this[mf]=0,this[gf]())),e.has("alt")&&this[xf].setAttribute("aria-label",null==this.alt?this[of]:this.alt)}},{key:"toDataURL",value:function(e,t){return this[Ef].displayCanvas(this[_f]).toDataURL(e,t)}},{key:"toBlob",value:(r=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,u,c,h,p,d,f,v,m,g,y,b,x=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?t.mimeType:void 0,i=t?t.qualityArgument:void 0,r=t?t.idealAspect:void 0,a=this[_f],o=a.width,s=a.height,u=a.fieldOfViewAspect,c=a.aspect,h=this[Ef],p=h.dpr,d=h.scaleFactor,f=o*d*p,v=s*d*p,m=0,g=0,!0===r&&(u>c?(y=v,v=Math.round(f/u),g=(y-v)/2):(b=f,f=Math.round(v*u),m=(b-f)/2)),rf.width=f,rf.height=v,e.prev=4,e.abrupt("return",new Promise(function(){var e=l(regeneratorRuntime.mark(function e(t,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(rf.getContext("2d").drawImage(x[Ef].displayCanvas(x[_f]),m,g,f,v,0,0,f,v),rf.msToBlob&&(!n||"image/png"===n)){e.next=14;break}if(!rf.toBlob){e.next=6;break}e.t1=void rf.toBlob(function(e){if(!e)return r(new Error("Unable to retrieve canvas blob"));t(e)},n,i),e.next=11;break;case 6:return e.t2=t,e.next=9,function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var i=t.match(/data:(.*);/);if(!i)return n(new Error("".concat(t," is not a valid data Url")));for(var r=i[1],a=t.replace(/data:image\/\w+;base64,/,""),o=atob(a),s=[],u=0;u<o.length;u+=512){for(var l=o.slice(u,u+512),c=new Array(l.length),h=0;h<l.length;h++)c[h]=l.charCodeAt(h);var p=new Uint8Array(c);s.push(p)}e(new Blob(s,{type:r}))}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(rf.toDataURL(n,i));case 9:e.t3=e.sent,e.t1=(0,e.t2)(e.t3);case 11:e.t0=e.t1,e.next=15;break;case 14:e.t0=t(rf.msToBlob());case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 6:return e.prev=6,this[hf]({width:o,height:s}),e.finish(6);case 9:case"end":return e.stop()}},e,this,[[4,,6,9]])})),function(e){return r.apply(this,arguments)})},{key:"registerRenderer",value:function(e){this[_f].externalRenderer=e}},{key:"unregisterRenderer",value:function(){this[_f].externalRenderer=null}},{key:vf,get:function(){return null==this.alt||"null"===this.alt?this[of]:this.alt}},{key:Cf,value:function(){return this[cf]}},{key:Of,value:function(){return this.loaded&&this[df]}},{key:Pf,value:function(){return this.modelIsVisible}},{key:Lf,value:function(){return!!this.src&&this[df]}},{key:Rf,value:function(){return this[cf]}},{key:hf,value:function(e){var t=e.width,n=e.height;this[bf].style.width="".concat(t,"px"),this[bf].style.height="".concat(n,"px"),this[kf]({width:parseFloat(t),height:parseFloat(n)})}},{key:Mf,value:function(e,t){}},{key:yf,value:function(){this[cf]||(this[cf]=!0,this[mf]=performance.now())}},{key:Sf,value:function(){this[_f].queueRender()}},{key:Tf,value:function(){}},{key:kf,value:function(e){this[_f].setSize(e.width,e.height)}},{key:n,value:(i=l(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loaded&&this[Lf]()){e.next=2;break}return e.abrupt("return");case 2:return t=this[Af].beginActivity(),n=this.src,e.prev=3,e.next=6,this[_f].setSource(n,function(e){return t(.8*e)});case 6:this.dispatchEvent(new CustomEvent("preload",{detail:{url:n}})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),this.dispatchEvent(new CustomEvent("error",{detail:e.t0}));case 12:return e.prev=12,t(.9),requestAnimationFrame(function(){requestAnimationFrame(function(){t(1)})}),e.finish(12);case 15:case"end":return e.stop()}},e,this,[[3,9,12,15]])})),function(){return i.apply(this,arguments)})}],[{key:"is",get:function(){return"model-viewer"}},{key:"modelCacheSize",get:function(){return Xh[Jh].evictionThreshold},set:function(e){Xh[Jh].evictionThreshold=e}},{key:"minimumRenderScale",get:function(){return Hd.singleton.minScale},set:function(e){e>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),e<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Hd.singleton.minScale=e}}]),o}(_t,(zd=df,Zd=cf,Gd=mf,jd=uf,qd=af,Wd=ff,Jd=sf,Yd=pf,Xd=Af,Ef),(Qd=lf,gf));nf([St({type:String})],Nf.prototype,"alt",void 0),nf([St({type:String})],Nf.prototype,"src",void 0);var Df=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ff=Symbol("changeAnimation"),Uf=Symbol("paused"),Bf=Symbol("hotspotMap"),Vf=Symbol("mutationCallback"),Hf=Symbol("observer"),zf=Symbol("addHotspot"),Zf=Symbol("removeHotspot"),Gf=new Wn,jf=new an,qf=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};try{URL.revokeObjectURL(qf(""))}catch(Oe){qf=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var Wf=Uint8Array,Jf=Uint16Array,Yf=Uint32Array,Xf=new Wf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qf=new Wf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Kf=new Wf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$f=function(e,t){for(var n=new Jf(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var r=new Yf(n[30]);for(i=1;i<30;++i)for(var a=n[i];a<n[i+1];++a)r[a]=a-n[i]<<5|i;return[n,r]},ev=$f(Xf,2),tv=ev[1];ev[0][28]=258,tv[258]=28;for(var nv=$f(Qf,0)[1],iv=new Jf(32768),rv=0;rv<32768;++rv){var av=(43690&rv)>>>1|(21845&rv)<<1;av=(61680&(av=(52428&av)>>>2|(13107&av)<<2))>>>4|(3855&av)<<4,iv[rv]=((65280&av)>>>8|(255&av)<<8)>>>1}var ov=function(e,t,n){for(var i=e.length,r=0,a=new Jf(t);r<i;++r)++a[e[r]-1];var o,s=new Jf(t);for(r=0;r<t;++r)s[r]=s[r-1]+a[r-1]<<1;if(n){o=new Jf(1<<t);var u=15-t;for(r=0;r<i;++r)if(e[r])for(var l=r<<4|e[r],c=t-e[r],h=s[e[r]-1]++<<c,p=h|(1<<c)-1;h<=p;++h)o[iv[h]>>>u]=l}else for(o=new Jf(i),r=0;r<i;++r)e[r]&&(o[r]=iv[s[e[r]-1]++]>>>15-e[r]);return o},sv=new Wf(288);for(rv=0;rv<144;++rv)sv[rv]=8;for(rv=144;rv<256;++rv)sv[rv]=9;for(rv=256;rv<280;++rv)sv[rv]=7;for(rv=280;rv<288;++rv)sv[rv]=8;var uv=new Wf(32);for(rv=0;rv<32;++rv)uv[rv]=5;var lv=ov(sv,9,0),cv=ov(uv,5,0),hv=function(e){return(e/8|0)+(7&e&&1)},pv=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var i=new(e instanceof Jf?Jf:e instanceof Yf?Yf:Wf)(n-t);return i.set(e.subarray(t,n)),i},dv=function(e,t,n){var i=t/8|0;e[i]|=n<<=7&t,e[i+1]|=n>>>8},fv=function(e,t,n){var i=t/8|0;e[i]|=n<<=7&t,e[i+1]|=n>>>8,e[i+2]|=n>>>16},vv=function(e,t){for(var n=[],i=0;i<e.length;++i)e[i]&&n.push({s:i,f:e[i]});var r=n.length,a=n.slice();if(!r)return[_v,0];if(1==r){var o=new Wf(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var s=n[0],u=n[1],l=0,c=1,h=2;for(n[0]={s:-1,f:s.f+u.f,l:s,r:u};c!=r-1;)s=n[n[l].f<n[h].f?l++:h++],u=n[l!=c&&n[l].f<n[h].f?l++:h++],n[c++]={s:-1,f:s.f+u.f,l:s,r:u};var p=a[0].s;for(i=1;i<r;++i)a[i].s>p&&(p=a[i].s);var d=new Jf(p+1),f=mv(n[c-1],d,0);if(f>t){i=0;var v=0,m=f-t,g=1<<m;for(a.sort(function(e,t){return d[t.s]-d[e.s]||e.f-t.f});i<r;++i){var y=a[i].s;if(!(d[y]>t))break;v+=g-(1<<f-d[y]),d[y]=t}for(v>>>=m;v>0;){var b=a[i].s;d[b]<t?v-=1<<t-d[b]++-1:++i}for(;i>=0&&v;--i){var x=a[i].s;d[x]==t&&(--d[x],++v)}f=t}return[new Wf(d),f]},mv=function e(t,n,i){return-1==t.s?Math.max(e(t.l,n,i+1),e(t.r,n,i+1)):n[t.s]=i},gv=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Jf(++t),i=0,r=e[0],a=1,o=function(e){n[i++]=e},s=1;s<=t;++s)if(e[s]==r&&s!=t)++a;else{if(!r&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(r),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(r);a=1,r=e[s]}return[n.subarray(0,i),t]},yv=function(e,t){for(var n=0,i=0;i<t.length;++i)n+=e[i]*t[i];return n},bv=function(e,t,n){var i=n.length,r=hv(t+2);e[r]=255&i,e[r+1]=i>>>8,e[r+2]=255^e[r],e[r+3]=255^e[r+1];for(var a=0;a<i;++a)e[r+a+4]=n[a];return 8*(r+4+i)},xv=function(e,t,n,i,r,a,o,s,u,l,c){dv(t,c++,n),++r[256];for(var h=vv(r,15),p=h[0],d=h[1],f=vv(a,15),v=f[0],m=f[1],g=gv(p),y=g[0],b=g[1],x=gv(v),w=x[0],_=x[1],S=new Jf(19),M=0;M<y.length;++M)S[31&y[M]]++;for(M=0;M<w.length;++M)S[31&w[M]]++;for(var T=vv(S,7),k=T[0],E=T[1],A=19;A>4&&!k[Kf[A-1]];--A);var C,O,L,R,P=l+5<<3,I=yv(r,sv)+yv(a,uv)+o,N=yv(r,p)+yv(a,v)+o+14+3*A+yv(S,k)+(2*S[16]+3*S[17]+7*S[18]);if(P<=I&&P<=N)return bv(t,c,e.subarray(u,u+l));if(dv(t,c,1+(N<I)),c+=2,N<I){C=ov(p,d,0),O=p,L=ov(v,m,0),R=v;var D=ov(k,E,0);for(dv(t,c,b-257),dv(t,c+5,_-1),dv(t,c+10,A-4),c+=14,M=0;M<A;++M)dv(t,c+3*M,k[Kf[M]]);c+=3*A;for(var F=[y,w],U=0;U<2;++U){var B=F[U];for(M=0;M<B.length;++M){var V=31&B[M];dv(t,c,D[V]),c+=k[V],V>15&&(dv(t,c,B[M]>>>5&127),c+=B[M]>>>12)}}}else C=lv,O=sv,L=cv,R=uv;for(M=0;M<s;++M)if(i[M]>255){fv(t,c,C[257+(V=i[M]>>>18&31)]),c+=O[V+257],V>7&&(dv(t,c,i[M]>>>23&31),c+=Xf[V]);var H=31&i[M];fv(t,c,L[H]),c+=R[H],H>3&&(fv(t,c,i[M]>>>5&8191),c+=Qf[H])}else fv(t,c,C[i[M]]),c+=O[i[M]];return fv(t,c,C[256]),c+O[256]},wv=new Yf([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),_v=new Wf(0),Sv=function(){for(var e=new Yf(256),t=0;t<256;++t){for(var n=t,i=9;--i;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),Mv=function(){var e=-1;return{p:function(t){for(var n=e,i=0;i<t.length;++i)n=Sv[255&n^t[i]]^n>>>8;e=n},d:function(){return~e}}},Tv=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},kv=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8};function Ev(e,t){return function(e,t,n,i,r){return function(e,t,n,i,r,a){var o=e.length,s=new Wf(0+o+5*(1+Math.ceil(o/7e3))+0),u=s.subarray(0,s.length-0),l=0;if(!t||o<8)for(var c=0;c<=o;c+=65535){var h=c+65535;h<o?l=bv(u,l,e.subarray(c,h)):(u[c]=!0,l=bv(u,l,e.subarray(c,o)))}else{for(var p=wv[t-1],d=p>>>13,f=8191&p,v=(1<<n)-1,m=new Jf(32768),g=new Jf(v+1),y=Math.ceil(n/3),b=2*y,x=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&v},w=new Yf(25e3),_=new Jf(288),S=new Jf(32),M=0,T=0,k=(c=0,0),E=0,A=0;c<o;++c){var C=x(c),O=32767&c,L=g[C];if(m[O]=L,g[C]=O,E<=c){var R=o-c;if((M>7e3||k>24576)&&R>423){l=xv(e,u,0,w,_,S,T,k,A,c-A,l),k=M=T=0,A=c;for(var P=0;P<286;++P)_[P]=0;for(P=0;P<30;++P)S[P]=0}var I=2,N=0,D=f,F=O-L&32767;if(R>2&&C==x(c-F))for(var U=Math.min(d,R)-1,B=Math.min(32767,c),V=Math.min(258,R);F<=B&&--D&&O!=L;){if(e[c+I]==e[c+I-F]){for(var H=0;H<V&&e[c+H]==e[c+H-F];++H);if(H>I){if(I=H,N=F,H>U)break;var z=Math.min(F,H-2),Z=0;for(P=0;P<z;++P){var G=c-F+P+32768&32767,j=G-m[G]+32768&32767;j>Z&&(Z=j,L=G)}}}F+=(O=L)-(L=m[O])+32768&32767}if(N){w[k++]=268435456|tv[I]<<18|nv[N];var q=31&tv[I],W=31&nv[N];T+=Xf[q]+Qf[W],++_[257+q],++S[W],E=c+I,++M}else w[k++]=e[c],++_[e[c]]}}l=xv(e,u,!0,w,_,S,T,k,A,c-A,l)}return pv(s,0,0+hv(l)+0)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem)}(e,t||{})}var Av=function e(t,n,i,r){for(var a in t){var o=t[a],s=n+a;o instanceof Wf?i[s]=[o,r]:Array.isArray(o)?i[s]=[o[0],Tv(r,o[1])]:e(o,s+"/",i,r)}},Cv="undefined"!=typeof TextEncoder&&new TextEncoder,Ov="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ov.decode(_v,{stream:!0})}catch(Oe){}function Lv(e,t){if(t){for(var n=new Wf(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}if(Cv)return Cv.encode(e);var r=e.length,a=new Wf(e.length+(e.length>>1)),o=0,s=function(e){a[o++]=e};for(i=0;i<r;++i){if(o+5>a.length){var u=new Wf(o+8+(r-i<<1));u.set(a),a=u}var l=e.charCodeAt(i);l<128||t?s(l):l<2048?(s(192|l>>6),s(128|63&l)):l>55295&&l<57344?(s(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++i))>>18),s(128|l>>12&63),s(128|l>>6&63),s(128|63&l)):(s(224|l>>12),s(128|l>>6&63),s(128|63&l))}return pv(a,0,o)}var Rv=function(e){var t=0;if(e)for(var n in e){var i=e[n].length;if(i>65535)throw"extra field too long";t+=i+4}return t},Pv=function(e,t,n,i,r,a,o,s){var u=i.length,l=n.extra,c=s&&s.length,h=Rv(l);kv(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==a&&8),e[t++]=r&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var p=new Date(null==n.mtime?Date.now():n.mtime),d=p.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(kv(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=a&&(kv(e,t,n.crc),kv(e,t+4,a),kv(e,t+8,n.size)),kv(e,t+12,u),kv(e,t+14,h),t+=16,null!=o&&(kv(e,t,c),kv(e,t+6,n.attrs),kv(e,t+10,o),t+=14),e.set(i,t),t+=u,h)for(var f in l){var v=l[f],m=v.length;kv(e,t,+f),kv(e,t+2,m),e.set(v,t+4),t+=4+m}return c&&(e.set(s,t),t+=c),t},Iv=function(){function e(){M(this,e)}var t;return k(e,[{key:"parse",value:(t=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,u,l,c,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={"model.usda":null},i='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n',r={},a={},t.traverseVisible(function(e){if(e.isMesh&&e.material.isMeshStandardMaterial){var t=e.geometry,a=e.material,o="geometries/Geometry_"+t.id+".usd";if(!(o in n)){var s=function(e){return'\ndef "Geometry"\n{\n  '.concat(function(e){var t=e.attributes,n=t.position.count;return'\n    def Mesh "Geometry"\n    {\n        int[] faceVertexCounts = ['.concat(function(e){return Array((null!==e.index?e.index.array.length:e.attributes.position.count)/3).fill(3).join(", ")}(e),"]\n        int[] faceVertexIndices = [").concat(function(e){if(null!==e.index)return e.index.array.join(", ");for(var t=[],n=e.attributes.position.count,i=0;i<n;i++)t.push(i);return t.join(", ")}(e),"]\n        normal3f[] normals = [").concat(Fv(t.normal,n),'] (\n            interpolation = "vertex"\n        )\n        point3f[] points = [').concat(Fv(t.position,n),"]\n        float2[] primvars:st = [").concat(function(e,t){if(void 0===e)return console.warn("USDZExporter: UVs missing."),Array(t).fill("(0, 0)").join(", ");for(var n=[],i=e.array,r=0;r<i.length;r+=2)n.push("(".concat(i[r+0].toPrecision(7),", ").concat(1-i[r+1].toPrecision(7),")"));return n.join(", ")}(t.uv,n),'] (\n            interpolation = "vertex"\n        )\n        uniform token subdivisionScheme = "none"\n    }\n')}(e),"\n}\n")}(t);n[o]=function(e){var t='#usda 1.0\n(\n    customLayerData = {\n        string creator = "Three.js USDZExporter"\n    }\n    metersPerUnit = 1\n    upAxis = "Y"\n)\n\n';return Lv(t+=e)}(s)}a.uuid in r||(r[a.uuid]=a),i+=function(e,t,n){var i="Object_"+e.id,r=function(e){var t=e.elements;return"( ".concat(Dv(t,0),", ").concat(Dv(t,4),", ").concat(Dv(t,8),", ").concat(Dv(t,12)," )")}(e.matrixWorld);return e.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",e),'def Xform "'.concat(i,'" (\n    prepend references = @./geometries/Geometry_').concat(t.id,".usd@</Geometry>\n)\n{\n    matrix4d xformOp:transform = ").concat(r,'\n    uniform token[] xformOpOrder = ["xformOp:transform"]\n\n    rel material:binding = </Materials/Material_').concat(n.id,">\n}\n\n")}(e,t,a)}}),i+=function(e,t){var n=[];for(var i in e)n.push(Uv(e[i],t));return'def "Materials"\n{\n'.concat(n.join(""),"\n}\n\n")}(r,a),n["model.usda"]=Lv(i),i=null,o=regeneratorRuntime.mark(function e(t){var i,r,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=a[t],r=t.split("_")[1],o=1023===i.format,s=Nv(i.image,r),e.next=6,new Promise(function(e){return s.toBlob(e,o?"image/png":"image/jpeg",1)});case 6:return u=e.sent,e.t0=Uint8Array,e.next=10,u.arrayBuffer();case 10:e.t1=e.sent,n["textures/Texture_".concat(t,".").concat(o?"png":"jpg")]=new e.t0(e.t1);case 12:case"end":return e.stop()}},e)}),e.t0=regeneratorRuntime.keys(a);case 6:if((e.t1=e.t0()).done){e.next=11;break}return s=e.t1.value,e.delegateYield(o(s),"t2",9);case 9:e.next=6;break;case 11:for(l in u=0,n)c=n[l],u+=34+l.length,4!=(h=63&u)&&(p=new Uint8Array(64-h),n[l]=[c,{extra:{12345:p}}]),u=c.length;return e.abrupt("return",function(e,t){t||(t={});var n={},i=[];Av(e,"",n,t);var r=0,a=0;for(var o in n){var s=n[o],u=s[0],l=s[1],c=0==l.level?0:8,h=(S=Lv(o)).length,p=l.comment,d=p&&Lv(p),f=d&&d.length,v=Rv(l.extra);if(h>65535)throw"filename too long";var m=c?Ev(u,l):u,g=m.length,y=Mv();y.p(u),i.push(Tv(l,{size:u.length,crc:y.d(),c:m,f:S,m:d,u:h!=o.length||d&&p.length!=f,o:r,compression:c})),r+=30+h+v+g,a+=76+2*(h+v)+(f||0)+g}for(var b=new Wf(a+22),x=r,w=a-r,_=0;_<i.length;++_){var S=i[_];Pv(b,S.o,S,S.f,S.u,S.c.length);var M=30+S.f.length+Rv(S.extra);b.set(S.c,S.o+M),Pv(b,r,S,S.f,S.u,S.c.length,S.o,S.m),r+=16+M+(S.m?S.m.length:0)}return function(e,t,n,i,r){kv(e,t,101010256),kv(e,t+8,n),kv(e,t+10,n),kv(e,t+12,i),kv(e,t+16,r)}(b,r,i.length,w,x),b}(n,{level:0}));case 14:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})}]),e}();function Nv(e,t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var n=1024/Math.max(e.width,e.height),i=document.createElement("canvas");i.width=e.width*Math.min(1,n),i.height=e.height*Math.min(1,n);var r=i.getContext("2d");if(r.drawImage(e,0,0,i.width,i.height),void 0!==t){for(var a=parseInt(t,16),o=(a>>16&255)/255,s=(a>>8&255)/255,u=(255&a)/255,l=r.getImageData(0,0,i.width,i.height),c=l.data,h=0;h<c.length;h+=4)c[h+0]=c[h+0]*o,c[h+1]=c[h+1]*s,c[h+2]=c[h+2]*u;r.putImageData(l,0,0)}return i}}function Dv(e,t){return"(".concat(e[t+0],", ").concat(e[t+1],", ").concat(e[t+2],", ").concat(e[t+3],")")}function Fv(e,t){if(void 0===e)return console.warn("USDZExporter: Normals missing."),Array(t).fill("(0, 0, 0)").join(", ");for(var n=[],i=e.array,r=0;r<i.length;r+=3)n.push("(".concat(i[r+0].toPrecision(7),", ").concat(i[r+1].toPrecision(7),", ").concat(i[r+2].toPrecision(7),")"));return n.join(", ")}function Uv(e,t){var n="            ",i=[],r=[];function a(n,i,r){var a=n.id+(r?"_"+r.getHexString():""),o=1023===n.format;return t[a]=n,'\n        def Shader "Transform2d_'.concat(i,'" (\n            sdrMetadata = {\n                string role = "math"\n            }\n        )\n        {\n            uniform token info:id = "UsdTransform2d"\n            float2 inputs:in.connect = </Materials/Material_').concat(e.id,"/uvReader_st.outputs:result>\n            float2 inputs:scale = ").concat(Vv(n.repeat),"\n            float2 inputs:translation = ").concat(Vv(n.offset),'\n            float2 outputs:result\n        }\n\n        def Shader "Texture_').concat(n.id,"_").concat(i,'"\n        {\n            uniform token info:id = "UsdUVTexture"\n            asset inputs:file = @textures/Texture_').concat(a,".").concat(o?"png":"jpg","@\n            float2 inputs:st.connect = </Materials/Material_").concat(e.id,"/Transform2d_").concat(i,'.outputs:result>\n            token inputs:wrapS = "repeat"\n            token inputs:wrapT = "repeat"\n            float outputs:r\n            float outputs:g\n            float outputs:b\n            float3 outputs:rgb\n        }')}return null!==e.map?(i.push("".concat(n,"color3f inputs:diffuseColor.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.map.id,"_diffuse.outputs:rgb>")),r.push(a(e.map,"diffuse",e.color))):i.push("".concat(n,"color3f inputs:diffuseColor = ").concat(Bv(e.color))),null!==e.emissiveMap?(i.push("".concat(n,"color3f inputs:emissiveColor.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.emissiveMap.id,"_emissive.outputs:rgb>")),r.push(a(e.emissiveMap,"emissive"))):e.emissive.getHex()>0&&i.push("".concat(n,"color3f inputs:emissiveColor = ").concat(Bv(e.emissive))),null!==e.normalMap&&(i.push("".concat(n,"normal3f inputs:normal.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.normalMap.id,"_normal.outputs:rgb>")),r.push(a(e.normalMap,"normal"))),null!==e.aoMap&&(i.push("".concat(n,"float inputs:occlusion.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.aoMap.id,"_occlusion.outputs:r>")),r.push(a(e.aoMap,"occlusion"))),null!==e.roughnessMap&&1===e.roughness?(i.push("".concat(n,"float inputs:roughness.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.roughnessMap.id,"_roughness.outputs:g>")),r.push(a(e.roughnessMap,"roughness"))):i.push("".concat(n,"float inputs:roughness = ").concat(e.roughness)),null!==e.metalnessMap&&1===e.metalness?(i.push("".concat(n,"float inputs:metallic.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.metalnessMap.id,"_metallic.outputs:b>")),r.push(a(e.metalnessMap,"metallic"))):i.push("".concat(n,"float inputs:metallic = ").concat(e.metalness)),null!==e.alphaMap?(i.push("".concat(n,"float inputs:opacity.connect = </Materials/Material_").concat(e.id,"/Texture_").concat(e.alphaMap.id,"_opacity.outputs:r>")),i.push("".concat(n,"float inputs:opacityThreshold = 0.0001")),r.push(a(e.alphaMap,"opacity"))):i.push("".concat(n,"float inputs:opacity = ").concat(e.opacity)),e.isMeshPhysicalMaterial&&(i.push("".concat(n,"float inputs:clearcoat = ").concat(e.clearcoat)),i.push("".concat(n,"float inputs:clearcoatRoughness = ").concat(e.clearcoatRoughness)),i.push("".concat(n,"float inputs:ior = ").concat(e.ior))),'\n    def Material "Material_'.concat(e.id,'"\n    {\n        def Shader "PreviewSurface"\n        {\n            uniform token info:id = "UsdPreviewSurface"\n').concat(i.join("\n"),"\n            int inputs:useSpecularWorkflow = 0\n            token outputs:surface\n        }\n\n        token outputs:surface.connect = </Materials/Material_").concat(e.id,'/PreviewSurface.outputs:surface>\n        token inputs:frame:stPrimvarName = "st"\n\n        def Shader "uvReader_st"\n        {\n            uniform token info:id = "UsdPrimvarReader_float2"\n            token inputs:varname.connect = </Materials/Material_').concat(e.id,".inputs:frame:stPrimvarName>\n            float2 inputs:fallback = (0.0, 0.0)\n            float2 outputs:result\n        }\n\n").concat(r.join("\n"),"\n\n    }\n")}function Bv(e){return"(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")")}function Vv(e){return"(".concat(e.x,", ").concat(e.y,")")}var Hv,zv,Zv,Gv,jv=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},qv=!1,Wv=!1,Jv=(Hv=["quick-look","scene-viewer","webxr","none"],function(e){try{var t,n=fp(e),i=(n.length?n[0].terms:[]).filter(function(e){return e&&"ident"===e.type}).map(function(e){return e.value}).filter(function(e){return Hv.indexOf(e)>-1}),r=new Set,a=x(i);try{for(a.s();!(t=a.n()).done;){var o=t.value;r.add(o)}}catch(s){a.e(s)}finally{a.f()}return r}catch(e){}return new Set}),Yv="quick-look",Xv="scene-viewer",Qv="none",Kv=Symbol("arButtonContainer"),$v=Symbol("enterARWithWebXR"),em=Symbol("openSceneViewer"),tm=Symbol("openIOSARQuickLook"),nm=Symbol("canActivateAR"),im=Symbol("arMode"),rm=Symbol("arModes"),am=Symbol("arAnchor"),om=Symbol("preload"),sm=Symbol("onARButtonContainerClick"),um=Symbol("onARStatus"),lm=Symbol("onARTracking"),cm=Symbol("onARTap"),hm=Symbol("selectARMode"),pm=Symbol("triggerLoad"),dm=Symbol("evaluate"),fm=Symbol("lastValue"),vm=function(){function e(){M(this,e),this[zv]=null}return k(e,[{key:"isConstant",get:function(){return!1}},{key:"evaluate",value:function(){return this.isConstant&&null!=this[fm]||(this[fm]=this[dm]()),this[fm]}}],[{key:"evaluatableFor",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_p;if(t instanceof e)return t;if("number"===t.type)return"%"===t.unit?new _m(t,n):t;switch(t.name.value){case"calc":return new Em(t,n);case"env":return new Mm(t)}return _p}},{key:"evaluate",value:function(t){return t instanceof e?t.evaluate():t}},{key:"isConstant",value:function(t){return!(t instanceof e)||t.isConstant}},{key:"applyIntrinsics",value:function(e,t){var n=t.basis,i=t.keywords,r=i.auto;return n.map(function(t,n){var a=null==r[n]?t:r[n],o=e[n]?e[n]:a;if("ident"===o.type){var s=o.value;s in i&&(o=i[s][n])}return null!=o&&"ident"!==o.type||(o=a),"%"===o.unit?dp(o.number/100*t.number,t.unit):(o=Tp(o,t)).unit!==t.unit?t:o})}}]),e}();zv=fm;var mm,gm,ym,bm,xm=Symbol("percentage"),wm=Symbol("basis"),_m=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this))[xm]=e,r[wm]=i,r}return k(n,[{key:"isConstant",get:function(){return!0}},{key:dm,value:function(){return dp(this[xm].number/100*this[wm].number,this[wm].unit)}}]),n}(vm),Sm=Symbol("identNode"),Mm=function(e,t){d(i,e);var n=v(i);function i(e){var t;M(this,i),(t=n.call(this))[Zv]=null;var r=e.arguments.length?e.arguments[0].terms[0]:null;return null!=r&&"ident"===r.type&&(t[Sm]=r),t}return k(i,[{key:"isConstant",get:function(){return!1}},{key:t,value:function(){return null!=this[Sm]&&"window-scroll-y"===this[Sm].value?{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}:_p}}]),i}(vm,(Zv=Sm,dm)),Tm=/[\*\/]/,km=Symbol("evalutor"),Em=function(e,t){d(i,e);var n=v(i);function i(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_p;if(M(this,i),(t=n.call(this))[Gv]=null,1!==e.arguments.length)return m(t);for(var o=e.arguments[0].terms.slice(),s=[];o.length;){var u=o.shift();if(s.length>0){var l=s[s.length-1];if("operator"===l.type&&Tm.test(l.value)){var c=s.pop(),h=s.pop();if(null==h)return m(t);s.push(new Lm(c,vm.evaluatableFor(h,a),vm.evaluatableFor(u,a)));continue}}s.push("operator"===u.type?u:vm.evaluatableFor(u,a))}for(;s.length>2;){var p=s.splice(0,3),d=r(p,3),f=d[0],v=d[1],g=d[2];if("operator"!==v.type)return m(t);s.unshift(new Lm(v,vm.evaluatableFor(f,a),vm.evaluatableFor(g,a)))}return 1===s.length&&(t[km]=s[0]),m(t)}return k(i,[{key:"isConstant",get:function(){return null==this[km]||vm.isConstant(this[km])}},{key:t,value:function(){return null!=this[km]?vm.evaluate(this[km]):_p}}]),i}(vm,(Gv=km,dm)),Am=Symbol("operator"),Cm=Symbol("left"),Om=Symbol("right"),Lm=function(e){d(n,e);var t=v(n);function n(e,i,r){var a;return M(this,n),(a=t.call(this))[Am]=e,a[Cm]=i,a[Om]=r,a}return k(n,[{key:"isConstant",get:function(){return vm.isConstant(this[Cm])&&vm.isConstant(this[Om])}},{key:dm,value:function(){var e=Tp(vm.evaluate(this[Cm])),t=Tp(vm.evaluate(this[Om])),n=e.number,i=e.unit,r=t.number,a=t.unit;if(null!=a&&null!=i&&a!=i)return _p;var o,s=i||a;switch(this[Am].value){case"+":o=n+r;break;case"-":o=n-r;break;case"/":o=n/r;break;case"*":o=n*r;break;default:return _p}return{type:"number",number:o,unit:s}}}]),n}(vm),Rm=Symbol("evaluatables"),Pm=Symbol("intrinsics"),Im=function(e){d(n,e);var t=v(n);function n(e,i){var r;M(this,n),(r=t.call(this))[Pm]=i;var a=e[0],o=null!=a?a.terms:[];return r[Rm]=i.basis.map(function(e,t){var n=o[t];return null==n?{type:"ident",value:"auto"}:"ident"===n.type?n:vm.evaluatableFor(n,e)}),r}return k(n,[{key:"isConstant",get:function(){var e,t=x(this[Rm]);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!vm.isConstant(n))return!1}}catch(i){t.e(i)}finally{t.f()}return!0}},{key:dm,value:function(){var e=this[Rm].map(function(e){return vm.evaluate(e)});return vm.applyIntrinsics(e,this[Pm]).map(function(e){return e.number})}}]),n}(vm),Nm=Symbol("instances"),Dm=Symbol("activateListener"),Fm=Symbol("deactivateListener"),Um=Symbol("notifyInstances"),Bm=Symbol("notify"),Vm=Symbol("callback"),Hm=function(e){function t(e){M(this,t),this[Vm]=e}return k(t,[{key:"observe",value:function(){0===t[Nm].size&&t[Dm](),t[Nm].add(this)}},{key:"disconnect",value:function(){t[Nm].delete(this),0===t[Nm].size&&t[Fm]()}},{key:Bm,value:function(){this[Vm]()}}],[{key:Um,value:function(){var e,n=x(t[Nm]);try{for(n.s();!(e=n.n()).done;){e.value[Bm]()}}catch(i){n.e(i)}finally{n.f()}}},{key:e,value:function(){window.addEventListener("scroll",this[Um],{passive:!0})}},{key:Fm,value:function(){window.removeEventListener("scroll",this[Um])}}]),t}((mm=Nm,Dm));Hm[mm]=new Set;var zm=Symbol("computeStyleCallback"),Zm=Symbol("astWalker"),Gm=Symbol("dependencies"),jm=Symbol("onScroll"),qm=function(){function e(t){var n=this;M(this,e),this[gm]={},this[ym]=new wp(["function"]),this[bm]=function(){n[zm]({relatedState:"window-scroll"})},this[zm]=t}return k(e,[{key:"observeEffectsFor",value:function(e){var t=this,n={},i=this[Gm];for(var r in this[Zm].walk(e,function(e){var r=e.name,a=e.arguments[0].terms[0];if("env"===r.value&&null!=a&&"ident"===a.type&&"window-scroll-y"===a.value&&null==n["window-scroll"]){var o="window-scroll"in i?i["window-scroll"]:new Hm(t[jm]);o.observe(),delete i["window-scroll"],n["window-scroll"]=o}}),i)i[r].disconnect();this[Gm]=n}},{key:"dispose",value:function(){for(var e in this[Gm])this[Gm][e].disconnect()}}]),e}();gm=Gm,ym=Zm,bm=jm;var Wm,Jm,Ym=function(e){var t=e.observeEffects||!1,n=e.intrinsics instanceof Function?e.intrinsics:function(){return e.intrinsics};return function(i,r){var a,s=i.updated,u=i.connectedCallback,l=i.disconnectedCallback,c=Symbol("".concat(r,"StyleEffector")),h=Symbol("".concat(r,"StyleEvaluator")),p=Symbol("".concat(r,"UpdateEvaluator")),d=Symbol("".concat(r,"EvaluateAndSync"));Object.defineProperties(i,(o(a={},c,{value:null,writable:!0}),o(a,h,{value:null,writable:!0}),o(a,p,{value:function(){var e=this,i=fp(this[r]);this[h]=new Im(i,n(this)),null==this[c]&&t&&(this[c]=new qm(function(){return e[d]()})),null!=this[c]&&this[c].observeEffectsFor(i)}}),o(a,d,{value:function(){if(null!=this[h]){var t=this[h].evaluate();this[e.updateHandler](t)}}}),o(a,"updated",{value:function(e){e.has(r)&&(this[p](),this[d]()),s.call(this,e)}}),o(a,"connectedCallback",{value:function(){u.call(this),this.requestUpdate(r,this[r])}}),o(a,"disconnectedCallback",{value:function(){l.call(this),null!=this[c]&&(this[c].dispose(),this[c]=null)}}),a))}},Xm=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:Math.PI/8,maximumPolarAngle:Math.PI-Math.PI/8,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,interactionPolicy:"always-allow",touchAction:"pan-y"}),Qm=Math.PI/8,Km="user-interaction",$m=function(e){d(n,e);var t=v(n);function n(e,i){var r;return M(this,n),(r=t.call(this)).camera=e,r.element=i,r.sensitivity=1,r._interactionEnabled=!1,r._disableZoom=!1,r.isUserChange=!1,r.isUserPointing=!1,r.spherical=new kc,r.goalSpherical=new kc,r.thetaDamper=new pp,r.phiDamper=new pp,r.radiusDamper=new pp,r.logFov=Math.log(Xm.maximumFieldOfView),r.goalLogFov=r.logFov,r.fovDamper=new pp,r.touchMode=null,r.lastPointerPosition={clientX:0,clientY:0},r.touchDecided=!1,r.onMouseMove=function(e){r.handleSinglePointerMove(e),e.cancelable&&e.preventDefault()},r.onTouchMove=function(e){null!==r.touchMode&&(r.touchMode(e),null!==r.touchMode&&e.cancelable&&e.preventDefault())},r.touchModeZoom=function(e){var t=e.targetTouches;if(r.lastTouches.length>1&&t.length>1){var n=.04*(r.twoTouchDistance(r.lastTouches[0],r.lastTouches[1])-r.twoTouchDistance(t[0],t[1]))/10;r.userAdjustOrbit(0,0,n),r.lastTouches=t}},r.touchModeRotate=function(e){var t=e.targetTouches,n=r._options.touchAction;if(!r.touchDecided&&"none"!==n){r.touchDecided=!0;var i=t[0],a=i.clientX,o=i.clientY,s=Math.abs(a-r.lastPointerPosition.clientX),u=Math.abs(o-r.lastPointerPosition.clientY);if("pan-y"===n&&u>s||"pan-x"===n&&s>u)return void(r.touchMode=null)}r.handleSinglePointerMove(t[0]),r.lastTouches=t},r.onMouseDown=function(e){r.onPointerDown(function(){self.addEventListener("mousemove",r.onMouseMove),self.addEventListener("mouseup",r.onMouseUp,{once:!0}),r.handleSinglePointerDown(e)})},r.onTouchStart=function(e){r.onPointerDown(function(){var t=e.targetTouches,n=e.changedTouches,i=e.touches;t.length===n.length&&(r.touchMode=null,r.touchDecided=!1),t.length===i.length&&r.onTouchChange(e)})},r.onMouseUp=function(e){self.removeEventListener("mousemove",r.onMouseMove),r.onPointerUp()},r.onTouchEnd=function(e){e.targetTouches.length>0&&null!==r.touchMode&&r.onTouchChange(e),r.onPointerUp()},r.onWheel=function(e){r.canInteract&&(r.userAdjustOrbit(0,0,e.deltaY*(1==e.deltaMode?18:1)*.04/30),e.cancelable&&e.preventDefault())},r.onKeyDown=function(e){var t=!1;switch(e.keyCode){case 33:t=!0,r.userAdjustOrbit(0,0,.04);break;case 34:t=!0,r.userAdjustOrbit(0,0,-.04);break;case 38:t=!0,r.userAdjustOrbit(0,-Qm,0);break;case 40:t=!0,r.userAdjustOrbit(0,Qm,0);break;case 37:t=!0,r.userAdjustOrbit(-Qm,0,0);break;case 39:t=!0,r.userAdjustOrbit(Qm,0,0)}t&&e.cancelable&&e.preventDefault()},r._options=Object.assign({},Xm),r.setOrbit(0,Math.PI/2,1),r.setFieldOfView(100),r.jumpToGoal(),r}return k(n,[{key:"interactionEnabled",get:function(){return this._interactionEnabled}},{key:"enableInteraction",value:function(){if(!1===this._interactionEnabled){var e=this.element;e.addEventListener("mousedown",this.onMouseDown),this._disableZoom||e.addEventListener("wheel",this.onWheel),e.addEventListener("keydown",this.onKeyDown),e.addEventListener("touchstart",this.onTouchStart,{passive:!0}),e.addEventListener("touchmove",this.onTouchMove,{passive:!1}),e.addEventListener("touchend",this.onTouchEnd),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}},{key:"disableInteraction",value:function(){if(!0===this._interactionEnabled){var e=this.element;self.removeEventListener("mousemove",this.onMouseMove),e.removeEventListener("mousedown",this.onMouseDown),this._disableZoom||e.removeEventListener("wheel",this.onWheel),e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("touchstart",this.onTouchStart),e.removeEventListener("touchmove",this.onTouchMove),self.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("touchend",this.onTouchEnd),e.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}},{key:"options",get:function(){return this._options}},{key:"disableZoom",set:function(e){this._disableZoom!=e&&(this._disableZoom=e,!0===e?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}},{key:"getCameraSpherical",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new kc;return e.copy(this.spherical)}},{key:"getFieldOfView",value:function(){return this.camera.fov}},{key:"applyOptions",value:function(e){Object.assign(this._options,e),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}},{key:"updateNearFar",value:function(e,t){this.camera.near=Math.max(e,t/1e3),this.camera.far=t,this.camera.updateProjectionMatrix()}},{key:"updateAspect",value:function(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}},{key:"setOrbit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.goalSpherical.theta,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.goalSpherical.phi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.goalSpherical.radius,i=this._options,r=i.minimumAzimuthalAngle,a=i.maximumAzimuthalAngle,o=i.minimumPolarAngle,s=i.maximumPolarAngle,u=i.minimumRadius,l=i.maximumRadius,c=this.goalSpherical,h=c.theta,p=c.phi,d=c.radius,f=up(e,r,a);isFinite(r)||isFinite(a)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-f)+f);var v=up(t,o,s),m=up(n,u,l);return(f!==h||v!==p||m!==d)&&(this.goalSpherical.theta=f,this.goalSpherical.phi=v,this.goalSpherical.radius=m,this.goalSpherical.makeSafe(),this.isUserChange=!1,!0)}},{key:"setRadius",value:function(e){this.goalSpherical.radius=e,this.setOrbit()}},{key:"setFieldOfView",value:function(e){var t=this._options,n=t.minimumFieldOfView,i=t.maximumFieldOfView;e=up(e,n,i),this.goalLogFov=Math.log(e)}},{key:"setDamperDecayTime",value:function(e){this.thetaDamper.setDecayTime(e),this.phiDamper.setDecayTime(e),this.radiusDamper.setDecayTime(e),this.fovDamper.setDecayTime(e)}},{key:"adjustOrbit",value:function(e,t,n){var i=this.goalSpherical,r=i.theta,a=i.phi,o=i.radius,s=this._options,u=s.minimumRadius,l=s.maximumRadius,c=s.minimumFieldOfView,h=s.maximumFieldOfView,p=this.spherical.theta-r,d=Math.PI-.001,f=r-up(e,-d-p,d-p),v=a-t,m=0===n?0:((n>0?l:u)-o)/(Math.log(n>0?h:c)-this.goalLogFov),g=o+n*Math.min(isFinite(m)?m:1/0,l-u);this.setOrbit(f,v,g),0!==n&&this.setFieldOfView(Math.exp(this.goalLogFov+n))}},{key:"jumpToGoal",value:function(){this.update(0,1e4)}},{key:"update",value:function(e,t){if(!this.isStationary()){var n=this._options,i=n.maximumPolarAngle,r=n.maximumRadius,a=this.spherical.theta-this.goalSpherical.theta;Math.abs(a)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(a)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,t,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,t,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,t,r),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,t,1),this.moveCamera()}}},{key:"updateTouchActionStyle",value:function(){var e=this.element.style;if(this._interactionEnabled){var t=this._options.touchAction;e.touchAction=this._disableZoom&&"none"!==t?"manipulation":t}else e.touchAction=""}},{key:"isStationary",value:function(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}},{key:"moveCamera",value:function(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new ii(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix()),this.dispatchEvent({type:"change",source:this.isUserChange?Km:"none"})}},{key:"canInteract",get:function(){return"allow-when-focused"==this._options.interactionPolicy?this.element.getRootNode().activeElement===this.element:"always-allow"===this._options.interactionPolicy}},{key:"userAdjustOrbit",value:function(e,t,n){this.adjustOrbit(e*this.sensitivity,t*this.sensitivity,n),this.isUserChange=!0,this.dispatchEvent({type:"change",source:Km})}},{key:"wrapAngle",value:function(e){var t=(e+Math.PI)/(2*Math.PI);return 2*(t-Math.floor(t))*Math.PI-Math.PI}},{key:"pixelLengthToSphericalAngle",value:function(e){return 2*Math.PI*e/this.element.clientHeight}},{key:"twoTouchDistance",value:function(e,t){var n=e.clientX,i=e.clientY,r=t.clientX-n,a=t.clientY-i;return Math.sqrt(r*r+a*a)}},{key:"handleSinglePointerMove",value:function(e){var t=e.clientX,n=e.clientY,i=this.pixelLengthToSphericalAngle(t-this.lastPointerPosition.clientX),r=this.pixelLengthToSphericalAngle(n-this.lastPointerPosition.clientY);this.lastPointerPosition.clientX=t,this.lastPointerPosition.clientY=n,!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start",pointer:Object.assign({},e)})),this.userAdjustOrbit(i,r,0)}},{key:"onPointerDown",value:function(e){this.canInteract&&(this.isUserPointing=!1,e())}},{key:"onTouchChange",value:function(e){var t=e.targetTouches;2===t.length?(this.touchMode=this._disableZoom||this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0):(this.touchMode=this.touchModeRotate,this.handleSinglePointerDown(t[0])),this.lastTouches=t}},{key:"handleSinglePointerDown",value:function(e){this.lastPointerPosition.clientX=e.clientX,this.lastPointerPosition.clientY=e.clientY,this.element.style.cursor="grabbing"}},{key:"onPointerUp",value:function(){this.element.style.cursor="grab",this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end",pointer:Object.assign({},this.lastPointerPosition)})}}]),n}(Ht),eg=function(e){return e<.5?2*e*e:(4-2*e)*e-1},tg=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eg;return function(i){return e+(t-e)*n(i)}},ng=function(e,t){for(var n=[],i=[],r=e,a=0;a<t.length;++a){var o=t[a],s=o.value,u=o.frames,l=tg(r,s,o.ease||eg);n.push(l),i.push(u),r=s}return function(e,t){var n=t.reduce(function(e,t){return e+t},0),i=t.map(function(e){return e/n});return function(t){for(var n=0,r=1/0,a=function(){return 0},o=0;o<i.length&&(r=i[o],a=e[o],!(t<=n+r));++o)n+=r;return a((t-n)/r)}}(n,i)},ig=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},rg=ng(0,[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]),ag=ng(0,[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]),og=1.1*Op,sg=["front","right","back","left"],ug=["upper-","","lower-"],lg="auto",cg="when-focused",hg="wiggle",pg=function(e){return{basis:[dp(e[Ug]*Math.PI/180,"rad")],keywords:{auto:[null]}}},dg={basis:[Sp(dp(25,"deg"))],keywords:{auto:[null]}},fg=function(e){var t=e[_f];return{basis:[Sp(dp(45,"deg"))],keywords:{auto:[dp(t.framedFieldOfView,"deg")]}}},vg=function(){var e=fp("0deg 75deg 105%")[0].terms,t=Tp(e[0]),n=Tp(e[1]);return function(e){return{basis:[t,n,dp(e[_f].idealCameraDistance,"m")],keywords:{auto:[null,null,dp(105,"%")]}}}}(),mg=function(e){var t=og*e[_f].idealCameraDistance;return{basis:[dp(-1/0,"rad"),dp(Math.PI/8,"rad"),dp(t,"m")],keywords:{auto:[null,null,null]}}},gg=function(e){var t=vg(e),n=new Im([],t).evaluate()[2];return{basis:[dp(1/0,"rad"),dp(Math.PI-Math.PI/8,"rad"),dp(n,"m")],keywords:{auto:[null,null,null]}}},yg=function(e){var t=e[_f].boundingBox.getCenter(new mn);return{basis:[dp(t.x,"m"),dp(t.y,"m"),dp(t.z,"m")],keywords:{auto:[null,null,null]}}},bg=Math.PI/2,xg=Math.PI/3,wg=bg/2,_g=2*Math.PI,Sg=Symbol("controls"),Mg=Symbol("promptElement"),Tg=Symbol("promptAnimatedContainer"),kg=Symbol("deferInteractionPrompt"),Eg=Symbol("updateAria"),Ag=Symbol("updateCameraForRadius"),Cg=Symbol("onBlur"),Og=Symbol("onFocus"),Lg=Symbol("onChange"),Rg=Symbol("onPointerChange"),Pg=Symbol("waitingToPromptUser"),Ig=Symbol("userHasInteracted"),Ng=Symbol("promptElementVisibleTime"),Dg=Symbol("lastPromptOffset"),Fg=Symbol("focusedTime"),Ug=Symbol("zoomAdjustedFieldOfView"),Bg=Symbol("lastSpherical"),Vg=Symbol("jumpCamera"),Hg=Symbol("initialized"),zg=Symbol("maintainThetaPhi"),Zg=Symbol("syncCameraOrbit"),Gg=Symbol("syncFieldOfView"),jg=Symbol("syncCameraTarget"),qg=Symbol("syncMinCameraOrbit"),Wg=Symbol("syncMaxCameraOrbit"),Jg=Symbol("syncMinFieldOfView"),Yg=Symbol("syncMaxFieldOfView"),Xg=Symbol("modelViewerStatusInstance"),Qg=Symbol("updateStatus");Wm=Xg,Jm=Qg;var Kg=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$g="auto",ey=new(function(e){d(i,e);var t,n=v(i);function i(){var e;M(this,i),(e=n.call(this))[Wm]=null,e.registeredInstanceStatuses=new Map,e.loadingPromises=[],e.statusElement=document.createElement("p"),e.statusUpdateInProgress=!1,e[Jm]=sp(function(){return e.updateStatus()},100);var t=g(e).statusElement,r=t.style;return t.setAttribute("role","status"),t.classList.add("screen-reader-only"),r.top=r.left="0",r.pointerEvents="none",e}return k(i,[{key:"registerInstance",value:function(e){if(!this.registeredInstanceStatuses.has(e)){var t=function(){},n=!1===e.loaded&&!!e.src,i=new Promise(function(i){if(n){var r=function t(){i(),e.removeEventListener("load",t),e.removeEventListener("error",t)};e.addEventListener("load",r),e.addEventListener("error",r),t=r}else i()});this.registeredInstanceStatuses.set(e,{onUnregistered:t}),this.loadingPromises.push(i),null==this.modelViewerStatusInstance&&(this.modelViewerStatusInstance=e)}}},{key:"unregisterInstance",value:function(e){if(this.registeredInstanceStatuses.has(e)){var t=this.registeredInstanceStatuses,n=t.get(e);t.delete(e),n.onUnregistered(),this.modelViewerStatusInstance===e&&(this.modelViewerStatusInstance=t.size>0?function(e){if(null!=e.keys)return e.keys().next().value||null;var t=null;try{e.forEach(function(e,n,i){throw t=n,new Error})}catch(e){}return t}(t):null)}}},{key:"modelViewerStatusInstance",get:function(){return this[Xg]},set:function(e){if(this[Xg]!==e){var t=this.statusElement;null!=e&&null!=e.shadowRoot?e.shadowRoot.appendChild(t):null!=t.parentNode&&t.parentNode.removeChild(t),this[Xg]=e,this[Qg]()}}},{key:"updateStatus",value:(t=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.statusUpdateInProgress||0===this.loadingPromises.length){e.next=10;break}this.statusElement.textContent="This page includes one or more 3D models that are loading",this.statusUpdateInProgress=!0,this.dispatchEvent({type:"initial-status-announced"});case 2:if(!this.loadingPromises.length){e.next=9;break}return t=this.loadingPromises,this.loadingPromises=[],e.next=7,Promise.all(t);case 7:e.next=2;break;case 9:this.statusElement.textContent="All 3D models in the page have loaded",this.statusUpdateInProgress=!1,this.dispatchEvent({type:"finished-loading-announced"});case 10:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),i}(Ht)),ty=Symbol("defaultProgressBarElement"),ny=Symbol("defaultProgressMaskElement"),iy=Symbol("posterContainerElement"),ry=Symbol("defaultPosterElement"),ay=Symbol("posterDismissalSource"),oy=Symbol("hidePoster"),sy=Symbol("modelIsRevealed"),uy=Symbol("updateProgressBar"),ly=Symbol("lastReportedProgress"),cy=Symbol("transitioned"),hy=Symbol("onTransitionEnd"),py=Symbol("ariaLabelCallToAction"),dy=Symbol("onClick"),fy=Symbol("onKeydown"),vy=Symbol("onProgress"),my=function(){function e(){M(this,e),this.pluginCallbacks=[],this.register(function(e){return new My(e)}),this.register(function(e){return new Ty(e)}),this.register(function(e){return new ky(e)}),this.register(function(e){return new Ey(e)}),this.register(function(e){return new Ay(e)})}return k(e,[{key:"register",value:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}},{key:"unregister",value:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}},{key:"parse",value:function(e,t,n){for(var i=new Sy,r=[],a=0,o=this.pluginCallbacks.length;a<o;a++)r.push(this.pluginCallbacks[a](i));i.setPlugins(r),i.write(e,t,n)}}]),e}(),gy={1003:9728,1004:9984,1005:9986,1006:9729,1007:9985,1008:9987,1001:33071,1e3:10497,1002:33648},yy={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function by(e,t){return e.length===t.length&&e.every(function(e,n){return e===t[n]})}function xy(e){return 4*Math.ceil(e/4)}function wy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=xy(e.byteLength);if(n!==e.byteLength){var i=new Uint8Array(n);if(i.set(new Uint8Array(e)),0!==t)for(var r=e.byteLength;r<n;r++)i[r]=t;return i.buffer}return e}var _y=null,Sy=function(){function e(){M(this,e),this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}return k(e,[{key:"setPlugins",value:function(e){this.plugins=e}},{key:"write",value:function(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,embedImages:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e);var i=this;Promise.all(this.pending).then(function(){var e=i.json,n=i.options,r=i.extensionsUsed,a=new Blob(i.buffers,{type:"application/octet-stream"}),o=Object.keys(r);if(o.length>0&&(e.extensionsUsed=o),e.buffers&&e.buffers.length>0&&(e.buffers[0].byteLength=a.size),!0===n.binary){var s=new window.FileReader;s.readAsArrayBuffer(a),s.onloadend=function(){var n=wy(s.result),i=new DataView(new ArrayBuffer(8));i.setUint32(0,n.byteLength,!0),i.setUint32(4,5130562,!0);var r=wy(function(e){if(void 0!==window.TextEncoder)return(new TextEncoder).encode(e).buffer;for(var t=new Uint8Array(new ArrayBuffer(e.length)),n=0,i=e.length;n<i;n++){var r=e.charCodeAt(n);t[n]=r>255?32:r}return t.buffer}(JSON.stringify(e)),32),a=new DataView(new ArrayBuffer(8));a.setUint32(0,r.byteLength,!0),a.setUint32(4,1313821514,!0);var o=new ArrayBuffer(12),u=new DataView(o);u.setUint32(0,1179937895,!0),u.setUint32(4,2,!0),u.setUint32(8,12+a.byteLength+r.byteLength+i.byteLength+n.byteLength,!0);var l=new Blob([o,a,r,i,n],{type:"application/octet-stream"}),c=new window.FileReader;c.readAsArrayBuffer(l),c.onloadend=function(){t(c.result)}}}else if(e.buffers&&e.buffers.length>0){var u=new window.FileReader;u.readAsDataURL(a),u.onloadend=function(){e.buffers[0].uri=u.result,t(e)}}else t(e)})}},{key:"serializeUserData",value:function(e,t){if(0!==Object.keys(e.userData).length){var n=this.options,i=this.extensionsUsed;try{var r=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&r.gltfExtensions){for(var a in void 0===t.extensions&&(t.extensions={}),r.gltfExtensions)t.extensions[a]=r.gltfExtensions[a],i[a]=!0;delete r.gltfExtensions}Object.keys(r).length>0&&(t.extras=r)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}}},{key:"getUID",value:function(e){return this.uids.has(e)||this.uids.set(e,this.uid++),this.uids.get(e)}},{key:"isNormalizedNormalAttribute",value:function(e){if(this.cache.attributesNormalized.has(e))return!1;for(var t=new mn,n=0,i=e.count;n<i;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}},{key:"createNormalizedNormalAttribute",value:function(e){var t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);for(var n=e.clone(),i=new mn,r=0,a=n.count;r<a;r++)i.fromBufferAttribute(n,r),0===i.x&&0===i.y&&0===i.z?i.setX(1):i.normalize(),n.setXYZ(r,i.x,i.y,i.z);return t.attributesNormalized.set(e,n),n}},{key:"applyTextureTransform",value:function(e,t){var n=!1,i={};0===t.offset.x&&0===t.offset.y||(i.offset=t.offset.toArray(),n=!0),0!==t.rotation&&(i.rotation=t.rotation,n=!0),1===t.repeat.x&&1===t.repeat.y||(i.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}},{key:"processBuffer",value:function(e){var t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}},{key:"processBufferView",value:function(e,t,n,i,r){var a,o=this.json;o.bufferViews||(o.bufferViews=[]),a=5121===t?1:5123===t?2:4;for(var s=xy(i*e.itemSize*a),u=new DataView(new ArrayBuffer(s)),l=0,c=n;c<n+i;c++)for(var h=0;h<e.itemSize;h++){var p=void 0;e.itemSize>4?p=e.array[c*e.itemSize+h]:0===h?p=e.getX(c):1===h?p=e.getY(c):2===h?p=e.getZ(c):3===h&&(p=e.getW(c)),5126===t?u.setFloat32(l,p,!0):5125===t?u.setUint32(l,p,!0):5123===t?u.setUint16(l,p,!0):5121===t&&u.setUint8(l,p),l+=a}var d={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:s};return void 0!==r&&(d.target=r),34962===r&&(d.byteStride=e.itemSize*a),this.byteOffset+=s,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}},{key:"processBufferViewImage",value:function(e){var t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(i){var r=new window.FileReader;r.readAsArrayBuffer(e),r.onloadend=function(){var e=wy(r.result),a={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(n.bufferViews.push(a)-1)}})}},{key:"processAccessor",value:function(e,t,n,i){var r,a=this.options,o=this.json;if(e.array.constructor===Float32Array)r=5126;else if(e.array.constructor===Uint32Array)r=5125;else if(e.array.constructor===Uint16Array)r=5123;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");r=5121}if(void 0===n&&(n=0),void 0===i&&(i=e.count),a.truncateDrawRange&&void 0!==t&&null===t.index){var s=n+i,u=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),(i=Math.min(s,u)-n)<0&&(i=0)}if(0===i)return null;var l,c=function(e,t,n){for(var i={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},r=t;r<t+n;r++)for(var a=0;a<e.itemSize;a++){var o=void 0;e.itemSize>4?o=e.array[r*e.itemSize+a]:0===a?o=e.getX(r):1===a?o=e.getY(r):2===a?o=e.getZ(r):3===a&&(o=e.getW(r)),i.min[a]=Math.min(i.min[a],o),i.max[a]=Math.max(i.max[a],o)}return i}(e,n,i);void 0!==t&&(l=e===t.index?34963:34962);var h=this.processBufferView(e,r,n,i,l),p={bufferView:h.id,byteOffset:h.byteOffset,componentType:r,count:i,max:c.max,min:c.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(p.normalized=!0),o.accessors||(o.accessors=[]),o.accessors.push(p)-1}},{key:"processImage",value:function(e,t,n){var i=this,r=i.cache,a=i.json,o=i.options,s=i.pending;r.images.has(e)||r.images.set(e,{});var u=r.images.get(e),l=1023===t?"image/png":"image/jpeg",c=l+":flipY/"+n.toString();if(void 0!==u[c])return u[c];a.images||(a.images=[]);var h={mimeType:l};if(o.embedImages){var p=_y=_y||document.createElement("canvas");p.width=Math.min(e.width,o.maxTextureSize),p.height=Math.min(e.height,o.maxTextureSize);var d=p.getContext("2d");if(!0===n&&(d.translate(0,p.height),d.scale(1,-1)),"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)d.drawImage(e,0,0,p.width,p.height);else{1023!==t&&1022!==t&&console.error("GLTFExporter: Only RGB and RGBA formats are supported."),(e.width>o.maxTextureSize||e.height>o.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);var f=new Uint8ClampedArray(e.height*e.width*4);if(1023===t)for(var v=0;v<f.length;v+=4)f[v+0]=e.data[v+0],f[v+1]=e.data[v+1],f[v+2]=e.data[v+2],f[v+3]=e.data[v+3];else for(var m=0,g=0;m<f.length;m+=4,g+=3)f[m+0]=e.data[g+0],f[m+1]=e.data[g+1],f[m+2]=e.data[g+2],f[m+3]=255;d.putImageData(new ImageData(f,e.width,e.height),0,0)}!0===o.binary?s.push(new Promise(function(e){p.toBlob(function(t){i.processBufferViewImage(t).then(function(t){h.bufferView=t,e()})},l)})):h.uri=p.toDataURL(l)}else h.uri=e.src;var y=a.images.push(h)-1;return u[c]=y,y}},{key:"processSampler",value:function(e){var t=this.json;return t.samplers||(t.samplers=[]),t.samplers.push({magFilter:gy[e.magFilter],minFilter:gy[e.minFilter],wrapS:gy[e.wrapS],wrapT:gy[e.wrapT]})-1}},{key:"processTexture",value:function(e){var t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);var i={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY)};e.name&&(i.name=e.name),this._invokeAll(function(t){t.writeTexture&&t.writeTexture(e,i)});var r=n.textures.push(i)-1;return t.textures.set(e,r),r}},{key:"processMaterial",value:function(e){var t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);var i={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");var r=e.color.toArray().concat([e.opacity]);if(by(r,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=e.metalness,i.pbrMetallicRoughness.roughnessFactor=e.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap)if(e.metalnessMap===e.roughnessMap){var a={index:this.processTexture(e.metalnessMap)};this.applyTextureTransform(a,e.metalnessMap),i.pbrMetallicRoughness.metallicRoughnessTexture=a}else console.warn("THREE.GLTFExporter: Ignoring metalnessMap and roughnessMap because they are not the same Texture.");if(e.map){var o={index:this.processTexture(e.map)};this.applyTextureTransform(o,e.map),i.pbrMetallicRoughness.baseColorTexture=o}if(e.emissive){var s=e.emissive.clone().multiplyScalar(e.emissiveIntensity),u=Math.max(s.r,s.g,s.b);if(u>1&&(s.multiplyScalar(1/u),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),u>0&&(i.emissiveFactor=s.toArray()),e.emissiveMap){var l={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(l,e.emissiveMap),i.emissiveTexture=l}}if(e.normalMap){var c={index:this.processTexture(e.normalMap)};e.normalScale&&1!==e.normalScale.x&&(c.scale=e.normalScale.x),this.applyTextureTransform(c,e.normalMap),i.normalTexture=c}if(e.aoMap){var h={index:this.processTexture(e.aoMap),texCoord:1};1!==e.aoMapIntensity&&(h.strength=e.aoMapIntensity),this.applyTextureTransform(h,e.aoMap),i.occlusionTexture=h}e.transparent?i.alphaMode="BLEND":e.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=e.alphaTest),2===e.side&&(i.doubleSided=!0),""!==e.name&&(i.name=e.name),this.serializeUserData(e,i),this._invokeAll(function(t){t.writeMaterial&&t.writeMaterial(e,i)});var p=n.materials.push(i)-1;return t.materials.set(e,p),p}},{key:"processMesh",value:function(e){var t=this.cache,n=this.json,i=[e.geometry.uuid];if(Array.isArray(e.material))for(var r=0,a=e.material.length;r<a;r++)i.push(e.material[r].uuid);else i.push(e.material.uuid);var o=i.join(":");if(t.meshes.has(o))return t.meshes.get(o);var s,u=e.geometry;if(s=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4,!0!==u.isBufferGeometry)throw new Error("THREE.GLTFExporter: Geometry is not of type THREE.BufferGeometry.");var l={},c={},h=[],p=[],d={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=u.getAttribute("normal");void 0===f||this.isNormalizedNormalAttribute(f)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),u.setAttribute("normal",this.createNormalizedNormalAttribute(f)));var v=null;for(var m in u.attributes)if("morph"!==m.substr(0,5)){var g=u.attributes[m];if(m=d[m]||m.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(m)||(m="_"+m),t.attributes.has(this.getUID(g)))c[m]=t.attributes.get(this.getUID(g));else{v=null;var y=g.array;"JOINTS_0"!==m||y instanceof Uint16Array||y instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),v=new zi(new Uint16Array(y),g.itemSize,g.normalized));var b=this.processAccessor(v||g,u);null!==b&&(c[m]=b,t.attributes.set(this.getUID(g),b))}}if(void 0!==f&&u.setAttribute("normal",f),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){var x=[],w=[],_={};if(void 0!==e.morphTargetDictionary)for(var S in e.morphTargetDictionary)_[e.morphTargetDictionary[S]]=S;for(var M=0;M<e.morphTargetInfluences.length;++M){var T={},k=!1;for(var E in u.morphAttributes)if("position"===E||"normal"===E){var A=u.morphAttributes[E][M],C=E.toUpperCase(),O=u.attributes[E];if(t.attributes.has(this.getUID(A)))T[C]=t.attributes.get(this.getUID(A));else{var L=A.clone();if(!u.morphTargetsRelative)for(var R=0,P=A.count;R<P;R++)L.setXYZ(R,A.getX(R)-O.getX(R),A.getY(R)-O.getY(R),A.getZ(R)-O.getZ(R));T[C]=this.processAccessor(L,u),t.attributes.set(this.getUID(O),T[C])}}else k||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),k=!0);p.push(T),x.push(e.morphTargetInfluences[M]),void 0!==e.morphTargetDictionary&&w.push(_[M])}l.weights=x,w.length>0&&(l.extras={},l.extras.targetNames=w)}var I=Array.isArray(e.material);if(I&&0===u.groups.length)return null;for(var N=I?e.material:[e.material],D=I?u.groups:[{materialIndex:0,start:void 0,count:void 0}],F=0,U=D.length;F<U;F++){var B={mode:s,attributes:c};if(this.serializeUserData(u,B),p.length>0&&(B.targets=p),null!==u.index){var V=this.getUID(u.index);void 0===D[F].start&&void 0===D[F].count||(V+=":"+D[F].start+":"+D[F].count),t.attributes.has(V)?B.indices=t.attributes.get(V):(B.indices=this.processAccessor(u.index,u,D[F].start,D[F].count),t.attributes.set(V,B.indices)),null===B.indices&&delete B.indices}var H=this.processMaterial(N[D[F].materialIndex]);null!==H&&(B.material=H),h.push(B)}l.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll(function(t){t.writeMesh&&t.writeMesh(e,l)});var z=n.meshes.push(l)-1;return t.meshes.set(o,z),z}},{key:"processCamera",value:function(e){var t=this.json;t.cameras||(t.cameras=[]);var n=e.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:i.perspective={aspectRatio:e.aspect,yfov:tn.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(i.name=e.type),t.cameras.push(i)-1}},{key:"processAnimation",value:function(e,t){var n=this.json,i=this.nodeMap;n.animations||(n.animations=[]);for(var r=(e=my.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],o=[],s=0;s<r.length;++s){var u=r[s],l=wc.parseTrackName(u.name),c=wc.findNode(t,l.nodeName),h=yy[l.propertyName];if("bones"===l.objectName&&(c=!0===c.isSkinnedMesh?c.skeleton.getBoneByName(l.objectIndex):void 0),!c||!h)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',u.name),null;var p=void 0,d=u.values.length/u.times.length;h===yy.morphTargetInfluences&&(d/=c.morphTargetInfluences.length),!0===u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(p="CUBICSPLINE",d/=3):p=2300===u.getInterpolation()?"STEP":"LINEAR",o.push({input:this.processAccessor(new zi(u.times,1)),output:this.processAccessor(new zi(u.values,d)),interpolation:p}),a.push({sampler:o.length-1,target:{node:i.get(c),path:h}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:o,channels:a}),n.animations.length-1}},{key:"processSkin",value:function(e){var t=this.json,n=this.nodeMap,i=t.nodes[n.get(e)],r=e.skeleton;if(void 0===r)return null;var a=e.skeleton.bones[0];if(void 0===a)return null;for(var o=[],s=new Float32Array(16*r.bones.length),u=new Wn,l=0;l<r.bones.length;++l)o.push(n.get(r.bones[l])),u.copy(r.boneInverses[l]),u.multiply(e.bindMatrix).toArray(s,16*l);return void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new zi(s,16)),joints:o,skeleton:n.get(a)}),i.skin=t.skins.length-1}},{key:"processNode",value:function(e){var t=this.json,n=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);var r={};if(n.trs){var a=e.quaternion.toArray(),o=e.position.toArray(),s=e.scale.toArray();by(a,[0,0,0,1])||(r.rotation=a),by(o,[0,0,0])||(r.translation=o),by(s,[1,1,1])||(r.scale=s)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===by(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(r.matrix=e.matrix.elements);if(""!==e.name&&(r.name=String(e.name)),this.serializeUserData(e,r),e.isMesh||e.isLine||e.isPoints){var u=this.processMesh(e);null!==u&&(r.mesh=u)}else e.isCamera&&(r.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){for(var l=[],c=0,h=e.children.length;c<h;c++){var p=e.children[c];if(p.visible||!1===n.onlyVisible){var d=this.processNode(p);null!==d&&l.push(d)}}l.length>0&&(r.children=l)}this._invokeAll(function(t){t.writeNode&&t.writeNode(e,r)});var f=t.nodes.push(r)-1;return i.set(e,f),f}},{key:"processScene",value:function(e){var t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);var i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);for(var r=[],a=0,o=e.children.length;a<o;a++){var s=e.children[a];if(s.visible||!1===n.onlyVisible){var u=this.processNode(s);null!==u&&r.push(u)}}r.length>0&&(i.nodes=r),this.serializeUserData(e,i)}},{key:"processObjects",value:function(e){var t=new _s;t.name="AuxScene";for(var n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}},{key:"processInput",value:function(e){var t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(t){t.beforeParse&&t.beforeParse(e)});for(var n=[],i=0;i<e.length;i++)e[i]instanceof _s?this.processScene(e[i]):n.push(e[i]);n.length>0&&this.processObjects(n);for(var r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(var a=0;a<t.animations.length;++a)this.processAnimation(t.animations[a],e[0]);this._invokeAll(function(t){t.afterParse&&t.afterParse(e)})}},{key:"_invokeAll",value:function(e){for(var t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}]),e}(),My=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_lights_punctual"}return k(e,[{key:"writeNode",value:function(e,t){if(e.isLight)if(e.isDirectionalLight||e.isPointLight||e.isSpotLight){var n=this.writer,i=n.json,r=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&0===e.target.position.x&&0===e.target.position.y&&-1===e.target.position.z||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),r[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},r[this.name]=!0);var o=i.extensions[this.name].lights;o.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:o.length-1}}else console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e)}}]),e}(),Ty=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_materials_unlit"}return k(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshBasicMaterial){var n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}}]),e}(),ky=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_materials_pbrSpecularGlossiness"}return k(e,[{key:"writeMaterial",value:function(e,t){if(e.isGLTFSpecularGlossinessMaterial){var n=this.writer,i=n.extensionsUsed,r={};t.pbrMetallicRoughness.baseColorFactor&&(r.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);var a=[1,1,1];if(e.specular.toArray(a,0),r.specularFactor=a,r.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(r.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){var o={index:n.processTexture(e.specularMap)};n.applyTextureTransform(o,e.specularMap),r.specularGlossinessTexture=o}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),Ey=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_materials_transmission"}return k(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.transmission){var n=this.writer,i=n.extensionsUsed,r={};if(r.transmissionFactor=e.transmission,e.transmissionMap){var a={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(a,e.transmissionMap),r.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}(),Ay=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_materials_volume"}return k(e,[{key:"writeMaterial",value:function(e,t){if(e.isMeshPhysicalMaterial&&0!==e.thickness){var n=this.writer,i=n.extensionsUsed,r={};if(r.thicknessFactor=e.thickness,e.thicknessMap){var a={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(a,e.thicknessMap),r.thicknessTexture=a}r.attenuationDistance=e.attenuationDistance,r.attenuationColor=e.attenuationTint.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=r,i[this.name]=!0}}}]),e}();my.Utils={insertKeyframe:function(e,t){var n,i=.001,r=e.getValueSize(),a=new e.TimeBufferType(e.times.length+1),o=new e.ValueBufferType(e.values.length+r),s=e.createInterpolant(new e.ValueBufferType(r));if(0===e.times.length){a[0]=t;for(var u=0;u<r;u++)o[u]=0;n=0}else if(t<e.times[0]){if(Math.abs(e.times[0]-t)<i)return 0;a[0]=t,a.set(e.times,1),o.set(s.evaluate(t),0),o.set(e.values,r),n=0}else if(t>e.times[e.times.length-1]){if(Math.abs(e.times[e.times.length-1]-t)<i)return e.times.length-1;a[a.length-1]=t,a.set(e.times,0),o.set(e.values,0),o.set(s.evaluate(t),e.values.length),n=a.length-1}else for(var l=0;l<e.times.length;l++){if(Math.abs(e.times[l]-t)<i)return l;if(e.times[l]<t&&e.times[l+1]>t){a.set(e.times.slice(0,l+1),0),a[l+1]=t,a.set(e.times.slice(l+1),l+2),o.set(e.values.slice(0,(l+1)*r),0),o.set(s.evaluate(t),(l+1)*r),o.set(e.values.slice((l+1)*r),(l+2)*r),n=l+1;break}}return e.times=a,e.values=o,n},mergeMorphTargetTracks:function(e,t){for(var n=[],i={},r=e.tracks,a=0;a<r.length;++a){var o=r[a],s=wc.parseTrackName(o.name),u=wc.findNode(t,s.nodeName);if("morphTargetInfluences"===s.propertyName&&void 0!==s.propertyIndex){if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(2301)}var l=u.morphTargetInfluences.length,c=u.morphTargetDictionary[s.propertyIndex];if(void 0===c)throw new Error("THREE.GLTFExporter: Morph target name not found: "+s.propertyIndex);var h=void 0;if(void 0!==i[u.uuid]){var p=o.createInterpolant(new o.ValueBufferType(1));h=i[u.uuid];for(var d=0;d<h.times.length;d++)h.values[d*l+c]=p.evaluate(h.times[d]);for(var f=0;f<o.times.length;f++){var v=this.insertKeyframe(h,o.times[f]);h.values[v*l+c]=o.values[f]}}else{for(var m=new((h=o.clone()).ValueBufferType)(l*h.times.length),g=0;g<h.times.length;g++)m[g*l+c]=h.values[g];h.name=(s.nodeName||"")+".morphTargetInfluences",h.values=m,i[u.uuid]=h,n.push(h)}}else n.push(o)}return e.tracks=n,e}};var Cy,Oy,Ly=function(e){return void 0!==e.material&&e.userData&&e.userData.variantMaterials&&!!Array.from(e.userData.variantMaterials.values()).filter(function(e){return Ry(e.material)})},Ry=function(e){return e&&e.isMaterial&&!Array.isArray(e)},Py=function(){function e(t){M(this,e),this.writer=t,this.name="KHR_materials_variants",this.variantNames=[]}return k(e,[{key:"beforeParse",value:function(e){var t,n=this,i=new Set,r=x(e);try{for(r.s();!(t=r.n()).done;){t.value.traverse(function(e){if(Ly(e)){var t,n=e.userData.variantMaterials,r=x(n.keys());try{for(r.s();!(t=r.n()).done;){var a=t.value,o=n.get(a);Ry(o.material)&&i.add(a)}}catch(s){r.e(s)}finally{r.f()}}})}}catch(a){r.e(a)}finally{r.f()}i.forEach(function(e){return n.variantNames.push(e)})}},{key:"writeMesh",value:function(e,t){if(Ly(e)){var n,i=e.userData,r=i.variantMaterials,a=new Map,o=x(r.keys());try{for(o.s();!(n=o.n()).done;){var s=n.value,u=r.get(s).material;if(Ry(u)){var l=this.variantNames.indexOf(s),c=this.writer.processMaterial(u);a.has(c)||a.set(c,{material:c,variants:[]}),a.get(c).variants.push(l)}}}catch(m){o.e(m)}finally{o.f()}var h=Array.from(a.values()).map(function(e){return e.variants.sort(function(e,t){return e-t})&&e}).sort(function(e,t){return e.material-t.material});if(0!==h.length){var p,d=Ry(i.originalMaterial)?this.writer.processMaterial(i.originalMaterial):-1,f=x(t.primitives);try{for(f.s();!(p=f.n()).done;){var v=p.value;d>=0&&(v.material=d),v.extensions=v.extensions||{},v.extensions[this.name]={mappings:h}}}catch(m){f.e(m)}finally{f.f()}}}}},{key:"afterParse",value:function(){if(0!==this.variantNames.length){var e=this.writer.json;e.extensions=e.extensions||{};var t=this.variantNames.map(function(e){return{name:e}});e.extensions[this.name]={variants:t},this.writer.extensionsUsed[this.name]=!0}}}]),e}(),Iy=Symbol("correlatedObjects"),Ny=Symbol("sourceObject"),Dy=Symbol("onUpdate"),Fy=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;M(this,e),this[Dy]=t,this[Ny]=n,this[Iy]=i},Uy=new zl,By=new Bi,Vy=new Ur(2,2),Hy=Symbol("threeTexture"),zy=function(e){d(r,e);var t,n,i=v(r);function r(e,t,n){return M(this,r),i.call(this,e,n=null!=n?n:{name:"adhoc_image",uri:t&&t.image?t.image.src:"adhoc_image"},new Set(t?[t]:[]))}return k(r,[{key:Hy,get:function(){var e;return console.assert(null!=this[Iy]&&this[Iy].size>0,"Image correlated object is undefined"),null===(e=this[Iy])||void 0===e?void 0:e.values().next().value}},{key:"name",get:function(){return this[Ny].name||""}},{key:"uri",get:function(){return this[Ny].uri}},{key:"bufferView",get:function(){return this[Ny].bufferView}},{key:"type",get:function(){return null!=this.uri?"external":"embedded"}},{key:"setURI",value:(n=l(regeneratorRuntime.mark(function e(t){var n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this[Ny].uri=t,e.next=3,new Promise(function(e,n){Uy.load(t,e,void 0,n)});case 3:n=e.sent,(i=this[Hy]).image=n,i.needsUpdate=!0,this[Dy]();case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"createThumbnail",value:(t=l(regeneratorRuntime.mark(function e(t,n){var i,r,a,o,s,u,c,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=new _s,By.map=this[Hy],r=new gr(Vy,By),i.add(r),a=new Jr(-1,1,1,-1,0,1),o=Hd.singleton.threeRenderer,s=new dn(t,n),o.setRenderTarget(s),o.render(i,a),o.setRenderTarget(null),u=new Uint8Array(t*n*4),o.readRenderTargetPixels(s,0,0,t,n,u),rf.width=t,rf.height=n,c=rf.getContext("2d"),h=c.createImageData(t,n),e.abrupt("return",(h.data.set(u),c.putImageData(h,0,0),new Promise(function(){var e=l(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:rf.toBlob(function(e){if(!e)return n("Failed to capture thumbnail.");t(URL.createObjectURL(e))},"image/png");case 1:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())));case 10:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})}]),r}(Fy);!function(e){e[e.Nearest=9728]="Nearest",e[e.Linear=9729]="Linear",e[e.NearestMipmapNearest=9984]="NearestMipmapNearest",e[e.LinearMipmapNearest=9985]="LinearMipmapNearest",e[e.NearestMipmapLinear=9986]="NearestMipmapLinear",e[e.LinearMipmapLinear=9987]="LinearMipmapLinear"}(Cy||(Cy={})),function(e){e[e.ClampToEdge=33071]="ClampToEdge",e[e.MirroredRepeat=33648]="MirroredRepeat",e[e.Repeat=10497]="Repeat"}(Oy||(Oy={}));var Zy,Gy,jy=function(){var e=[Cy.Nearest,Cy.Linear,Cy.NearestMipmapNearest,Cy.LinearMipmapLinear,Cy.NearestMipmapLinear,Cy.LinearMipmapLinear];return function(t){return e.indexOf(t)>-1}}(),qy=function(){var e=[Cy.Nearest,Cy.Linear];return function(t){return e.indexOf(t)>-1}}(),Wy=function(){var e=[Oy.ClampToEdge,Oy.MirroredRepeat,Oy.Repeat];return function(t){return e.indexOf(t)>-1}}(),Jy=Symbol("threeTextures"),Yy=Symbol("setProperty"),Xy=Symbol("sourceSampler"),Qy=function(e){d(n,e);var t=v(n);function n(e,i,r){return M(this,n),null==(r=null!=r?r:{}).minFilter&&(r.minFilter=i?i.minFilter:Cy.LinearMipmapLinear),null==r.magFilter&&(r.magFilter=i?i.magFilter:Cy.Linear),null==r.wrapS&&(r.wrapS=i?i.wrapS:Oy.Repeat),null==r.wrapT&&(r.wrapT=i?i.wrapT:Oy.Repeat),t.call(this,e,r,new Set(i?[i]:[]))}return k(n,[{key:Jy,get:function(){return console.assert(null!=this[Iy]&&this[Iy].size>0,"Sampler correlated object is undefined"),this[Iy]}},{key:Xy,get:function(){return console.assert(null!=this[Ny],"Sampler source is undefined"),this[Ny]}},{key:"name",get:function(){return this[Ny].name||""}},{key:"minFilter",get:function(){return this[Xy].minFilter}},{key:"magFilter",get:function(){return this[Xy].magFilter}},{key:"wrapS",get:function(){return this[Xy].wrapS}},{key:"wrapT",get:function(){return this[Xy].wrapT}},{key:"setMinFilter",value:function(e){this[Yy]("minFilter",e)}},{key:"setMagFilter",value:function(e){this[Yy]("magFilter",e)}},{key:"setWrapS",value:function(e){this[Yy]("wrapS",e)}},{key:"setWrapT",value:function(e){this[Yy]("wrapT",e)}},{key:Yy,value:function(e,t){var n=this[Xy];if(null!=n){if(function(e,t){switch(e){case"minFilter":return jy(t);case"magFilter":return qy(t);case"wrapS":case"wrapT":return Wy(t);default:throw new Error('Cannot configure property "'.concat(e,'" on Sampler'))}}(e,t)){n[e]=t;var i,r=x(this[Jy]);try{for(r.s();!(i=r.n()).done;){var a=i.value;a[e]=t,a.needsUpdate=!0}}catch(o){r.e(o)}finally{r.f()}}this[Dy]()}}}]),n}(Fy),Ky=Symbol("image"),$y=Symbol("sampler"),eb=function(e){d(n,e);var t=v(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return M(this,n),(r=t.call(this,e,a||{},new Set(i?[i]:[])))[$y]=new Qy(e,i,o),r[Ky]=new zy(e,i,s),r}return k(n,[{key:"name",get:function(){return this[Ny].name||""}},{key:"sampler",get:function(){return this[$y]}},{key:"source",get:function(){return this[Ky]}}]),n}(Fy),tb=Symbol("texture"),nb=Symbol("materials"),ib=Symbol("usage");!function(e){e[e.Base=0]="Base",e[e.MetallicRoughness=1]="MetallicRoughness",e[e.Normal=2]="Normal",e[e.Occlusion=3]="Occlusion",e[e.Emissive=4]="Emissive"}(Gy||(Gy={}));var rb=function(){function e(t,n,i,r,a,o){if(M(this,e),this[Zy]=null,o){var s=a.textures?a.textures[o.index]:null;this[tb]=new eb(t,i,s,s&&a.samplers?a.samplers[s.sampler]:null,s&&a.images?a.images[s.source]:null)}this.onUpdate=t,this[nb]=r,this[ib]=n}return k(e,[{key:"texture",get:function(){return this[tb]}},{key:"setTexture",value:function(e){var t=null!=e?e.source[Hy]:null,n=3001;if(this[tb]=e,this[nb]){var i,r=x(this[nb]);try{for(r.s();!(i=r.n()).done;){var a=i.value;switch(this[ib]){case Gy.Base:a.map=t;break;case Gy.MetallicRoughness:n=3e3,a.metalnessMap=t,a.roughnessMap=t;break;case Gy.Normal:n=3e3,a.normalMap=t;break;case Gy.Occlusion:n=3e3,a.aoMap=t;break;case Gy.Emissive:a.emissiveMap=t}a.needsUpdate=!0}}catch(o){r.e(o)}finally{r.f()}}t&&(t.encoding=n),this.onUpdate()}}]),e}();Zy=tb;var ab,ob,sb=Symbol("threeMaterials"),ub=Symbol("baseColorTexture"),lb=Symbol("metallicRoughnessTexture"),cb=function(e){d(n,e);var t=v(n);function n(e,i,r,a){var o;M(this,n),o=t.call(this,e,r,a),null==r.baseColorFactor&&(r.baseColorFactor=[1,1,1,1]),null==r.roughnessFactor&&(r.roughnessFactor=1),null==r.metallicFactor&&(r.metallicFactor=1);var s=r.baseColorTexture,u=r.metallicRoughnessTexture,l=a.values().next().value,c=l.map,h=l.metalnessMap;return o[ub]=new rb(e,Gy.Base,c,a,i,s||null),o[lb]=new rb(e,Gy.MetallicRoughness,h,a,i,u||null),o}return k(n,[{key:sb,get:function(){return this[Iy]}},{key:"baseColorFactor",get:function(){return this[Ny].baseColorFactor}},{key:"metallicFactor",get:function(){return this[Ny].metallicFactor}},{key:"roughnessFactor",get:function(){return this[Ny].roughnessFactor}},{key:"baseColorTexture",get:function(){return this[ub]}},{key:"metallicRoughnessTexture",get:function(){return this[lb]}},{key:"setBaseColorFactor",value:function(e){var t,n=x(this[sb]);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.color.fromArray(e),i.opacity=e[3]}}catch(r){n.e(r)}finally{n.f()}this[Ny].baseColorFactor=e,this[Dy]()}},{key:"setMetallicFactor",value:function(e){var t,n=x(this[sb]);try{for(n.s();!(t=n.n()).done;){t.value.metalness=e}}catch(i){n.e(i)}finally{n.f()}this[Ny].metallicFactor=e,this[Dy]()}},{key:"setRoughnessFactor",value:function(e){var t,n=x(this[sb]);try{for(n.s();!(t=n.n()).done;){t.value.roughness=e}}catch(i){n.e(i)}finally{n.f()}this[Ny].roughnessFactor=e,this[Dy]()}}]),n}(Fy),hb=Symbol("pbrMetallicRoughness"),pb=Symbol("normalTexture"),db=Symbol("occlusionTexture"),fb=Symbol("emissiveTexture"),vb=Symbol("backingThreeMaterial"),mb=Symbol("applyAlphaCutoff"),gb=Symbol("lazyLoadGLTFInfo"),yb=Symbol("initialize"),bb=Symbol("getLoadedMaterial"),xb=Symbol("ensureMaterialIsLoaded"),wb=function(e){d(r,e);var t,n,i=v(r);function r(e,t,n,a,o){var s;return M(this,r),s=i.call(this,e,n,a),null==o?s[yb](t):s[gb]=o,s}return k(r,[{key:vb,get:function(){return this[Iy].values().next().value}},{key:yb,value:function(e){var t=this[Dy],n=this[Ny],i=this[Iy];n.extensions&&n.extensions.KHR_materials_pbrSpecularGlossiness&&console.warn("Material ".concat(n.name,' uses a deprecated extension\n          "KHR_materials_pbrSpecularGlossiness", please use\n          "pbrMetallicRoughness" instead. Specular Glossiness materials are\n          currently supported for rendering, but not for our scene-graph API,\n          nor for auto-generation of USDZ for Quick Look.')),null==n.pbrMetallicRoughness&&(n.pbrMetallicRoughness={}),this[hb]=new cb(t,e,n.pbrMetallicRoughness,i),null==n.emissiveFactor&&(n.emissiveFactor=[0,0,0]),null==n.doubleSided&&(n.doubleSided=!1),null==n.alphaMode&&(n.alphaMode="OPAQUE"),null==n.alphaCutoff&&(n.alphaCutoff=.5);var r=n.normalTexture,a=n.occlusionTexture,o=n.emissiveTexture,s=i.values().next().value,u=s.normalMap,l=s.aoMap,c=s.emissiveMap;this[pb]=new rb(t,Gy.Normal,u,i,e,r||null),this[db]=new rb(t,Gy.Occlusion,l,i,e,a||null),this[fb]=new rb(t,Gy.Emissive,c,i,e,o||null)}},{key:bb,value:(n=l(regeneratorRuntime.mark(function e(){var t,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this[gb]){e.next=7;break}return e.next=3,this[gb].doLazyLoad();case 3:return t=e.sent,n=t.set,i=t.material,e.abrupt("return",(this[Iy]=n,this[yb](this[gb].gltf),this[gb]=void 0,this.ensureLoaded=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),i));case 7:return e.abrupt("return",this[Iy].values().next().value);case 8:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:xb,value:function(){if(null!=this[gb])throw new Error('Material "'.concat(this.name,"\" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material."))}},{key:"ensureLoaded",value:(t=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this[bb]();case 2:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"isLoaded",get:function(){return null==this[gb]}},{key:"name",get:function(){return this[Ny].name||""}},{key:"pbrMetallicRoughness",get:function(){return this[xb](),this[hb]}},{key:"normalTexture",get:function(){return this[xb](),this[pb]}},{key:"occlusionTexture",get:function(){return this[xb](),this[db]}},{key:"emissiveTexture",get:function(){return this[xb](),this[fb]}},{key:"emissiveFactor",get:function(){return this[xb](),this[Ny].emissiveFactor}},{key:"setEmissiveFactor",value:function(e){this[xb]();var t,n=x(this[Iy]);try{for(n.s();!(t=n.n()).done;){t.value.emissive.fromArray(e)}}catch(i){n.e(i)}finally{n.f()}this[Ny].emissiveFactor=e,this[Dy]()}},{key:mb,value:function(){this[xb]();var e,t=this[Ny],n=x(this[Iy]);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.alphaTest=t.alphaCutoff,i.needsUpdate=!0}}catch(r){n.e(r)}finally{n.f()}}},{key:"setAlphaCutoff",value:function(e){this[xb](),this[Ny].alphaCutoff=e,this[mb](),this[Dy]()}},{key:"getAlphaCutoff",value:function(){return this[xb](),this[Ny].alphaCutoff}},{key:"setDoubleSided",value:function(e){this[xb]();var t,n=x(this[Iy]);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.side=e?2:0,i.needsUpdate=!0}}catch(r){n.e(r)}finally{n.f()}this[Ny].doubleSided=e,this[Dy]()}},{key:"getDoubleSided",value:function(){return this[xb](),this[Ny].doubleSided}},{key:"setAlphaMode",value:function(e){this[xb]();var t=function(e,t){e.transparent=t,e.depthWrite=!t};this[Ny].alphaMode=e;var n,i=x(this[Iy]);try{for(i.s();!(n=i.n()).done;){var r=n.value;t(r,"OPAQUE"!==e),this[mb](),r.needsUpdate=!0}}catch(a){i.e(a)}finally{i.f()}this[Dy]()}},{key:"getAlphaMode",value:function(){return this[xb](),this[Ny].alphaMode}}]),r}(Fy),_b=Symbol("materials"),Sb=Symbol("variantInfo"),Mb=Symbol("mesh"),Tb=Symbol("children"),kb=Symbol("initialMaterialIdx"),Eb=Symbol("activeMaterialIdx"),Ab=function e(t){M(this,e),this.name="",this[ab]=new Array,this.name=t};ab=Tb;var Cb,Ob,Lb,Rb,Pb=function(e){d(a,e);var t,n,i,r=v(a);function a(e,t,n){var i;M(this,a),(i=r.call(this,e.name))[ob]=new Map,i[Mb]=e;var o=n.gltf,s=n.threeGLTF,u=n.threeObjectMap,l=u.get(e.material);null!=l.materials?i[kb]=i[Eb]=l.materials:console.error("Primitive (".concat(e.name,") missing initial material reference."));var c,h=u.get(e).meshes,p=x((o.meshes||[])[h].primitives||[]);try{for(p.s();!(c=p.n()).done;){var d=c.value;if(null!=d.material)i[_b].set(d.material,t[d.material]);else{var f=t.findIndex(function(e){return"Default"===e.name});f>=0?i[_b].set(f,t[f]):console.warn("Primitive has no material!")}if(d.extensions&&d.extensions.KHR_materials_variants){var v=d.extensions.KHR_materials_variants,m=s.parser.json.extensions.KHR_materials_variants.variants;i[Sb]=new Map;var g,y=x(v.mappings);try{for(y.s();!(g=y.n()).done;){var b=g.value;i[_b].set(b.material,t[b.material]);var w,_=x(b.variants);try{for(_.s();!(w=_.n()).done;){var S=m[w.value].name;i[Sb].set(S,{material:t[b.material],index:b.material})}}catch(T){_.e(T)}finally{_.f()}}}catch(T){y.e(T)}finally{y.f()}}}}catch(T){p.e(T)}finally{p.f()}return i}return k(a,[{key:"mesh",get:function(){return this[Mb]}},{key:"setActiveMaterial",value:(i=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this[_b].get(t),e.t0=null!=n,!e.t0){e.next=7;break}return e.next=5,n[bb]();case 5:this.mesh.material=e.sent,this[Eb]=t;case 7:return e.abrupt("return",this.mesh.material);case 8:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getActiveMaterial",value:function(){return this[_b].get(this[Eb])}},{key:"enableVariant",value:(n=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return",this.setActiveMaterial(this[kb]));case 2:if(null==this[Sb]){e.next=6;break}if(null==(n=this[Sb].get(t))){e.next=6;break}return e.abrupt("return",this.setActiveMaterial(n.index));case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"instantiateVariants",value:(t=l(regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this[Sb]){e.next=22;break}t=x(this[Sb].keys()),e.prev=2,t.s();case 4:if((n=t.n()).done){e.next=14;break}if(i=n.value,null==this.mesh.userData.variantMaterials.get(i).material){e.next=8;break}return e.abrupt("continue",12);case 8:return e.next=10,this.enableVariant(i);case 10:null!=(r=e.sent)&&(this.mesh.userData.variantMaterials.get(i).material=r);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),t.e(e.t0);case 19:return e.prev=19,t.f(),e.finish(19);case 22:case"end":return e.stop()}},e,this,[[2,16,19,22]])})),function(){return t.apply(this,arguments)})},{key:"variantInfo",get:function(){return this[Sb]}}]),a}(Ab);ob=_b;var Ib=Symbol("materials"),Nb=Symbol("hierarchy"),Db=Symbol("roots"),Fb=Symbol("primitives"),Ub=Symbol("prepareVariantsForExport"),Bb=Symbol("switchVariant"),Vb=Symbol("threeScene"),Hb=Symbol("materialsFromPoint"),zb=Symbol("materialFromPoint"),Zb=function e(t,n,i,r){M(this,e),this.gltf=t,this.gltfElementMap=n,this.mapKey=i,this.doLazyLoad=r},Gb=function(e){function t(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};M(this,t),this[Cb]=new Array,this[Ob]=new Array,this[Lb]=new Array,this[Rb]=new Array;var a=e.gltf,o=e.threeGLTF,s=e.gltfElementMap;this[Vb]=o.scene;var u,c=x(a.materials.entries());try{for(c.s();!(u=c.n()).done;){var h=r(u.value,2),p=h[0],d=h[1],f=s.get(d);null!=f?this[Ib].push(new wb(i,a,d,f)):function(){var e=(a.materials||[])[p],t=p,r=function(){var n=l(regeneratorRuntime.mark(function n(){var i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.parser.getDependency("material",t);case 2:return i=n.sent,r=new Set,n.abrupt("return",(s.set(e,r),r.add(i),{set:r,material:i}));case 5:case"end":return n.stop()}},n)}));return function(){return n.apply(this,arguments)}}();n[Ib].push(new wb(i,a,e,f,new Zb(a,s,e,r)))}()}}catch(A){c.e(A)}finally{c.f()}var v,m=new Map,g=new Array,y=x(o.scene.children);try{for(y.s();!(v=y.n()).done;){var b=v.value;g.push(b)}}catch(A){y.e(A)}finally{y.f()}for(;g.length>0;){var w=g.pop(),_=null;w instanceof gr?(_=new Pb(w,this.materials,e),this[Fb].push(_)):_=new Ab(w.name);var S=m.get(w);null!=S?S[Tb].push(_):this[Db].push(_),this[Nb].push(_);var T,k=x(w.children);try{for(k.s();!(T=k.n()).done;){var E=T.value;g.push(E),m.set(w,_)}}catch(A){k.e(A)}finally{k.f()}}}var n,i;return k(t,[{key:"materials",get:function(){return this[Ib]}},{key:"getMaterialByName",value:function(e){var t=this[Ib].filter(function(t){return t.name===e});return t.length>0?t[0]:null}},{key:e,value:function(e){var t=this;return e.intersectObject(this[Vb],!0).map(function(e){var n=t[Nb].find(function(t){return t instanceof Pb&&t.mesh===e.object});return null!=n?n.getActiveMaterial():null})}},{key:zb,value:function(e){var t=this[Hb](e);return t.length>0?t[0]:null}},{key:Bb,value:(i=l(regeneratorRuntime.mark(function e(t){var n,i,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=new Array,i=x(this[Fb]);try{for(i.s();!(r=i.n()).done;)a=r.value,n.push(a.enableVariant(t))}catch(o){i.e(o)}finally{i.f()}return e.next=5,Promise.all(n);case 5:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:Ub,value:(n=l(regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=new Array,n=x(this[Fb]);try{for(n.s();!(i=n.n()).done;)r=i.value,t.push(r.instantiateVariants())}catch(a){n.e(a)}finally{n.f()}return e.next=5,Promise.all(t);case 5:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})}]),t}((Cb=Ib,Ob=Nb,Lb=Db,Rb=Fb,Hb)),jb=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},qb=Symbol("currentGLTF"),Wb=Symbol("model"),Jb=Symbol("variants"),Yb=Symbol("getOnUpdateMethod"),Xb=Symbol("textureLoader"),Qb=Symbol("originalGltfJson"),Kb=function(e,t,n,i){for(var r,a=arguments.length,o=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s=e.length-1;s>=0;s--)(r=e[s])&&(o=(a<3?r(o):a>3?r(t,n,o):r(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},$b=Math.PI/32,ex={basis:[Sp(dp($b,"rad"))],keywords:{auto:[null]}},tx=Symbol("autoRotateStartTime"),nx=Symbol("radiansPerSecond"),ix=Symbol("syncRotationRate"),rx=Symbol("onCameraChange"),ax=function(e){var t,n,i;return function(e,r){d(o,e);var a=v(o);function o(){var e;return M(this,o),(e=a.apply(this,arguments))[t]=new Map,e[n]=function(t){t.forEach(function(t){t instanceof MutationRecord&&"childList"!==t.type||(t.addedNodes.forEach(function(t){e[zf](t)}),t.removedNodes.forEach(function(t){e[Zf](t)}),e[Sf]())})},e[i]=new MutationObserver(e[Vf]),e}return k(o,[{key:"connectedCallback",value:function(){p(b(o.prototype),"connectedCallback",this).call(this);for(var e=0;e<this.children.length;++e)this[zf](this.children[e]);var t=self.ShadyDOM;null==t?this[Hf].observe(this,{childList:!0}):this[Hf]=t.observeChildren(this,this[Vf])}},{key:"disconnectedCallback",value:function(){p(b(o.prototype),"disconnectedCallback",this).call(this);var e=self.ShadyDOM;null==e?this[Hf].disconnect():e.unobserveChildren(this[Hf])}},{key:r,value:function(e,t){p(b(o.prototype),Mf,this).call(this,e,t);var n=this[_f],i=n.annotationRenderer,r=n.getCamera();n.shouldRender()&&(n.updateHotspots(r.position),i.domElement.style.display="",i.render(n,r))}},{key:"updateHotspot",value:function(e){var t=this[Bf].get(e.name);null!=t&&(t.updatePosition(e.position),t.updateNormal(e.normal),this[Sf]())}},{key:"positionAndNormalFromPoint",value:function(e,t){var n=this[_f],i=n.getNDC(e,t),r=n.positionAndNormalFromPoint(i);if(null==r)return null;Gf.copy(n.target.matrixWorld).invert();var a=If(r.position.applyMatrix4(Gf));return jf.getNormalMatrix(Gf),{position:a,normal:If(r.normal.applyNormalMatrix(jf))}}},{key:zf,value:function(e){if(e instanceof HTMLElement&&0===e.slot.indexOf("hotspot")){var t=this[Bf].get(e.slot);null!=t?t.increment():(t=new kp({name:e.slot,position:e.dataset.position,normal:e.dataset.normal}),this[Bf].set(e.slot,t),this[_f].addHotspot(t)),this[_f].queueRender()}}},{key:Zf,value:function(e){if(e instanceof HTMLElement){var t=this[Bf].get(e.slot);t&&(t.decrement()&&(this[_f].removeHotspot(t),this[Bf].delete(e.slot)),this[_f].queueRender())}}}]),o}(e,(t=Bf,n=Vf,i=Hf,Mf))}(function(e){var t,n,i,r,a,o=function(e,o){d(f,e);var s,u,c,h=v(f);function f(){var e;return M(this,f),(e=h.apply(this,arguments))[t]=void 0,e[n]=null,e[i]=[],e[r]=new jl,e[a]=null,e.variantName=null,e.orientation="0 0 0",e.scale="1 1 1",e}return k(f,[{key:"model",get:function(){return this[Wb]}},{key:"availableVariants",get:function(){return this[Jb]}},{key:"originalGltfJson",get:function(){return this[Qb]}},{key:o,value:function(){var e=this;return function(){e[Sf]()}}},{key:"createTexture",value:(c=l(regeneratorRuntime.mark(function e(t){var n,i,r,a=this,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"image/png",i=this[qb],e.next=4,new Promise(function(e){return a[Xb].load(t,e)});case 4:return r=e.sent,e.abrupt("return",i&&r?(r.encoding=3001,r.wrapS=1e3,r.wrapT=1e3,r.flipY=!1,"image/jpeg"===n&&(r.format=1022),new eb(this[Yb](),r)):null);case 6:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"updated",value:(u=l(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,s,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p(b(f.prototype),"updated",this).call(this,t),!t.has("variantName")){e.next=8;break}if(n=this[qb],i=this.variantName,e.t0=null!=n,!e.t0){e.next=8;break}return e.next=6,this[Wb][Bb](i);case 6:this[Sf](),this.dispatchEvent(new CustomEvent("variant-applied"));case 8:(t.has("orientation")||t.has("scale"))&&(r=this[_f].modelContainer,a=fp(this.orientation)[0].terms,o=Tp(a[0]).number,s=Tp(a[1]).number,u=Tp(a[2]).number,r.quaternion.setFromEuler(new ii(s,u,o,"YXZ")),l=fp(this.scale)[0].terms,r.scale.set(l[0].number,l[1].number,l[2].number),this[_f].updateBoundingBox(),this[_f].updateShadow(),this[Ef].arRenderer.onUpdateScene(),this[Sf]());case 9:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:Tf,value:function(){p(b(f.prototype),Tf,this).call(this),this[Jb]=[];var e=this[_f].currentGLTF;if(null!=e){var t=e.correlatedSceneGraph;null!=t&&e!==this[qb]&&(this[Wb]=new Gb(t,this[Yb]()),this[Qb]=JSON.parse(JSON.stringify(t.gltf))),"variants"in e.userData&&(this[Jb]=e.userData.variants.slice(),this.requestUpdate("variantName"))}this[qb]=e,this.dispatchEvent(new CustomEvent("scene-graph-ready"))}},{key:"exportScene",value:(s=l(regeneratorRuntime.mark(function e(t){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this[_f],e.abrupt("return",new Promise(function(){var e=l(regeneratorRuntime.mark(function e(r){var a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={binary:!0,onlyVisible:!0,maxTextureSize:1/0,forcePowerOfTwoTextures:!1,includeCustomExtensions:!1,embedImages:!0},Object.assign(a,t),a.animations=n.animations,a.truncateDrawRange=!0,o=n.shadow,s=!1,null!=o&&(s=o.visible,o.visible=!1),e.next=7,i[Wb][Ub]();case 7:(new my).register(function(e){return new Py(e)}).parse(n.modelContainer.children[0],function(e){return r(new Blob([a.binary?e:JSON.stringify(e)],{type:a.binary?"application/octet-stream":"application/json"}))},a),null!=o&&(o.visible=s);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"materialFromPoint",value:function(e,t){var n=this[_f],i=n.getNDC(e,t);return n.raycaster.setFromCamera(i,n.getCamera()),this[Wb][zb](n.raycaster)}}]),f}(e,(t=Wb,n=qb,i=Jb,r=Xb,a=Qb,Yb));return jb([St({type:String,attribute:"variant-name"})],o.prototype,"variantName",void 0),jb([St({type:String,attribute:"orientation"})],o.prototype,"orientation",void 0),jb([St({type:String,attribute:"scale"})],o.prototype,"scale",void 0),o}(function(e){var t,n,i,r=function(e,r){d(o,e);var a=v(o);function o(){var e;return M(this,o),(e=a.apply(this,arguments)).autoRotate=!1,e.autoRotateDelay=3e3,e.rotationPerSecond="auto",e[t]=performance.now(),e[n]=0,e[i]=function(t){e.autoRotate&&"user-interaction"===t.detail.source&&(e[tx]=performance.now())},e}return k(o,[{key:"connectedCallback",value:function(){p(b(o.prototype),"connectedCallback",this).call(this),this.addEventListener("camera-change",this[rx]),this[tx]=performance.now()}},{key:"disconnectedCallback",value:function(){p(b(o.prototype),"disconnectedCallback",this).call(this),this.removeEventListener("camera-change",this[rx]),this[tx]=performance.now()}},{key:"updated",value:function(e){p(b(o.prototype),"updated",this).call(this,e),e.has("autoRotate")&&(this[tx]=performance.now())}},{key:r,value:function(e){this[nx]=e[0]}},{key:Mf,value:function(e,t){if(p(b(o.prototype),Mf,this).call(this,e,t),this.autoRotate&&this[Pf]()&&!this[Ef].isPresenting){var n=Math.min(t,e-this[tx]-this.autoRotateDelay);n>0&&(this[_f].yaw=this.turntableRotation+this[nx]*n*.001)}}},{key:"turntableRotation",get:function(){return this[_f].yaw}},{key:"resetTurntableRotation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this[_f].yaw=e}}]),o}(e,(t=tx,n=nx,ix));return i=rx,Kb([St({type:Boolean,attribute:"auto-rotate"})],r.prototype,"autoRotate",void 0),Kb([St({type:Number,attribute:"auto-rotate-delay"})],r.prototype,"autoRotateDelay",void 0),Kb([Ym({intrinsics:ex,updateHandler:ix}),St({type:String,attribute:"rotation-per-second"})],r.prototype,"rotationPerSecond",void 0),r}(function(e){var t,n,i,r=function(e,r){d(s,e);var a,o=v(s);function s(){var e;return M(this,s),(e=o.apply(this,arguments)).environmentImage=null,e.skyboxImage=null,e.shadowIntensity=0,e.shadowSoftness=1,e.exposure=1,e[t]=null,e[n]=null,e[i]=function(t){t.element===g(e)&&e[Jp]()},e}return k(s,[{key:"connectedCallback",value:function(){p(b(s.prototype),"connectedCallback",this).call(this),this[Ef].loader.addEventListener("preload",this[Xp])}},{key:"disconnectedCallback",value:function(){p(b(s.prototype),"disconnectedCallback",this).call(this),this[Ef].loader.removeEventListener("preload",this[Xp])}},{key:"updated",value:function(e){p(b(s.prototype),"updated",this).call(this,e),e.has("shadowIntensity")&&(this[_f].setShadowIntensity(.1*this.shadowIntensity),this[Sf]()),e.has("shadowSoftness")&&(this[_f].setShadowSoftness(this.shadowSoftness),this[Sf]()),e.has("exposure")&&(this[_f].exposure=this.exposure,this[Sf]()),(e.has("environmentImage")||e.has("skyboxImage"))&&this[Lf]()&&this[Jp]()}},{key:r,value:function(){p(b(s.prototype),Tf,this).call(this),null!=this[qp]&&this[Wp](this[qp])}},{key:Jp,value:(a=l(regeneratorRuntime.mark(function e(){var t,n,i,r,a,o,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.skyboxImage,n=this.environmentImage,null!=this[Yp]&&(this[Yp](),this[Yp]=null),null==(i=this[Ef].textureUtils)){e.next=17;break}return e.prev=4,e.next=7,new Promise(function(){var e=l(regeneratorRuntime.mark(function e(r,a){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.generateEnvironmentMapAndSkybox(rp(t),n,{progressTracker:s[Af]}),s[Yp]=function(){return a(o)},e.t0=r,e.next=5,o;case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}());case 7:r=e.sent,a=r.environmentMap,o=r.skybox,this[_f].background=null!=o?o.name===a.name?a:o:null,this[Wp](a),this[_f].dispatchEvent({type:"envmap-update"}),e.next=17;break;case 13:if(e.prev=13,e.t0=e.catch(4),!(e.t0 instanceof Error)){e.next=17;break}throw this[Wp](null),e.t0;case 17:case"end":return e.stop()}},e,this,[[4,13]])})),function(){return a.apply(this,arguments)})},{key:Wp,value:function(e){this[_f].environment!==e&&(this[qp]=e,this[_f].environment=this[qp],this.dispatchEvent(new CustomEvent("environment-change")),this[Sf]())}}]),s}(e,(t=qp,n=Yp,i=Xp,Tf));return jp([St({type:String,attribute:"environment-image"})],r.prototype,"environmentImage",void 0),jp([St({type:String,attribute:"skybox-image"})],r.prototype,"skyboxImage",void 0),jp([St({type:Number,attribute:"shadow-intensity"})],r.prototype,"shadowIntensity",void 0),jp([St({type:Number,attribute:"shadow-softness"})],r.prototype,"shadowSoftness",void 0),jp([St({type:Number})],r.prototype,"exposure",void 0),r}(function(e){var t,n,i,a,o,s,u,c,h,f,m,g,y,x,w,_,S,T=function(e,T){d(C,e);var E,A=v(C);function C(){var e;return M(this,C),(e=A.apply(this,arguments)).cameraControls=!1,e.cameraOrbit="0deg 75deg 105%",e.cameraTarget="auto auto auto",e.fieldOfView="auto",e.minCameraOrbit="auto",e.maxCameraOrbit="auto",e.minFieldOfView="auto",e.maxFieldOfView="auto",e.interactionPromptThreshold=3e3,e.interactionPromptStyle=hg,e.interactionPrompt=lg,e.interactionPolicy="always-allow",e.orbitSensitivity=1,e.touchAction="pan-y",e.disableZoom=!1,e.interpolationDecay=50,e.bounds="legacy",e[t]=e.shadowRoot.querySelector(".interaction-prompt"),e[n]=e.shadowRoot.querySelector(".interaction-prompt > .animated-container"),e[i]=1/0,e[a]=0,e[o]=1/0,e[s]=!1,e[u]=!1,e[c]=new $m(e[_f].camera,e[xf]),e[h]=0,e[f]=new kc,e[m]=!1,e[g]=!1,e[y]=!1,e[x]=function(){var t=e[xf];isFinite(e[Fg])||(e[Fg]=performance.now());var n=e[vf];t.getAttribute("aria-label")!==n&&t.setAttribute("aria-label",n),e.interactionPrompt!==cg||e[Ig]||(e[Pg]=!0)},e[w]=function(){e.interactionPrompt===cg&&(e[Pg]=!1,e[Mg].classList.remove("visible"),e[Ng]=1/0,e[Fg]=1/0)},e[_]=function(t){var n=t.source;e[Eg](),e[Sf](),n===Km&&(e[Ig]=!0,e[kg]()),e.dispatchEvent(new CustomEvent("camera-change",{detail:{source:n}}))},e[S]=function(t){"pointer-change-start"===t.type?e[bf].classList.add("pointer-tumbling"):e[bf].classList.remove("pointer-tumbling")},e}return k(C,[{key:"getCameraOrbit",value:function(){var e=this[Bg];return{theta:e.theta,phi:e.phi,radius:e.radius,toString:function(){return"".concat(this.theta,"rad ").concat(this.phi,"rad ").concat(this.radius,"m")}}}},{key:"getCameraTarget",value:function(){return If(this[Ef].isPresenting?this[Ef].arRenderer.target:this[_f].getTarget())}},{key:"getFieldOfView",value:function(){return this[Sg].getFieldOfView()}},{key:"getMinimumFieldOfView",value:function(){return this[Sg].options.minimumFieldOfView}},{key:"getMaximumFieldOfView",value:function(){return this[Sg].options.maximumFieldOfView}},{key:"jumpCameraToGoal",value:function(){this[Vg]=!0,this.requestUpdate(Vg,!1)}},{key:"resetInteractionPrompt",value:function(){this[Dg]=0,this[Ng]=1/0,this[Ig]=!1,this[Pg]=this.interactionPrompt===lg&&this.cameraControls}},{key:"connectedCallback",value:function(){p(b(C.prototype),"connectedCallback",this).call(this),this[Sg].addEventListener("change",this[Lg]),this[Sg].addEventListener("pointer-change-start",this[Rg]),this[Sg].addEventListener("pointer-change-end",this[Rg])}},{key:"disconnectedCallback",value:function(){p(b(C.prototype),"disconnectedCallback",this).call(this),this[Sg].removeEventListener("change",this[Lg]),this[Sg].removeEventListener("pointer-change-start",this[Rg]),this[Sg].removeEventListener("pointer-change-end",this[Rg])}},{key:"updated",value:function(e){var t=this;p(b(C.prototype),"updated",this).call(this,e);var n=this[Sg],i=this[xf];e.has("cameraControls")&&(this.cameraControls?(n.enableInteraction(),this.interactionPrompt===lg&&(this[Pg]=!0),i.addEventListener("focus",this[Og]),i.addEventListener("blur",this[Cg])):(i.removeEventListener("focus",this[Og]),i.removeEventListener("blur",this[Cg]),n.disableInteraction(),this[kg]())),e.has("disableZoom")&&(n.disableZoom=this.disableZoom),e.has("bounds")&&(this[_f].tightBounds="tight"===this.bounds),(e.has("interactionPrompt")||e.has("cameraControls")||e.has("src"))&&(this.interactionPrompt===lg&&this.cameraControls&&!this[Ig]?this[Pg]=!0:this[kg]()),e.has("interactionPromptStyle")&&this[Mg].classList.toggle("wiggle",this.interactionPromptStyle===hg),e.has("interactionPolicy")&&n.applyOptions({interactionPolicy:this.interactionPolicy}),e.has("touchAction")&&(n.applyOptions({touchAction:this.touchAction}),n.updateTouchActionStyle()),e.has("orbitSensitivity")&&(n.sensitivity=this.orbitSensitivity),e.has("interpolationDecay")&&(n.setDamperDecayTime(this.interpolationDecay),this[_f].setTargetDamperDecayTime(this.interpolationDecay)),!0===this[Vg]&&Promise.resolve().then(function(){n.jumpToGoal(),t[_f].jumpToGoal(),t[Vg]=!1})}},{key:"updateFraming",value:(E=l(regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this[_f],n=t.framedFieldOfView,e.next=3,this.requestUpdate("cameraTarget");case 3:return t.updateFraming("tight"===this.bounds?t.getTarget():void 0),t.frameModel(),i=t.framedFieldOfView,r=this[Sg].getFieldOfView()/n,this[Ug]=i*r,this[zg]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),e.next=14,this.requestUpdate("cameraOrbit");case 14:case"end":return e.stop()}},e,this)})),function(){return E.apply(this,arguments)})},{key:T,value:function(e){this[Sg].setFieldOfView(180*e[0]/Math.PI)}},{key:Zg,value:function(e){if(this[zg]){var t=this.getCameraOrbit(),n=t.theta,i=t.phi;e[0]=n,e[1]=i,this[zg]=!1}this[Sg].setOrbit(e[0],e[1],e[2])}},{key:qg,value:function(e){this[Sg].applyOptions({minimumAzimuthalAngle:e[0],minimumPolarAngle:e[1],minimumRadius:e[2]}),this.jumpCameraToGoal()}},{key:Wg,value:function(e){this[Sg].applyOptions({maximumAzimuthalAngle:e[0],maximumPolarAngle:e[1],maximumRadius:e[2]}),this[Ag](e[2]),this.jumpCameraToGoal()}},{key:Jg,value:function(e){this[Sg].applyOptions({minimumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}},{key:Yg,value:function(e){this[Sg].applyOptions({maximumFieldOfView:180*e[0]/Math.PI}),this.jumpCameraToGoal()}},{key:jg,value:function(e){var t=r(e,3),n=t[0],i=t[1],a=t[2];this[_f].setTarget(n,i,a),this[Ef].arRenderer.updateTarget()}},{key:Mf,value:function(e,t){if(p(b(C.prototype),Mf,this).call(this,e,t),!this[Ef].isPresenting&&this[Pf]()){var n=performance.now();if(this[Pg]){var i=this.interactionPrompt===lg?this[mf]:this[Fg];this.loaded&&n>i+this.interactionPromptThreshold&&(this[xf].setAttribute("aria-label","Use mouse, touch or arrow keys to control the camera!"),this[Pg]=!1,this[Ng]=n,this[Mg].classList.add("visible"))}if(isFinite(this[Ng])&&this.interactionPromptStyle===hg){var r=this[_f],a=(n-this[Ng])/5e3%1,o=rg(a),s=ag(a);if(this[Tg].style.opacity="".concat(s),o!==this[Dg]){var u=(o-this[Dg])*Math.PI/16;this[Tg].style.transform="translateX(".concat(o*r.width*.05,"px)"),this[Sg].adjustOrbit(u,0,0),this[Dg]=o}}this[Sg].update(e,t),this[_f].updateTarget(t)}}},{key:kg,value:function(){this[Pg]=!1,this[Mg].classList.remove("visible"),this[Ng]=1/0}},{key:Ag,value:function(e){var t=this[_f].idealCameraDistance,n=2*Math.max(t,e);this[Sg].updateNearFar(0,n)}},{key:Eg,value:function(){var e=this[Bg],t=e.theta,n=e.phi,i=this[Sg].getCameraSpherical(this[Bg]),r=i.theta,a=i.phi,o=this.getRootNode();if(null!=o&&o.activeElement===this){var s=(4+Math.floor((t%_g+wg)/bg))%4,u=(4+Math.floor((r%_g+wg)/bg))%4,l=Math.floor(n/xg),c=Math.floor(a/xg);u===s&&c===l||this[xf].setAttribute("aria-label","View from stage ".concat(ug[c]).concat(sg[u]))}}},{key:kf,value:function(e){var t=this[Sg],n=this[_f].framedFieldOfView;p(b(C.prototype),kf,this).call(this,e);var i=this[_f].framedFieldOfView,r=t.getFieldOfView()/n;this[Ug]=i*r,t.updateAspect(this[_f].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.jumpCameraToGoal()}},{key:Tf,value:function(){p(b(C.prototype),Tf,this).call(this);var e=this[_f].framedFieldOfView;this[Ug]=e,this[Hg]?this[zg]=!0:this[Hg]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}}]),C}(e,(t=Mg,n=Tg,i=Fg,a=Dg,o=Ng,s=Ig,u=Pg,c=Sg,h=Ug,f=Bg,m=Vg,g=Hg,y=zg,Gg));return x=Og,w=Cg,_=Lg,S=Rg,ig([St({type:Boolean,attribute:"camera-controls"})],T.prototype,"cameraControls",void 0),ig([Ym({intrinsics:vg,observeEffects:!0,updateHandler:Zg}),St({type:String,attribute:"camera-orbit",hasChanged:function(){return!0}})],T.prototype,"cameraOrbit",void 0),ig([Ym({intrinsics:yg,observeEffects:!0,updateHandler:jg}),St({type:String,attribute:"camera-target",hasChanged:function(){return!0}})],T.prototype,"cameraTarget",void 0),ig([Ym({intrinsics:pg,observeEffects:!0,updateHandler:Gg}),St({type:String,attribute:"field-of-view",hasChanged:function(){return!0}})],T.prototype,"fieldOfView",void 0),ig([Ym({intrinsics:mg,updateHandler:qg}),St({type:String,attribute:"min-camera-orbit",hasChanged:function(){return!0}})],T.prototype,"minCameraOrbit",void 0),ig([Ym({intrinsics:gg,updateHandler:Wg}),St({type:String,attribute:"max-camera-orbit",hasChanged:function(){return!0}})],T.prototype,"maxCameraOrbit",void 0),ig([Ym({intrinsics:dg,updateHandler:Jg}),St({type:String,attribute:"min-field-of-view",hasChanged:function(){return!0}})],T.prototype,"minFieldOfView",void 0),ig([Ym({intrinsics:fg,updateHandler:Yg}),St({type:String,attribute:"max-field-of-view",hasChanged:function(){return!0}})],T.prototype,"maxFieldOfView",void 0),ig([St({type:Number,attribute:"interaction-prompt-threshold"})],T.prototype,"interactionPromptThreshold",void 0),ig([St({type:String,attribute:"interaction-prompt-style"})],T.prototype,"interactionPromptStyle",void 0),ig([St({type:String,attribute:"interaction-prompt"})],T.prototype,"interactionPrompt",void 0),ig([St({type:String,attribute:"interaction-policy"})],T.prototype,"interactionPolicy",void 0),ig([St({type:Number,attribute:"orbit-sensitivity"})],T.prototype,"orbitSensitivity",void 0),ig([St({type:String,attribute:"touch-action"})],T.prototype,"touchAction",void 0),ig([St({type:Boolean,attribute:"disable-zoom"})],T.prototype,"disableZoom",void 0),ig([St({type:Number,attribute:"interpolation-decay"})],T.prototype,"interpolationDecay",void 0),ig([St({type:String,attribute:"bounds"})],T.prototype,"bounds",void 0),T}(function(e){var t,n,i,r,a,o,s,u,c,h,f=function(e,f){d(A,e);var m,g,y,w,_,S,T,E=v(A);function A(){var e;return M(this,A),(e=E.apply(this,arguments)).ar=!1,e.arScale="auto",e.arPlacement="floor",e.arModes="webxr scene-viewer",e.iosSrc=null,e.xrEnvironment=!1,e[t]=!1,e[n]=e.shadowRoot.querySelector(".ar-button"),e[i]=document.createElement("a"),e[r]=new Set,e[a]=Qv,e[o]=!1,e[s]=function(t){t.preventDefault(),e.activateAR()},e[u]=function(t){var n=t.status;n!==id&&e[Ef].arRenderer.presentedScene!==e[_f]||(e.setAttribute("ar-status",n),e.dispatchEvent(new CustomEvent("ar-status",{detail:{status:n}})),n===id?e.removeAttribute("ar-tracking"):n===rd&&e.setAttribute("ar-tracking",ad))},e[c]=function(t){var n=t.status;e.setAttribute("ar-tracking",n),e.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:n}}))},e[h]=function(t){"_apple_ar_quicklook_button_tapped"==t.data&&e.dispatchEvent(new CustomEvent("quick-look-button-tapped"))},e}return k(A,[{key:"canActivateAR",get:function(){return this[im]!==Qv}},{key:"connectedCallback",value:function(){p(b(A.prototype),"connectedCallback",this).call(this),this[Ef].arRenderer.addEventListener("status",this[um]),this.setAttribute("ar-status",id),this[Ef].arRenderer.addEventListener("tracking",this[lm]),this[am].addEventListener("message",this[cm])}},{key:"disconnectedCallback",value:function(){p(b(A.prototype),"disconnectedCallback",this).call(this),this[Ef].arRenderer.removeEventListener("status",this[um]),this[Ef].arRenderer.removeEventListener("tracking",this[lm]),this[am].removeEventListener("message",this[cm])}},{key:"update",value:(T=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p(b(A.prototype),"update",this).call(this,t),t.has("arScale")&&(this[_f].canScale="fixed"!==this.arScale),t.has("arPlacement")&&(this[_f].updateShadow(),this[Sf]()),(t.has("ar")||t.has("arModes")||t.has("iosSrc"))&&(t.has("arModes")&&(this[rm]=Jv(this.arModes)),this[hm]());case 1:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:"activateAR",value:(S=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this[im],e.next=e.t0===Yv?3:"webxr"===e.t0?5:e.t0===Xv?8:10;break;case 3:return this[tm](),e.abrupt("break",11);case 5:return e.next=7,this[$v]();case 7:return e.abrupt("break",11);case 8:return this[em](),e.abrupt("break",11);case 10:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities");case 11:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})},{key:f,value:(_=l(regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this[im]=Qv,!this.ar){e.next=32;break}if(null==this.src){e.next=31;break}t=x(this[rm]),e.prev=3,t.s();case 5:if((n=t.n()).done){e.next=23;break}if(i=n.value,e.t0="webxr"===i&&Pt&&!qv,!e.t0){e.next=12;break}return e.next=11,this[Ef].arRenderer.supportsPresentation();case 11:e.t0=e.sent;case 12:if(!e.t0){e.next=15;break}return this[im]="webxr",e.abrupt("break",23);case 15:if("scene-viewer"!==i||!Bt||Wv){e.next=18;break}return this[im]=Xv,e.abrupt("break",23);case 18:if("quick-look"!==i||!Dt){e.next=21;break}return this[im]=Yv,e.abrupt("break",23);case 21:e.next=5;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(3),t.e(e.t1);case 28:return e.prev=28,t.f(),e.finish(28);case 31:!this.canActivateAR&&null!=this.iosSrc&&Dt&&(this[im]=Yv);case 32:this.canActivateAR?(this[Kv].classList.add("enabled"),this[Kv].addEventListener("click",this[sm])):this[Kv].classList.contains("enabled")&&(this[Kv].removeEventListener("click",this[sm]),this[Kv].classList.remove("enabled"),r="failed",this.setAttribute("ar-status",r),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:r}})));case 33:case"end":return e.stop()}},e,this,[[3,25,28,31]])})),function(){return _.apply(this,arguments)})},{key:$v,value:(w=l(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Attempting to present in AR with WebXR..."),e.next=3,this[pm]();case 3:return e.prev=3,this[Kv].removeEventListener("click",this[sm]),(t=this[Ef].arRenderer).placeOnWall="wall"===this.arPlacement,e.next=9,t.present(this[_f],this.xrEnvironment);case 9:e.next=22;break;case 11:return e.prev=11,e.t0=e.catch(3),console.warn("Error while trying to present in AR with WebXR"),console.error(e.t0),e.next=17,this[Ef].arRenderer.stopPresenting();case 17:return qv=!0,console.warn("Falling back to next ar-mode"),e.next=21,this[hm]();case 21:this.activateAR();case 22:return e.prev=22,this[hm](),e.finish(22);case 25:case"end":return e.stop()}},e,this,[[3,11,22,25]])})),function(){return w.apply(this,arguments)})},{key:pm,value:(y=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loaded,e.t0){e.next=7;break}return this[om]=!0,this[gf](),e.next=6,function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(i){e.addEventListener(t,function r(a){n&&!n(a)||(i(a),e.removeEventListener(t,r))})})}(this,"load");case 6:this[om]=!1;case 7:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:Lf,value:function(){return p(b(A.prototype),Lf,this).call(this)||this[om]}},{key:em,value:function(){var e=this,t=self.location.toString(),n=new URL(t),i=new URL(this.src,t),r=new URLSearchParams(i.search);if(n.hash="#model-viewer-no-ar-fallback",r.set("mode","ar_preferred"),r.has("disable_occlusion")||r.set("disable_occlusion","true"),"fixed"===this.arScale&&r.set("resizable","false"),"wall"===this.arPlacement&&r.set("enable_vertical_placement","true"),r.has("sound")){var a=new URL(r.get("sound"),t);r.set("sound",a.toString())}if(r.has("link")){var o=new URL(r.get("link"),t);r.set("link",o.toString())}var s="intent://arvr.google.com/scene-viewer/1.0?".concat(r.toString()+"&file="+encodeURIComponent(i.toString()),"#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;S.browser_fallback_url=").concat(encodeURIComponent(n.toString()),";end;");self.addEventListener("hashchange",function(){"#model-viewer-no-ar-fallback"===self.location.hash&&(Wv=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),e[hm]())},{once:!0}),this[am].setAttribute("href",s),console.log("Attempting to present in AR with Scene Viewer..."),this[am].click()}},{key:tm,value:(g=l(regeneratorRuntime.mark(function e(){var t,n,i,r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!this.iosSrc,this[Kv].classList.remove("enabled"),!t){e.next=8;break}return e.next=5,this.prepareUSDZ();case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=this.iosSrc;case 9:n=e.t0,i=new URL(n,self.location.toString()),"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0"),(r=this[am]).setAttribute("rel","ar"),a=document.createElement("img"),r.appendChild(a),r.setAttribute("href",i.toString()),t&&r.setAttribute("download","model.usdz"),console.log("Attempting to present in AR with Quick Look..."),r.click(),r.removeChild(a),t&&URL.revokeObjectURL(n),this[Kv].classList.add("enabled");case 16:case"end":return e.stop()}},e,this)})),function(){return g.apply(this,arguments)})},{key:"prepareUSDZ",value:(m=l(regeneratorRuntime.mark(function e(){var t,n,i,r,a,o,s,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this[Af].beginActivity(),e.next=3,this[pm]();case 3:return n=this[_f],i=n.shadow,r=!1,null!=i&&(r=i.visible,i.visible=!1),t(.2),a=new Iv,e.next=9,a.parse(n.modelContainer);case 9:return o=e.sent,s=new Blob([o],{type:"model/vnd.usdz+zip"}),u=URL.createObjectURL(s),e.abrupt("return",(t(1),null!=i&&(i.visible=r),u));case 13:case"end":return e.stop()}},e,this)})),function(){return m.apply(this,arguments)})}]),A}(e,(t=nm,n=Kv,i=am,r=rm,a=im,o=om,s=sm,u=um,c=lm,h=cm,hm));return jv([St({type:Boolean,attribute:"ar"})],f.prototype,"ar",void 0),jv([St({type:String,attribute:"ar-scale"})],f.prototype,"arScale",void 0),jv([St({type:String,attribute:"ar-placement"})],f.prototype,"arPlacement",void 0),jv([St({type:String,attribute:"ar-modes"})],f.prototype,"arModes",void 0),jv([St({type:String,attribute:"ios-src"})],f.prototype,"iosSrc",void 0),jv([St({type:Boolean,attribute:"xr-environment"})],f.prototype,"xrEnvironment",void 0),f}(function(e){var t,n,i,r,a,o,s,u,c,h,f,m,y,x,w=function(e,w,_){d(A,e);var S,T,E=v(A);function A(){var e;M(this,A);for(var l=arguments.length,p=new Array(l),d=0;d<l;d++)p[d]=arguments[d];(e=E.call.apply(E,[this].concat(p))).poster=null,e.reveal=$g,e.loading="auto",e.generateSchema=!1,e.seamlessPoster=!1,e[t]=!1,e[n]=!1,e[i]=0,e[r]=null,e[a]=e.shadowRoot.querySelector(".slot.poster"),e[o]=e.shadowRoot.querySelector("#default-poster"),e[s]=e.shadowRoot.querySelector("#default-progress-bar > .bar"),e[u]=e.shadowRoot.querySelector("#default-progress-bar > .mask"),e[c]=e[ry].getAttribute("aria-label"),e[h]=function(e,t){var n=null,i=function(){null==n&&(e.apply(void 0,arguments),n=self.setTimeout(function(){return n=null},100))};return i.flush=function(){null!=n&&(self.clearTimeout(n),n=null)},i}(function(t){var n=e[ty].parentNode;requestAnimationFrame(function(){e[ny].style.opacity=""+.2*(1-t),e[ty].style.transform="scaleX(".concat(t,")"),0===t&&(n.removeChild(e[ty]),n.appendChild(e[ty])),1===t?e[ty].classList.add("hide"):e[ty].classList.remove("hide")})}),e[f]=function(){"manual"!==e.reveal&&e.dismissPoster()},e[m]=function(t){if("manual"!==e.reveal)switch(t.keyCode){case 32:case 13:e.dismissPoster()}},e[y]=function(t){var n=t.detail.totalProgress;e[ly]=Math.max(n,e[ly]),1===n&&(e[uy].flush(),!e[Rf]()||null==e[ay]&&e.reveal!==$g||e[oy]()),e[uy](n),e.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:n}}))},e[x]=function(){e[cy]=!0;var t=e.getRootNode();t&&t.activeElement===g(e)&&e[xf].focus();var n=e[ry];n.setAttribute("aria-hidden","true"),n.tabIndex=-1,e.dispatchEvent(new CustomEvent("poster-dismissed"))};var v=self.ModelViewerElement||{};return Xh.setDRACODecoderLocation(v.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.4.1/"),Xh.setKTX2TranscoderLocation(v.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/"),v.meshoptDecoderLocation&&Xh.setMeshoptDecoderLocation(v.meshoptDecoderLocation),e}return k(A,[{key:"dismissPoster",value:function(){this[Rf]()?this[oy]():(this[ay]="interaction",this[gf]())}},{key:"showPoster",value:function(){var e=this[iy],t=this[ry];t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden"),e.classList.add("show");var n=this.modelIsVisible;this[sy]=!1,this[ff](n),this[cy]=!1}},{key:"getDimensions",value:function(){return If(this[_f].size)}},{key:"connectedCallback",value:function(){p(b(A.prototype),"connectedCallback",this).call(this),this[iy].addEventListener("click",this[dy]),this[iy].addEventListener("keydown",this[fy]),this[Af].addEventListener("progress",this[vy]),ey.registerInstance(this)}},{key:"disconnectedCallback",value:function(){p(b(A.prototype),"disconnectedCallback",this).call(this),this[iy].removeEventListener("click",this[dy]),this[iy].removeEventListener("keydown",this[fy]),this[Af].removeEventListener("progress",this[vy]),ey.unregisterInstance(this)}},{key:"updated",value:(T=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p(b(A.prototype),"updated",this).call(this,t),t.has("poster")&&null!=this.poster&&(this[ry].style.backgroundImage="url(".concat(this.poster,")")),t.has("alt")&&this[ry].setAttribute("aria-label","".concat(this[vf],". ").concat(this[py])),(t.has("reveal")||t.has("loading"))&&this[gf](),t.has("generateSchema")&&this[_f].updateSchema(!0===this.generateSchema?this.src:null),t.has("seamlessPoster")&&(!0===this.seamlessPoster?this[iy].classList.add("quick"):this[iy].classList.remove("quick"));case 1:case"end":return e.stop()}},e,this)})),function(e){return T.apply(this,arguments)})},{key:w,value:function(){return!!this.src&&(null!=this[ay]||"eager"===this.loading||this.reveal===$g&&this[df])}},{key:Rf,value:function(){return!!this.src&&p(b(A.prototype),Rf,this).call(this)&&1===this[ly]}},{key:_,value:function(){var e=this;this[ay]=null;var t=this[iy];if(t.classList.contains("show")){var n=this.modelIsVisible;this[sy]=!0,this[ff](n),requestAnimationFrame(function(){t.classList.remove("show"),!0===e.seamlessPoster?e[hy]():t.addEventListener("transitionend",e[hy],{once:!0})})}else this[cy]=!0}},{key:Of,value:function(){return p(b(A.prototype),Of,this).call(this)&&this[sy]}},{key:Pf,value:function(){return p(b(A.prototype),Pf,this).call(this)&&this[cy]}},{key:gf,value:(S=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this[ly]=0,!0===this.generateSchema&&this[_f].updateSchema(this.src),null!=this[_f].currentGLTF&&null!=this.src&&this[Lf]()||this.showPoster(),e.next=5,p(b(A.prototype),gf,this).call(this);case 5:case"end":return e.stop()}},e,this)})),function(){return S.apply(this,arguments)})}],[{key:"dracoDecoderLocation",get:function(){return Xh.getDRACODecoderLocation()},set:function(e){Xh.setDRACODecoderLocation(e)}},{key:"ktx2TranscoderLocation",get:function(){return Xh.getKTX2TranscoderLocation()},set:function(e){Xh.setKTX2TranscoderLocation(e)}},{key:"meshoptDecoderLocation",get:function(){return Xh.getMeshoptDecoderLocation()},set:function(e){Xh.setMeshoptDecoderLocation(e)}},{key:"mapURLs",value:function(e){Hd.singleton.loader[Wh].manager.setURLModifier(e)}}]),A}(e,(t=sy,n=cy,i=ly,r=ay,a=iy,o=ry,s=ty,u=ny,c=py,h=uy,f=dy,m=fy,y=vy,Lf),(x=hy,oy));return Kg([St({type:String})],w.prototype,"poster",void 0),Kg([St({type:String})],w.prototype,"reveal",void 0),Kg([St({type:String})],w.prototype,"loading",void 0),Kg([St({type:Boolean,attribute:"generate-schema"})],w.prototype,"generateSchema",void 0),Kg([St({type:Boolean,attribute:"seamless-poster"})],w.prototype,"seamlessPoster",void 0),w}(function(e){var t,n=function(e,n){d(a,e);var i,r=v(a);function a(){var e;return M(this,a),(e=r.apply(this,arguments)).autoplay=!1,e.animationName=void 0,e.animationCrossfadeDuration=300,e[t]=!0,e}return k(a,[{key:"availableAnimations",get:function(){return this.loaded?this[_f].animationNames:[]}},{key:"duration",get:function(){return this[_f].duration}},{key:"paused",get:function(){return this[Uf]}},{key:"currentTime",get:function(){return this[_f].animationTime},set:function(e){this[_f].animationTime=e,this[Ef].threeRenderer.shadowMap.needsUpdate=!0,this[Sf]()}},{key:"pause",value:function(){this[Uf]||(this[Uf]=!0,this[Ef].threeRenderer.shadowMap.autoUpdate=!1,this.dispatchEvent(new CustomEvent("pause")))}},{key:"play",value:function(){this[Uf]&&this.availableAnimations.length>0&&(this[Uf]=!1,this[Ef].threeRenderer.shadowMap.autoUpdate=!0,this[_f].hasActiveAnimation||this[Ff](),this.dispatchEvent(new CustomEvent("play")))}},{key:n,value:function(){p(b(a.prototype),Tf,this).call(this),this[Uf]=!0,this.autoplay&&(this[Ff](),this.play())}},{key:Mf,value:function(e,t){p(b(a.prototype),Mf,this).call(this,e,t),this[Uf]||!this[Pf]()&&!this[Ef].isPresenting||(this[_f].updateAnimation(t/1e3),this[Sf]())}},{key:"updated",value:function(e){p(b(a.prototype),"updated",this).call(this,e),e.has("autoplay")&&this.autoplay&&this.play(),e.has("animationName")&&this[Ff]()}},{key:gf,value:(i=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this[_f].stopAnimation(),p(b(a.prototype),gf,this).call(this)));case 1:case"end":return e.stop()}},e,this)})),function(){return i.apply(this,arguments)})},{key:Ff,value:function(){this[_f].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3),this[Uf]&&(this[_f].updateAnimation(0),this[Sf]())}}]),a}(e,(t=Uf,Tf));return Df([St({type:Boolean})],n.prototype,"autoplay",void 0),Df([St({type:String,attribute:"animation-name"})],n.prototype,"animationName",void 0),Df([St({type:Number,attribute:"animation-crossfade-duration"})],n.prototype,"animationCrossfadeDuration",void 0),n}(function(e){var t,n=Symbol("endPolyfillCoordination");return t=n,function(e){d(r,e);var i=v(r);function r(){var e;return M(this,r),(e=i.apply(this,arguments))[t]=null,e}return k(r,[{key:"connectedCallback",value:function(){p(b(r.prototype),"connectedCallback",this)&&p(b(r.prototype),"connectedCallback",this).call(this),null==this[n]&&(this[n]=function(e){if(null==e.shadowRoot||e.hasAttribute("data-js-focus-visible"))return function(){};if(!self.applyFocusVisiblePolyfill){var t=function(){self.applyFocusVisiblePolyfill(e.shadowRoot)};return self.addEventListener("focus-visible-polyfill-ready",t,{once:!0}),function(){self.removeEventListener("focus-visible-polyfill-ready",t)}}return self.applyFocusVisiblePolyfill(e.shadowRoot),function(){}}(this))}},{key:"disconnectedCallback",value:function(){p(b(r.prototype),"disconnectedCallback",this)&&p(b(r.prototype),"disconnectedCallback",this).call(this),null!=this[n]&&(this[n](),this[n]=null)}}]),r}(e)}(Nf)))))))));customElements.define("model-viewer",ax);var ox=f(369),sx=f(52320),ux=f(63960);function lx(e,t){if(1&e&&(_.TgZ(0,"p",5),_._uU(1),_.qZA()),2&e){var n=_.oxw(2);_.xp6(1),_.hij(" Hurry! We have only ",n.stock," product in stock. ")}}function cx(e,t){1&e&&(_.TgZ(0,"p",5),_.TgZ(1,"span",6),_._uU(2,"Sorry, stock is empty."),_.qZA(),_.qZA())}function hx(e,t){if(1&e&&(_.TgZ(0,"div",1),_.YNc(1,lx,2,1,"p",2),_.YNc(2,cx,3,0,"p",2),_.TgZ(3,"div",3),_._UZ(4,"span",4),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngIf",n.stock>0),_.xp6(1),_.Q6J("ngIf",n.stock<=0)}}var px=function(){var e=function(){function e(){M(this,e)}return k(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-stock-inventory"]],inputs:{stock:"stock"},decls:1,vars:1,consts:[["class","pro_inventory",4,"ngIf"],[1,"pro_inventory"],["class","active",4,"ngIf"],[1,"inventory-scroll","nostripes","active"],[2,"width","95%"],[1,"active"],[1,"text-danger"]],template:function(e,t){1&e&&_.YNc(0,hx,5,2,"div",0),2&e&&_.Q6J("ngIf",t.stock<=5)},directives:[y.O5],styles:[""]}),e}(),dx=f(60314),fx=["view3D"];function vx(e,t){if(1&e&&(_.TgZ(0,"div",2),_.TgZ(1,"div",3),_.TgZ(2,"button",4),_.NdJ("click",function(){return t.$implicit.dismiss("Cross click")}),_.TgZ(3,"span",5),_._uU(4,"\xd7"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(5,"div",6),_.TgZ(6,"div",7),_.TgZ(7,"a-scene",8),_.TgZ(8,"a-assets"),_._UZ(9,"a-asset-item",9),_._UZ(10,"a-asset-item",10),_.qZA(),_._UZ(11,"a-camera",11),_.TgZ(12,"a-entity",12),_._UZ(13,"a-gltf-model",13),_.qZA(),_.TgZ(14,"a-entity",12),_._UZ(15,"a-gltf-model",14),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(10),_.uIk("src",n.modelSrc)}}var mx=function(){var e=function(){function e(t,n){M(this,e),this.platformId=t,this.modalService=n,this.modalOpen=!1}return k(e,[{key:"ngOnInit",value:function(){}},{key:"openModal",value:function(){var e=this;this.modalOpen=!0,(0,y.NF)(this.platformId)&&(this.modelSrc=this.image3d,this.modalService.open(this.view3D,{size:"md",ariaLabelledBy:"view3d-modal",centered:!0,windowClass:"view3D"}).result.then(function(e){console.log("Result: ".concat(e))},function(t){e.closeResult="Dismissed ".concat(e.getDismissReason(t))}))}},{key:"getDismissReason",value:function(e){return e===dx.If.ESC?"by pressing ESC":e===dx.If.BACKDROP_CLICK?"by clicking on a backdrop":"with: ".concat(e)}},{key:"ngOnDestroy",value:function(){this.modalOpen&&this.modalService.dismissAll()}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.Lbi),_.Y36(dx.FF))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-product-view3D"]],viewQuery:function(e,t){var n;(1&e&&_.Gf(fx,5),2&e)&&(_.iGM(n=_.CRH())&&(t.view3D=n.first))},inputs:{image3d:"image3d"},decls:2,vars:0,consts:[["class","theme-modal"],["view3D",""],[1,"modal-content"],[1,"modal-header"],["type","button","data-dismiss","modal","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"example-container"],["mindar-face","","embedded","","color-space","sRGB","renderer","colorManagement: true, physicallyCorrectLights","vr-mode-ui","enabled: false","device-orientation-permission-ui","enabled: false"],["id","headModel","src","assets/images/headOccluder.glb"],["id","glassesModel"],["fov","80","active","false","position","0 0 0"],["mindar-face-target","anchorIndex: 168"],["mindar-face-occluder","","position","0 -0.3 0.05","rotation","0 0 0","scale","0.048 0.048 0.048","src","#headModel"],["rotation","0 0 0","position","0 -.06 -.05","scale",".70 .70 .70","src","#glassesModel","cursor-listener",""]],template:function(e,t){1&e&&_.YNc(0,vx,16,1,"ng-template",0,1,_.W1O)},styles:[".model-viewer[_ngcontent-%COMP%]{width:100%;height:500px}"]}),e}(),gx=f(88516),yx=f(81356),bx=f(99624),xx=function(){var e=function(){function e(t){M(this,e),this.sanitizer=t}return k(e,[{key:"transform",value:function(e,t){switch(t){case"html":return this.sanitizer.bypassSecurityTrustHtml(e);case"style":return this.sanitizer.bypassSecurityTrustStyle(e);case"script":return this.sanitizer.bypassSecurityTrustScript(e);case"url":return this.sanitizer.bypassSecurityTrustUrl(e);case"resourceUrl":return this.sanitizer.bypassSecurityTrustResourceUrl(e);default:throw new Error("Invalid safe type specified: ".concat(t))}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(bx.H7,16))},e.\u0275pipe=_.Yjl({name:"safe",type:e,pure:!0}),e}(),wx=["view3D"];function _x(e,t){if(1&e&&(_.TgZ(0,"div"),_._UZ(1,"model-viewer",30),_.qZA()),2&e){var n=_.oxw(2).$implicit;_.xp6(1),_.s9C("src",n.pro_3d_image)}}function Sx(e,t){if(1&e&&_.YNc(0,_x,2,1,"ng-template",29),2&e){var n=_.oxw().index;_.Q6J("id",n)}}function Mx(e,t){if(1&e&&(_.TgZ(0,"div"),_._UZ(1,"lib-ngx-image-zoom",31),_.qZA()),2&e){var n=_.oxw(2).$implicit;_.xp6(1),_.Q6J("thumbImage",n.pro_image)("fullImage",n.pro_image)("magnification",1.5)("enableLens",!0)("lensWidth",300)("lensHeight",300)}}function Tx(e,t){if(1&e&&_.YNc(0,Mx,2,6,"ng-template",29),2&e){var n=_.oxw().index;_.Q6J("id",n)}}function kx(e,t){if(1&e&&(_.ynx(0),_.YNc(1,Sx,1,1,void 0,19),_.YNc(2,Tx,1,1,void 0,19),_.BQk()),2&e){var n=t.$implicit,i=t.index;_.xp6(1),_.Q6J("ngIf",0==i&&n.pro_3d_image),_.xp6(1),_.Q6J("ngIf",i>0)}}function Ex(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",32),_.TgZ(1,"img",33),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2).index,t=_.oxw();return _.MAs(6).to(t.activeSlide=e.toString())}),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).index,r=_.oxw();_.ekj("active",i==r.activeSlide),_.xp6(1),_.Q6J("defaultImage","assets/images/product/placeholder.jpg")("lazyLoad","assets/images/rotate-360.svg")("alt",r.product.product_name)("src","assets/images/rotate-360.svg",_.LSH)}}function Ax(e,t){if(1&e&&_.YNc(0,Ex,2,6,"ng-template",29),2&e){var n=_.oxw().index;_.Q6J("id",n)}}function Cx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",32),_.TgZ(1,"img",34),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2).index,t=_.oxw();return _.MAs(6).to(t.activeSlide=e.toString())}),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2),r=i.index,a=i.$implicit,o=_.oxw();_.ekj("active",r==o.activeSlide),_.xp6(1),_.Q6J("defaultImage","assets/images/product/placeholder.jpg")("lazyLoad",a.pro_image)("alt",o.product.product_name)("src",a.pro_image,_.LSH)}}function Ox(e,t){if(1&e&&_.YNc(0,Cx,2,6,"ng-template",29),2&e){var n=_.oxw().index;_.Q6J("id",n)}}function Lx(e,t){if(1&e&&(_.ynx(0),_.YNc(1,Ax,1,1,void 0,19),_.YNc(2,Ox,1,1,void 0,19),_.BQk()),2&e){var n=t.$implicit,i=t.index;_.xp6(1),_.Q6J("ngIf",0==i&&n.pro_3d_image),_.xp6(1),_.Q6J("ngIf",i>0)}}function Rx(e,t){1&e&&(_.TgZ(0,"h5",35),_.TgZ(1,"span"),_._uU(2,"In Stock"),_.qZA(),_.qZA())}function Px(e,t){1&e&&(_.TgZ(0,"h5",35),_.TgZ(1,"span"),_._uU(2,"Out of Stock"),_.qZA(),_.qZA())}function Ix(e,t){if(1&e&&(_.TgZ(0,"h3"),_.TgZ(1,"del",36),_._uU(2),_.ALo(3,"currency"),_.qZA(),_.TgZ(4,"span"),_._uU(5),_.ALo(6,"currency"),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(2),_.Oqu(_.Dn7(3,2,null==n.product?null:n.product.product_retail_price,null==n.productService.Currency?null:n.productService.Currency.currency,"symbol")),_.xp6(3),_.Oqu(_.Dn7(6,6,null==n.product?null:n.product.product_sale_price,null==n.productService.Currency?null:n.productService.Currency.currency,"symbol"))}}function Nx(e,t){if(1&e&&(_.TgZ(0,"h3"),_.TgZ(1,"span"),_._uU(2),_.ALo(3,"currency"),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(2),_.Oqu(_.Dn7(3,1,null==n.product?null:n.product.product_retail_price,null==n.productService.Currency?null:n.productService.Currency.currency,"symbol"))}}function Dx(e,t){if(1&e&&(_.TgZ(0,"div",38),_.TgZ(1,"h4"),_._uU(2),_.qZA(),_.TgZ(3,"p"),_._uU(4),_.qZA(),_.qZA()),2&e){var n=_.oxw().$implicit,i=_.oxw(2);_.xp6(2),_.Oqu(i.capitalizeString(n.attribute_slug)),_.xp6(2),_.Oqu(n.value)}}function Fx(e,t){if(1&e&&(_.TgZ(0,"div",38),_.TgZ(1,"h4"),_._uU(2),_.qZA(),_._UZ(3,"img",39),_.ALo(4,"safe"),_.qZA()),2&e){var n=_.oxw().$implicit,i=_.oxw(2);_.xp6(2),_.Oqu(i.capitalizeString(n.attribute_slug)),_.xp6(1),_.s9C("src",_.xi3(4,2,n.value,"resourceUrl"),_.LSH)}}function Ux(e,t){if(1&e&&(_.TgZ(0,"div",38),_.TgZ(1,"h4"),_._uU(2),_.qZA(),_._UZ(3,"iframe",40),_.ALo(4,"safe"),_.qZA()),2&e){var n=_.oxw().$implicit,i=_.oxw(2);_.xp6(2),_.Oqu(i.capitalizeString(n.attribute_slug)),_.xp6(1),_.Q6J("src",_.xi3(4,2,n.value,"resourceUrl"),_.uOi)}}function Bx(e,t){if(1&e&&(_.TgZ(0,"div"),_.YNc(1,Dx,5,2,"div",37),_.YNc(2,Fx,5,5,"div",37),_.YNc(3,Ux,5,5,"div",37),_.qZA()),2&e){var n=t.$implicit,i=_.oxw(2);_.xp6(1),_.Q6J("ngIf",n.value&&!i.stingURLCheck(n.value)),_.xp6(1),_.Q6J("ngIf",n.value&&"img"==i.stingURLCheck(n.value)),_.xp6(1),_.Q6J("ngIf",n.value&&"pdf"==i.stingURLCheck(n.value))}}function Vx(e,t){if(1&e&&(_.TgZ(0,"div"),_.YNc(1,Bx,4,3,"div",7),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngForOf",n.productAttributeArr)}}function Hx(e,t){if(1&e&&(_.TgZ(0,"div",53),_.TgZ(1,"h4",54),_._uU(2),_.qZA(),_.qZA()),2&e){var n=_.oxw().$implicit;_.xp6(2),_.Oqu(n.add_ons_level)}}function zx(e,t){1&e&&(_.TgZ(0,"span"),_._uU(1,"*"),_.qZA())}function Zx(e,t){if(1&e&&_._UZ(0,"img",55),2&e){var n=_.oxw().$implicit;_.Q6J("src",n.add_ons_image,_.LSH)}}function Gx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.TgZ(3,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(2).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngModel",r.value[i.addon_slug])}}function jx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"div"),_.TgZ(2,"input",57,58),_.NdJ("change",function(){_.CHM(n);var e=_.MAs(3),t=_.oxw().$implicit;return _.oxw(3).onMultiInputChange(e.value,t.addon_slug,t)}),_.qZA(),_.TgZ(4,"input",59,60),_.NdJ("change",function(){_.CHM(n);var e=_.MAs(5),t=_.oxw().$implicit;return _.oxw(3).onInputChange(e.value,t.addon_slug,t)}),_.qZA(),_.qZA(),_.YNc(6,Gx,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(2),_.Q6J("disabled",i.add_ons_value[0].values<1&&r.range),_.xp6(2),_.Q6J("disabled",i.add_ons_value[0].values<1&&r.range),_.xp6(2),_.Q6J("ngIf",i.add_ons_value[0].values>0&&r.range)}}function qx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.TgZ(3,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(2).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngModel",r.value[i.addon_slug])}}function Wx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"input",65,60),_.NdJ("change",function(){_.CHM(n);var e=_.MAs(2),t=_.oxw().$implicit;return _.oxw(3).onInputChange(e.value,t.addon_slug,t)}),_.qZA(),_.YNc(3,qx,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngIf",r.value[i.addon_slug]>0)}}function Jx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(3).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA()}if(2&e){var i=_.oxw(3).$implicit,r=_.oxw(3);_.Q6J("ngModel",r.value[i.addon_slug])}}function Yx(e,t){if(1&e&&(_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.YNc(3,Jx,1,1,"input",66),_.qZA(),_.qZA()),2&e){var n=_.oxw(2).$implicit,i=_.oxw(3);_.xp6(3),_.Q6J("ngIf",n.add_ons_value[0].values>0&&i.range)}}function Xx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"input",59,60),_.NdJ("change",function(){_.CHM(n);var e=_.MAs(2),t=_.oxw().$implicit;return _.oxw(3).onInputChange(e.value,t.addon_slug,t)}),_.qZA(),_.YNc(3,Yx,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(1),_.Q6J("disabled",i.add_ons_value[0].values<1&&r.range),_.xp6(2),_.Q6J("ngIf",r.value[i.addon_slug]>0)}}function Qx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.TgZ(3,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(2).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngModel",r.value[i.addon_slug])}}function Kx(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"input",67),_.NdJ("change",function(e){_.CHM(n);var t=_.oxw().$implicit,i=_.oxw(3);return i.uploadFiles(e.target.files,i.getFormControlName(t.add_ons_name),t)}),_.qZA(),_.YNc(2,Qx,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(2),_.Q6J("ngIf",r.value[i.addon_slug]>0)}}function $x(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.TgZ(3,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(2).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngModel",r.value[i.addon_slug])}}function ew(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"textarea",68,60),_.NdJ("change",function(){_.CHM(n);var e=_.MAs(2),t=_.oxw().$implicit;return _.oxw(3).onInputChange(e.value,t.addon_slug,t)}),_.qZA(),_.YNc(3,$x,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngIf",r.value[i.addon_slug]>0)}}function tw(e,t){if(1&e&&_._UZ(0,"img",73),2&e){var n=_.oxw().$implicit;_.Q6J("src",n.value_image,_.LSH)}}function nw(e,t){if(1&e&&(_.TgZ(0,"option",71),_.YNc(1,tw,1,1,"img",72),_._uU(2),_.qZA()),2&e){var n=t.$implicit,i=_.oxw(5);_.Q6J("value",n.value_slug),_.xp6(1),_.Q6J("ngIf",n.value_image),_.xp6(1),_.hij(" ",i.capitalizeString(n.value_slug)," ")}}function iw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",62),_.TgZ(1,"p",63),_._uU(2,"Seleted Price : "),_.TgZ(3,"input",64),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw(2).$implicit;return _.oxw(3).value[t.addon_slug]=e}),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2).$implicit,r=_.oxw(3);_.xp6(3),_.Q6J("ngModel",r.value[i.addon_slug])}}function rw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",56),_.TgZ(1,"select",69),_.NdJ("ngModelChange",function(e){_.CHM(n);var t=_.oxw().$implicit;return _.oxw(3).selectedOptions[t.addon_slug]=e})("change",function(){_.CHM(n);var e=_.oxw().$implicit;return _.oxw(3).updatePrice(e.addon_slug)}),_.YNc(2,nw,3,3,"option",70),_.qZA(),_.YNc(3,iw,4,1,"div",61),_.qZA()}if(2&e){var i=_.oxw().$implicit,r=_.oxw(3);_.xp6(1),_.Q6J("ngModel",r.selectedOptions[i.addon_slug]),_.xp6(1),_.Q6J("ngForOf",i.add_ons_value),_.xp6(1),_.Q6J("ngIf",r.value[i.addon_slug]>0)}}function aw(e,t){if(1&e&&(_.TgZ(0,"div",46),_.TgZ(1,"div",47),_.YNc(2,Hx,3,1,"div",48),_.TgZ(3,"h4",49),_.YNc(4,zx,2,0,"span",19),_._uU(5),_.qZA(),_.YNc(6,Zx,1,1,"img",50),_.ynx(7,51),_.YNc(8,jx,7,3,"div",52),_.YNc(9,Wx,4,1,"div",52),_.YNc(10,Xx,4,2,"div",52),_.YNc(11,Kx,3,1,"div",52),_.YNc(12,ew,4,1,"div",52),_.YNc(13,rw,4,3,"div",52),_.BQk(),_.qZA(),_.qZA()),2&e){var n=t.$implicit;_.xp6(2),_.Q6J("ngIf",n.add_ons_level),_.xp6(2),_.Q6J("ngIf",n.is_mandatory),_.xp6(1),_.hij(" ",n.add_ons_name,""),_.xp6(1),_.Q6J("ngIf",n.add_ons_image),_.xp6(1),_.Q6J("ngSwitch",n.add_ons_input),_.xp6(1),_.Q6J("ngSwitchCase","range-input"),_.xp6(1),_.Q6J("ngSwitchCase","input"),_.xp6(1),_.Q6J("ngSwitchCase","range"),_.xp6(1),_.Q6J("ngSwitchCase","file"),_.xp6(1),_.Q6J("ngSwitchCase","textarea"),_.xp6(1),_.Q6J("ngSwitchCase","select")}}function ow(e,t){if(1&e&&(_.TgZ(0,"div",24),_.TgZ(1,"h3"),_._uU(2,"Addons"),_.qZA(),_.TgZ(3,"div",3),_.YNc(4,aw,14,11,"div",45),_.qZA(),_.qZA()),2&e){var n=_.oxw(2);_.xp6(4),_.Q6J("ngForOf",n.productAddons)}}function sw(e,t){if(1&e&&(_.TgZ(0,"h4"),_._uU(1,"Product Additional Cost : "),_.TgZ(2,"span",74),_._uU(3),_.ALo(4,"currency"),_.qZA(),_.qZA()),2&e){var n=_.oxw(2);_.xp6(3),_.Oqu(_.Dn7(4,1,n.productAddonsPrice,null==n.productService.Currency?null:n.productService.Currency.currency,"symbol"))}}function uw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div"),_.TgZ(1,"div",41),_.TgZ(2,"input",42),_.NdJ("ngModelChange",function(e){return _.CHM(n),_.oxw().AddonService=e}),_.qZA(),_.TgZ(3,"label",43),_._uU(4,"Want To Buy Addons ?"),_.qZA(),_.qZA(),_.YNc(5,ow,5,1,"div",44),_.YNc(6,sw,5,5,"h4",19),_.qZA()}if(2&e){var i=_.oxw();_.xp6(2),_.Q6J("ngModel",i.AddonService),_.xp6(3),_.Q6J("ngIf",i.AddonService),_.xp6(1),_.Q6J("ngIf",i.AddonService)}}function lw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div"),_.TgZ(1,"h6",75),_._uU(2,"quantity"),_.qZA(),_.TgZ(3,"div",76),_.TgZ(4,"div",77),_.TgZ(5,"span",78),_.TgZ(6,"button",79),_.NdJ("click",function(){return _.CHM(n),_.oxw(2).decrement()}),_._UZ(7,"i",80),_.qZA(),_.qZA(),_._UZ(8,"input",81),_.TgZ(9,"span",78),_.TgZ(10,"button",82),_.NdJ("click",function(){return _.CHM(n),_.oxw(2).increment()}),_._UZ(11,"i",83),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2);_.xp6(8),_.Q6J("value",i.counter)}}function cw(e,t){if(1&e&&(_.TgZ(0,"div"),_.YNc(1,lw,12,1,"div",19),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngIf",n.product_external_link.length<12)}}function hw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",85),_.TgZ(1,"a",86),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2);return e.addToCart(e.product)}),_._uU(2,"add to cart"),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2);_.xp6(1),_.ekj("disabled",i.counter>i.product.stock)}}function pw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",85),_.TgZ(1,"a",86),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2);return e.externalLInk(e.product_external_link)}),_._uU(2,"Buy Now "),_.qZA(),_.qZA()}}function dw(e,t){if(1&e&&(_.TgZ(0,"div"),_.YNc(1,hw,3,2,"div",84),_.YNc(2,pw,3,0,"div",84),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngIf",n.product_external_link.length<12),_.xp6(1),_.Q6J("ngIf",n.product_external_link.length>12)}}function fw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"form",87),_.TgZ(1,"button",88),_.NdJ("click",function(){_.CHM(n);var e=_.oxw();return e.addToWishlist(e.product)}),_._UZ(2,"i",89),_.TgZ(3,"span",90),_._uU(4,"Wishlist"),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw();_.xp6(1),_.Q6J("disabled",i.productWishliststatus),_.xp6(1),_.Q6J("ngClass",i.productWishliststatus?"fa fa-heart":"fa fa-heart-o")}}JSON.parse(localStorage.products||"[]"),JSON.parse(localStorage.wishlistItems||"[]"),JSON.parse(localStorage.compareItems||"[]"),JSON.parse(localStorage.cartItems||"[]");var vw=function(){var e=function(){function e(t,n,i,r,a){M(this,e),this.route=t,this.router=n,this.productService=i,this.toastrService=r,this.formBuilder=a,this.products=[],this.product={},this.counter=1,this.activeSlide=0,this.addtocartstatus=!1,this.product_external_link="#",this.cartbuttonhideStatus="inactive",this.quentityStatus="inactive",this.productAttributeArr=[],this.productAddons=[],this.selectedOptions={},this.value={},this.uploadAddonsImage=[],this.addonSelectedResult=[],this.fileToUpload=null,this.range=!1,this.productAddonsPrice=0,this.desableInput=!1,this.AddonService=!1,this.productImages=[],this.productWishliststatus=!1,this.ProductDetailsMainSliderConfig=Ce.lz,this.ProductDetailsThumbConfig=Ce.Br}return k(e,[{key:"ngOnInit",value:function(){var e=this;this.productService.getSettingsDetails().subscribe(function(t){t.length&&(e.cartbuttonhideStatus=t.data[0].addto_cart_status,e.quentityStatus=t.data[0].quentity_status)});var t=this.route.snapshot.paramMap.get("slug");this.productService.getproductsBySlugs(t).subscribe(function(t){var n,i;e.product=t.data,e.productWishliststatus=e.productService.wishlistProductCheck(e.product),e.productAttributeArr=t.data.attributes,e.productAddons=t.data.add_ons,(n=e.productImages).push.apply(n,w(t.data.product_3d_image)),(i=e.productImages).push.apply(i,w(t.data.product_image)),localStorage.setItem("productglb",t.data.product_3d_image[0].pro_3d_image),console.log("response.data.product_3d_image.pro_3d_image =======================>",t.data.product_3d_image[0].pro_3d_image),console.log("this.productImages =======================>",e.productImages),e.ceateForm(),e.product_external_link=t.data.product_external_link?t.data.product_external_link:"#",e.image3d=e.product.product_3d_image[0].pro_3d_image})}},{key:"ceateForm",value:function(){var e={};if(this.productAddons){var t,n=x(this.productAddons);try{for(n.s();!(t=n.n()).done;){var i=t.value;"range-input"==i.add_ons_input?(e[(i.add_ons_name.includes(" ")?i.add_ons_name.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):i.add_ons_name.toLowerCase())+"-1_addons"]=new I.NI,e[(i.add_ons_name.includes(" ")?i.add_ons_name.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):i.add_ons_name.toLowerCase())+"-2_addons"]=new I.NI,e[(i.add_ons_name.includes(" ")?i.add_ons_name.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):i.add_ons_name.toLowerCase())+"-price_addons"]=new I.NI):(e[(i.add_ons_name.includes(" ")?i.add_ons_name.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):i.add_ons_name.toLowerCase())+"_addons"]=new I.NI,e[(i.add_ons_name.includes(" ")?i.add_ons_name.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,""):i.add_ons_name.toLowerCase())+"-price_addons"]=new I.NI)}}catch(r){n.e(r)}finally{n.f()}}console.log("formControlsConfig -========================>?",e),this.productSubmitForm=this.formBuilder.group(e)}},{key:"externalLInk",value:function(e){window.open(e,"_blank")}},{key:"ngOnChanges",value:function(){}},{key:"increment",value:function(){this.counter++}},{key:"tryonpage",value:function(){this.router.navigateByUrl("/tryon")}},{key:"decrement",value:function(){this.counter>1&&this.counter--}},{key:"addToCart",value:function(e){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.addonsprice=this.productAddonsPrice,this.addonSelectedResult.push({extra_document:this.uploadAddonsImage}),e.addons=this.addonSelectedResult,console.log("Final Cart Product ==================>",e),t.next=6,this.productService.addToCart(e,this.counter);case 6:if(t.t0=t.sent,!t.t0){t.next=9;break}e.stock=e.stock-this.counter,this.toastrService.success("Product has been added in Cart.");case 9:case"end":return t.stop()}},t,this)}))}},{key:"capitalizeString",value:function(e){return e.split("_").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")}},{key:"uploadFiles",value:function(e,t,n){var i=this;this.fileToUpload=e.item(0),this.productService.uploadImage(this.fileToUpload).subscribe(function(e){i.value[t]=n.add_ons_value[0].price?n.add_ons_value[0].price:0;var r={keyname:t,fileUrl:e.data.fileUrl},a=i.uploadAddonsImage.findIndex(function(e){return e.keyname==t}),o=i.uploadAddonsImage.find(function(e){return e.keyname==t});-1==a?(i.uploadAddonsImage.push(r),i.productAddonsPrice+=parseFloat(n.add_ons_value[0].price?n.add_ons_value[0].price:0)):(o.fileUrl=e.data.fileUrl,i.uploadAddonsImage.splice(a,1,o)),console.log("imgobj =======================>",r)},function(e){}),console.log("this.uploadAddonsImage",this.uploadAddonsImage),console.log("this.addonSelectedResult",this.addonSelectedResult),console.log("this.productAddonsPrice ",this.productAddonsPrice)}},{key:"onMultiInputChange",value:function(e,t,n){var i={key:n.addon_slug,value:"",price:n.add_ons_value[0].price?n.add_ons_value[0].price:0,other:e},r=this.addonSelectedResult.findIndex(function(e){return e.key==n.addon_slug}),a=this.addonSelectedResult.find(function(e){return e.key==n.addon_slug});-1==r?(this.addonSelectedResult.push(i),this.productAddonsPrice+=parseFloat(n.add_ons_value[0].price?n.add_ons_value[0].price:0)):(a.other=e,this.addonSelectedResult.splice(r,1,a)),console.log("this.addonSelectedResult",this.addonSelectedResult),console.log("this.productAddonsPrice ",this.productAddonsPrice)}},{key:"onInputChange",value:function(e,t,n){var i=this;this.productAddons.map(function(r){r.addon_slug==t&&(r.add_ons_value[0].values=e),i.range=!0,0!=e||"range"!=n.add_ons_input&&"range-input"!=n.add_ons_input||(r.add_ons_value[0].values=e,i.range=!1)});var r=this.productAddons.find(function(e){return e.addon_slug===t});console.log("selecttxt Find",r),r&&(this.value[t]=r.add_ons_value[0].price?r.add_ons_value[0].price:0);var a={key:n.addon_slug,value:e,price:n.add_ons_value[0].price?n.add_ons_value[0].price:0,other:""},o=this.addonSelectedResult.findIndex(function(e){return e.key==n.addon_slug}),s=this.addonSelectedResult.find(function(e){return e.key==n.addon_slug});console.log("exists ===========>",o),-1==o?(this.addonSelectedResult.push(a),this.productAddonsPrice+=parseFloat(n.add_ons_value[0].price?n.add_ons_value[0].price:0)):(console.log("val ===========>",Number(e),n.add_ons_input),Number(e)>0&&("range"==n.add_ons_input||"range-input"==n.add_ons_input)||e.length>0&&("input"==n.add_ons_input||"textarea"==n.add_ons_input)?(""!=s.other&&(a.other=s.other),this.addonSelectedResult.splice(o,1,a)):(this.addonSelectedResult.splice(o,1),this.productAddonsPrice-=parseFloat(s.price))),console.log("this.addonSelectedResult",this.addonSelectedResult),console.log("this.productAddonsPrice ",this.productAddonsPrice)}},{key:"getFormControlName",value:function(e){return e.toLowerCase().replace(/ /g,"_").replace(/[^\w-]+/g,"")}},{key:"updatePrice",value:function(e){var t=this.productAddons.find(function(t){return t.addon_slug===e});if(t){var n=this.selectedOptions[e],i=t.add_ons_value.find(function(e){return e.value_slug===n});i&&(this.pushObjectIfKeyNotExists(this.addonSelectedResult,"key",n,{key:e,value:n,price:i.price?i.price:0,other:""}),this.productAddonsPrice+=parseFloat(i.price?i.price:0),console.log("this.addonSelectedResult",this.addonSelectedResult),console.log("this.productAddonsPrice ",this.productAddonsPrice),this.value[e]=i.price)}}},{key:"pushObjectIfKeyNotExists",value:function(e,t,n,i){var r=e.findIndex(function(e){return e.key==i.key}),a=e.find(function(e){return e.key==i.key});-1==r?e.push(i):(e.splice(r,1,i),this.productAddonsPrice-=parseFloat(a.price?a.price:0))}},{key:"stingURLCheck",value:function(e){if(e.startsWith("http")){var t=e.split("."),n=t[t.length-1];return"jpg"==n||"png"==n?"img":"pdf"}return!1}},{key:"buyNow",value:function(e){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Before Cart Product ==================>",e),this.addonSelectedResult[this.addonSelectedResult.length+1].extra_document=this.uploadAddonsImage,e.addons=this.addonSelectedResult,console.log("Final Cart Product ==================>",e),t.next=6,this.productService.addToCart(e,this.counter);case 6:if(t.t0=t.sent,!t.t0){t.next=9;break}this.router.navigate(["/checkout"]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"addToWishlist",value:function(e){this.productService.addToWishlist(e),this.productWishliststatus=this.productService.wishlistProductCheck(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(Ee.gz),_.Y36(Ee.F0),_.Y36(ox.M),_.Y36(sx._W),_.Y36(I.qu))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-product-no-sidebar"]],viewQuery:function(e,t){var n;(1&e&&_.Gf(wx,5),2&e)&&(_.iGM(n=_.CRH())&&(t.view3D=n.first))},features:[_.TTD],decls:40,vars:17,consts:[[1,"section-b-space"],[1,"collection-wrapper"],[1,"container"],[1,"row"],[1,"col-lg-6"],[1,"product-slick1",3,"options"],["owlCar",""],[4,"ngFor","ngForOf"],[1,"row","align-items-center"],[1,"col-12","p-0"],[1,"slider-nav","small-slider-product","row"],[1,"col-9"],[1,"product-slick",3,"options"],[1,"col-3","align-items-center","justify-content-center","d-flex"],["href","javascrip:void(0)",1,"try_on_btn",3,"click"],["aria-hidden","true",1,"fa","fa-video-camera"],[1,"col-lg-6","rtl-text"],[1,"product-right"],["class","avalibility",4,"ngIf"],[4,"ngIf"],[1,"mb-2"],[3,"stock"],[1,"product-attributes","pb-4"],[1,"product-description","pb-4"],[1,"border-product"],[1,"product-icon"],["class","d-inline-block",4,"ngIf"],[3,"image3d"],["view3D",""],["carouselSlide","",3,"id"],["camera-controls","","camera-orbit","75deg 75deg 20m","alt","A 3D model Product","data-js-focus-visible","","ar-status","not-presenting",1,"model-viewer",3,"src"],[1,"img-fluid",3,"thumbImage","fullImage","magnification","enableLens","lensWidth","lensHeight"],[1,"owl-thumb"],[1,"view_3d","img-fluid",3,"defaultImage","lazyLoad","alt","src","click"],[1,"img-fluid",3,"defaultImage","lazyLoad","alt","src","click"],[1,"avalibility"],[1,"text-danger"],["class","py-2",4,"ngIf"],[1,"py-2"],["alt","",3,"src"],["width","100%",3,"src"],[1,"form-check","form-switch","pb-2"],["type","checkbox","id","flexSwitchCheckChecked",1,"form-check-input",3,"ngModel","ngModelChange"],["for","flexSwitchCheckChecked",1,"form-check-label"],["class","border-product",4,"ngIf"],["class","col-sm-6 col-12",4,"ngFor","ngForOf"],[1,"col-sm-6","col-12"],[1,"row","m-0","form-group","mb-3"],["class","add_ons_level",4,"ngIf"],[1,"w-100"],["alt","Addon Image",3,"src",4,"ngIf"],[3,"ngSwitch"],["class","w-100 addons-price",4,"ngSwitchCase"],[1,"add_ons_level"],[1,"pb-2","mb-3"],["alt","Addon Image",3,"src"],[1,"w-100","addons-price"],["type","color",1,"form-control",3,"disabled","change"],["otherInput",""],["type","range","value","0",1,"form-control",3,"disabled","change"],["ranger",""],["class","price-section",4,"ngIf"],[1,"price-section"],[1,"mt-1"],["type","text",3,"ngModel","ngModelChange"],["type","text",1,"form-control",3,"change"],["type","text",3,"ngModel","ngModelChange",4,"ngIf"],["type","file","accept",".pdf,image/png, image/jpg, image/jpeg",1,"form-control",3,"change"],[1,"form-control",3,"change"],[1,"form-control",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["class","Addon-image",3,"src",4,"ngIf"],[1,"Addon-image",3,"src"],[2,"font-weight","700"],[1,"product-title"],[1,"qty-box"],[1,"input-group"],[1,"input-group-prepend"],["type","button","data-type","minus",1,"btn","quantity-left-minus",3,"click"],[1,"ti-minus"],["type","text","name","quantity","disabled","",1,"form-control","input-number",3,"value"],["type","button","data-type","plus",1,"btn","quantity-right-plus",3,"click"],[1,"ti-plus"],["class","product-buttons",4,"ngIf"],[1,"product-buttons"],[1,"btn","btn-solid","rounded-lg","virtual_btn",3,"click"],[1,"d-inline-block"],[1,"wishlist-btn",3,"disabled","click"],[1,"",3,"ngClass"],[1,"title-font"]],template:function(e,t){1&e&&(_.TgZ(0,"section",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"div",4),_.TgZ(5,"owl-carousel-o",5,6),_.YNc(7,kx,3,2,"ng-container",7),_.qZA(),_.TgZ(8,"div",8),_.TgZ(9,"div",9),_.TgZ(10,"div",10),_.TgZ(11,"div",11),_.TgZ(12,"owl-carousel-o",12),_.YNc(13,Lx,3,2,"ng-container",7),_.qZA(),_.qZA(),_.TgZ(14,"div",13),_.TgZ(15,"a",14),_.NdJ("click",function(){return t.tryonpage()}),_._UZ(16,"i",15),_._uU(17," Try On"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(18,"div",16),_.TgZ(19,"div",17),_.YNc(20,Rx,3,0,"h5",18),_.YNc(21,Px,3,0,"h5",18),_.TgZ(22,"h2"),_._uU(23),_.qZA(),_.YNc(24,Ix,7,10,"h3",19),_.YNc(25,Nx,4,5,"h3",19),_.TgZ(26,"p",20),_._uU(27),_.qZA(),_._UZ(28,"app-stock-inventory",21),_.TgZ(29,"div",22),_.YNc(30,Vx,2,1,"div",19),_.YNc(31,uw,7,3,"div",19),_.qZA(),_.TgZ(32,"div",23),_.YNc(33,cw,2,1,"div",19),_.qZA(),_.YNc(34,dw,3,2,"div",19),_.TgZ(35,"div",24),_.TgZ(36,"div",25),_.YNc(37,fw,5,2,"form",26),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_._UZ(38,"app-product-view3D",27,28)),2&e&&(_.xp6(5),_.Q6J("options",t.ProductDetailsMainSliderConfig),_.xp6(2),_.Q6J("ngForOf",t.productImages),_.xp6(5),_.Q6J("options",t.ProductDetailsThumbConfig),_.xp6(1),_.Q6J("ngForOf",t.productImages),_.xp6(7),_.Q6J("ngIf",t.counter<=t.product.stock),_.xp6(1),_.Q6J("ngIf",t.counter>t.product.stock),_.xp6(2),_.Oqu(null==t.product?null:t.product.product_name),_.xp6(1),_.Q6J("ngIf",null==t.product?null:t.product.product_sale_price),_.xp6(1),_.Q6J("ngIf",null==(null==t.product?null:t.product.product_sale_price)),_.xp6(2),_.Oqu(null==t.product?null:t.product.product_description),_.xp6(1),_.Q6J("stock",t.product.stock),_.xp6(2),_.Q6J("ngIf",t.productAttributeArr),_.xp6(1),_.Q6J("ngIf",t.productAddons),_.xp6(2),_.Q6J("ngIf","inactive"==t.quentityStatus),_.xp6(1),_.Q6J("ngIf","inactive"==t.cartbuttonhideStatus),_.xp6(3),_.Q6J("ngIf",t.product_external_link.length<12),_.xp6(1),_.Q6J("image3d",t.image3d))},directives:[ux.Fy,y.sg,y.O5,px,mx,ux.Mp,gx.r,yx.z1,I.Wl,I.JJ,I.On,y.RF,y.n9,I.Fj,I.EJ,I.YN,I.Kr,I._Y,I.JL,I.F,y.mk],pipes:[y.H9,xx],styles:[".small-slider-product[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-height:130px;-o-object-fit:contain;object-fit:contain}.product-right[_ngcontent-%COMP%]   .color-variant[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{border:2px solid #9d9999!important}.addons-price[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:first-child, .addons-price[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .addons-price[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .addons-price[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{margin-right:15px;flex-basis:55%}.addons-price[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex-basis:40%}.price-section[_ngcontent-%COMP%]{display:flex}.price-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;box-shadow:none}model-viewer[_ngcontent-%COMP%]{width:100%;height:400px}.form-control[_ngcontent-%COMP%]{height:46px;border-radius:8px;border-width:2px}.price-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{pointer-events:none;min-width:40px;margin-right:0!important;background:transparent}.view_3d[_ngcontent-%COMP%]{width:100px!important;margin:0 auto;height:130px}.add_ons_level[_ngcontent-%COMP%]{width:100%}.add_ons_level[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{border-bottom:1px solid #9d9999}.border-product[_ngcontent-%COMP%]   .col-sm-6[_ngcontent-%COMP%]:nth-child(6){max-width:100%!important;flex:100%}.try_on_btn[_ngcontent-%COMP%]{border:1px solid #007bff;padding:5px 15px;font-size:16px;border-radius:3px}.try_on_btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:5px}.try_on_btn[_ngcontent-%COMP%]:hover{background-color:#007bff;color:#fff}.modal-body[_ngcontent-%COMP%]{padding-left:1rem!important;padding-bottom:1rem!important}"]}),e}(),mw=f(529);function gw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"ng5-slider",6),_.NdJ("valueChange",function(e){return _.CHM(n),_.oxw().min=e})("highValueChange",function(e){return _.CHM(n),_.oxw().max=e})("userChangeEnd",function(e){return _.CHM(n),_.oxw().appliedFilter(e)}),_.qZA()}if(2&e){var i=_.oxw();_.Q6J("value",i.min)("highValue",i.max)("options",i.options)}}var yw=function(){var e=function(){function e(t,n,i){M(this,e),this.platformId=t,this.route=n,this.productservice=i,this.priceFilter=new _.vpe,this.products=[],this.collapse=!0,this.isBrowser=!1,this.maxdata=0,this.options={floor:0,ceil:9999},(0,y.NF)(this.platformId)&&(this.isBrowser=!0)}return k(e,[{key:"ngOnInit",value:function(){}},{key:"appliedFilter",value:function(e){this.price={minPrice:e.value,maxPrice:e.highValue},this.priceFilter.emit(this.price)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(_.Lbi),_.Y36(Ee.gz),_.Y36(ox.M))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-price"]],inputs:{min:"min",max:"max"},outputs:{priceFilter:"priceFilter"},decls:7,vars:3,consts:[[1,"collection-collapse-block","border-0"],[1,"collapse-block-title",3,"click"],[1,"collection-collapse-block-content"],[1,"collection-brand-filter"],[1,"mt-2"],[3,"value","highValue","options","valueChange","highValueChange","userChangeEnd",4,"ngIf"],[3,"value","highValue","options","valueChange","highValueChange","userChangeEnd"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"h3",1),_.NdJ("click",function(){return t.collapse=!t.collapse}),_._uU(2,"price"),_.qZA(),_.TgZ(3,"div",2),_.TgZ(4,"div",3),_.TgZ(5,"div",4),_.YNc(6,gw,1,3,"ng5-slider",5),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.ekj("open",t.collapse),_.xp6(6),_.Q6J("ngIf",t.isBrowser))},directives:[y.O5,xe],styles:[""]}),e}();function bw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",17),_.TgZ(1,"ul"),_.TgZ(2,"li",6),_.NdJ("click",function(){return _.CHM(n),_.oxw().setGridLayout("col-lg-6")}),_._UZ(3,"img",18),_.qZA(),_.TgZ(4,"li",6),_.NdJ("click",function(){return _.CHM(n),_.oxw().setGridLayout("col-lg-4")}),_._UZ(5,"img",19),_.qZA(),_.TgZ(6,"li",6),_.NdJ("click",function(){return _.CHM(n),_.oxw().setGridLayout("col-lg-3")}),_._UZ(7,"img",20),_.qZA(),_.TgZ(8,"li",6),_.NdJ("click",function(){return _.CHM(n),_.oxw().setGridLayout("col-lg-2")}),_._UZ(9,"img",21),_.qZA(),_.qZA(),_.qZA()}}var xw=function(){var e=function(){function e(){M(this,e),this.products=[],this.paginate={},this.layoutView="grid-view",this.setGrid=new _.vpe,this.setLayout=new _.vpe,this.sortedBy=new _.vpe}return k(e,[{key:"ngOnInit",value:function(){}},{key:"setGridLayout",value:function(e){this.setGrid.emit(e)}},{key:"setLayoutView",value:function(e){this.layoutView=e,this.setLayout.emit(e)}},{key:"sorting",value:function(e){this.sortedBy.emit(e.target.value)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-grid"]],inputs:{products:"products",paginate:"paginate",layoutView:"layoutView",sortBy:"sortBy"},outputs:{setGrid:"setGrid",setLayout:"setLayout",sortedBy:"sortedBy"},decls:26,vars:7,consts:[[1,"product-top-filter"],[1,"row"],[1,"col-12"],[1,"product-filter-content"],[1,"search-count"],[1,"collection-view"],[3,"click"],[1,"fa","fa-th","grid-layout-view"],[1,"fa","fa-list-ul","list-layout-view"],["class","collection-grid-view",4,"ngIf"],[1,"product-page-filter"],[3,"change"],["value",""],["value","a-z",3,"selected"],["value","z-a",3,"selected"],["value","low",3,"selected"],["value","high",3,"selected"],[1,"collection-grid-view"],["src","assets/images/icon/2.png",1,"product-2-layout-view"],["src","assets/images/icon/3.png",1,"product-3-layout-view"],["src","assets/images/icon/4.png",1,"product-4-layout-view"],["src","assets/images/icon/6.png",1,"product-6-layout-view"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"div",4),_.TgZ(5,"h5"),_._uU(6),_.qZA(),_.qZA(),_.TgZ(7,"div",5),_.TgZ(8,"ul"),_.TgZ(9,"li",6),_.NdJ("click",function(){return t.setLayoutView("grid-view")}),_._UZ(10,"i",7),_.qZA(),_.TgZ(11,"li",6),_.NdJ("click",function(){return t.setLayoutView("list-view")}),_._UZ(12,"i",8),_.qZA(),_.qZA(),_.qZA(),_.YNc(13,bw,10,0,"div",9),_.TgZ(14,"div",10),_.TgZ(15,"select",11),_.NdJ("change",function(e){return t.sorting(e)}),_.TgZ(16,"option",12),_._uU(17,"Sorting Items"),_.qZA(),_.TgZ(18,"option",13),_._uU(19,"Alphabetically A-Z"),_.qZA(),_.TgZ(20,"option",14),_._uU(21,"Alphabetically Z-A"),_.qZA(),_.TgZ(22,"option",15),_._uU(23,"Price Low to High"),_.qZA(),_.TgZ(24,"option",16),_._uU(25,"Price High to Low"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(6),_.AsE("Showing Products 1-",t.products.length," of ",t.paginate.totalItems," Result"),_.xp6(7),_.Q6J("ngIf","grid-view"==t.layoutView),_.xp6(5),_.Q6J("selected","a-z"==t.sortBy),_.xp6(2),_.Q6J("selected","z-a"==t.sortBy),_.xp6(2),_.Q6J("selected","low"==t.sortBy),_.xp6(2),_.Q6J("selected","high"==t.sortBy))},directives:[y.O5,I.YN,I.Kr],styles:[""]}),e}(),ww=function(e){return{active:e}};function _w(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"li",18),_.TgZ(1,"a",19),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(3).pageSet(e)}),_._uU(2),_.qZA(),_.qZA()}if(2&e){var i=t.$implicit,r=_.oxw(3);_.Q6J("ngClass",_.VKq(2,ww,r.paginate.currentPage==i)),_.xp6(2),_.Oqu(i)}}var Sw=function(e){return{disabled:e}};function Mw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"ul",9),_.TgZ(1,"li",10),_.TgZ(2,"a",11),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2);return e.pageSet(e.paginate.currentPage-1)}),_.TgZ(3,"span",12),_._UZ(4,"i",13),_.qZA(),_.TgZ(5,"span",14),_._uU(6,"Previous"),_.qZA(),_.qZA(),_.qZA(),_.YNc(7,_w,3,4,"li",15),_.TgZ(8,"li",10),_.TgZ(9,"a",16),_.NdJ("click",function(){_.CHM(n);var e=_.oxw(2);return e.pageSet(e.paginate.currentPage+1)}),_.TgZ(10,"span",12),_._UZ(11,"i",17),_.qZA(),_.TgZ(12,"span",14),_._uU(13,"Next"),_.qZA(),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=_.oxw(2);_.xp6(1),_.Q6J("ngClass",_.VKq(3,Sw,1===i.paginate.currentPage)),_.xp6(6),_.Q6J("ngForOf",i.paginate.pages),_.xp6(1),_.Q6J("ngClass",_.VKq(5,Sw,i.paginate.currentPage==i.paginate.totalPages))}}function Tw(e,t){if(1&e&&(_.TgZ(0,"div",1),_.TgZ(1,"div",2),_.TgZ(2,"div",3),_.TgZ(3,"div",4),_.TgZ(4,"div",5),_.TgZ(5,"nav",6),_.YNc(6,Mw,14,7,"ul",7),_.qZA(),_.qZA(),_.TgZ(7,"div",5),_.TgZ(8,"div",8),_.TgZ(9,"h5"),_._uU(10),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(6),_.Q6J("ngIf",n.paginate.pages&&n.paginate.pages.length),_.xp6(4),_.AsE("Showing Products 1-",n.products.length," of ",n.paginate.totalItems," Result")}}var kw=function(){var e=function(){function e(){M(this,e),this.products=[],this.paginate={},this.setPage=new _.vpe}return k(e,[{key:"ngOnInit",value:function(){}},{key:"pageSet",value:function(e){this.setPage.emit(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-pagination"]],inputs:{products:"products",paginate:"paginate"},outputs:{setPage:"setPage"},decls:1,vars:1,consts:[["class","product-pagination",4,"ngIf"],[1,"product-pagination"],[1,"theme-paggination-block"],[1,"container-fluid","p-0"],[1,"row"],[1,"col-xl-6","col-md-6","col-sm-12"],["aria-label","Page navigation"],["class","pagination",4,"ngIf"],[1,"product-search-count-bottom"],[1,"pagination"],[1,"page-item",3,"ngClass"],["href","javascript:void(0)","aria-label","Previous",1,"page-link",3,"click"],["aria-hidden","true"],["aria-hidden","true",1,"fa","fa-chevron-left"],[1,"sr-only"],["class","page-item active",3,"ngClass",4,"ngFor","ngForOf"],["href","javascript:void(0)","aria-label","Next",1,"page-link",3,"click"],["aria-hidden","true",1,"fa","fa-chevron-right"],[1,"page-item","active",3,"ngClass"],["href","javascript:void(0)",1,"page-link",3,"click"]],template:function(e,t){1&e&&_.YNc(0,Tw,11,3,"div",0),2&e&&_.Q6J("ngIf",t.products.length)},directives:[y.O5,y.mk,y.sg],styles:[""]}),e}(),Ew=f(37481);function Aw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"h3",33),_._uU(1,"Filters "),_.TgZ(2,"span",34),_.TgZ(3,"a",35),_.NdJ("click",function(){return _.CHM(n),_.oxw().removeAllTags()}),_._uU(4," Clear all "),_.qZA(),_.qZA(),_.qZA()}}function Cw(e,t){if(1&e&&(_.TgZ(0,"div",36),_.TgZ(1,"div",37),_._UZ(2,"app-product-box-one",38),_.qZA(),_.qZA()),2&e){var n=t.$implicit,i=_.oxw();_.Q6J("ngClass",i.grid),_.xp6(2),_.Q6J("product",n)("currency",null==i.productService?null:i.productService.Currency)("thumbnail",!0)("cartModal",!1)("loader",!0)}}function Ow(e,t){if(1&e&&(_.TgZ(0,"div",43),_.TgZ(1,"div",37),_.TgZ(2,"p"),_._uU(3),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw(2);_.xp6(3),_.hij("Product Length :: ",n.products.length,"")}}var Lw=function(){return["/shop/collection/left/sidebar"]};function Rw(e,t){if(1&e&&(_.TgZ(0,"div",39),_.YNc(1,Ow,4,1,"div",40),_._UZ(2,"img",41),_.TgZ(3,"h3"),_._uU(4,"Sorry! Couldn't find the product you were looking For!!! "),_.qZA(),_.TgZ(5,"p"),_._uU(6,"Please check if you have misspelt something or try searching with other words."),_.qZA(),_.TgZ(7,"a",42),_._uU(8,"continue shopping"),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngForOf",n.products),_.xp6(6),_.Q6J("routerLink",_.DdM(2,Lw))}}JSON.parse(localStorage.products||"[]"),JSON.parse(localStorage.wishlistItems||"[]"),JSON.parse(localStorage.compareItems||"[]"),JSON.parse(localStorage.cartItems||"[]");var Pw=function(){var e=function(){function e(t,n,i,r,a){M(this,e),this.route=t,this.router=n,this.viewScroller=i,this.productService=r,this.toastr=a,this.grid="col-xl-3 col-md-6",this.layoutView="grid-view",this.products=[],this.product_list=[],this.minPrice=0,this.maxPrice=12e4,this.tags=[],this.pageNo=1,this.paginate={},this.mobileSidebar=!1,this.loader=!0,this.no_results=0}return k(e,[{key:"ngOnInit",value:function(){var e=this;this.route.paramMap.subscribe(function(t){e.store_slug=t.get("slug"),e.page_no=t.get("page")}),this.productService.get2DProductList({store_slug:this.store_slug}).subscribe(function(t){e.products=t.data.product_list,e.product_list=t.data.product_list,e.no_results=t.data.product_count},function(t){e.toastr.error(t.error.message)}),this.route.queryParams.subscribe(function(t){console.log("Param Details in collection page",t),e.minPrice=t.minPrice?t.minPrice:e.minPrice,e.maxPrice=t.maxPrice?t.maxPrice:e.maxPrice,e.sortBy=t.sortBy?t.sortBy:"ascending",e.pageNo=t.page?t.page:e.pageNo,e.products=e.productService.sortProducts(e.product_list,e.sortBy),e.products=e.products.filter(function(t){var n;return(n=null==t.product_sale_price?t.product_retail_price:t.product_sale_price)>=e.minPrice&&n<=e.maxPrice}),console.log("Product Price Check",e.products),e.paginate=e.productService.getPager(e.products.length,+e.pageNo),e.products=e.products.slice(e.paginate.startIndex,e.paginate.endIndex+1),console.log("Product Paginate Check",e.products)}),this.storeurl="".concat(mw.N.storeUrl,"/?s_slug=").concat(this.store_slug,"&page=").concat(this.page_no)}},{key:"updateFilter",value:function(e){var t=this;e.page=null,this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge",skipLocationChange:!1}).finally(function(){t.viewScroller.setOffset([120,120]),t.viewScroller.scrollToAnchor("products")})}},{key:"sortByFilter",value:function(e){var t=this;console.log("================>>",this.products),this.router.navigate([],{relativeTo:this.route,queryParams:{sortBy:e||null},queryParamsHandling:"merge",skipLocationChange:!1}).finally(function(){t.viewScroller.setOffset([120,120]),t.viewScroller.scrollToAnchor("products")})}},{key:"removeAllTags",value:function(){var e=this;this.router.navigate([],{relativeTo:this.route,queryParams:{},skipLocationChange:!1}).finally(function(){e.viewScroller.setOffset([120,120]),e.viewScroller.scrollToAnchor("products")})}},{key:"setPage",value:function(e){var t=this;this.router.navigate([],{relativeTo:this.route,queryParams:{page:e},queryParamsHandling:"merge",skipLocationChange:!1}).finally(function(){t.viewScroller.setOffset([120,120]),t.viewScroller.scrollToAnchor("products")})}},{key:"updateGridLayout",value:function(e){this.grid=e}},{key:"updateLayoutView",value:function(e){this.layoutView=e,this.grid="list-view"==e?"col-lg-12":"col-xl-3 col-md-6"}},{key:"toggleMobileSidebar",value:function(){this.mobileSidebar=!this.mobileSidebar}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(Ee.gz),_.Y36(Ee.F0),_.Y36(y.EM),_.Y36(ox.M),_.Y36(sx._W))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-collection"]],decls:48,vars:16,consts:[[1,"breadcrumb-section"],[1,"container"],[1,"row"],[1,"col-sm-6"],["aria-label","breadcrumb",1,"theme-breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],[3,"href"],["aria-current","page",1,"breadcrumb-item","active"],[1,"pt-0","section-b-space"],[1,"collection-wrapper"],[1,"col-lg-3"],[1,"collection-filter"],[1,"collection-filter-block"],[1,"collection-mobile-back",3,"click"],[1,"filter-back"],["aria-hidden","true",1,"fa","fa-angle-left"],[1,"filter_block"],["class","block-title",4,"ngIf"],[3,"min","max","priceFilter"],[1,"collection-content","col"],[1,"page-main-content"],[1,"col-sm-12"],[1,"col-xl-12"],[1,"filter-main-btn",3,"click"],[1,"filter-btn","btn","btn-theme"],["aria-hidden","true",1,"fa","fa-filter"],["id","products",1,"collection-product-wrapper"],[3,"products","paginate","layoutView","sortBy","setGrid","setLayout","sortedBy"],[1,"product-wrapper-grid",3,"ngClass"],["class","col-grid-box",3,"ngClass",4,"ngFor","ngForOf"],["class","col-sm-12 text-center section-b-space mt-5 no-found",4,"ngIf"],[3,"products","paginate","setPage"],[1,"block-title"],[1,"clear_filter"],["href","javascript:void(0)",1,"clear_filter",3,"click"],[1,"col-grid-box",3,"ngClass"],[1,"product-box"],[3,"product","currency","thumbnail","cartModal","loader"],[1,"col-sm-12","text-center","section-b-space","mt-5","no-found"],["class","col-grid-box",4,"ngFor","ngForOf"],["src","assets/images/empty-search.jpg",1,"img-fluid","mb-4"],[1,"btn","btn-solid",3,"routerLink"],[1,"col-grid-box"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"div",2),_.TgZ(5,"div",3),_.TgZ(6,"nav",4),_.TgZ(7,"ol",5),_.TgZ(8,"li",6),_.TgZ(9,"a",7),_._uU(10,"3D Store"),_.qZA(),_.qZA(),_.TgZ(11,"li",8),_._uU(12,"2D Product List"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(13,"div",3),_.TgZ(14,"div",5),_._uU(15),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(16,"section",9),_.TgZ(17,"div",10),_.TgZ(18,"div",1),_.TgZ(19,"div",2),_.TgZ(20,"div",11),_.TgZ(21,"div",12),_.TgZ(22,"div",13),_.TgZ(23,"div",14),_.NdJ("click",function(){return t.toggleMobileSidebar()}),_.TgZ(24,"span",15),_._UZ(25,"i",16),_._uU(26," back "),_.qZA(),_.qZA(),_.TgZ(27,"div",17),_.YNc(28,Aw,5,0,"h3",18),_.qZA(),_.qZA(),_.TgZ(29,"div",13),_.TgZ(30,"app-price",19),_.NdJ("priceFilter",function(e){return t.updateFilter(e)}),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(31,"div",20),_.TgZ(32,"div",21),_.TgZ(33,"div",2),_.TgZ(34,"div",22),_.TgZ(35,"div",2),_.TgZ(36,"div",23),_.TgZ(37,"div",24),_.NdJ("click",function(){return t.toggleMobileSidebar()}),_.TgZ(38,"span",25),_._UZ(39,"i",26),_._uU(40," Filter "),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(41,"div",27),_.TgZ(42,"app-grid",28),_.NdJ("setGrid",function(e){return t.updateGridLayout(e)})("setLayout",function(e){return t.updateLayoutView(e)})("sortedBy",function(e){return t.sortByFilter(e)}),_.qZA(),_.TgZ(43,"div",29),_.TgZ(44,"div",2),_.YNc(45,Cw,3,6,"div",30),_.YNc(46,Rw,9,3,"div",31),_.qZA(),_.qZA(),_.TgZ(47,"app-pagination",32),_.NdJ("setPage",function(e){return t.setPage(e)}),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(9),_.s9C("href",t.storeurl,_.LSH),_.xp6(6),_.hij("",t.no_results," Results"),_.xp6(6),_.ekj("openFilterbar",t.mobileSidebar),_.xp6(7),_.Q6J("ngIf",t.tags.length>0),_.xp6(2),_.Q6J("min",t.minPrice)("max",5e4),_.xp6(12),_.Q6J("products",t.products)("paginate",t.paginate)("layoutView",t.layoutView)("sortBy",t.sortBy),_.xp6(1),_.Q6J("ngClass",t.layoutView),_.xp6(2),_.Q6J("ngForOf",t.products),_.xp6(1),_.Q6J("ngIf",!t.products.length),_.xp6(1),_.Q6J("products",t.products)("paginate",t.paginate))},directives:[y.O5,yw,xw,y.mk,y.sg,kw,Ew.y,Ee.yS],styles:[".category_banner[_ngcontent-%COMP%]{max-height:400px;overflow:hidden}.category_banner[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}"]}),e}();function Iw(e,t){1&e&&(_.TgZ(0,"div",4),_._UZ(1,"img",5),_.TgZ(2,"h3"),_.TgZ(3,"strong"),_._uU(4,"Your Cart is Empty"),_.qZA(),_.qZA(),_.TgZ(5,"h4"),_._uU(6,"Add something to make me happy :)"),_.qZA(),_.qZA())}function Nw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",24),_.TgZ(1,"div",25),_.TgZ(2,"div",26),_._UZ(3,"img",27),_.qZA(),_.TgZ(4,"div",28),_.TgZ(5,"p",29),_._uU(6),_.ALo(7,"titlecase"),_.qZA(),_.TgZ(8,"p",30),_._uU(9),_.ALo(10,"currency"),_.qZA(),_.TgZ(11,"p",30),_._uU(12),_.ALo(13,"currency"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(14,"div",31),_.TgZ(15,"div",32),_.TgZ(16,"div",33),_.TgZ(17,"span",34),_.TgZ(18,"button",35),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).decrement(e)}),_._UZ(19,"i",36),_.qZA(),_.qZA(),_.TgZ(20,"input",37),_.NdJ("ngModelChange",function(e){return t.$implicit.quantity=e}),_.qZA(),_.TgZ(21,"span",34),_.TgZ(22,"button",38),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).increment(e)}),_._UZ(23,"i",39),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(24,"div",40),_.TgZ(25,"ul",41),_.TgZ(26,"li"),_.TgZ(27,"a",42),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).removeItem(e)}),_._UZ(28,"i",43),_._uU(29,"Remove"),_.qZA(),_.qZA(),_.TgZ(30,"li"),_.TgZ(31,"a",42),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).addwishlist(e)}),_._UZ(32,"i",44),_._uU(33,"Wishlist"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=t.$implicit,r=_.oxw(2);_.xp6(3),_.Q6J("src",i.product_image[0].pro_image,_.LSH)("alt",i.product_name),_.xp6(3),_.hij(" ",_.lcZ(7,9,i.product_name)," "),_.xp6(3),_.hij("Price : ",_.Dn7(10,11,i.product_sale_price?i.product_sale_price:i.product_retail_price,null==r.product_service.Currency?null:r.product_service.Currency.currency,"symbol"),""),_.xp6(3),_.hij("Addons : ",_.Dn7(13,15,i.addonsprice?i.addonsprice:0,null==r.product_service.Currency?null:r.product_service.Currency.currency,"symbol"),""),_.xp6(6),_.Q6J("disabled",r.desabledecrement),_.xp6(2),_.Q6J("ngModel",i.quantity),_.xp6(2),_.Q6J("disabled",r.desableincrement),_.xp6(10),_.Q6J("ngClass",r.checkwishlist(i)?"fa fa-heart":"fa fa-heart-o")}}function Dw(e,t){if(1&e&&(_.TgZ(0,"ul",45),_.TgZ(1,"li"),_._uU(2),_.ALo(3,"titlecase"),_.TgZ(4,"span"),_._uU(5),_.ALo(6,"currency"),_.ALo(7,"currency"),_.qZA(),_.qZA(),_.qZA()),2&e){var n=t.$implicit,i=_.oxw(2);_.xp6(2),_.AsE("",_.lcZ(3,4,n.product_name)," \xd7 ",n.quantity," "),_.xp6(3),_.AsE("",_.Dn7(6,6,n.product_sale_price?n.product_sale_price:n.product_retail_price,null==i.product_service.Currency?null:i.product_service.Currency.currency,"symbol")," + ",_.Dn7(7,10,n.addonsprice?n.addonsprice:0,null==i.product_service.Currency?null:i.product_service.Currency.currency,"symbol"),"")}}var Fw=function(){return["/checkout"]};function Uw(e,t){if(1&e&&(_.TgZ(0,"div",6),_.TgZ(1,"div",7),_.TgZ(2,"div",8),_.TgZ(3,"h2"),_._uU(4,"Your shopping bag"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(5,"div",9),_.YNc(6,Nw,34,19,"div",10),_.TgZ(7,"div",11),_._UZ(8,"div",12),_.qZA(),_.qZA(),_.TgZ(9,"div",13),_.TgZ(10,"div",14),_.TgZ(11,"div",15),_.TgZ(12,"div",16),_.TgZ(13,"div"),_._uU(14,"Product "),_.TgZ(15,"span"),_._uU(16," Total"),_.qZA(),_.qZA(),_.qZA(),_.YNc(17,Dw,8,14,"ul",17),_.TgZ(18,"ul",18),_.TgZ(19,"li"),_._uU(20,"Subtotal "),_.TgZ(21,"span",19),_._uU(22),_.ALo(23,"currency"),_.ALo(24,"async"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(25,"ul",20),_.TgZ(26,"li"),_._uU(27,"Estimated Total "),_.TgZ(28,"span",19),_._uU(29),_.ALo(30,"currency"),_.ALo(31,"async"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(32,"div",21),_.TgZ(33,"a",22),_._UZ(34,"i",23),_._uU(35,"Checkout"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(6),_.Q6J("ngForOf",n.products),_.xp6(11),_.Q6J("ngForOf",n.products),_.xp6(5),_.Oqu(_.Dn7(23,5,_.lcZ(24,9,n.getTotal),null==n.product_service?null:n.product_service.Currency.currency,"symbol")),_.xp6(7),_.Oqu(_.Dn7(30,11,_.lcZ(31,15,n.getTotal),null==n.product_service?null:n.product_service.Currency.currency,"symbol")),_.xp6(4),_.Q6J("routerLink",_.DdM(17,Fw))}}JSON.parse(localStorage.getItem("products")||"[]"),JSON.parse(localStorage.wishlistItems||"[]"),JSON.parse(localStorage.compareItems||"[]"),JSON.parse(localStorage.cartItems||"[]");var Bw=function(){var e=function(){function e(t,n){M(this,e),this.product_service=t,this.toaster=n,this.products=[],this.ProductSliderConfig=Ce.O_,this.cartproducts=[],this.cartproductlist=[],this.desableincrement=!1,this.desabledecrement=!1,this.delay=!1,this.productWishliststatus=!1}return k(e,[{key:"ngOnInit",value:function(){var e=this;console.log("Cart"),this.products=JSON.parse(localStorage.getItem("cartItems")),this.product_service.cartItems.subscribe(function(t){return e.products=t}),console.log("this.products ==========> Cart page :::",this.products)}},{key:"ngOnChanges",value:function(e){}},{key:"getTotal",get:function(){return this.product_service.cartTotalAmount()}},{key:"increment",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;console.log("product.stock",e.stock),this.desabledecrement=!1,this.delay=!0,setTimeout(function(){t.delay=!1},1e3),console.log("product.quantity===============",e.quantity),e.stock>0?(e.stock>0&&(e.stock=e.stock-1),this.product_service.updateCartQuantity(e,n),this.getTotal.subscribe(),this.desableincrement=!1):(this.toaster.error("Your product out of stock"),this.desableincrement=!0),console.log("product.quantity===============",e.quantity),this.desableincrement=!(e.quantity>=1)}},{key:"decrement",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;console.log("product.stock",e.stock),this.desableincrement=!1,this.delay=!0,setTimeout(function(){t.delay=!1},1e3),1==e.quantity?this.desabledecrement=!0:(e.stock=e.stock+1,this.desabledecrement=!1,this.product_service.updateCartQuantity(e,n),this.getTotal.subscribe())}},{key:"checkwishlist",value:function(e){return this.product_service.wishlistProductCheck(e)}},{key:"addwishlist",value:function(e){this.productWishliststatus=this.product_service.wishlistProductCheck(e),this.productWishliststatus||this.product_service.addToWishlist(e)}},{key:"removeItem",value:function(e){var t=this;e.stock=e.stock+1,this.product_service.removeCartItem(e),this.product_service.cartItems.subscribe(function(e){return t.products=e})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(ox.M),_.Y36(sx._W))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-cart"]],features:[_.TTD],decls:4,vars:2,consts:[[1,"cart-section"],[1,"container"],["class","col-sm-12 empty-cart-cls text-center",4,"ngIf"],["class","row cart_section",4,"ngIf"],[1,"col-sm-12","empty-cart-cls","text-center"],["src","assets/images/icon-empty-cart.png",1,"img-fluid","mb-4"],[1,"row","cart_section"],[1,"col-sm-12"],[1,"title1","section-b-space"],[1,"col-sm-12","col-lg-8","col-12"],["class","row justify-content-center align-items-center mb-4",4,"ngFor","ngForOf"],[1,"row","section-t-space"],[1,"col-12"],[1,"col-lg-4","col-sm-12","col-xs-12"],[1,"checkout-details"],[1,"order-box"],[1,"title-box"],["class","qty",4,"ngFor","ngForOf"],[1,"sub-total"],[1,"count"],[1,"total"],[1,"text-center"],[1,"btn","btn-solid","rounded-lg","w-100",3,"routerLink"],[1,"ti-lock","mr-1"],[1,"row","justify-content-center","align-items-center","mb-4"],[1,"col-sm-5","col-md-5","col-9","flex_item"],[1,"cart_product_img"],[1,"img-fluid",3,"src","alt"],[1,"cart_product_info"],[1,"mb-2","product_title"],[1,"mb-2"],[1,"col-sm-4","col-md-4","col-3"],[1,"qty-box"],[1,"input-group"],[1,"input-group-prepend"],["type","button","data-type","minus",1,"btn","quantity-left-minus",3,"disabled","click"],[1,"ti-minus"],["type","text","name","quantity","disabled","",1,"form-control","input-number",3,"ngModel","ngModelChange"],["type","button","data-type","plus",1,"btn","quantity-right-plus",3,"disabled","click"],[1,"ti-plus"],[1,"col-sm-3","col-12"],[1,"cart_item_action","mt-2"],[3,"click"],[1,"ti-trash"],[1,"",3,"ngClass"],[1,"qty"]],template:function(e,t){1&e&&(_.TgZ(0,"section",0),_.TgZ(1,"div",1),_.YNc(2,Iw,7,0,"div",2),_.YNc(3,Uw,36,18,"div",3),_.qZA(),_.qZA()),2&e&&(_.xp6(2),_.Q6J("ngIf",t.products.length<1),_.xp6(1),_.Q6J("ngIf",t.products.length>0))},directives:[y.O5,y.sg,Ee.yS,I.Fj,I.JJ,I.On,y.mk],pipes:[y.H9,y.Ov,y.rS],styles:[".cart_procolor[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{width:16px;height:16px;position:absolute}.cart_product_info[_ngcontent-%COMP%]{width:40%}.cart_product_info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#000}.cart_product_info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-child{font-weight:700}.flex_item[_ngcontent-%COMP%]{align-items:center;justify-content:space-evenly}"]}),e}();function Vw(e,t){1&e&&(_.TgZ(0,"div",5),_._UZ(1,"img",6),_.TgZ(2,"h3",7),_.TgZ(3,"b"),_._uU(4,"Wishlist is Empty"),_.qZA(),_.qZA(),_.TgZ(5,"h4"),_._uU(6,"Explore More. Shortlist Some Items."),_.qZA(),_.qZA())}var Hw=function(){return["/shop/cart"]};function zw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"tr"),_.TgZ(1,"td"),_._UZ(2,"img",14),_.qZA(),_.TgZ(3,"td"),_.TgZ(4,"h2"),_._uU(5),_.ALo(6,"titlecase"),_.qZA(),_.TgZ(7,"div",15),_.TgZ(8,"div",16),_.TgZ(9,"h2",17),_._uU(10),_.qZA(),_.qZA(),_.TgZ(11,"div",16),_.TgZ(12,"h2",17),_.TgZ(13,"a",18),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).removeItem(e)}),_._UZ(14,"i",19),_.qZA(),_.TgZ(15,"a",20),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).addToCart(e)}),_._UZ(16,"i",21),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(17,"td"),_.TgZ(18,"h2"),_._uU(19),_.ALo(20,"currency"),_.qZA(),_.qZA(),_.TgZ(21,"td"),_.TgZ(22,"a",22),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).removeItem(e)}),_._UZ(23,"i",19),_.qZA(),_.TgZ(24,"a",23),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).addToCart(e)}),_._UZ(25,"i",21),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=t.$implicit,r=_.oxw(2);_.xp6(2),_.Q6J("src",i.product_image[0].pro_image,_.LSH)("alt",i.product_name),_.xp6(3),_.Oqu(_.lcZ(6,6,i.product_name)),_.xp6(5),_.hij(" ",i.product_sale_price," "),_.xp6(5),_.Q6J("routerLink",_.DdM(12,Hw)),_.xp6(4),_.hij(" ",_.Dn7(20,8,i.product_sale_price,null==r.productService.Currency?null:r.productService.Currency.currency,"symbol")," ")}}function Zw(e,t){if(1&e&&(_.TgZ(0,"div",8),_.TgZ(1,"div",9),_.TgZ(2,"table",10),_.TgZ(3,"thead"),_.TgZ(4,"tr",11),_.TgZ(5,"th",12),_._uU(6,"image"),_.qZA(),_.TgZ(7,"th",12),_._uU(8,"product name"),_.qZA(),_.TgZ(9,"th",12),_._uU(10,"price"),_.qZA(),_.TgZ(11,"th",12),_._uU(12,"action"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(13,"tbody"),_.YNc(14,zw,26,13,"tr",13),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(14),_.Q6J("ngForOf",n.products)}}var Gw=function(){return["/"]},jw=function(){return["/checkout"]};function qw(e,t){1&e&&(_.TgZ(0,"div",24),_.TgZ(1,"div",25),_.TgZ(2,"a",26),_._uU(3,"continue shopping"),_.qZA(),_.TgZ(4,"a",26),_._uU(5,"checkout"),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(2),_.Q6J("routerLink",_.DdM(2,Gw)),_.xp6(2),_.Q6J("routerLink",_.DdM(3,jw)))}var Ww=function(){var e=function(){function e(t,n){var i=this;M(this,e),this.router=t,this.productService=n,this.products=[],this.productService.wishlistItems.subscribe(function(e){i.products=e})}return k(e,[{key:"ngOnInit",value:function(){}},{key:"getTotal",get:function(){return this.productService.cartTotalAmount()}},{key:"addToCart",value:function(e){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.productService.addToCart(e,1);case 2:n=t.sent,this.getTotal.subscribe(),n&&(e.stock>0&&(e.stock=e.stock-1),this.router.navigate(["/cart"]),this.removeItem(e));case 4:case"end":return t.stop()}},t,this)}))}},{key:"removeItem",value:function(e){this.productService.removeWishlistItem(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(Ee.F0),_.Y36(ox.M))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-wishlist"]],decls:5,vars:3,consts:[[1,"wishlist-section","section-b-space"],[1,"container"],["class","col-md-12 empty-cart-cls text-center",4,"ngIf"],["class","row",4,"ngIf"],["class","row wishlist-buttons",4,"ngIf"],[1,"col-md-12","empty-cart-cls","text-center"],["src","assets/images/empty-wishlist.png","alt","Empty cart","title","Emprt cart"],[1,"mt-4"],[1,"row"],[1,"col-sm-12"],[1,"table","cart-table","table-responsive-xs"],[1,"table-head"],["scope","col"],[4,"ngFor","ngForOf"],["height","120",3,"src","alt"],[1,"mobile-cart-content","row"],[1,"col-xs-3"],[1,"td-color"],["href","javascript:void(0)",1,"icon","mr-1",3,"click"],[1,"ti-close"],[1,"cart",3,"routerLink","click"],[1,"ti-shopping-cart"],["href","javascript:void(0)",1,"icon","mr-3",3,"click"],["href","javascript:void(0)",1,"cart",3,"click"],[1,"row","wishlist-buttons"],[1,"col-12"],[1,"btn","btn-solid","rounded-lg",3,"routerLink"]],template:function(e,t){1&e&&(_.TgZ(0,"section",0),_.TgZ(1,"div",1),_.YNc(2,Vw,7,0,"div",2),_.YNc(3,Zw,15,1,"div",3),_.YNc(4,qw,6,4,"div",4),_.qZA(),_.qZA()),2&e&&(_.xp6(2),_.Q6J("ngIf",!t.products.length),_.xp6(1),_.Q6J("ngIf",t.products.length),_.xp6(1),_.Q6J("ngIf",t.products.length))},directives:[y.O5,y.sg,Ee.yS],pipes:[y.rS,y.H9],styles:[".cart-section[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .cart-section[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .wishlist-section[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .wishlist-section[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:20px}.wishlist-section[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:18px}"]}),e}(),Jw=f(43675),Yw=f(25968);function Xw(e,t){1&e&&(_.TgZ(0,"div",8),_._UZ(1,"img",9),_.TgZ(2,"h3"),_.TgZ(3,"strong"),_._uU(4,"Compare List is Empty"),_.qZA(),_.qZA(),_.TgZ(5,"h4"),_._uU(6,"Explore More. Shortlist Some Items."),_.qZA(),_.qZA())}function Qw(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"th",18),_.TgZ(1,"button",19),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).removeItem(e)}),_._uU(2," Remove "),_.qZA(),_.qZA()}}function Kw(e,t){if(1&e&&(_.TgZ(0,"td",20),_._uU(1),_.ALo(2,"titlecase"),_.qZA()),2&e){var n=t.$implicit;_.xp6(1),_.Oqu(_.lcZ(2,1,n.title))}}function $w(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"td",18),_._UZ(1,"img",21),_.TgZ(2,"div",22),_.TgZ(3,"strong"),_._uU(4,"On Sale: "),_.qZA(),_.TgZ(5,"span"),_._uU(6),_.ALo(7,"currency"),_.ALo(8,"discount"),_.qZA(),_.qZA(),_.TgZ(9,"form",23),_.TgZ(10,"button",24),_.NdJ("click",function(){var e=_.CHM(n).$implicit;return _.oxw(2).addToCart(e)}),_._uU(11,"Add to Cart"),_.qZA(),_.qZA(),_.qZA()}if(2&e){var i=t.$implicit,r=_.oxw(2);_.xp6(1),_.Q6J("src",i.images[0].src,_.LSH)("alt",i.images[0].alt),_.xp6(5),_.hij(" ",_.Dn7(7,3,_.xi3(8,7,i.price,i)*(null==r.productService?null:r.productService.Currency.price),null==r.productService?null:r.productService.Currency.currency,"symbol"),"")}}function e_(e,t){if(1&e&&(_.TgZ(0,"td",18),_.TgZ(1,"p",25),_._uU(2),_.qZA(),_.qZA()),2&e){var n=t.$implicit;_.xp6(2),_.Oqu(n.description.substring(0,200)+"...")}}function t_(e,t){if(1&e&&(_.TgZ(0,"td",26),_.TgZ(1,"p"),_._uU(2),_.qZA(),_.qZA()),2&e){var n=t.$implicit;_.xp6(2),_.hij(" ",n.stock>0?"In stock":"Out of stock"," ")}}function n_(e,t){if(1&e&&(_.TgZ(0,"div",10),_.TgZ(1,"table",11),_.TgZ(2,"thead"),_.TgZ(3,"tr",12),_.TgZ(4,"td"),_._uU(5,"Action"),_.qZA(),_.YNc(6,Qw,3,0,"th",13),_.qZA(),_.qZA(),_.TgZ(7,"tbody",14),_.TgZ(8,"tr"),_.TgZ(9,"th",15),_._uU(10,"Product Name"),_.qZA(),_.YNc(11,Kw,3,3,"td",16),_.qZA(),_.TgZ(12,"tr"),_.TgZ(13,"th",15),_._uU(14,"Product Image"),_.qZA(),_.YNc(15,$w,12,10,"td",13),_.qZA(),_.TgZ(16,"tr"),_.TgZ(17,"th",15),_._uU(18,"Product Description"),_.qZA(),_.YNc(19,e_,3,1,"td",13),_.qZA(),_.TgZ(20,"tr"),_.TgZ(21,"th",15),_._uU(22," Availability "),_.qZA(),_.YNc(23,t_,3,1,"td",17),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.xp6(6),_.Q6J("ngForOf",n.products),_.xp6(5),_.Q6J("ngForOf",n.products),_.xp6(4),_.Q6J("ngForOf",n.products),_.xp6(4),_.Q6J("ngForOf",n.products),_.xp6(4),_.Q6J("ngForOf",n.products)}}var i_,r_=function(){var e=function(){function e(t,n){var i=this;M(this,e),this.router=t,this.productService=n,this.products=[],this.productService.compareItems.subscribe(function(e){return i.products=e})}return k(e,[{key:"ngOnInit",value:function(){}},{key:"addToCart",value:function(e){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.productService.addToCart(e,1);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}this.router.navigate(["/cart"]);case 5:case"end":return t.stop()}},t,this)}))}},{key:"removeItem",value:function(e){this.productService.removeCompareItem(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(Ee.F0),_.Y36(ox.M))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-compare"]],decls:8,vars:4,consts:[[3,"title","breadcrumb"],[1,"compare-padding"],[1,"container"],[1,"row"],[1,"col-sm-12"],[1,"compare-page"],["class","col-sm-12 empty-cart-cls text-center",4,"ngIf"],["class","table-wrapper table-responsive",4,"ngIf"],[1,"col-sm-12","empty-cart-cls","text-center"],["src","assets/images/empty-compare.png",1,"img-fluid","mb-4"],[1,"table-wrapper","table-responsive"],[1,"table"],[1,"th-compare"],["class","item-row",4,"ngFor","ngForOf"],["id","table-compare"],[1,"product-name"],["class","grid-link__title",4,"ngFor","ngForOf"],["class","available-stock",4,"ngFor","ngForOf"],[1,"item-row"],["type","button",1,"remove-compare",3,"click"],[1,"grid-link__title"],["width","185",1,"featured-image",3,"src","alt"],[1,"product-price","product_price"],[1,"variants","clearfix"],["title","Add to Cart",1,"add-to-cart","btn","btn-solid",3,"click"],[1,"description-compare"],[1,"available-stock"]],template:function(e,t){1&e&&(_._UZ(0,"app-breadcrumb",0),_.TgZ(1,"section",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"div",4),_.TgZ(5,"div",5),_.YNc(6,Xw,7,0,"div",6),_.YNc(7,n_,24,5,"div",7),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.Q6J("title","Compare")("breadcrumb","Compare"),_.xp6(6),_.Q6J("ngIf",!t.products.length),_.xp6(1),_.Q6J("ngIf",t.products.length))},directives:[Jw.L,y.O5,y.sg,I._Y,I.JL,I.F],pipes:[y.rS,y.H9,Yw.B],styles:[""]}),e}(),a_=new Uint8Array(16);function o_(){if(!i_&&!(i_="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i_(a_)}for(var s_=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,u_=function(e){return"string"==typeof e&&s_.test(e)},l_=[],c_=0;c_<256;++c_)l_.push((c_+256).toString(16).substr(1));var h_=function(e,t,n){var i=(e=e||{}).random||(e.rng||o_)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l_[e[t+0]]+l_[e[t+1]]+l_[e[t+2]]+l_[e[t+3]]+"-"+l_[e[t+4]]+l_[e[t+5]]+"-"+l_[e[t+6]]+l_[e[t+7]]+"-"+l_[e[t+8]]+l_[e[t+9]]+"-"+l_[e[t+10]]+l_[e[t+11]]+l_[e[t+12]]+l_[e[t+13]]+l_[e[t+14]]+l_[e[t+15]]).toLowerCase();if(!u_(n))throw TypeError("Stringified UUID is invalid");return n}(i)},p_=f(3530),d_=f(31615),f_=f(34166);function v_(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",45),_.TgZ(1,"p"),_._uU(2,"You need to login, to continue.. "),_.qZA(),_.TgZ(3,"button",46),_.NdJ("click",function(){return _.CHM(n),_.oxw().checkoutLogin()}),_._uU(4,"Login"),_.qZA(),_.qZA()}}function m_(e,t){1&e&&(_.TgZ(0,"div"),_._uU(1," Email is required. "),_.qZA())}function g_(e,t){1&e&&(_.TgZ(0,"div"),_._uU(1," Please enter a valid email. "),_.qZA())}function y_(e,t){if(1&e&&(_.TgZ(0,"div",47),_.YNc(1,m_,2,0,"div",48),_.YNc(2,g_,2,0,"div",48),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngIf",null==n.email.errors?null:n.email.errors.required),_.xp6(1),_.Q6J("ngIf",(null==n.email.errors?null:n.email.errors.email)||(null==n.email.errors?null:n.email.errors.pattern))}}function b_(e,t){1&e&&(_.TgZ(0,"div",49),_.TgZ(1,"h5",12),_._uU(2,"1. Shipping Address "),_.qZA(),_.qZA())}function x_(e,t){if(1&e&&_._UZ(0,"input",58),2&e){var n=_.oxw(),i=n.$implicit;_.MGl("id","userShippingAddressId",n.index,""),_.s9C("ngModel",i._id),_.s9C("value",i._id)}}function w_(e,t){if(1&e&&_._UZ(0,"input",59),2&e){var n=_.oxw(),i=n.$implicit;_.MGl("id","userShippingAddressId",n.index,""),_.s9C("value",i._id)}}function __(e,t){if(1&e&&(_.TgZ(0,"div",53),_.TgZ(1,"div",54),_.YNc(2,x_,1,3,"input",55),_.YNc(3,w_,1,2,"input",56),_.TgZ(4,"label",57),_.TgZ(5,"address"),_.TgZ(6,"h4"),_._uU(7),_.qZA(),_.TgZ(8,"p"),_._uU(9),_.qZA(),_.TgZ(10,"p"),_._uU(11),_.qZA(),_.TgZ(12,"p"),_._uU(13),_.qZA(),_.TgZ(14,"h5"),_._uU(15),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=t.$implicit,i=t.index;_.xp6(2),_.Q6J("ngIf",1==n.is_default),_.xp6(1),_.Q6J("ngIf",0==n.is_default||1!=n.is_default),_.xp6(1),_.MGl("for","userShippingAddressId",i,""),_.xp6(3),_.hij(" ",n.user_full_name," "),_.xp6(2),_.AsE("",n.addressline1,", ",n.addressline2,""),_.xp6(2),_.AsE("",n.city," - ",n.postal_code,""),_.xp6(2),_.Oqu(n.state),_.xp6(2),_.hij("Ph: ",n.mobile,"")}}function S_(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",5),_.YNc(1,__,16,10,"div",50),_.TgZ(2,"div",51),_.TgZ(3,"a",52),_.NdJ("click",function(){return _.CHM(n),_.oxw().checkaddress()}),_._uU(4,"Add New adress"),_.qZA(),_._UZ(5,"br"),_.qZA(),_.qZA()}if(2&e){var i=_.oxw();_.xp6(1),_.Q6J("ngForOf",i.useraddressslist)}}function M_(e,t){1&e&&(_.TgZ(0,"div",49),_.TgZ(1,"h5",12),_._uU(2,"2. Billing Address"),_.qZA(),_.qZA())}function T_(e,t){if(1&e&&_._UZ(0,"input",62),2&e){var n=_.oxw(),i=n.$implicit;_.MGl("id","userBillingAddressId",n.index,""),_.s9C("ngModel",i._id),_.s9C("value",i._id)}}function k_(e,t){if(1&e&&_._UZ(0,"input",63),2&e){var n=_.oxw(),i=n.$implicit;_.MGl("id","userBillingAddressId",n.index,""),_.s9C("value",i._id)}}function E_(e,t){if(1&e&&(_.TgZ(0,"div",53),_.TgZ(1,"div",54),_.YNc(2,T_,1,3,"input",60),_.YNc(3,k_,1,2,"input",61),_.TgZ(4,"label",57),_.TgZ(5,"address"),_.TgZ(6,"h4"),_._uU(7),_.qZA(),_.TgZ(8,"p"),_._uU(9),_.qZA(),_.TgZ(10,"p"),_._uU(11),_.qZA(),_.TgZ(12,"p"),_._uU(13),_.qZA(),_.TgZ(14,"h5"),_._uU(15),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e){var n=t.$implicit,i=t.index;_.xp6(2),_.Q6J("ngIf",1==n.is_default),_.xp6(1),_.Q6J("ngIf",0==n.is_default||1!=n.is_default),_.xp6(1),_.MGl("for","userBillingAddressId",i,""),_.xp6(3),_.hij(" ",n.user_full_name," "),_.xp6(2),_.AsE("",n.addressline1,", ",n.addressline2,""),_.xp6(2),_.AsE("",n.city," - ",n.postal_code,""),_.xp6(2),_.Oqu(n.state),_.xp6(2),_.hij("Ph: ",n.mobile,"")}}function A_(e,t){if(1&e){var n=_.EpF();_.TgZ(0,"div",5),_.YNc(1,E_,16,10,"div",50),_.TgZ(2,"div",51),_.TgZ(3,"a",52),_.NdJ("click",function(){return _.CHM(n),_.oxw().checkaddress()}),_._uU(4,"Add New adress"),_.qZA(),_._UZ(5,"br"),_.qZA(),_.qZA()}if(2&e){var i=_.oxw();_.xp6(1),_.Q6J("ngForOf",i.useraddressslist)}}function C_(e,t){if(1&e&&(_.TgZ(0,"span"),_._uU(1),_.ALo(2,"currency"),_.ALo(3,"currency"),_.qZA()),2&e){var n=_.oxw().$implicit,i=_.oxw(2);_.xp6(1),_.AsE(" ",_.Dn7(2,2,n.product_sale_price*(null==i.productService?null:i.productService.Currency.price),null==i.productService?null:i.productService.Currency.currency,"symbol")," + ",_.Dn7(3,6,n.addonsprice,null==i.productService?null:i.productService.Currency.currency,"symbol")," ")}}function O_(e,t){if(1&e&&(_.TgZ(0,"span"),_._uU(1),_.ALo(2,"currency"),_.ALo(3,"currency"),_.qZA()),2&e){var n=_.oxw().$implicit,i=_.oxw(2);_.xp6(1),_.AsE(" ",_.Dn7(2,2,n.product_retail_price*(null==i.productService?null:i.productService.Currency.price),null==i.productService?null:i.productService.Currency.currency,"symbol")," + ",_.Dn7(3,6,n.addonsprice,null==i.productService?null:i.productService.Currency.currency,"symbol")," ")}}function L_(e,t){if(1&e&&(_.TgZ(0,"li"),_._uU(1),_.YNc(2,C_,4,10,"span",48),_.YNc(3,O_,4,10,"span",48),_.qZA()),2&e){var n=t.$implicit;_.xp6(1),_.AsE(" ",n.product_name," \xd7 ",n.quantity," "),_.xp6(1),_.Q6J("ngIf",n.product_sale_price),_.xp6(1),_.Q6J("ngIf",null==n.product_sale_price)}}function R_(e,t){if(1&e&&(_.TgZ(0,"ul",64),_.YNc(1,L_,4,4,"li",65),_.qZA()),2&e){var n=_.oxw();_.xp6(1),_.Q6J("ngForOf",n.products)}}function P_(e,t){1&e&&(_.TgZ(0,"ul",64),_.TgZ(1,"li",66),_._uU(2," There are no products in cart "),_.qZA(),_.qZA())}function I_(e,t){if(1&e&&_._UZ(0,"ngx-paypal",67),2&e){var n=_.oxw();_.Q6J("config",n.payPalConfig)}}function N_(e,t){if(1&e&&(_.TgZ(0,"button",68),_._uU(1," Place Order "),_.qZA()),2&e){var n=_.oxw();_.Q6J("disabled",n.checkoutForm.invalid)}}function D_(e,t){1&e&&(_.TgZ(0,"span"),_._UZ(1,"i",71),_._uU(2," \xa0"),_.qZA())}function F_(e,t){if(1&e&&(_.TgZ(0,"div",69),_.TgZ(1,"div",70),_.YNc(2,D_,3,0,"span",48),_._uU(3),_.qZA(),_.qZA()),2&e){var n=_.oxw();_.Q6J("className",n.orderValid?"alert mt-3 alert-success":"alert mt-3 alert-danger"),_.xp6(2),_.Q6J("ngIf",n.orderValid),_.xp6(1),_.Oqu(n.orderMassage)}}JSON.parse(localStorage.products||"[]"),JSON.parse(localStorage.wishlistItems||"[]"),JSON.parse(localStorage.compareItems||"[]"),JSON.parse(localStorage.cartItems||"[]");var U_,B_,V_=function(){var e=function(){function e(t,n,i,r,a,o,s){M(this,e),this.fb=t,this.productService=n,this.userservice=i,this.orderService=r,this.route=a,this.router=o,this.toaster=s,this.products=[],this.payment="Stripe",this.useraddressslist=[],this.orderValid=!1,this.paypalstatus=!1,this.transactionId=0,this.isUserLogin=!0,this.paypalreurnData=[],this.local_checkout_obj={},this.product_not_available=[]}return k(e,[{key:"ngOnInit",value:function(){var e=this,t=JSON.parse(localStorage.getItem("currentUser"));this.email_=t.data.email,this.phone_=t.data.phone,this.userFuyllName=t.data.name,this.local_checkout_obj=JSON.parse(localStorage.getItem("checkoutform")),this.local_checkout_obj&&(this.email_=this.local_checkout_obj.email_address,this.phone_=this.local_checkout_obj.phone_no),localStorage.getItem("user_id")&&(this.isUserLogin=!1),this.productService.cartItems.subscribe(function(t){return e.products=t});var n,i=x(this.products);try{var r=function(){var t=n.value;e.productService.getproductsBySlugs(t.product_slug).pipe((0,p_.P)()).subscribe({next:function(n){n.data.stock-t.quantity<0&&n.data.product_name&&(e.toaster.error("".concat(n.data.product_name," is out of stock, please delete from cart to continue shoping")),e.router.navigateByUrl("stores/".concat(n.data.product_store.store_slug,"/").concat(n.data.product_department.department_slug,"/").concat(n.data.product_slug)))},error:function(e){},complete:function(){return console.info("Complete")}})};for(i.s();!(n=i.n()).done;)r()}catch(a){i.e(a)}finally{i.f()}this.getTotal.subscribe(function(t){return e.amount=t}),this.initConfig(),this.checkoutForm=new I.cw({phone:new I.NI(null,[I.kI.required]),email:new I.NI(null,[I.kI.required,I.kI.email,I.kI.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")]),paymentOption:new I.NI(null),userShippingAddressId:new I.NI(null,[I.kI.required]),userBillingAddressId:new I.NI(null,[I.kI.required])}),this.isUserLogin&&(this.checkoutForm.controls.phone.disable(),this.checkoutForm.controls.email.disable(),this.checkoutForm.controls.paymentOption.disable()),this.isUserLogin||this.getuserallAddressList()}},{key:"phone",get:function(){return this.checkoutForm.get("phone")}},{key:"email",get:function(){return this.checkoutForm.get("email")}},{key:"paymentOption",get:function(){return this.checkoutForm.get("paymentOption")}},{key:"userShippingAddressId",get:function(){return this.checkoutForm.get("userShippingAddressId")}},{key:"userBillingAddressId",get:function(){return this.checkoutForm.get("userBillingAddressId")}},{key:"getuserallAddressList",value:function(){var e=this;this.orderService.getAllAddress().subscribe(function(t){e.useraddressslist=t.data})}},{key:"getTotal",get:function(){return this.productService.cartTotalAmount()}},{key:"checkoutLogin",value:function(){this.router.navigate(["/login"],{queryParams:{returnUrl:"/checkout"}})}},{key:"checkaddress",value:function(){var e={email_address:document.getElementById("email_address").value,phone_no:document.getElementById("email_address").value};localStorage.setItem("checkoutform",JSON.stringify(e)),this.router.navigate(["/address"],{queryParams:{returnUrl:"/checkout"}})}},{key:"initConfig",value:function(){var e,t=this,n=[],i=x(this.products);try{for(i.s();!(e=i.n()).done;){var r=e.value;n.push({name:r.product_name,quantity:r.quantity,unit_amount:{currency_code:this.productService.Currency.currency,value:r.product_sale_price}})}}catch(a){i.e(a)}finally{i.f()}this.payPalConfig={currency:this.productService.Currency.currency,clientId:mw.N.paypal_token,createOrderOnClient:function(e){return{intent:"CAPTURE",purchase_units:[{amount:{currency_code:t.productService.Currency.currency,value:t.amount,breakdown:{item_total:{currency_code:t.productService.Currency.currency,value:t.amount}}},items:n}]}},advanced:{commit:"true"},style:{label:"paypal",layout:"vertical"},onApprove:function(e,n){n.order.get().then(function(e){t.transactionId=e.id,setTimeout(function(){t.placeorder()},1500),t.paypalreurnData=[{transaction_id:e.id,country_code:e.payer.address.country_code,email_address:e.payer.email_address,name:"".concat(e.payer.name.given_name," ").concat(e.payer.name.surname),customer_id_paypal:e.payer.payer_id,paypal_status:e.status}]})},onClientAuthorization:function(e){},onCancel:function(e,t){},onError:function(e){},onClick:function(e,t){}}}},{key:"getpaymentoption",value:function(e){"COD"==e.target.value&&(this.paypalstatus=!1);var t=this.checkoutForm.value;"paypal"==e.target.value&&this.useraddressslist.length>0&&null!=t.userShippingAddressId&&null!=t.userBillingAddressId&&(this.paypalstatus=!0)}},{key:"placeorder",value:function(){var e=this;if(localStorage.getItem("user_id")){if(this.products.length>0){var t=0,n="",i=this.checkoutForm.value;"COD"==i.paymentOption?(n="success",this.transactionId=h_()):(this.initConfig(),n="pending"),this.getTotal.subscribe(function(e){t=e});var r,a=[],o=x(this.products);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.push({product_id:s._id,product_name:s.product_name,product_image:s.product_image[0].pro_image,product_slug:s.product_slug,qty:s.quantity,price:s.product_sale_price,addons:s.addons,addonsprice:s.addonsprice})}}catch(p){o.e(p)}finally{o.f()}var u={};if("paypal"==i.paymentOption)u={total_order_amount:t,order_status:"initiated",payment_status:n,payment_method:i.paymentOption,transaction_id:this.transactionId,country_code:this.paypalreurnData[0].country_code,email_address:this.paypalreurnData[0].email_address,name:this.paypalreurnData[0].name,customer_id_paypal:this.paypalreurnData[0].customer_id_paypal,paypal_status:this.paypalreurnData[0].paypal_status,shipping_address_id:i.userShippingAddressId,billing_address_id:i.userBillingAddressId,billing_email:i.email,billing_phone:i.phone,order_details:a};else{if("COD"!=i.paymentOption)return void this.toaster.error("Please select a payment method");u={total_order_amount:t,order_status:"initiated",payment_status:n,payment_method:i.paymentOption,transaction_id:this.transactionId,country_code:"",email_address:i.email,name:this.userFuyllName,customer_id_paypal:"",paypal_status:"",shipping_address_id:i.userShippingAddressId,billing_address_id:i.userBillingAddressId,billing_email:i.email,billing_phone:i.phone,order_details:a}}var l,c=x(this.products);try{var h=function(){var t=l.value;e.productService.getproductsBySlugs(t.product_slug).pipe((0,p_.P)()).subscribe({next:function(n){n.data.stock-t.quantity<0&&n.data.product_name&&(e.toaster.error("".concat(n.data.product_name," is out of stock, please delete from cart to continue shoping")),e.router.navigateByUrl("stores/".concat(n.data.product_store.store_slug,"/").concat(n.data.product_department.department_slug,"/").concat(n.data.product_slug)))},error:function(e){},complete:function(){return console.info("Complete")}})};for(c.s();!(l=c.n()).done;)h()}catch(p){c.e(p)}finally{c.f()}this.orderService.userCreateOrder(u).subscribe(function(t){e.orderValid=!0,e.orderMassage="Your Order Placed successfully";var n,i=x(e.products);try{for(i.s();!(n=i.n()).done;){var r=n.value;e.productService.removeCartItem(r)}}catch(p){i.e(p)}finally{i.f()}e.userservice.setUserOrderid(t.data._id),setTimeout(function(){e.router.navigateByUrl("/order/success")},1e3)},function(t){e.toaster.error(t.error.message)})}}else this.router.navigate(["/login"],{queryParams:{returnUrl:"/checkout"}})}}]),e}();return e.\u0275fac=function(t){return new(t||e)(_.Y36(I.qu),_.Y36(ox.M),_.Y36(d_.K),_.Y36(f_.p),_.Y36(Ee.gz),_.Y36(Ee.F0),_.Y36(sx._W))},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-checkout"]],decls:83,vars:31,consts:[[1,"section-b-space"],[1,"container","padding-cls"],[1,"checkout-page"],[1,"checkout-form"],[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-sm-12"],[1,"title1","section-b-space"],["class","login-sec col-sm-12 pb-4",4,"ngIf"],[1,"col-lg-7","col-sm-12","col-xs-12"],[1,"checkout-title"],[1,"mb-1"],[1,"m-0"],[1,"form-group","col-md-6","col-sm-6","col-xs-12"],[1,"field-label"],["id","email_address","type","text","formControlName","email","placeholder","","autocomplete","off",3,"ngModel","ngModelChange"],["class","text text-danger mt-1",4,"ngIf"],["id","phone_no","type","text","formControlName","phone","placeholder","","autocomplete","off",3,"ngModel","ngModelChange"],[1,"col-12"],["activeIds","custom-panel-1"],["a","ngbAccordion"],["id","custom-panel-1"],["ngbPanelTitle",""],["ngbPanelContent",""],[1,"col-lg-5","col-sm-12","col-xs-12"],[1,"checkout-details"],[1,"order-box"],[1,"title-box"],["class","qty",4,"ngIf"],[1,"sub-total"],[1,"count"],[1,"total"],[1,"payment-box"],[1,"upper-box"],[1,"payment-options"],[1,"custom-control","custom-radio"],["type","radio","id","defaultUnchecked","name","paymentOption","value","COD","mdbInput","","formControlName","paymentOption",1,"custom-control-input",3,"click"],["for","defaultUnchecked",1,"custom-control-label"],["type","radio","id","defaultUnchecked1","name","paymentOption","value","paypal","mdbInput","","formControlName","paymentOption",1,"custom-control-input",3,"disabled","click"],["for","defaultUnchecked1",1,"custom-control-label"],["src","assets/images/paypal.png","alt","",1,"image","d-block"],[3,"config",4,"ngIf"],[1,"text-right"],["type","submit","class","btn-solid btn rounded-lg",3,"disabled",4,"ngIf"],["role","alert",3,"className",4,"ngIf"],[1,"login-sec","col-sm-12","pb-4"],["type","button",1,"btn","btn-solid","rounded-lg",3,"click"],[1,"text","text-danger","mt-1"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between"],["class","col-sm-6",4,"ngFor","ngForOf"],[1,"linkaddress"],[1,"add_address",3,"click"],[1,"col-sm-6"],[1,"radio-option","d-flex","align-items-start"],["type","radio","class","user_address_id","name","userShippingAddressId","formControlName","userShippingAddressId",3,"id","ngModel","value",4,"ngIf"],["type","radio","class","user_address_id","name","userShippingAddressId","formControlName","userShippingAddressId",3,"id","value",4,"ngIf"],[3,"for"],["type","radio","name","userShippingAddressId","formControlName","userShippingAddressId",1,"user_address_id",3,"id","ngModel","value"],["type","radio","name","userShippingAddressId","formControlName","userShippingAddressId",1,"user_address_id",3,"id","value"],["type","radio","class","user_address_id","name","userBillingAddressId","formControlName","userBillingAddressId",3,"id","ngModel","value",4,"ngIf"],["type","radio","class","user_address_id","name","userBillingAddressId","formControlName","userBillingAddressId",3,"id","value",4,"ngIf"],["type","radio","name","userBillingAddressId","formControlName","userBillingAddressId",1,"user_address_id",3,"id","ngModel","value"],["type","radio","name","userBillingAddressId","formControlName","userBillingAddressId",1,"user_address_id",3,"id","value"],[1,"qty"],[4,"ngFor","ngForOf"],[1,"empty-checkout"],[3,"config"],["type","submit",1,"btn-solid","btn","rounded-lg",3,"disabled"],["role","alert",3,"className"],[1,"d-flex","align-items-center"],[1,"fa","fa-spinner","fa-spin",2,"font-size","24px"]],template:function(e,t){1&e&&(_.TgZ(0,"section",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"form",4),_.NdJ("ngSubmit",function(){return t.placeorder()}),_.TgZ(5,"div",5),_.TgZ(6,"div",6),_.TgZ(7,"div",7),_.TgZ(8,"h2"),_._uU(9,"Checkout"),_.qZA(),_.qZA(),_.qZA(),_.YNc(10,v_,5,0,"div",8),_.TgZ(11,"div",9),_.TgZ(12,"div",10),_.TgZ(13,"h3"),_._uU(14,"Billing Details"),_.qZA(),_.TgZ(15,"p",11),_._uU(16,"Contact Information"),_.qZA(),_.TgZ(17,"p",12),_._uU(18,"We'll use these details to keep you inform on your delivery."),_.qZA(),_.qZA(),_.TgZ(19,"div",5),_.TgZ(20,"div",13),_.TgZ(21,"div",14),_._uU(22,"Email Address"),_.qZA(),_.TgZ(23,"input",15),_.NdJ("ngModelChange",function(e){return t.email_=e}),_.qZA(),_.YNc(24,y_,3,2,"div",16),_.qZA(),_.TgZ(25,"div",13),_.TgZ(26,"div",14),_._uU(27,"Phone"),_.qZA(),_.TgZ(28,"input",17),_.NdJ("ngModelChange",function(e){return t.phone_=e}),_.qZA(),_.qZA(),_.qZA(),_.TgZ(29,"div",5),_.TgZ(30,"div",18),_.TgZ(31,"ngb-accordion",19,20),_.TgZ(33,"ngb-panel",21),_.YNc(34,b_,3,0,"ng-template",22),_.YNc(35,S_,6,1,"ng-template",23),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(36,"div",5),_.TgZ(37,"div",18),_.TgZ(38,"ngb-accordion",19,20),_.TgZ(40,"ngb-panel",21),_.YNc(41,M_,3,0,"ng-template",22),_.YNc(42,A_,6,1,"ng-template",23),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(43,"div",24),_.TgZ(44,"div",25),_.TgZ(45,"div",26),_.TgZ(46,"div",27),_.TgZ(47,"div"),_._uU(48,"Product "),_.TgZ(49,"span"),_._uU(50," Total"),_.qZA(),_.qZA(),_.qZA(),_.YNc(51,R_,2,1,"ul",28),_.YNc(52,P_,3,0,"ul",28),_.TgZ(53,"ul",29),_.TgZ(54,"li"),_._uU(55," Subtotal "),_.TgZ(56,"span",30),_._uU(57),_.ALo(58,"currency"),_.ALo(59,"async"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(60,"ul",31),_.TgZ(61,"li"),_._uU(62,"Estimated Total "),_.TgZ(63,"span",30),_._uU(64),_.ALo(65,"currency"),_.ALo(66,"async"),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.TgZ(67,"div",32),_.TgZ(68,"div",33),_.TgZ(69,"div",34),_.TgZ(70,"div",35),_.TgZ(71,"input",36),_.NdJ("click",function(e){return t.getpaymentoption(e)}),_.qZA(),_.TgZ(72,"label",37),_._uU(73,"Cash On Delivery"),_.qZA(),_.qZA(),_.TgZ(74,"div",35),_.TgZ(75,"input",38),_.NdJ("click",function(e){return t.getpaymentoption(e)}),_.qZA(),_.TgZ(76,"label",39),_._uU(77,"Paypal"),_.qZA(),_._UZ(78,"img",40),_.qZA(),_.YNc(79,I_,1,1,"ngx-paypal",41),_.qZA(),_.qZA(),_.TgZ(80,"div",42),_.YNc(81,N_,2,1,"button",43),_.YNc(82,F_,4,3,"div",44),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(4),_.Q6J("formGroup",t.checkoutForm),_.xp6(6),_.Q6J("ngIf",t.isUserLogin),_.xp6(1),_.ekj("desabledform",t.isUserLogin),_.xp6(12),_.Q6J("ngModel",t.email_),_.xp6(1),_.Q6J("ngIf",t.email.invalid&&(t.email.dirty||t.email.touched)),_.xp6(4),_.Q6J("ngModel",t.phone_),_.xp6(15),_.ekj("desabledform",t.isUserLogin),_.xp6(1),_.ekj("desabledform",t.checkoutForm.invalid),_.xp6(7),_.Q6J("ngIf",t.products.length),_.xp6(1),_.Q6J("ngIf",!t.products.length),_.xp6(5),_.Oqu(_.Dn7(58,19,_.lcZ(59,23,t.getTotal),null==t.productService?null:t.productService.Currency.currency,"symbol")),_.xp6(7),_.Oqu(_.Dn7(65,25,_.lcZ(66,29,t.getTotal),null==t.productService?null:t.productService.Currency.currency,"symbol")),_.xp6(11),_.Q6J("disabled",t.checkoutForm.invalid),_.xp6(4),_.Q6J("ngIf",t.paypalstatus),_.xp6(2),_.Q6J("ngIf",!t.paypalstatus),_.xp6(1),_.Q6J("ngIf",t.orderValid))},directives:[I._Y,I.JL,I.sg,y.O5,I.Fj,I.JJ,I.u,dx.gY,dx.Gk,dx.Cu,dx.gW,I._,y.sg,C],pipes:[y.H9,y.Ov],styles:["address[_ngcontent-%COMP%]{padding-left:10px}.desabledform[_ngcontent-%COMP%]{opacity:.4}.add_address[_ngcontent-%COMP%]{text-decoration:underline;color:#007bff;cursor:pointer}"]}),e}(),H_=function(){var e=function(){function e(){M(this,e),this.modelSrc="https://ralbaassetstorage.s3.us-east-2.amazonaws.com/product/pro-1698997429.glb"}return k(e,[{key:"ngOnInit",value:function(){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-video-mode"]],decls:10,vars:0,consts:[["id","video-data",1,"example-container"],["mindar-face","","embedded","","color-space","sRGB","renderer","colorManagement: true, physicallyCorrectLights","vr-mode-ui","enabled: false","device-orientation-permission-ui","enabled: false"],["id","headModel","src","assets/images/headOccluder.glb"],["id","glassesModel","src","assets/images/pro-1698997429.glb"],["fov","80","position","0 1.6 0"],["mindar-face-target","anchorIndex: 168"],["mindar-face-occluder","","position","0 -0.3 0.15","rotation","0 0 0","scale","0.065 0.065 0.065","src","#headModel"],["rotation","0 -0 0","position","0 -.1 0","scale",".80 .80 .80","src","#glassesModel",1,"glasses1-entity"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"a-scene",1),_.TgZ(2,"a-assets"),_._UZ(3,"a-asset-item",2),_._UZ(4,"a-asset-item",3),_.qZA(),_._UZ(5,"a-camera",4),_.TgZ(6,"a-entity",5),_._UZ(7,"a-gltf-model",6),_.qZA(),_.TgZ(8,"a-entity",5),_._UZ(9,"a-gltf-model",7),_.qZA(),_.qZA(),_.qZA())},styles:[""]}),e}(),z_=function(){var e=function(){function e(){M(this,e),this.imageUrl=null,this.isVideo=!1,this.model=null,this.cameraFrame=null,this.detectFace=!1,this.clearMask=!1,this.maskOnImage=!1,this.masks=[],this.maskKeyPointIndexs=[10,234,152,454]}return k(e,[{key:"ngOnInit",value:function(){this.canvasElement=document.getElementById("canvas"),this.imageElement=document.getElementById("faces"),this.selectedMask=document.querySelector(".selected-mask img")}},{key:"onFileSelected",value:function(e){var t=this,n=e.target.files[0];n&&(this.readFile(n),setTimeout(function(){t.startFacemask()},2e3))}},{key:"startFacemask",value:function(){var e=this;this.startFaceMask().then(function(){e.maskOnImage=!0,e.detectFaces()})}},{key:"readFile",value:function(e){var t=this,n=new FileReader;n.onload=function(){t.imageUrl=n.result},n.readAsDataURL(e)}},{key:"startFaceMask",value:function(){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){return(0,Ae.mG)(t,void 0,void 0,regeneratorRuntime.mark(function t(){var n,i,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(n=document.querySelector(".loading"))||void 0===n||n.classList.remove("d-none"),null!=this.model){t.next=13;break}return t.next=4,faceLandmarksDetection.load(faceLandmarksDetection.SupportedPackages.mediapipeFacemesh);case 4:return this.model=t.sent,console.log("model loaded"),t.next=8,this.detectFaces();case 8:this.cameraFrame=t.sent,null===(i=document.querySelector(".loading"))||void 0===i||i.classList.add("d-none"),e(),t.next=20;break;case 13:if(t.t0=this.isVideo,t.t0){t.next=20;break}return t.next=17,this.detectFaces();case 17:this.cameraFrame=t.sent,null===(r=document.querySelector(".loading"))||void 0===r||r.classList.add("d-none"),e();case 20:case"end":return t.stop()}},t,this)}))}));case 1:case"end":return e.stop()}},e)}))}},{key:"detectFaces",value:function(){return(0,Ae.mG)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.imageElement,n=this.isVideo,console.log("model ",this.model.estimateFaces),console.log("inputElement ",t),e.next=4,this.model.estimateFaces({input:t,returnTensors:!1,flipHorizontal:n,predictIrises:!1});case 4:i=e.sent,console.log("predictions ",i),r=i.filter(function(e){return e.faceInViewConfidence>.5}),this.drawMask(r),this.clearMask&&(this.clearCanvas(),this.clearMask=!1),this.detectFace&&(this.cameraFrame=requestAnimationFrame(this.detectFaces));case 8:case"end":return e.stop()}},e,this)}))}},{key:"drawMask",value:function(e){this.masks.length!==e.length&&this.clearCanvas();var t=this.isVideo?3:1,n=this.isVideo?1:3;if(e.length>0)for(var i=0;i<e.length;i++){var r,a,o,s,u,l,c,h=e[i].scaledMesh,p=void 0,d=void 0,f=void 0,v=void 0;this.masks.length>i?(p=this.masks[i].keypoints,d=this.masks[i].maskElement):(p=[],(d=document.createElement("img")).src=this.selectedMask.src,d.id="mask_".concat(i),d.classList.add("mask"),this.masks.push({keypoints:p,maskElement:d}),this.canvasElement.appendChild(d));for(var m=0;m<this.maskKeyPointIndexs.length;m++){var g=this.getCoordinate(h[this.maskKeyPointIndexs[m]][0],h[this.maskKeyPointIndexs[m]][1]),y=void 0;if(p.length>m)y=p[m];else{var b=document.createElement("div");b.classList.add("dot"),y={top:0,left:0,element:b},p.push(y),this.canvasElement.appendChild(b)}y.left=g[0],y.top=g[1],y.element.style.top="".concat(y.top,"px"),y.element.style.left="".concat(y.left,"px"),y.element.style.position="absolute"}switch(this.selectedMask.getAttribute("data-mask-type")){case"eye":case"full":f={top:p[0].top,left:p[t].left},v=p[2].top-p[0].top;break;case"half":default:f=p[t],v=p[2].top-p[t].top}r=p[n].left-p[t].left,a=parseFloat(this.selectedMask.getAttribute("data-scale-width")||"0"),o=parseFloat(this.selectedMask.getAttribute("data-scale-height")||"0"),s=parseFloat(this.selectedMask.getAttribute("data-top-adj")||"0"),u=this.isVideo?parseFloat(this.selectedMask.getAttribute("data-left-adj")||"0"):0,l=f.top-v*(o-1)/2-v*s,c=f.left-r*(a-1)/2-r*u,d.style.top="".concat(l,"px"),d.style.left="".concat(c,"px"),d.style.width=r*a+"px",d.style.height=v*o+"px",d.style.position="absolute"}}},{key:"getCoordinate",value:function(e,t){return[e,t]}},{key:"clearCanvas",value:function(){for(;this.canvasElement.firstChild;)this.canvasElement.removeChild(this.canvasElement.lastChild);this.masks=[]}},{key:"switchSource",value:function(){var e;this.canvasElement.style.transform="";var t=document.getElementById("image-container");null===(e=document.getElementById("button-control"))||void 0===e||e.classList.remove("d-none"),this.canvasElement.style.width="".concat(this.imageElement.clientWidth,"px"),this.canvasElement.style.height="".concat(this.imageElement.clientHeight,"px"),t.appendChild(this.canvasElement),t.appendChild(document.querySelector(".loading")),t.appendChild(document.getElementById("mask-slider")),this.clearCanvas()}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=_.Xpm({type:e,selectors:[["app-image-mode"]],decls:18,vars:2,consts:[[1,"upload-section","text-center","align-items-center","justify-content-center",3,"ngClass"],["type","file","accept","image/*",3,"change"],["id","face-mask-app"],["id","image-container"],["id","faces",3,"src"],["id","canvas"],[1,"loading","d-none"],["role","status",1,"spinner-border"],[1,"sr-only"],["id","mask-slider",2,"display","none"],["id","arrowLeft","src","assets/images/arrow-left.png"],["id","mask-list"],[1,"selected-mask"],["src","assets/images/eyeglass.png","data-mask-type","eye","data-scale-width","1.1","data-scale-height",".3","data-top-adj","0.15","data-left-adj",".7",1,"full-mask"],["id","arrowRight","src","assets/images/arrow-right.png"],[1,"md-overlay"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"input",1),_.NdJ("change",function(e){return t.onFileSelected(e)}),_.qZA(),_.qZA(),_.TgZ(2,"main",2),_.TgZ(3,"div",3),_._UZ(4,"img",4),_._UZ(5,"div",5),_.TgZ(6,"div",6),_._uU(7," Loading Model "),_.TgZ(8,"div",7),_._UZ(9,"span",8),_.qZA(),_.qZA(),_.TgZ(10,"div",9),_._UZ(11,"img",10),_.TgZ(12,"div",11),_.TgZ(13,"ul"),_.TgZ(14,"li",12),_._UZ(15,"img",13),_.qZA(),_.qZA(),_.qZA(),_._UZ(16,"img",14),_.qZA(),_.qZA(),_._UZ(17,"div",15),_.qZA()),2&e&&(_.Q6J("ngClass",t.imageUrl?"d-none":""),_.xp6(4),_.s9C("src",t.imageUrl,_.LSH))},directives:[y.mk],styles:[".loading[_ngcontent-%COMP%], img[_ngcontent-%COMP%]{width:100%}.loading[_ngcontent-%COMP%]{height:100%;position:absolute;top:0;left:0;display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px}.spinner-border[_ngcontent-%COMP%]{width:15rem;height:15rem;position:absolute}.upload-section[_ngcontent-%COMP%]{min-height:270px;display:flex}.upload-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#f9f9f9;border-radius:12px;padding:5px}.upload-section[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::file-selector-button{font-weight:700;color:#fff;padding:.5em;background-color:#1b7cbf;border:none;border-radius:10px}"]}),e}(),Z_=[{path:"product/:slug",component:vw},{path:"tryon",component:(U_=function(){function e(){M(this,e),this.mode="video"}return k(e,[{key:"ngOnInit",value:function(){}},{key:"modeChage",value:function(e){this.mode=e,console.log("this.mode",this.mode)}}]),e}(),U_.\u0275fac=function(e){return new(e||U_)},U_.\u0275cmp=_.Xpm({type:U_,selectors:[["app-tryon"]],decls:13,vars:4,consts:[[1,"container"],[1,"row","row-centered","justify-content-center"],[1,"col-md-12","col-centered"],[1,"d-flex","align-items-center","justify-content-center","mb-3"],[1,"btn","btn-solid","rounded-lg","virtual_btn","mr-3",3,"ngClass","click"],[1,"btn","btn-solid","rounded-lg","virtual_btn",3,"ngClass","click"],[1,"col-md-9","col-centered"],[1,"video-section",3,"ngClass"],[1,"image-section",3,"ngClass"]],template:function(e,t){1&e&&(_.TgZ(0,"div",0),_.TgZ(1,"div",1),_.TgZ(2,"div",2),_.TgZ(3,"div",3),_.TgZ(4,"button",4),_.NdJ("click",function(){return t.modeChage("video")}),_._uU(5," Video Mode"),_.qZA(),_.TgZ(6,"button",5),_.NdJ("click",function(){return t.modeChage("image")}),_._uU(7,"Image Mode"),_.qZA(),_.qZA(),_.qZA(),_.TgZ(8,"div",6),_.TgZ(9,"div",7),_._UZ(10,"app-video-mode"),_.qZA(),_.TgZ(11,"div",8),_._UZ(12,"app-image-mode"),_.qZA(),_.qZA(),_.qZA(),_.qZA()),2&e&&(_.xp6(4),_.Q6J("ngClass","video"==t.mode?"active":""),_.xp6(2),_.Q6J("ngClass","image"==t.mode?"active":""),_.xp6(3),_.Q6J("ngClass","video"==t.mode?"d-block":"d-none"),_.xp6(2),_.Q6J("ngClass","image"==t.mode?"d-block":"d-none"))},directives:[y.mk,H_,z_],styles:[".image-section[_ngcontent-%COMP%], .video-section[_ngcontent-%COMP%]{background-color:#d3d3d3;border-radius:15px;min-height:300px;position:relative;overflow:hidden}.video-section[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{left:0!important}.active[_ngcontent-%COMP%]{background:#fff;color:#000}"]}),U_)},{path:"live-video",component:H_},{path:"2d-products/:slug/:page",component:Pw},{path:"cart",component:Bw,canActivate:[ke.a]},{path:"wishlist",component:Ww,canActivate:[ke.a]},{path:"compare",component:r_},{path:"checkout",component:V_,canActivate:[ke.a]},{path:"settings-header",component:Te.f}],G_=function(){var e=function e(){M(this,e)};return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=_.oAB({type:e}),e.\u0275inj=_.cJS({imports:[[Ee.Bz.forChild(Z_)],Ee.Bz]}),e}(),j_=((B_=function e(){M(this,e)}).\u0275fac=function(e){return new(e||B_)},B_.\u0275mod=_.oAB({type:B_}),B_.\u0275inj=_.cJS({imports:[[y.ez,O,_e,Se,Me.m,G_,gx.L]]}),B_)}}])}();